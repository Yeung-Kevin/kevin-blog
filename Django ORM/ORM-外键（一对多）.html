<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ORM-外键（一对多） | Kevin-Blog</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/kevin-blog/logo.png">
    <meta name="description" content="">
    <link rel="preload" href="/kevin-blog/assets/css/0.styles.267bc68b.css" as="style"><link rel="preload" href="/kevin-blog/assets/js/app.dd46475d.js" as="script"><link rel="preload" href="/kevin-blog/assets/js/2.97d04891.js" as="script"><link rel="preload" href="/kevin-blog/assets/js/13.e55a4126.js" as="script"><link rel="prefetch" href="/kevin-blog/assets/js/10.2b686438.js"><link rel="prefetch" href="/kevin-blog/assets/js/100.cfc5acd5.js"><link rel="prefetch" href="/kevin-blog/assets/js/101.628bd39e.js"><link rel="prefetch" href="/kevin-blog/assets/js/102.41585307.js"><link rel="prefetch" href="/kevin-blog/assets/js/103.5d18350a.js"><link rel="prefetch" href="/kevin-blog/assets/js/104.85cd65cf.js"><link rel="prefetch" href="/kevin-blog/assets/js/105.9d303bac.js"><link rel="prefetch" href="/kevin-blog/assets/js/106.73f6a263.js"><link rel="prefetch" href="/kevin-blog/assets/js/107.9dfe114c.js"><link rel="prefetch" href="/kevin-blog/assets/js/108.315e8c63.js"><link rel="prefetch" href="/kevin-blog/assets/js/109.ef21ffa0.js"><link rel="prefetch" href="/kevin-blog/assets/js/11.2b0f6358.js"><link rel="prefetch" href="/kevin-blog/assets/js/110.dfe062a3.js"><link rel="prefetch" href="/kevin-blog/assets/js/111.08f0c3e7.js"><link rel="prefetch" href="/kevin-blog/assets/js/112.0e180f10.js"><link rel="prefetch" href="/kevin-blog/assets/js/113.295f1fca.js"><link rel="prefetch" href="/kevin-blog/assets/js/114.5645d09d.js"><link rel="prefetch" href="/kevin-blog/assets/js/115.ebe19212.js"><link rel="prefetch" href="/kevin-blog/assets/js/116.b3eb5cab.js"><link rel="prefetch" href="/kevin-blog/assets/js/117.076c6372.js"><link rel="prefetch" href="/kevin-blog/assets/js/118.226fb513.js"><link rel="prefetch" href="/kevin-blog/assets/js/119.298c0302.js"><link rel="prefetch" href="/kevin-blog/assets/js/12.01390043.js"><link rel="prefetch" href="/kevin-blog/assets/js/120.943d0d71.js"><link rel="prefetch" href="/kevin-blog/assets/js/121.2d1bd8ef.js"><link rel="prefetch" href="/kevin-blog/assets/js/122.84b9dff1.js"><link rel="prefetch" href="/kevin-blog/assets/js/123.85d93d87.js"><link rel="prefetch" href="/kevin-blog/assets/js/124.4913aefd.js"><link rel="prefetch" href="/kevin-blog/assets/js/125.cf667169.js"><link rel="prefetch" href="/kevin-blog/assets/js/126.eefd3250.js"><link rel="prefetch" href="/kevin-blog/assets/js/127.f9697daf.js"><link rel="prefetch" href="/kevin-blog/assets/js/128.aff6033d.js"><link rel="prefetch" href="/kevin-blog/assets/js/129.fa7ec9a8.js"><link rel="prefetch" href="/kevin-blog/assets/js/130.9d50b78d.js"><link rel="prefetch" href="/kevin-blog/assets/js/131.f384aa34.js"><link rel="prefetch" href="/kevin-blog/assets/js/132.e60091dc.js"><link rel="prefetch" href="/kevin-blog/assets/js/133.09a9de16.js"><link rel="prefetch" href="/kevin-blog/assets/js/134.a7739a99.js"><link rel="prefetch" href="/kevin-blog/assets/js/135.bea491db.js"><link rel="prefetch" href="/kevin-blog/assets/js/136.92af3a82.js"><link rel="prefetch" href="/kevin-blog/assets/js/137.dbda7b02.js"><link rel="prefetch" href="/kevin-blog/assets/js/138.9fea4ca4.js"><link rel="prefetch" href="/kevin-blog/assets/js/139.0a81aff9.js"><link rel="prefetch" href="/kevin-blog/assets/js/14.efd69f3b.js"><link rel="prefetch" href="/kevin-blog/assets/js/140.3f048218.js"><link rel="prefetch" href="/kevin-blog/assets/js/141.002d7568.js"><link rel="prefetch" href="/kevin-blog/assets/js/142.aec10062.js"><link rel="prefetch" href="/kevin-blog/assets/js/143.2e682c5b.js"><link rel="prefetch" href="/kevin-blog/assets/js/144.d05092f0.js"><link rel="prefetch" href="/kevin-blog/assets/js/145.358437b8.js"><link rel="prefetch" href="/kevin-blog/assets/js/146.af219f24.js"><link rel="prefetch" href="/kevin-blog/assets/js/147.061cb5fe.js"><link rel="prefetch" href="/kevin-blog/assets/js/148.422d1f87.js"><link rel="prefetch" href="/kevin-blog/assets/js/149.c97f27f4.js"><link rel="prefetch" href="/kevin-blog/assets/js/15.271f58eb.js"><link rel="prefetch" href="/kevin-blog/assets/js/150.177533a9.js"><link rel="prefetch" href="/kevin-blog/assets/js/151.d70f314c.js"><link rel="prefetch" href="/kevin-blog/assets/js/152.ca40e6fc.js"><link rel="prefetch" href="/kevin-blog/assets/js/153.a2bca317.js"><link rel="prefetch" href="/kevin-blog/assets/js/154.22edbf9f.js"><link rel="prefetch" href="/kevin-blog/assets/js/155.e59b2d87.js"><link rel="prefetch" href="/kevin-blog/assets/js/156.d5a38de8.js"><link rel="prefetch" href="/kevin-blog/assets/js/157.cbe5199a.js"><link rel="prefetch" href="/kevin-blog/assets/js/158.31c5b8b2.js"><link rel="prefetch" href="/kevin-blog/assets/js/159.0763ed0c.js"><link rel="prefetch" href="/kevin-blog/assets/js/16.e92cdd55.js"><link rel="prefetch" href="/kevin-blog/assets/js/160.a05ced02.js"><link rel="prefetch" href="/kevin-blog/assets/js/161.7e52ed13.js"><link rel="prefetch" href="/kevin-blog/assets/js/162.f5df7208.js"><link rel="prefetch" href="/kevin-blog/assets/js/163.78a78de8.js"><link rel="prefetch" href="/kevin-blog/assets/js/164.54fd347c.js"><link rel="prefetch" href="/kevin-blog/assets/js/165.a0347ed3.js"><link rel="prefetch" href="/kevin-blog/assets/js/166.0702e96e.js"><link rel="prefetch" href="/kevin-blog/assets/js/167.69136cd0.js"><link rel="prefetch" href="/kevin-blog/assets/js/168.d0aa7e0d.js"><link rel="prefetch" href="/kevin-blog/assets/js/169.6229f0ca.js"><link rel="prefetch" href="/kevin-blog/assets/js/17.9a006e5d.js"><link rel="prefetch" href="/kevin-blog/assets/js/170.b6571721.js"><link rel="prefetch" href="/kevin-blog/assets/js/171.600f9683.js"><link rel="prefetch" href="/kevin-blog/assets/js/172.6e1792a7.js"><link rel="prefetch" href="/kevin-blog/assets/js/173.cef126b3.js"><link rel="prefetch" href="/kevin-blog/assets/js/174.97b3e897.js"><link rel="prefetch" href="/kevin-blog/assets/js/175.fcefca30.js"><link rel="prefetch" href="/kevin-blog/assets/js/176.31862a66.js"><link rel="prefetch" href="/kevin-blog/assets/js/177.089b09c0.js"><link rel="prefetch" href="/kevin-blog/assets/js/178.a5dcd25c.js"><link rel="prefetch" href="/kevin-blog/assets/js/179.a9d685f2.js"><link rel="prefetch" href="/kevin-blog/assets/js/18.a1c24192.js"><link rel="prefetch" href="/kevin-blog/assets/js/180.4ad69266.js"><link rel="prefetch" href="/kevin-blog/assets/js/181.691d48a2.js"><link rel="prefetch" href="/kevin-blog/assets/js/182.e77aa679.js"><link rel="prefetch" href="/kevin-blog/assets/js/183.2b4341f4.js"><link rel="prefetch" href="/kevin-blog/assets/js/184.b3610e8b.js"><link rel="prefetch" href="/kevin-blog/assets/js/185.08107897.js"><link rel="prefetch" href="/kevin-blog/assets/js/186.9f5a3f65.js"><link rel="prefetch" href="/kevin-blog/assets/js/187.ac2fe2c2.js"><link rel="prefetch" href="/kevin-blog/assets/js/188.09023a78.js"><link rel="prefetch" href="/kevin-blog/assets/js/189.409b4ed0.js"><link rel="prefetch" href="/kevin-blog/assets/js/19.c733cdfe.js"><link rel="prefetch" href="/kevin-blog/assets/js/190.ca5d775c.js"><link rel="prefetch" href="/kevin-blog/assets/js/191.8052fe42.js"><link rel="prefetch" href="/kevin-blog/assets/js/192.31ebe059.js"><link rel="prefetch" href="/kevin-blog/assets/js/193.9bf32e11.js"><link rel="prefetch" href="/kevin-blog/assets/js/194.0667554a.js"><link rel="prefetch" href="/kevin-blog/assets/js/195.ea249ba4.js"><link rel="prefetch" href="/kevin-blog/assets/js/196.6278ec5a.js"><link rel="prefetch" href="/kevin-blog/assets/js/197.90f6af7b.js"><link rel="prefetch" href="/kevin-blog/assets/js/198.2e358b6a.js"><link rel="prefetch" href="/kevin-blog/assets/js/199.a0bd0085.js"><link rel="prefetch" href="/kevin-blog/assets/js/20.890583ea.js"><link rel="prefetch" href="/kevin-blog/assets/js/200.bc1e237a.js"><link rel="prefetch" href="/kevin-blog/assets/js/201.767e166e.js"><link rel="prefetch" href="/kevin-blog/assets/js/202.a52f0e94.js"><link rel="prefetch" href="/kevin-blog/assets/js/203.06f0ebab.js"><link rel="prefetch" href="/kevin-blog/assets/js/204.7ae45191.js"><link rel="prefetch" href="/kevin-blog/assets/js/205.b8412fbc.js"><link rel="prefetch" href="/kevin-blog/assets/js/206.682f9a3e.js"><link rel="prefetch" href="/kevin-blog/assets/js/207.8978346c.js"><link rel="prefetch" href="/kevin-blog/assets/js/208.35db8c05.js"><link rel="prefetch" href="/kevin-blog/assets/js/209.1eebeab0.js"><link rel="prefetch" href="/kevin-blog/assets/js/21.48328b6a.js"><link rel="prefetch" href="/kevin-blog/assets/js/210.b56db64f.js"><link rel="prefetch" href="/kevin-blog/assets/js/211.31da36f5.js"><link rel="prefetch" href="/kevin-blog/assets/js/212.2f2d2d1f.js"><link rel="prefetch" href="/kevin-blog/assets/js/213.be55b8cc.js"><link rel="prefetch" href="/kevin-blog/assets/js/214.aeffc247.js"><link rel="prefetch" href="/kevin-blog/assets/js/215.137bae15.js"><link rel="prefetch" href="/kevin-blog/assets/js/216.2692c636.js"><link rel="prefetch" href="/kevin-blog/assets/js/217.a6a9cf62.js"><link rel="prefetch" href="/kevin-blog/assets/js/218.7353ed7a.js"><link rel="prefetch" href="/kevin-blog/assets/js/219.f1fdfe8e.js"><link rel="prefetch" href="/kevin-blog/assets/js/22.5fd865e7.js"><link rel="prefetch" href="/kevin-blog/assets/js/220.e20ab2b5.js"><link rel="prefetch" href="/kevin-blog/assets/js/221.0d06c8b0.js"><link rel="prefetch" href="/kevin-blog/assets/js/222.e39491a9.js"><link rel="prefetch" href="/kevin-blog/assets/js/223.ae98df72.js"><link rel="prefetch" href="/kevin-blog/assets/js/224.4ba5d334.js"><link rel="prefetch" href="/kevin-blog/assets/js/225.913ee059.js"><link rel="prefetch" href="/kevin-blog/assets/js/226.b8d730bd.js"><link rel="prefetch" href="/kevin-blog/assets/js/227.69ee92e2.js"><link rel="prefetch" href="/kevin-blog/assets/js/228.1cf17cff.js"><link rel="prefetch" href="/kevin-blog/assets/js/229.6ce44fac.js"><link rel="prefetch" href="/kevin-blog/assets/js/23.9ef4ab20.js"><link rel="prefetch" href="/kevin-blog/assets/js/230.30c28e05.js"><link rel="prefetch" href="/kevin-blog/assets/js/231.ef327150.js"><link rel="prefetch" href="/kevin-blog/assets/js/232.6cb791d8.js"><link rel="prefetch" href="/kevin-blog/assets/js/233.473fa94b.js"><link rel="prefetch" href="/kevin-blog/assets/js/234.848de787.js"><link rel="prefetch" href="/kevin-blog/assets/js/235.f5db4ed9.js"><link rel="prefetch" href="/kevin-blog/assets/js/236.5da3f87c.js"><link rel="prefetch" href="/kevin-blog/assets/js/237.018a543d.js"><link rel="prefetch" href="/kevin-blog/assets/js/238.74d22845.js"><link rel="prefetch" href="/kevin-blog/assets/js/239.fca187a6.js"><link rel="prefetch" href="/kevin-blog/assets/js/24.3dff5faa.js"><link rel="prefetch" href="/kevin-blog/assets/js/240.0dbbfe84.js"><link rel="prefetch" href="/kevin-blog/assets/js/241.8b1ccf29.js"><link rel="prefetch" href="/kevin-blog/assets/js/242.f5216a9f.js"><link rel="prefetch" href="/kevin-blog/assets/js/243.8e5c5e34.js"><link rel="prefetch" href="/kevin-blog/assets/js/244.8f78ae9a.js"><link rel="prefetch" href="/kevin-blog/assets/js/245.e0b2e7b9.js"><link rel="prefetch" href="/kevin-blog/assets/js/246.7700207e.js"><link rel="prefetch" href="/kevin-blog/assets/js/247.c1e13b57.js"><link rel="prefetch" href="/kevin-blog/assets/js/248.63d6adf8.js"><link rel="prefetch" href="/kevin-blog/assets/js/249.500fdd00.js"><link rel="prefetch" href="/kevin-blog/assets/js/25.0ebddc27.js"><link rel="prefetch" href="/kevin-blog/assets/js/250.ebbb5c92.js"><link rel="prefetch" href="/kevin-blog/assets/js/251.4e51605e.js"><link rel="prefetch" href="/kevin-blog/assets/js/252.2534bb33.js"><link rel="prefetch" href="/kevin-blog/assets/js/253.330d0073.js"><link rel="prefetch" href="/kevin-blog/assets/js/254.da99904b.js"><link rel="prefetch" href="/kevin-blog/assets/js/255.f9a1774e.js"><link rel="prefetch" href="/kevin-blog/assets/js/256.7ee8ac66.js"><link rel="prefetch" href="/kevin-blog/assets/js/257.41594669.js"><link rel="prefetch" href="/kevin-blog/assets/js/258.9d8beffc.js"><link rel="prefetch" href="/kevin-blog/assets/js/259.1539043a.js"><link rel="prefetch" href="/kevin-blog/assets/js/26.7e91ac9d.js"><link rel="prefetch" href="/kevin-blog/assets/js/260.034695f0.js"><link rel="prefetch" href="/kevin-blog/assets/js/261.953910a0.js"><link rel="prefetch" href="/kevin-blog/assets/js/262.e2b0764f.js"><link rel="prefetch" href="/kevin-blog/assets/js/263.fe9b0b70.js"><link rel="prefetch" href="/kevin-blog/assets/js/264.489e20f7.js"><link rel="prefetch" href="/kevin-blog/assets/js/265.43596b34.js"><link rel="prefetch" href="/kevin-blog/assets/js/266.07bb7008.js"><link rel="prefetch" href="/kevin-blog/assets/js/267.5caf5b93.js"><link rel="prefetch" href="/kevin-blog/assets/js/268.fc6e09e2.js"><link rel="prefetch" href="/kevin-blog/assets/js/269.764500c0.js"><link rel="prefetch" href="/kevin-blog/assets/js/27.55c7093f.js"><link rel="prefetch" href="/kevin-blog/assets/js/270.9760648a.js"><link rel="prefetch" href="/kevin-blog/assets/js/271.019b1f9a.js"><link rel="prefetch" href="/kevin-blog/assets/js/272.bce07ec6.js"><link rel="prefetch" href="/kevin-blog/assets/js/273.038ff1e3.js"><link rel="prefetch" href="/kevin-blog/assets/js/274.2cb7fd59.js"><link rel="prefetch" href="/kevin-blog/assets/js/275.3c831af6.js"><link rel="prefetch" href="/kevin-blog/assets/js/276.8d0732f8.js"><link rel="prefetch" href="/kevin-blog/assets/js/277.5aa0c664.js"><link rel="prefetch" href="/kevin-blog/assets/js/278.a3cdd3b8.js"><link rel="prefetch" href="/kevin-blog/assets/js/279.d049a479.js"><link rel="prefetch" href="/kevin-blog/assets/js/28.da28db4a.js"><link rel="prefetch" href="/kevin-blog/assets/js/280.6b7f68c4.js"><link rel="prefetch" href="/kevin-blog/assets/js/281.eff251cb.js"><link rel="prefetch" href="/kevin-blog/assets/js/282.f0dc7866.js"><link rel="prefetch" href="/kevin-blog/assets/js/283.36ca2fb9.js"><link rel="prefetch" href="/kevin-blog/assets/js/284.470e6db4.js"><link rel="prefetch" href="/kevin-blog/assets/js/285.a9c60b36.js"><link rel="prefetch" href="/kevin-blog/assets/js/286.3eff6f51.js"><link rel="prefetch" href="/kevin-blog/assets/js/287.f406cf63.js"><link rel="prefetch" href="/kevin-blog/assets/js/288.d6bb5731.js"><link rel="prefetch" href="/kevin-blog/assets/js/289.518409f3.js"><link rel="prefetch" href="/kevin-blog/assets/js/29.37ea8137.js"><link rel="prefetch" href="/kevin-blog/assets/js/290.e4795980.js"><link rel="prefetch" href="/kevin-blog/assets/js/291.6ca97e3d.js"><link rel="prefetch" href="/kevin-blog/assets/js/292.f434852f.js"><link rel="prefetch" href="/kevin-blog/assets/js/293.256f39e1.js"><link rel="prefetch" href="/kevin-blog/assets/js/294.0e051edc.js"><link rel="prefetch" href="/kevin-blog/assets/js/295.d6a1cfbb.js"><link rel="prefetch" href="/kevin-blog/assets/js/296.9a3f4bb2.js"><link rel="prefetch" href="/kevin-blog/assets/js/297.374bbc2d.js"><link rel="prefetch" href="/kevin-blog/assets/js/298.c37b0145.js"><link rel="prefetch" href="/kevin-blog/assets/js/299.008098d2.js"><link rel="prefetch" href="/kevin-blog/assets/js/3.0c6053de.js"><link rel="prefetch" href="/kevin-blog/assets/js/30.24e20f30.js"><link rel="prefetch" href="/kevin-blog/assets/js/300.ab07139a.js"><link rel="prefetch" href="/kevin-blog/assets/js/301.69ee5ffa.js"><link rel="prefetch" href="/kevin-blog/assets/js/302.05af46d8.js"><link rel="prefetch" href="/kevin-blog/assets/js/303.cec1cf65.js"><link rel="prefetch" href="/kevin-blog/assets/js/304.7c82ba6c.js"><link rel="prefetch" href="/kevin-blog/assets/js/305.7ac25f4a.js"><link rel="prefetch" href="/kevin-blog/assets/js/306.82149841.js"><link rel="prefetch" href="/kevin-blog/assets/js/307.f56afc9c.js"><link rel="prefetch" href="/kevin-blog/assets/js/308.7c084ed0.js"><link rel="prefetch" href="/kevin-blog/assets/js/309.feb89623.js"><link rel="prefetch" href="/kevin-blog/assets/js/31.19d1e3af.js"><link rel="prefetch" href="/kevin-blog/assets/js/310.1e33889a.js"><link rel="prefetch" href="/kevin-blog/assets/js/311.416e7d20.js"><link rel="prefetch" href="/kevin-blog/assets/js/312.ee11dbec.js"><link rel="prefetch" href="/kevin-blog/assets/js/313.f58bb112.js"><link rel="prefetch" href="/kevin-blog/assets/js/314.543b2b1c.js"><link rel="prefetch" href="/kevin-blog/assets/js/315.18b9a70e.js"><link rel="prefetch" href="/kevin-blog/assets/js/316.6dfba854.js"><link rel="prefetch" href="/kevin-blog/assets/js/317.19590777.js"><link rel="prefetch" href="/kevin-blog/assets/js/318.a3ec0c19.js"><link rel="prefetch" href="/kevin-blog/assets/js/319.f990a61a.js"><link rel="prefetch" href="/kevin-blog/assets/js/32.07887ecb.js"><link rel="prefetch" href="/kevin-blog/assets/js/320.a3c5cbbf.js"><link rel="prefetch" href="/kevin-blog/assets/js/321.1f58e49c.js"><link rel="prefetch" href="/kevin-blog/assets/js/322.032ff5a2.js"><link rel="prefetch" href="/kevin-blog/assets/js/323.cdd3ba68.js"><link rel="prefetch" href="/kevin-blog/assets/js/324.5238a4e1.js"><link rel="prefetch" href="/kevin-blog/assets/js/325.df06c071.js"><link rel="prefetch" href="/kevin-blog/assets/js/33.9539a78e.js"><link rel="prefetch" href="/kevin-blog/assets/js/34.fa08dd12.js"><link rel="prefetch" href="/kevin-blog/assets/js/35.d6823664.js"><link rel="prefetch" href="/kevin-blog/assets/js/36.5e074071.js"><link rel="prefetch" href="/kevin-blog/assets/js/37.f4a65a95.js"><link rel="prefetch" href="/kevin-blog/assets/js/38.4f127420.js"><link rel="prefetch" href="/kevin-blog/assets/js/39.a5427f94.js"><link rel="prefetch" href="/kevin-blog/assets/js/4.a60d4c06.js"><link rel="prefetch" href="/kevin-blog/assets/js/40.859a530c.js"><link rel="prefetch" href="/kevin-blog/assets/js/41.b61d8247.js"><link rel="prefetch" href="/kevin-blog/assets/js/42.cd204014.js"><link rel="prefetch" href="/kevin-blog/assets/js/43.8076c8fc.js"><link rel="prefetch" href="/kevin-blog/assets/js/44.8a85cf72.js"><link rel="prefetch" href="/kevin-blog/assets/js/45.f46f354b.js"><link rel="prefetch" href="/kevin-blog/assets/js/46.5990e5be.js"><link rel="prefetch" href="/kevin-blog/assets/js/47.9381b746.js"><link rel="prefetch" href="/kevin-blog/assets/js/48.77d95473.js"><link rel="prefetch" href="/kevin-blog/assets/js/49.fc6dff0d.js"><link rel="prefetch" href="/kevin-blog/assets/js/5.6b8c7ebc.js"><link rel="prefetch" href="/kevin-blog/assets/js/50.297dac6d.js"><link rel="prefetch" href="/kevin-blog/assets/js/51.c6ed15a6.js"><link rel="prefetch" href="/kevin-blog/assets/js/52.8bb5ec6f.js"><link rel="prefetch" href="/kevin-blog/assets/js/53.32ab5818.js"><link rel="prefetch" href="/kevin-blog/assets/js/54.1fe541f9.js"><link rel="prefetch" href="/kevin-blog/assets/js/55.6084b23b.js"><link rel="prefetch" href="/kevin-blog/assets/js/56.242cd75a.js"><link rel="prefetch" href="/kevin-blog/assets/js/57.a3aa61b8.js"><link rel="prefetch" href="/kevin-blog/assets/js/58.5dc813ec.js"><link rel="prefetch" href="/kevin-blog/assets/js/59.0649b9f5.js"><link rel="prefetch" href="/kevin-blog/assets/js/6.8f60ce79.js"><link rel="prefetch" href="/kevin-blog/assets/js/60.e912e60f.js"><link rel="prefetch" href="/kevin-blog/assets/js/61.2348484b.js"><link rel="prefetch" href="/kevin-blog/assets/js/62.43b03d30.js"><link rel="prefetch" href="/kevin-blog/assets/js/63.6e56096d.js"><link rel="prefetch" href="/kevin-blog/assets/js/64.c45908b4.js"><link rel="prefetch" href="/kevin-blog/assets/js/65.aab0a20e.js"><link rel="prefetch" href="/kevin-blog/assets/js/66.2555ebea.js"><link rel="prefetch" href="/kevin-blog/assets/js/67.80828b1b.js"><link rel="prefetch" href="/kevin-blog/assets/js/68.5b1b38ff.js"><link rel="prefetch" href="/kevin-blog/assets/js/69.d735686b.js"><link rel="prefetch" href="/kevin-blog/assets/js/7.8fc0c0e7.js"><link rel="prefetch" href="/kevin-blog/assets/js/70.fd567fdf.js"><link rel="prefetch" href="/kevin-blog/assets/js/71.3dc39cbd.js"><link rel="prefetch" href="/kevin-blog/assets/js/72.6fe3454c.js"><link rel="prefetch" href="/kevin-blog/assets/js/73.80c96fab.js"><link rel="prefetch" href="/kevin-blog/assets/js/74.7b652913.js"><link rel="prefetch" href="/kevin-blog/assets/js/75.a9cc5506.js"><link rel="prefetch" href="/kevin-blog/assets/js/76.81bca567.js"><link rel="prefetch" href="/kevin-blog/assets/js/77.1851c464.js"><link rel="prefetch" href="/kevin-blog/assets/js/78.06a9be2e.js"><link rel="prefetch" href="/kevin-blog/assets/js/79.89ac9186.js"><link rel="prefetch" href="/kevin-blog/assets/js/8.d7f3575e.js"><link rel="prefetch" href="/kevin-blog/assets/js/80.76b8cfc2.js"><link rel="prefetch" href="/kevin-blog/assets/js/81.7c87b7a7.js"><link rel="prefetch" href="/kevin-blog/assets/js/82.1995f469.js"><link rel="prefetch" href="/kevin-blog/assets/js/83.dd77915d.js"><link rel="prefetch" href="/kevin-blog/assets/js/84.d167dd7d.js"><link rel="prefetch" href="/kevin-blog/assets/js/85.b858e7d4.js"><link rel="prefetch" href="/kevin-blog/assets/js/86.c4508e18.js"><link rel="prefetch" href="/kevin-blog/assets/js/87.e5015ac2.js"><link rel="prefetch" href="/kevin-blog/assets/js/88.03ea7184.js"><link rel="prefetch" href="/kevin-blog/assets/js/89.6c4aecd6.js"><link rel="prefetch" href="/kevin-blog/assets/js/9.541bf307.js"><link rel="prefetch" href="/kevin-blog/assets/js/90.e64c083e.js"><link rel="prefetch" href="/kevin-blog/assets/js/91.208ff0cf.js"><link rel="prefetch" href="/kevin-blog/assets/js/92.0247f769.js"><link rel="prefetch" href="/kevin-blog/assets/js/93.1d51e9e8.js"><link rel="prefetch" href="/kevin-blog/assets/js/94.52fd5e59.js"><link rel="prefetch" href="/kevin-blog/assets/js/95.3641a4fe.js"><link rel="prefetch" href="/kevin-blog/assets/js/96.a96da06a.js"><link rel="prefetch" href="/kevin-blog/assets/js/97.877152bf.js"><link rel="prefetch" href="/kevin-blog/assets/js/98.4fe249c2.js"><link rel="prefetch" href="/kevin-blog/assets/js/99.400d0dc4.js">
    <link rel="stylesheet" href="/kevin-blog/assets/css/0.styles.267bc68b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kevin-blog/" class="home-link router-link-active"><!----> <span class="site-name">Kevin-Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web" class="dropdown-title"><span class="title">Web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kevin-blog/ES6/Map 数据结构.html" class="nav-link">
  ES6
</a></li></ul></div></div><div class="nav-item"><a href="/kevin-blog/Python/DBUtils 数据库连接池模块.html" class="nav-link">
  Python
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Django" class="dropdown-title"><span class="title">Django</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kevin-blog/Django/Ajax.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/kevin-blog/Django ORM/ORM-ContentType.html" class="nav-link">
  ORM
</a></li><li class="dropdown-item"><!----> <a href="/kevin-blog/Django Rest-Framework/JWT - JSON Web Tokens.html" class="nav-link">
  Rest-Framework
</a></li></ul></div></div><div class="nav-item"><a href="/kevin-blog/Flask/Flask 文件上传.html" class="nav-link">
  Flask
</a></div><div class="nav-item"><a href="/kevin-blog/Git GitHub/Git.html" class="nav-link">
  Git GitHub
</a></div><div class="nav-item"><a href="/kevin-blog/Linux/CentOS 下载和安装.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/kevin-blog/MySQL/distinct 去重.html" class="nav-link">
  MySQL
</a></div><div class="nav-item"><a href="/kevin-blog/爬虫/Anaconda环境.html" class="nav-link">
  爬虫
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web" class="dropdown-title"><span class="title">Web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kevin-blog/ES6/Map 数据结构.html" class="nav-link">
  ES6
</a></li></ul></div></div><div class="nav-item"><a href="/kevin-blog/Python/DBUtils 数据库连接池模块.html" class="nav-link">
  Python
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Django" class="dropdown-title"><span class="title">Django</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kevin-blog/Django/Ajax.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/kevin-blog/Django ORM/ORM-ContentType.html" class="nav-link">
  ORM
</a></li><li class="dropdown-item"><!----> <a href="/kevin-blog/Django Rest-Framework/JWT - JSON Web Tokens.html" class="nav-link">
  Rest-Framework
</a></li></ul></div></div><div class="nav-item"><a href="/kevin-blog/Flask/Flask 文件上传.html" class="nav-link">
  Flask
</a></div><div class="nav-item"><a href="/kevin-blog/Git GitHub/Git.html" class="nav-link">
  Git GitHub
</a></div><div class="nav-item"><a href="/kevin-blog/Linux/CentOS 下载和安装.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/kevin-blog/MySQL/distinct 去重.html" class="nav-link">
  MySQL
</a></div><div class="nav-item"><a href="/kevin-blog/爬虫/Anaconda环境.html" class="nav-link">
  爬虫
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Django ORM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kevin-blog/Django ORM/ORM-ContentType.html" class="sidebar-link">ORM-ContentType</a></li><li><a href="/kevin-blog/Django ORM/ORM-F查询.html" class="sidebar-link">ORM-F查询</a></li><li><a href="/kevin-blog/Django ORM/ORM-Q查询.html" class="sidebar-link">ORM-Q查询</a></li><li><a href="/kevin-blog/Django ORM/ORM-_meta的用法.html" class="sidebar-link">ORM-_meta的用法</a></li><li><a href="/kevin-blog/Django ORM/ORM-一对一.html" class="sidebar-link">ORM-一对一</a></li><li><a href="/kevin-blog/Django ORM/ORM-分组查询.html" class="sidebar-link">ORM-分组查询</a></li><li><a href="/kevin-blog/Django ORM/ORM-在模型类中重写save方法.html" class="sidebar-link">ORM-在模型类中重写save方法</a></li><li><a href="/kevin-blog/Django ORM/ORM-外键（一对多）.html" class="active sidebar-link">ORM-外键（一对多）</a></li><li><a href="/kevin-blog/Django ORM/ORM-多对多.html" class="sidebar-link">ORM-多对多</a></li><li><a href="/kevin-blog/Django ORM/ORM-字段对象相关方法.html" class="sidebar-link">ORM-字段对象相关方法</a></li><li><a href="/kevin-blog/Django ORM/ORM-序列化.html" class="sidebar-link">ORM-序列化</a></li><li><a href="/kevin-blog/Django ORM/ORM-性能相关的查询方法.html" class="sidebar-link">ORM-性能相关的查询方法</a></li><li><a href="/kevin-blog/Django ORM/ORM-执行自定义的SQL语句.html" class="sidebar-link">ORM-执行自定义的SQL语句</a></li><li><a href="/kevin-blog/Django ORM/ORM-操作数据.html" class="sidebar-link">ORM-操作数据</a></li><li><a href="/kevin-blog/Django ORM/ORM-操作表.html" class="sidebar-link">ORM-操作表</a></li><li><a href="/kevin-blog/Django ORM/ORM-练习题.html" class="sidebar-link">ORM-练习题</a></li><li><a href="/kevin-blog/Django ORM/ORM-聚合查询.html" class="sidebar-link">ORM-聚合查询</a></li><li><a href="/kevin-blog/Django ORM/ORM-自关联.html" class="sidebar-link">ORM-自关联</a></li><li><a href="/kevin-blog/Django ORM/ORM-跨多张表查询自身的数据.html" class="sidebar-link">ORM-跨多张表查询自身的数据</a></li><li><a href="/kevin-blog/Django ORM/ORM-配置和使用多个数据库.html" class="sidebar-link">ORM-配置和使用多个数据库</a></li><li><a href="/kevin-blog/Django ORM/ORM-锁和事务.html" class="sidebar-link">ORM-锁和事务</a></li><li><a href="/kevin-blog/Django ORM/ORM的介绍.html" class="sidebar-link">ORM的介绍</a></li><li><a href="/kevin-blog/Django ORM/ORM的配置.html" class="sidebar-link">ORM的配置</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div><span><div><div><div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">外键（一对多</span><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">）</span></h2><div><span style="font-size:14pt;white-space:pre-wrap;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"> 使用 </span><span style="font-size:14pt;"><span style="font-size:14pt;font-weight:bold;">ForeignKey </span></span><span style="font-size:14pt;font-weight:bold;">创建外键</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="color:rgb(227, 0, 0);">在建立外键（即: 一对多关系）的时候，ForeignKey() 一般定义在多的一方（即: 一对多关系中多的一方的表类中）</span></div></li></ul><div><span style="font-size:14pt;"><br></span></div><ul><li><div>models.ForeignKey(to='表的类名', to_field='字段名', related_name='反向操作使用的属性名')</div></li></ul><div><br></div><ul><li><div>ForeignKey 的参数解释:</div></li></ul><div><br></div><ul><ul><li><div>to -&gt; 设置需要关联表的类名</div></li><ul><li><div>to='Classes' -&gt; 加上引号是为了在当前models.py文件中通过反射去查询表的类</div></li><li><div>to=Classes -&gt; 不加引号，直接使用表的类，如果Classes类定义在to的表类下面那么就会报错，因为Classes未定义就引用了</div></li></ul></ul></ul><div>                        -&gt; 不加引号的使用场景: 使用导入的表类时无需加引号（不会出现上面的报错情况，因为表类在文件一开始就已经导入了）</div><ul><ul><li><div>to_field -&gt; 设置关联表的那个字段，如果不传默认关联 id</div></li><li><div>related_name -&gt; 反向操作时，使用的属性名，用于代替原反向查询时的 '表名_set' 的写法 -&gt; (通俗理解: 给主表起的别名，用于反向操作)</div></li><li><div>related_query_name -&gt; 反向查询操作时，使用的连接前缀，用于替换表名</div></li><li><div>on_delete -&gt; <span style="letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:12pt;color:rgb(0, 0, 0);font-variant-caps:normal;font-variant-ligatures:normal;">当删除关联表中的数据时，当前表与其关联的行的行为</span></div></li></ul></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="color:rgb(65, 173, 28);"># models.ForeignKey(to='表的类名', to_field='字段名', related_name='反向操作使用的属性名')</font></div><div><br></div><div><font color="#41AD1C"># 班级表</font></div><div>class Classes(models.Model):</div><div>    id = models.AutoField(primary_key=True)</div><div>    name = models.CharField(max_length=10)</div><div><br></div><div><br></div><div><font color="#41AD1C"># 学生表</font></div><div>class Student(models.Model):</div><div>    id = models.AutoField(primary_key=True)</div><div>    name = models.CharField(max_length=10)</div><div>    age = models.IntegerField()</div><div>    classes = models.ForeignKey(to='Classes', related_name='fkclass')  <font color="#E30000"># 建立外键，且 classes 就是外键属性</font></div></div><div><br></div></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">8.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;"><span style="font-size:14pt;font-weight:bold;">on_delete -&gt; 外键方法参数</span></span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:12pt;color:rgb(0, 0, 0);font-variant-caps:normal;font-variant-ligatures:normal;">当删除关联表中的数据时，当前表与其关联的行的行为</span></span></div></li><li><div>Django1+ 中默认设置了 on_delete=models.CASCADE</div></li><li><div><span style="color:rgb(227, 0, 0);">注意</span>: 在Django2+中创建外键时一定要设置该参数，不然就会报错</div></li></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size:9pt;">class Student(models.Model):</font></div><div><font style="font-size:9pt;">    id = models.AutoField(primary_key=True)</font></div><div><font style="font-size:9pt;">    name = models.CharField(max_length=10)</font></div><div><font style="font-size:9pt;">    classes = models.ForeignKey(to='Classes', on_delete=models.CASCADE)</font></div></div><div><font style="font-size:12pt;"><br></font></div><ul><li><div>on_delete 的值: </div></li><ul><li><div><font style="font-size:12pt;"><span style="letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:12pt;color:rgb(0, 0, 0);font-variant-caps:normal;font-variant-ligatures:normal;">models.CASCADE -&gt;  </span><span style="letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:12pt;color:rgb(0, 0, 0);font-variant-caps:normal;font-variant-ligatures:normal;">删除关联数据，与之关联也删除</span></font></div></li><li><div><span style="letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:12pt;color:rgb(0, 0, 0);font-variant-caps:normal;font-variant-ligatures:normal;">models.DO_NOTHING -&gt; </span><span style="font-size:12pt;">删除关联数据，引发错误IntegrityError</span></div></li><li><div><span style="letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:12pt;color:rgb(0, 0, 0);font-variant-caps:normal;font-variant-ligatures:normal;">models.PROTECT -&gt; </span><span style="font-size:12pt;">删除关联数据，引发错误ProtectedError</span></div></li><li><div><span style="letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:12pt;color:rgb(0, 0, 0);font-variant-caps:normal;font-variant-ligatures:normal;">models.SET_NULL -&gt; </span><span style="font-size:12pt;">删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）</span></div></li><li><div><span style="letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:12pt;color:rgb(0, 0, 0);font-variant-caps:normal;font-variant-ligatures:normal;">models.SET_DEFAULT -&gt; </span><span style="font-size:12pt;">删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）</span></div></li><li><div><span style="font-size:12pt;">models.SET -&gt; 删除关联数据</span></div></li><ul><li><div><span style="font-size:12pt;">与之关联的值设置为指定值，设置：models.SET(值)</span></div></li><li><div><span style="font-size:12pt;">与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)</span></div></li></ul></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># models.SET 的演示</font></div><div><br></div><div>def func():</div><div>    return 10</div><div><br></div><div>class MyModel(models.Model):</div><div>    user = models.ForeignKey(</div><div>        to=&quot;User&quot;,</div><div>        to_field=&quot;id&quot;，</div><div>        on_delete=models.SET(func)</div><div>    )</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">9.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;"><span style="font-size:14pt;font-weight:bold;">db_constraint </span></span><span style="font-size:14pt;font-weight:bold;">-&gt; 外键方法参数</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:12pt;color:rgb(0, 0, 0);font-variant-caps:normal;font-variant-ligatures:normal;">是否在数据库中创建外键约束，默认为True</span></span></div></li><li><div>通俗理解: 如果 <span style="font-size:12pt;">db_constraint=False ,虽然通过 </span>ForeignKey 字段类建立了索引，但是实际上在数据库中是没有建立，只是说明了该字段有外键的功能，一般用于软外键</div></li><li><div>软外键的说明: 不在表中建立外键约束，从代码层面上建立外键约束</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>class Student(models.Model):</div><div>    id = models.AutoField(primary_key=True)</div><div>    name = models.CharField(max_length=10)</div><div>    classes = models.ForeignKey(to='Classes', db_constraint=True)</div></div><div><span style="font-size:14pt;"><br></span></div></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">外键字段相关</span></h2><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;color:rgb(227, 0, 0);font-weight:bold;">1.</span><span style="font-size:14pt;color:rgb(227, 0, 0);font-weight:bold;"> 使用外键字段的注意事项</span></div><div><br></div><ul><li><div><span style="font-size:12pt;">使用 orm 所创建的外键都会在外键字段名的结尾处加上 _id，除非使用了 db_column='xxx' 去重新设置该外键字段的字段名（如果使用 db_column 重新设置外键字段名，不要和类中的外键属性名重复，因为该属性名是用于正向查询的（即：存放着与主表数据相关的从表数据的对象））</span></div></li></ul><div><br></div><div><img data-filename="Image.png" src="/kevin-blog/Django ORM/ORM-外键（一对多）_files/Image.png" type="image/png"></div><div><br></div><ul><li><div><span style="font-size:12pt;">使用数据库表中的外键名（xxx_id）去对外键字段中的数据进行添加和修改操作（查询、删除、批量修改除外），而不是直接使用类中的外键字段名，因为类中的外键字段名是用于正向查询（即：存放着与主表数据相关的从表数据的对象）</span></div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size:9pt;font-family:Monaco;color:rgb(65, 173, 28);"># 正确示范 -&gt; 这里使用了上面的表的类做示范</span></div><div><br></div><div><span style="font-size:9pt;font-family:Monaco;color:rgb(65, 173, 28);"># 增加数据</span></div><div>models.Student.objects.create(name='Kevin', classes_id=1)</div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 查询数据</span></div><div>models.Student.objects.get(classes_id=1)</div><div>models.Student.objects.get(classes=1)</div><div><br></div><div><span style="font-size:9pt;font-family:Monaco;color:rgb(65, 173, 28);"># 删除数据</span></div><div>models.Student.objects.get(classes_id=1).delete()</div><div>models.Student.objects.get(classes=1).delete()</div><div><br></div><div><span style="font-size:9pt;font-family:Monaco;color:rgb(65, 173, 28);"># 修改数据</span></div><div>obj = models.Student.objects.get(classes_id=1)</div><div>obj = models.Student.objects.get(classes=1)</div><div>obj.classes_id= 2</div><div>obj.save()</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size:9pt;font-family:Monaco;color:rgb(65, 173, 28);"># </span><span style="font-size:9pt;font-family:Monaco;color:rgb(227, 0, 0);">错误示范</span> <span style="font-size:9pt;font-family:Monaco;color:rgb(65, 173, 28);">-&gt; 这里使用了上面的表的类做示范</span></div><div><br></div><div><span style="font-size:9pt;font-family:Monaco;color:rgb(65, 173, 28);"># 增加数据</span></div><div>models.Student.objects.create(name='Kevin', classes=1)</div><div><br></div><div><span style="font-size:9pt;font-family:Monaco;color:rgb(65, 173, 28);"># 修改数据</span></div><div>obj = models.Student.objects.get(classes=1)</div><div>obj.classes = 2</div><div>obj.save()</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"> 两种修改外键数据的方法</span></div><div><br></div><ul><li><div>方法一 -&gt; 通过数据库中的外键名进行修改 -&gt; 推荐使用</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># 这里使用了上面的表的类做示范</span></div><div><br></div><div>obj = models.Student.objects.get(classes_id=1)</div><div>obj.classes_id= 2</div><div>obj.save()</div></div><div><br></div><ul><li><div>方法二 -&gt; 对类中的外键属性进行重新的赋值</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># 这里使用了上面的表的类做示范</span></div><div><br></div><div>class_obj = Classes.objects.get(id=5)</div><div>student_obj = Student.objects.get(id=4)</div><div>student_obj.classes = class_obj  <span style="color:rgb(65, 173, 28);"># 对外键属性进行重新赋值，且该值必须是班级对象，因为 classes 的外键属性返回的就是班级对象</span></div><div>student_obj.save()</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(227, 0, 0);"># 错误示范: 不要直接修改外键属性所返回的对象，因为直接修改该对象相当于直接修改了从表（班级表）中的内容</span></div><div><br></div><div>student_obj = Student.objects.get(id=4)</div><div>student_obj.classes.id = 2</div><div>student_obj.classes.save()</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">3.</span><span style="font-size:14pt;font-weight:bold;"> 外键字段接收的参数</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>在进行正删改查的时候，如果涉及到外键字段，那么外键字段可以接收两种类型的参数:</div></li></ul><div><br></div><ul><ul><li><div>对象 -&gt; 外键字段属性名 = 对象 -&gt; 对象一般代指的是查询数据后得到的对象（因为 .外键字段属性名 返回的是一个对象，所以它可以接收一个对象）</div></li><li><div>数字 -&gt; 外键字段属性名_id = 数字</div></li></ul></ul><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">外键字段接收的参数是 对象 的相关操作</span></div></li></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 增</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#FA7A00">classes_obj</font> = Classes.objects.filter(id=1).first()</div><div>Student.objects.create(name='Yeung', age=18, <font color="#FA7A00">classes</font>=<font color="#FA7A00">classes_obj</font>)</div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 改</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#FA7A00">classes</font> = Classes.objects.filter(id=2).first()</div><div>student = Student.objects.filter(name='Yeung').first()</div><div><br></div><div>student.<font color="#FA7A00">classes</font> = <font color="#FA7A00">classes</font></div><div><br></div><div>student.save()</div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 查</font></div><div><br></div><div><font color="#FA7A00">classes</font> = Classes.objects.filter(id=1).first()</div><div>student = Student.objects.filter(<font color="#FA7A00">classes</font>=<font color="#FA7A00">classes</font>)</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">外键字段接收的参数是 数字 的相关操作</span></div></li></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 增 </font></div><div><font color="#41AD1C"><br></font></div><div>Student.objects.create(name='Yeung', age=18, <font color="#FA7A00">classes_id</font>=<font color="#FA7A00">1</font>)</div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 改 </font></div><div><font color="#41AD1C"><br></font></div><div>student = Student.objects.filter(name='Yeung').first()</div><div><br></div><div>student.<font color="#FA7A00">classes_id</font> = <font color="#FA7A00">1</font></div><div><br></div><div>student.save()</div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 查</font></div><div><font color="#41AD1C"><br></font></div><div>student = Student.objects.filter(classes_id=1)</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>在查询数据 或 批量修改外键字段的数据的时候，外键字段可以不用加 _id 直接传递数字类型的参数</div></li></ul><div><br></div><ul><ul><li><div>查询数据</div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="color:rgb(65, 173, 28);"># classes 是外键字段</font></div><div><br></div><div>student = Student.objects.filter(classes=1)  <font color="#41AD1C"># 传递的参数是数字类型</font></div><div><br></div><div><font color="#41AD1C"># ------------------------------------------------------</font></div><div><br></div><div>classes_obj = Classes.objects.filter(id=1).first()</div><div>student = Student.objects.filter(classes=classes_obj)  <font color="#41AD1C"># 传递的参数是对象</font></div><div><font color="#41AD1C"><br></font></div><div><font style="color:rgb(65, 173, 28);"># ------------------------------------------------------</font></div><div><br></div><div>student = Student.objects.get(classes=2)  <font color="#41AD1C"># 传递的参数是数字类型</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># ------------------------------------------------------</font></div><div><br></div><div>classes_obj = Classes.objects.filter(id=2).first()</div><div>student = Student.objects.get(classes=classes_obj)  <font color="#41AD1C"># 传递的参数是对象</font></div></div><div><span style="font-size:14pt;"><br></span></div><ul><ul><li><div>批量修改外键字段的数据</div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># classes 是外键字段</font></div><div><font color="#41AD1C"><br></font></div><div>student = Student.objects.filter(classes=1)</div><div>student.update(classes=2)  <font color="#41AD1C"># 传递的参数是数字类型</font></div><div><font color="#41AD1C"><br></font></div><div><font style="color:rgb(65, 173, 28);"># ------------------------------------------------------</font></div><div><font color="#41AD1C"><br></font></div><div>student = Student.objects.filter(classes=1)</div><div>classes_obj = Classes.objects.filter(id=2).first()</div><div>student.update(classes=classes_obj)  <font color="#41AD1C"># 传递的参数是数字类型</font></div></div><div><span style="font-size:14pt;"><br></span></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">查询相关</span></h2><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"> 正向查询 -&gt; </span><span style="font-size:14pt;font-weight:bold;">主表获取从表的数据</span></div><div><br></div><ul><li><div><span style="font-size:12pt;">作用: 简化连表获取数据的操作</span></div></li></ul><div><br></div><ul><li><div><span style="font-size:12pt;">正向查询用字段，反向查询用表名</span></div></li></ul><div><br></div><ul><li><div>写法一:</div></li></ul><div><br></div><ul><ul><li><div>通过对象查找</div></li><li><div><span style="color:rgb(227, 0, 0);">语法:</span> 查询到的对象.类的外键属性 -&gt; 返回值：主表数据相关的从表数据的对象</div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(227, 0, 0);"># Django会将从表的所有数据放进表的类中的外键属性中，当要获取与主表数据相关的从表数据的时候，外键属性就会返回与主表数据相关的从表数据的对象</span></div><div><span style="color:rgb(65, 173, 28);"># 这里使用了上面的表的类做示范</span></div><div><br></div><div>class_obj = Student.objects.get(id=2).classes  <span style="color:rgb(65, 173, 28);"># &lt;Classes: Classes object&gt; -&gt; 返回值: 与查询到的 student 数据相关的 class 数据的对象</span></div><div><br></div><div><span style="color:rgb(0, 0, 0);">class_name = </span>Student.objects.get(id=2).classes.name  <span style="color:rgb(65, 173, 28);"># '一班'</span></div></div><div><br></div><ul><li><div>写法二:</div></li></ul><div><br></div><ul><ul><li><div>使用 values 或 values_list 通过字段查询</div></li></ul></ul><div><br></div><ul><ul><li><div><span style="color:rgb(227, 0, 0);">语法</span><span style="color:rgb(227, 0, 0);">:</span></div></li><ul><li><div>.values('主表字段名', '主表字段名', '主表类的外键属性名__从表字段名', '主表类的外键属性名__主表类的外键属性名下的外键属性名__从表字段名')</div></li><li><div>.values_list('主表字段名', '主表字段名', '主表类的外键属性名__从表字段名', '主表类的外键属性名__主表类的外键属性名下的外键属性名__从表字段名')</div></li></ul></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>student_obj1 = Student.objects.all().values('name', 'classes__id', 'classes__name')  <span style="color:rgb(65, 173, 28);"># name是Student表的字段名，而classes__id中的classes是Student类中所创建的外键属性，id则是classes表中的字段</span></div><div>student_obj2 = Student.objects.all().values_list('name', 'classes__id', 'classes__name')</div><div><br></div><div>print(student_obj1) <span style="color:rgb(65, 173, 28);"> # &lt;QuerySet [{'classes__name': '一班', 'name': 'Kevin', 'classes__id': 1}, {'classes__name': '三班', 'name': 'Aimer', 'classes__id': 4}]&gt;</span></div><div>print(student_obj2)  <span style="color:rgb(65, 173, 28);"># &lt;QuerySet [('Kevin', 1, '一班'), ('Aimer', 4, '三班')]&gt;</span></div></div><div><br></div><ul><ul><li><div>跨多张表进行查询 -&gt; 查找书名是“西游记”的书的作者的年龄和手机号码和作者详情id（是ORM练习中的最后一题）</div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>author_list = Book.objects.filter(title='西游记').values('author__name', 'author__detail_id', 'author__detail__addr', 'author__detail__email')</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"> 反向查询 -&gt; </span><span style="font-size:14pt;font-weight:bold;">从表获取主表的数据</span></div><div><br></div><ul><li><div><span style="font-size:12pt;">作用: 简化连表获取数据的操作</span></div></li></ul><div><br></div><ul><li><div><span style="font-size:12pt;">正向查询用字段，反向查询用表名</span></div></li></ul><div><br></div><ul><li><div>写法一:</div></li></ul><div><br></div><ul><ul><li><div>通过对象查找</div></li><li><div>语法: 查询到的对象.主表的类名_set.all/get/filter() -&gt; 主表类名首字母无需大写</div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># 这里使用了上面的表的类做示范</span></div><div><span style="color:rgb(65, 173, 28);"># 例子: 查询一班的所有学生</span></div><div><br></div><div>student_list = Classes.objects.get(id=1).student_set.all()  <span style="color:rgb(65, 173, 28);"># &lt;QuerySet [&lt;Student: Student object&gt;, &lt;Student: Student object&gt;]&gt;</span></div><div><br></div><div><span style="font-family:Monaco;color:rgb(0, 0, 0);">for student in </span>student_list:</div><div>    print(student.name)  <span style="color:rgb(65, 173, 28);"># Kevin ……</span></div></div><div><br></div><ul><ul><li><div><span style="font-size:12pt;">related_name</span></div></li></ul></ul><div><br></div><ul><ul><ul><li><div><span style="font-size:12pt;">用于替换</span> 主表的类名<span style="font-size:12pt;">_set 的写法 </span></div></li><li><div>在表类的外键属性（即: ForeignKey()方法）中添加 <span style="font-size:12pt;">related_name='xxx' 即可</span></div></li><li><div>如果在表类的外键属性中添加了 <span style="font-size:12pt;">related_name='xxx'，那么 </span>主表的类名<span style="font-size:12pt;">_set 的写法就会无效</span></div></li></ul></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># models.py</span></div><div><br></div><div>class Student(models.Model):</div><div>    id = models.AutoField(primary_key=True)</div><div>    name = models.CharField(max_length=10)</div><div>    classes = models.ForeignKey(to='Classes', <span style="color:rgb(250, 122, 0);">related_name='fkclass'</span>)</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># views.py</span></div><div><br></div><div>student_list = Classes.objects.get(id=1).<span style="color:rgb(250, 122, 0);">fkclass</span>.all()  <span style="color:rgb(65, 173, 28);"># &lt;QuerySet [&lt;Student: Student object&gt;, &lt;Student: Student object&gt;]&gt;</span></div><div><br></div><div>for student in student_list:</div><div>    print(student.name)  <span style="color:rgb(65, 173, 28);"># Kevin ……</span></div></div><div><br></div><ul><li><div>写法二:</div></li></ul><div><br></div><ul><ul><li><div>使用 values 或 values_list 通过字段查询</div></li></ul></ul><div><br></div><ul><ul><li><div><span style="color:rgb(227, 0, 0);">语法</span><span style="color:rgb(227, 0, 0);">:</span></div></li></ul></ul><div><br></div><ul><ul><ul><li><div>如果没有设置表类中外键属性的 related_name</div></li></ul></ul></ul><div><br></div><ul><ul><ul><ul><li><div>.values('从表字段名', '从表字段名', '主表类名__主表字段名', '主表类名__主表字段名') -&gt; 主表类名无需大写</div></li><li><div>.values_list('从表字段名', '从表字段名', '主表类名__主表字段名', '主表类名__主表字段名') -&gt; 主表类名无需大写</div></li></ul></ul></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># models.py</span></div><div><br></div><div>class Student(models.Model):</div><div>    id = models.AutoField(primary_key=True)</div><div>    name = models.CharField(max_length=10)</div><div>    classes = models.ForeignKey(to='Classes')</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>student_list1 = Classes.objects.all().values('name', 'student__name')</div><div>student_list2 = Classes.objects.all().values_list('name', 'student__name')</div><div><br></div><div>print(student_list1)  <span style="color:rgb(65, 173, 28);"># &lt;QuerySet [{'student__name': 'Kevin', 'name': '一班'}, {'student__name': 'Aimer', 'name': '三班'}, ……]&gt;</span></div><div>print(student_list2)  <span style="color:rgb(65, 173, 28);"># &lt;QuerySet [('一班', 'Kevin'), ('三班', 'Aimer'), ('一班', 'Timmy'), ('二班', None), ('四班', None), ('五班', None)]&gt;</span></div></div><div><br></div><ul><ul><ul><li><div>如果设置了表类中外键属性的 related_name</div></li></ul></ul></ul><div><br></div><ul><ul><ul><ul><li><div>.values('从表字段名', '从表字段名', 'related_name所设置的名字__主表字段名', 'related_name所设置的名字__主表字段名')</div></li><li><div>.values_list('从表字段名', '从表字段名', 'related_name所设置的名字__主表字段名', 'related_name所设置的名字__主表字段名')</div></li></ul></ul></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># models.py</span></div><div><br></div><div>class Student(models.Model):</div><div>    id = models.AutoField(primary_key=True)</div><div>    name = models.CharField(max_length=10)</div><div>    classes = models.ForeignKey(to='Classes', <span style="color:rgb(250, 122, 0);">related_name='fkclass'</span>)</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>student_list1 = Classes.objects.all().values('name', '<span style="color:rgb(250, 122, 0);">fkclass</span>__name')</div><div>student_list2 = Classes.objects.all().values_list('name', '<span style="color:rgb(250, 122, 0);">fkclass</span>__name')</div><div><br></div><div>print(student_list1) <span style="color:rgb(65, 173, 28);"> # &lt;QuerySet [{'fkclass__name': 'Kevin', 'name': '一班'}, {'fkclass__name': 'Aimer', 'name': '三班'}, ……]&gt;</span></div><div>print(student_list2)  <span style="color:rgb(65, 173, 28);"># &lt;QuerySet [('一班', 'Kevin'), ('三班', 'Aimer'), ('一班', 'Timmy'), ('二班', None), ('四班', None), ('五班', None)]&gt;</span></div></div><div><br></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">QuerySet方法大全</span></h2><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C">##################################################################</font></div><div><font color="#41AD1C"># PUBLIC METHODS THAT ALTER ATTRIBUTES AND RETURN A NEW QUERYSET #</font></div><div><font color="#41AD1C">##################################################################</font></div><div><br></div><div><br></div><div>def all(self)</div><div><font color="#41AD1C"> # 获取所有的数据对象</font></div><div><br></div><div><br></div><div>def filter(self, *args, **kwargs)</div><div><font color="#41AD1C"># 条件查询</font></div><div><font color="#41AD1C">    # 条件可以是：参数，字典，Q</font></div><div><br></div><div><br></div><div>def exclude(self, *args, **kwargs)</div><div><font color="#41AD1C">  # 条件查询</font></div><div><font color="#41AD1C">    # 条件可以是：参数，字典，Q</font></div><div><br></div><div><br></div><div>def select_related(self, *fields)</div><div><font color="#41AD1C"> 性能相关：表之间进行join连表操作，一次性获取关联的数据。</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C">    总结：</font></div><div><font color="#41AD1C">    1. select_related主要针一对一和多对一关系进行优化。</font></div><div><font color="#41AD1C">    2. select_related使用SQL的JOIN语句进行优化，通过减少SQL查询的次数来进行优化、提高性能。</font></div><div><br></div><div><br></div><div>def prefetch_related(self, *lookups)</div><div><font color="#41AD1C">性能相关：多表连表操作时速度会慢，使用其执行多次SQL查询在Python代码中实现连表操作。</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C">    总结：</font></div><div><font color="#41AD1C">    1. 对于多对多字段（ManyToManyField）和一对多字段，可以使用prefetch_related()来进行优化。</font></div><div><font color="#41AD1C">    2. prefetch_related()的优化方式是分别查询每个表，然后用Python处理他们之间的关系。</font></div><div><br></div><div><br></div><div>def annotate(self, *args, **kwargs)</div><div><font color="#41AD1C">    # 用于实现聚合group by查询</font></div><div><br></div><div>    from django.db.models import Count, Avg, Max, Min, Sum</div><div><br></div><div>    v = models.UserInfo.objects.values('u_id').annotate(uid=Count('u_id'))</div><div><font color="#41AD1C">    # SELECT u_id, COUNT(ui) AS `uid` FROM UserInfo GROUP BY u_id</font></div><div><br></div><div>    v = models.UserInfo.objects.values('u_id').annotate(uid=Count('u_id')).filter(uid__gt=1)</div><div><font color="#41AD1C">    # SELECT u_id, COUNT(ui_id) AS `uid` FROM UserInfo GROUP BY u_id having count(u_id) &gt; 1</font></div><div><br></div><div>    v = models.UserInfo.objects.values('u_id').annotate(uid=Count('u_id',distinct=True)).filter(uid__gt=1)</div><div><font color="#41AD1C">    # SELECT u_id, COUNT( DISTINCT ui_id) AS `uid` FROM UserInfo GROUP BY u_id having count(u_id) &gt; 1</font></div><div><br></div><div><br></div><div>def distinct(self, *field_names)</div><div><font color="#41AD1C"># 用于distinct去重</font></div><div>    models.UserInfo.objects.values('nid').distinct()</div><div><font color="#41AD1C"> # select distinct nid from userinfo</font></div><div><br></div><div><br></div><div>    注：只有在PostgreSQL中才能使用distinct进行去重</div><div><br></div><div><br></div><div>def order_by(self, *field_names)</div><div><font color="#41AD1C"> # 用于排序</font></div><div>    models.UserInfo.objects.all().order_by('-id','age')</div><div><br></div><div><br></div><div>def extra(self, select=None, where=None, params=None, tables=None, order_by=None, select_params=None)</div><div><font color="#41AD1C"> # 构造额外的查询条件或者映射，如：子查询</font></div><div>    Entry.objects.extra(select={'new_id': &quot;select col from sometable where othercol &gt; %s&quot;}, select_params=(1,))</div><div>    Entry.objects.extra(where=['headline=%s'], params=['Lennon'])</div><div>    Entry.objects.extra(where=[&quot;foo='a' OR bar = 'a'&quot;, &quot;baz = 'a'&quot;])</div><div>    Entry.objects.extra(select={'new_id': &quot;select id from tb where id &gt; %s&quot;}, select_params=(1,), order_by=['-nid'])</div><div><br></div><div><br></div><div>def reverse(self):</div><div><font color="#41AD1C"># 倒序</font></div><div>    models.UserInfo.objects.all().order_by('-nid').reverse()</div><div><font color="#41AD1C"> # 注：如果存在order_by，reverse则是倒序，如果多个排序则一一倒序</font></div><div><br></div><div><br></div><div><br></div><div><br></div><div>def defer(self, *fields):</div><div><font color="#000000">    models.UserInfo.objects.defer('username','id')</font></div><div><font color="#41AD1C">    # 或</font></div><div><font color="#41AD1C"></font> <font color="#000000">models.UserInfo.objects.filter(...).defer('username','id')</font></div><div><font color="#41AD1C">    # 映射中排除某列数据</font></div><div><br></div><div><br></div><div>def only(self, *fields):</div><div><font color="#41AD1C"># 仅取某个表中的数据</font></div><div><font color="#41AD1C"></font> <font color="#000000">models.UserInfo.objects.only('username','id')</font></div><div><font color="#41AD1C">    # 或</font></div><div><font color="#41AD1C"></font> <font color="#000000">models.UserInfo.objects.filter(...).only('username','id')</font></div><div><br></div><div><br></div><div>def using(self, alias):</div><div><font color="#41AD1C"># 指定使用的数据库，参数为别名（setting中的设置）</font></div><div><br></div><div><br></div><div><br></div><div><br></div><div><font color="#41AD1C">##################################################</font></div><div><font color="#41AD1C"># PUBLIC METHODS THAT RETURN A QUERYSET SUBCLASS #</font></div><div><font color="#41AD1C">##################################################</font></div><div><br></div><div><br></div><div>def raw(self, raw_query, params=None, translations=None, using=None):</div><div><font color="#41AD1C"># 执行原生SQL</font></div><div>    models.UserInfo.objects.raw('select * from userinfo')</div><div><br></div><div><br></div><div><font color="#41AD1C"> # 如果SQL是其他表时，必须将名字设置为当前UserInfo对象的主键列名</font></div><div>    models.UserInfo.objects.raw('select id as nid from 其他表')</div><div><br></div><div><br></div><div><font color="#41AD1C"> # 为原生SQL设置参数</font></div><div>    models.UserInfo.objects.raw('select id as nid from userinfo where nid&gt;%s', params=[12,])</div><div><br></div><div><br></div><div><font color="#41AD1C"># 将获取的到列名转换为指定列名</font></div><div>    name_map = {'first': 'first_name', 'last': 'last_name', 'bd': 'birth_date', 'pk': 'id'}</div><div>    Person.objects.raw('SELECT * FROM some_other_table', translations=name_map)</div><div><br></div><div><br></div><div><font color="#41AD1C"> # 指定数据库</font></div><div>    models.UserInfo.objects.raw('select * from userinfo', using=&quot;default&quot;)</div><div><br></div><div><br></div><div><font color="#41AD1C">################### 原生SQL ###################</font></div><div>    from django.db import connection, connections</div><div>    cursor = connection.cursor()  # cursor = connections['default'].cursor()</div><div>    cursor.execute(&quot;&quot;&quot;SELECT * from auth_user where id = %s&quot;&quot;&quot;, [1])</div><div>    row = cursor.fetchone() # fetchall()/fetchmany(..)</div><div><br></div><div><br></div><div><br></div><div><br></div><div>def values(self, *fields):</div><div>    # 获取每行数据为字典格式</div><div><br></div><div><br></div><div>def values_list(self, *fields, **kwargs):</div><div><font color="#41AD1C"># 获取每行数据为元祖</font></div><div><br></div><div><br></div><div>def dates(self, field_name, kind, order='ASC'):</div><div><font color="#41AD1C"># 根据时间进行某一部分进行去重查找并截取指定内容</font></div><div><font color="#41AD1C">    # kind只能是：&quot;year&quot;（年）, &quot;month&quot;（年-月）, &quot;day&quot;（年-月-日）</font></div><div><font color="#41AD1C">    # order只能是：&quot;ASC&quot;  &quot;DESC&quot;</font></div><div><font color="#41AD1C">    # 并获取转换后的时间</font></div><div><font color="#41AD1C">        - year : 年-01-01</font></div><div><font color="#41AD1C">        - month: 年-月-01</font></div><div><font color="#41AD1C">        - day  : 年-月-日</font></div><div><br></div><div><br></div><div>    models.DatePlus.objects.dates('ctime','day','DESC')</div><div><br></div><div><br></div><div>def datetimes(self, field_name, kind, order='ASC', tzinfo=None):</div><div><font color="#41AD1C"># 根据时间进行某一部分进行去重查找并截取指定内容，将时间转换为指定时区时间</font></div><div><font color="#41AD1C">    # kind只能是 &quot;year&quot;, &quot;month&quot;, &quot;day&quot;, &quot;hour&quot;, &quot;minute&quot;, &quot;second&quot;</font></div><div><font color="#41AD1C">    # order只能是：&quot;ASC&quot;  &quot;DESC&quot;</font></div><div><font color="#41AD1C">    # tzinfo时区对象</font></div><div>    models.DDD.objects.datetimes('ctime','hour',tzinfo=pytz.UTC)</div><div>    models.DDD.objects.datetimes('ctime','hour',tzinfo=pytz.timezone('Asia/Shanghai'))</div><div><br></div><div><br></div><div><font color="#41AD1C">&quot;&quot;&quot;</font></div><div><font color="#41AD1C">    pip3 install pytz</font></div><div><font color="#41AD1C">    import pytz</font></div><div><font color="#41AD1C">    pytz.all_timezones</font></div><div><font color="#41AD1C">    pytz.timezone(‘Asia/Shanghai’)</font></div><div><font color="#41AD1C">    &quot;&quot;&quot;</font></div><div><br></div><div><br></div><div>def none(self):</div><div><font color="#41AD1C"> # 空QuerySet对象</font></div><div><br></div><div><br></div><div><br></div><div><br></div><div><font color="#41AD1C">####################################</font></div><div><font color="#41AD1C"># METHODS THAT DO DATABASE QUERIES #</font></div><div><font color="#41AD1C">####################################</font></div><div><br></div><div><br></div><div>def aggregate(self, *args, **kwargs):</div><div><font color="#41AD1C"># 聚合函数，获取字典类型聚合结果</font></div><div>   from django.db.models import Count, Avg, Max, Min, Sum</div><div>   result = models.UserInfo.objects.aggregate(k=Count('u_id', distinct=True), n=Count('nid'))</div><div><font color="#41AD1C">===&gt; {'k': 3, 'n': 4}</font></div><div><br></div><div><br></div><div>def count(self):</div><div><font color="#41AD1C"># 获取个数</font></div><div><br></div><div><br></div><div>def get(self, *args, **kwargs):</div><div><font color="#41AD1C"> # 获取单个对象</font></div><div><br></div><div><br></div><div>def create(self, **kwargs):</div><div><font color="#41AD1C">  # 创建对象</font></div><div><br></div><div><br></div><div>def bulk_create(self, objs, batch_size=None):</div><div><font color="#41AD1C"> # 批量插入</font></div><div><font color="#41AD1C">    # batch_size表示一次插入的个数</font></div><div>    objs = [</div><div>        models.DDD(name='r11'),</div><div>        models.DDD(name='r22')</div><div>    ]</div><div>    models.DDD.objects.bulk_create(objs, 10)</div><div><br></div><div><br></div><div>def get_or_create(self, defaults=None, **kwargs):</div><div><font color="#41AD1C"># 如果存在，则获取，否则，创建</font></div><div><font color="#41AD1C">    # defaults 指定创建时，其他字段的值</font></div><div>    obj, created = models.UserInfo.objects.get_or_create(username='root1', defaults={'email': '1111111','u_id': 2, 't_id': 2})</div><div><br></div><div><br></div><div>def update_or_create(self, defaults=None, **kwargs):</div><div><font color="#41AD1C"># 如果存在，则更新，否则，创建</font></div><div><font color="#41AD1C">    # defaults 指定创建时或更新时的其他字段</font></div><div>    obj, created = models.UserInfo.objects.update_or_create(username='root1', defaults={'email': '1111111','u_id': 2, 't_id': 1})</div><div><br></div><div><br></div><div>def first(self):</div><div><font color="#41AD1C"># 获取第一个</font></div><div><br></div><div><br></div><div>def last(self):</div><div><font color="#41AD1C"> # 获取最后一个</font></div><div><br></div><div><br></div><div>def in_bulk(self, id_list=None):</div><div><font color="#41AD1C"># 根据主键ID进行查找</font></div><div>   id_list = [11,21,31]</div><div>   models.DDD.objects.in_bulk(id_list)</div><div><br></div><div><br></div><div>def delete(self):</div><div><font color="#41AD1C"># 删除</font></div><div><br></div><div><br></div><div>def update(self, **kwargs):</div><div><font color="#41AD1C"> # 更新</font></div><div><br></div><div><br></div><div>def exists(self):</div><div><font color="#41AD1C"># 是否有结果</font></div></div><div><br></div></div><div><br></div></span></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/kevin-blog/Django ORM/ORM-在模型类中重写save方法.html" class="prev">
        ORM-在模型类中重写save方法
      </a></span> <span class="next"><a href="/kevin-blog/Django ORM/ORM-多对多.html">
        ORM-多对多
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/kevin-blog/assets/js/app.dd46475d.js" defer></script><script src="/kevin-blog/assets/js/2.97d04891.js" defer></script><script src="/kevin-blog/assets/js/13.e55a4126.js" defer></script>
  </body>
</html>
