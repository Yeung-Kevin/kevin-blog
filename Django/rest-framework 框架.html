<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>rest-framework 框架 | Kevin-Blog</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/kevin-blog/logo.png">
    <meta name="description" content="">
    <link rel="preload" href="/kevin-blog/assets/css/0.styles.267bc68b.css" as="style"><link rel="preload" href="/kevin-blog/assets/js/app.dd46475d.js" as="script"><link rel="preload" href="/kevin-blog/assets/js/2.97d04891.js" as="script"><link rel="preload" href="/kevin-blog/assets/js/67.80828b1b.js" as="script"><link rel="prefetch" href="/kevin-blog/assets/js/10.2b686438.js"><link rel="prefetch" href="/kevin-blog/assets/js/100.cfc5acd5.js"><link rel="prefetch" href="/kevin-blog/assets/js/101.628bd39e.js"><link rel="prefetch" href="/kevin-blog/assets/js/102.41585307.js"><link rel="prefetch" href="/kevin-blog/assets/js/103.5d18350a.js"><link rel="prefetch" href="/kevin-blog/assets/js/104.85cd65cf.js"><link rel="prefetch" href="/kevin-blog/assets/js/105.9d303bac.js"><link rel="prefetch" href="/kevin-blog/assets/js/106.73f6a263.js"><link rel="prefetch" href="/kevin-blog/assets/js/107.9dfe114c.js"><link rel="prefetch" href="/kevin-blog/assets/js/108.315e8c63.js"><link rel="prefetch" href="/kevin-blog/assets/js/109.ef21ffa0.js"><link rel="prefetch" href="/kevin-blog/assets/js/11.2b0f6358.js"><link rel="prefetch" href="/kevin-blog/assets/js/110.dfe062a3.js"><link rel="prefetch" href="/kevin-blog/assets/js/111.08f0c3e7.js"><link rel="prefetch" href="/kevin-blog/assets/js/112.0e180f10.js"><link rel="prefetch" href="/kevin-blog/assets/js/113.295f1fca.js"><link rel="prefetch" href="/kevin-blog/assets/js/114.5645d09d.js"><link rel="prefetch" href="/kevin-blog/assets/js/115.ebe19212.js"><link rel="prefetch" href="/kevin-blog/assets/js/116.b3eb5cab.js"><link rel="prefetch" href="/kevin-blog/assets/js/117.076c6372.js"><link rel="prefetch" href="/kevin-blog/assets/js/118.226fb513.js"><link rel="prefetch" href="/kevin-blog/assets/js/119.298c0302.js"><link rel="prefetch" href="/kevin-blog/assets/js/12.01390043.js"><link rel="prefetch" href="/kevin-blog/assets/js/120.943d0d71.js"><link rel="prefetch" href="/kevin-blog/assets/js/121.2d1bd8ef.js"><link rel="prefetch" href="/kevin-blog/assets/js/122.84b9dff1.js"><link rel="prefetch" href="/kevin-blog/assets/js/123.85d93d87.js"><link rel="prefetch" href="/kevin-blog/assets/js/124.4913aefd.js"><link rel="prefetch" href="/kevin-blog/assets/js/125.cf667169.js"><link rel="prefetch" href="/kevin-blog/assets/js/126.eefd3250.js"><link rel="prefetch" href="/kevin-blog/assets/js/127.f9697daf.js"><link rel="prefetch" href="/kevin-blog/assets/js/128.aff6033d.js"><link rel="prefetch" href="/kevin-blog/assets/js/129.fa7ec9a8.js"><link rel="prefetch" href="/kevin-blog/assets/js/13.e55a4126.js"><link rel="prefetch" href="/kevin-blog/assets/js/130.9d50b78d.js"><link rel="prefetch" href="/kevin-blog/assets/js/131.f384aa34.js"><link rel="prefetch" href="/kevin-blog/assets/js/132.e60091dc.js"><link rel="prefetch" href="/kevin-blog/assets/js/133.09a9de16.js"><link rel="prefetch" href="/kevin-blog/assets/js/134.a7739a99.js"><link rel="prefetch" href="/kevin-blog/assets/js/135.bea491db.js"><link rel="prefetch" href="/kevin-blog/assets/js/136.92af3a82.js"><link rel="prefetch" href="/kevin-blog/assets/js/137.dbda7b02.js"><link rel="prefetch" href="/kevin-blog/assets/js/138.9fea4ca4.js"><link rel="prefetch" href="/kevin-blog/assets/js/139.0a81aff9.js"><link rel="prefetch" href="/kevin-blog/assets/js/14.efd69f3b.js"><link rel="prefetch" href="/kevin-blog/assets/js/140.3f048218.js"><link rel="prefetch" href="/kevin-blog/assets/js/141.002d7568.js"><link rel="prefetch" href="/kevin-blog/assets/js/142.aec10062.js"><link rel="prefetch" href="/kevin-blog/assets/js/143.2e682c5b.js"><link rel="prefetch" href="/kevin-blog/assets/js/144.d05092f0.js"><link rel="prefetch" href="/kevin-blog/assets/js/145.358437b8.js"><link rel="prefetch" href="/kevin-blog/assets/js/146.af219f24.js"><link rel="prefetch" href="/kevin-blog/assets/js/147.061cb5fe.js"><link rel="prefetch" href="/kevin-blog/assets/js/148.422d1f87.js"><link rel="prefetch" href="/kevin-blog/assets/js/149.c97f27f4.js"><link rel="prefetch" href="/kevin-blog/assets/js/15.271f58eb.js"><link rel="prefetch" href="/kevin-blog/assets/js/150.177533a9.js"><link rel="prefetch" href="/kevin-blog/assets/js/151.d70f314c.js"><link rel="prefetch" href="/kevin-blog/assets/js/152.ca40e6fc.js"><link rel="prefetch" href="/kevin-blog/assets/js/153.a2bca317.js"><link rel="prefetch" href="/kevin-blog/assets/js/154.22edbf9f.js"><link rel="prefetch" href="/kevin-blog/assets/js/155.e59b2d87.js"><link rel="prefetch" href="/kevin-blog/assets/js/156.d5a38de8.js"><link rel="prefetch" href="/kevin-blog/assets/js/157.cbe5199a.js"><link rel="prefetch" href="/kevin-blog/assets/js/158.31c5b8b2.js"><link rel="prefetch" href="/kevin-blog/assets/js/159.0763ed0c.js"><link rel="prefetch" href="/kevin-blog/assets/js/16.e92cdd55.js"><link rel="prefetch" href="/kevin-blog/assets/js/160.a05ced02.js"><link rel="prefetch" href="/kevin-blog/assets/js/161.7e52ed13.js"><link rel="prefetch" href="/kevin-blog/assets/js/162.f5df7208.js"><link rel="prefetch" href="/kevin-blog/assets/js/163.78a78de8.js"><link rel="prefetch" href="/kevin-blog/assets/js/164.54fd347c.js"><link rel="prefetch" href="/kevin-blog/assets/js/165.a0347ed3.js"><link rel="prefetch" href="/kevin-blog/assets/js/166.0702e96e.js"><link rel="prefetch" href="/kevin-blog/assets/js/167.69136cd0.js"><link rel="prefetch" href="/kevin-blog/assets/js/168.d0aa7e0d.js"><link rel="prefetch" href="/kevin-blog/assets/js/169.6229f0ca.js"><link rel="prefetch" href="/kevin-blog/assets/js/17.9a006e5d.js"><link rel="prefetch" href="/kevin-blog/assets/js/170.b6571721.js"><link rel="prefetch" href="/kevin-blog/assets/js/171.600f9683.js"><link rel="prefetch" href="/kevin-blog/assets/js/172.6e1792a7.js"><link rel="prefetch" href="/kevin-blog/assets/js/173.cef126b3.js"><link rel="prefetch" href="/kevin-blog/assets/js/174.97b3e897.js"><link rel="prefetch" href="/kevin-blog/assets/js/175.fcefca30.js"><link rel="prefetch" href="/kevin-blog/assets/js/176.31862a66.js"><link rel="prefetch" href="/kevin-blog/assets/js/177.089b09c0.js"><link rel="prefetch" href="/kevin-blog/assets/js/178.a5dcd25c.js"><link rel="prefetch" href="/kevin-blog/assets/js/179.a9d685f2.js"><link rel="prefetch" href="/kevin-blog/assets/js/18.a1c24192.js"><link rel="prefetch" href="/kevin-blog/assets/js/180.4ad69266.js"><link rel="prefetch" href="/kevin-blog/assets/js/181.691d48a2.js"><link rel="prefetch" href="/kevin-blog/assets/js/182.e77aa679.js"><link rel="prefetch" href="/kevin-blog/assets/js/183.2b4341f4.js"><link rel="prefetch" href="/kevin-blog/assets/js/184.b3610e8b.js"><link rel="prefetch" href="/kevin-blog/assets/js/185.08107897.js"><link rel="prefetch" href="/kevin-blog/assets/js/186.9f5a3f65.js"><link rel="prefetch" href="/kevin-blog/assets/js/187.ac2fe2c2.js"><link rel="prefetch" href="/kevin-blog/assets/js/188.09023a78.js"><link rel="prefetch" href="/kevin-blog/assets/js/189.409b4ed0.js"><link rel="prefetch" href="/kevin-blog/assets/js/19.c733cdfe.js"><link rel="prefetch" href="/kevin-blog/assets/js/190.ca5d775c.js"><link rel="prefetch" href="/kevin-blog/assets/js/191.8052fe42.js"><link rel="prefetch" href="/kevin-blog/assets/js/192.31ebe059.js"><link rel="prefetch" href="/kevin-blog/assets/js/193.9bf32e11.js"><link rel="prefetch" href="/kevin-blog/assets/js/194.0667554a.js"><link rel="prefetch" href="/kevin-blog/assets/js/195.ea249ba4.js"><link rel="prefetch" href="/kevin-blog/assets/js/196.6278ec5a.js"><link rel="prefetch" href="/kevin-blog/assets/js/197.90f6af7b.js"><link rel="prefetch" href="/kevin-blog/assets/js/198.2e358b6a.js"><link rel="prefetch" href="/kevin-blog/assets/js/199.a0bd0085.js"><link rel="prefetch" href="/kevin-blog/assets/js/20.890583ea.js"><link rel="prefetch" href="/kevin-blog/assets/js/200.bc1e237a.js"><link rel="prefetch" href="/kevin-blog/assets/js/201.767e166e.js"><link rel="prefetch" href="/kevin-blog/assets/js/202.a52f0e94.js"><link rel="prefetch" href="/kevin-blog/assets/js/203.06f0ebab.js"><link rel="prefetch" href="/kevin-blog/assets/js/204.7ae45191.js"><link rel="prefetch" href="/kevin-blog/assets/js/205.b8412fbc.js"><link rel="prefetch" href="/kevin-blog/assets/js/206.682f9a3e.js"><link rel="prefetch" href="/kevin-blog/assets/js/207.8978346c.js"><link rel="prefetch" href="/kevin-blog/assets/js/208.35db8c05.js"><link rel="prefetch" href="/kevin-blog/assets/js/209.1eebeab0.js"><link rel="prefetch" href="/kevin-blog/assets/js/21.48328b6a.js"><link rel="prefetch" href="/kevin-blog/assets/js/210.b56db64f.js"><link rel="prefetch" href="/kevin-blog/assets/js/211.31da36f5.js"><link rel="prefetch" href="/kevin-blog/assets/js/212.2f2d2d1f.js"><link rel="prefetch" href="/kevin-blog/assets/js/213.be55b8cc.js"><link rel="prefetch" href="/kevin-blog/assets/js/214.aeffc247.js"><link rel="prefetch" href="/kevin-blog/assets/js/215.137bae15.js"><link rel="prefetch" href="/kevin-blog/assets/js/216.2692c636.js"><link rel="prefetch" href="/kevin-blog/assets/js/217.a6a9cf62.js"><link rel="prefetch" href="/kevin-blog/assets/js/218.7353ed7a.js"><link rel="prefetch" href="/kevin-blog/assets/js/219.f1fdfe8e.js"><link rel="prefetch" href="/kevin-blog/assets/js/22.5fd865e7.js"><link rel="prefetch" href="/kevin-blog/assets/js/220.e20ab2b5.js"><link rel="prefetch" href="/kevin-blog/assets/js/221.0d06c8b0.js"><link rel="prefetch" href="/kevin-blog/assets/js/222.e39491a9.js"><link rel="prefetch" href="/kevin-blog/assets/js/223.ae98df72.js"><link rel="prefetch" href="/kevin-blog/assets/js/224.4ba5d334.js"><link rel="prefetch" href="/kevin-blog/assets/js/225.913ee059.js"><link rel="prefetch" href="/kevin-blog/assets/js/226.b8d730bd.js"><link rel="prefetch" href="/kevin-blog/assets/js/227.69ee92e2.js"><link rel="prefetch" href="/kevin-blog/assets/js/228.1cf17cff.js"><link rel="prefetch" href="/kevin-blog/assets/js/229.6ce44fac.js"><link rel="prefetch" href="/kevin-blog/assets/js/23.9ef4ab20.js"><link rel="prefetch" href="/kevin-blog/assets/js/230.30c28e05.js"><link rel="prefetch" href="/kevin-blog/assets/js/231.ef327150.js"><link rel="prefetch" href="/kevin-blog/assets/js/232.6cb791d8.js"><link rel="prefetch" href="/kevin-blog/assets/js/233.473fa94b.js"><link rel="prefetch" href="/kevin-blog/assets/js/234.848de787.js"><link rel="prefetch" href="/kevin-blog/assets/js/235.f5db4ed9.js"><link rel="prefetch" href="/kevin-blog/assets/js/236.5da3f87c.js"><link rel="prefetch" href="/kevin-blog/assets/js/237.018a543d.js"><link rel="prefetch" href="/kevin-blog/assets/js/238.74d22845.js"><link rel="prefetch" href="/kevin-blog/assets/js/239.fca187a6.js"><link rel="prefetch" href="/kevin-blog/assets/js/24.3dff5faa.js"><link rel="prefetch" href="/kevin-blog/assets/js/240.0dbbfe84.js"><link rel="prefetch" href="/kevin-blog/assets/js/241.8b1ccf29.js"><link rel="prefetch" href="/kevin-blog/assets/js/242.f5216a9f.js"><link rel="prefetch" href="/kevin-blog/assets/js/243.8e5c5e34.js"><link rel="prefetch" href="/kevin-blog/assets/js/244.8f78ae9a.js"><link rel="prefetch" href="/kevin-blog/assets/js/245.e0b2e7b9.js"><link rel="prefetch" href="/kevin-blog/assets/js/246.7700207e.js"><link rel="prefetch" href="/kevin-blog/assets/js/247.c1e13b57.js"><link rel="prefetch" href="/kevin-blog/assets/js/248.63d6adf8.js"><link rel="prefetch" href="/kevin-blog/assets/js/249.500fdd00.js"><link rel="prefetch" href="/kevin-blog/assets/js/25.0ebddc27.js"><link rel="prefetch" href="/kevin-blog/assets/js/250.ebbb5c92.js"><link rel="prefetch" href="/kevin-blog/assets/js/251.4e51605e.js"><link rel="prefetch" href="/kevin-blog/assets/js/252.2534bb33.js"><link rel="prefetch" href="/kevin-blog/assets/js/253.330d0073.js"><link rel="prefetch" href="/kevin-blog/assets/js/254.da99904b.js"><link rel="prefetch" href="/kevin-blog/assets/js/255.f9a1774e.js"><link rel="prefetch" href="/kevin-blog/assets/js/256.7ee8ac66.js"><link rel="prefetch" href="/kevin-blog/assets/js/257.41594669.js"><link rel="prefetch" href="/kevin-blog/assets/js/258.9d8beffc.js"><link rel="prefetch" href="/kevin-blog/assets/js/259.1539043a.js"><link rel="prefetch" href="/kevin-blog/assets/js/26.7e91ac9d.js"><link rel="prefetch" href="/kevin-blog/assets/js/260.034695f0.js"><link rel="prefetch" href="/kevin-blog/assets/js/261.953910a0.js"><link rel="prefetch" href="/kevin-blog/assets/js/262.e2b0764f.js"><link rel="prefetch" href="/kevin-blog/assets/js/263.fe9b0b70.js"><link rel="prefetch" href="/kevin-blog/assets/js/264.489e20f7.js"><link rel="prefetch" href="/kevin-blog/assets/js/265.43596b34.js"><link rel="prefetch" href="/kevin-blog/assets/js/266.07bb7008.js"><link rel="prefetch" href="/kevin-blog/assets/js/267.5caf5b93.js"><link rel="prefetch" href="/kevin-blog/assets/js/268.fc6e09e2.js"><link rel="prefetch" href="/kevin-blog/assets/js/269.764500c0.js"><link rel="prefetch" href="/kevin-blog/assets/js/27.55c7093f.js"><link rel="prefetch" href="/kevin-blog/assets/js/270.9760648a.js"><link rel="prefetch" href="/kevin-blog/assets/js/271.019b1f9a.js"><link rel="prefetch" href="/kevin-blog/assets/js/272.bce07ec6.js"><link rel="prefetch" href="/kevin-blog/assets/js/273.038ff1e3.js"><link rel="prefetch" href="/kevin-blog/assets/js/274.2cb7fd59.js"><link rel="prefetch" href="/kevin-blog/assets/js/275.3c831af6.js"><link rel="prefetch" href="/kevin-blog/assets/js/276.8d0732f8.js"><link rel="prefetch" href="/kevin-blog/assets/js/277.5aa0c664.js"><link rel="prefetch" href="/kevin-blog/assets/js/278.a3cdd3b8.js"><link rel="prefetch" href="/kevin-blog/assets/js/279.d049a479.js"><link rel="prefetch" href="/kevin-blog/assets/js/28.da28db4a.js"><link rel="prefetch" href="/kevin-blog/assets/js/280.6b7f68c4.js"><link rel="prefetch" href="/kevin-blog/assets/js/281.eff251cb.js"><link rel="prefetch" href="/kevin-blog/assets/js/282.f0dc7866.js"><link rel="prefetch" href="/kevin-blog/assets/js/283.36ca2fb9.js"><link rel="prefetch" href="/kevin-blog/assets/js/284.470e6db4.js"><link rel="prefetch" href="/kevin-blog/assets/js/285.a9c60b36.js"><link rel="prefetch" href="/kevin-blog/assets/js/286.3eff6f51.js"><link rel="prefetch" href="/kevin-blog/assets/js/287.f406cf63.js"><link rel="prefetch" href="/kevin-blog/assets/js/288.d6bb5731.js"><link rel="prefetch" href="/kevin-blog/assets/js/289.518409f3.js"><link rel="prefetch" href="/kevin-blog/assets/js/29.37ea8137.js"><link rel="prefetch" href="/kevin-blog/assets/js/290.e4795980.js"><link rel="prefetch" href="/kevin-blog/assets/js/291.6ca97e3d.js"><link rel="prefetch" href="/kevin-blog/assets/js/292.f434852f.js"><link rel="prefetch" href="/kevin-blog/assets/js/293.256f39e1.js"><link rel="prefetch" href="/kevin-blog/assets/js/294.0e051edc.js"><link rel="prefetch" href="/kevin-blog/assets/js/295.d6a1cfbb.js"><link rel="prefetch" href="/kevin-blog/assets/js/296.9a3f4bb2.js"><link rel="prefetch" href="/kevin-blog/assets/js/297.374bbc2d.js"><link rel="prefetch" href="/kevin-blog/assets/js/298.c37b0145.js"><link rel="prefetch" href="/kevin-blog/assets/js/299.008098d2.js"><link rel="prefetch" href="/kevin-blog/assets/js/3.0c6053de.js"><link rel="prefetch" href="/kevin-blog/assets/js/30.24e20f30.js"><link rel="prefetch" href="/kevin-blog/assets/js/300.ab07139a.js"><link rel="prefetch" href="/kevin-blog/assets/js/301.69ee5ffa.js"><link rel="prefetch" href="/kevin-blog/assets/js/302.05af46d8.js"><link rel="prefetch" href="/kevin-blog/assets/js/303.cec1cf65.js"><link rel="prefetch" href="/kevin-blog/assets/js/304.7c82ba6c.js"><link rel="prefetch" href="/kevin-blog/assets/js/305.7ac25f4a.js"><link rel="prefetch" href="/kevin-blog/assets/js/306.82149841.js"><link rel="prefetch" href="/kevin-blog/assets/js/307.f56afc9c.js"><link rel="prefetch" href="/kevin-blog/assets/js/308.7c084ed0.js"><link rel="prefetch" href="/kevin-blog/assets/js/309.feb89623.js"><link rel="prefetch" href="/kevin-blog/assets/js/31.19d1e3af.js"><link rel="prefetch" href="/kevin-blog/assets/js/310.1e33889a.js"><link rel="prefetch" href="/kevin-blog/assets/js/311.416e7d20.js"><link rel="prefetch" href="/kevin-blog/assets/js/312.ee11dbec.js"><link rel="prefetch" href="/kevin-blog/assets/js/313.f58bb112.js"><link rel="prefetch" href="/kevin-blog/assets/js/314.543b2b1c.js"><link rel="prefetch" href="/kevin-blog/assets/js/315.18b9a70e.js"><link rel="prefetch" href="/kevin-blog/assets/js/316.6dfba854.js"><link rel="prefetch" href="/kevin-blog/assets/js/317.19590777.js"><link rel="prefetch" href="/kevin-blog/assets/js/318.a3ec0c19.js"><link rel="prefetch" href="/kevin-blog/assets/js/319.f990a61a.js"><link rel="prefetch" href="/kevin-blog/assets/js/32.07887ecb.js"><link rel="prefetch" href="/kevin-blog/assets/js/320.a3c5cbbf.js"><link rel="prefetch" href="/kevin-blog/assets/js/321.1f58e49c.js"><link rel="prefetch" href="/kevin-blog/assets/js/322.032ff5a2.js"><link rel="prefetch" href="/kevin-blog/assets/js/323.cdd3ba68.js"><link rel="prefetch" href="/kevin-blog/assets/js/324.5238a4e1.js"><link rel="prefetch" href="/kevin-blog/assets/js/325.df06c071.js"><link rel="prefetch" href="/kevin-blog/assets/js/33.9539a78e.js"><link rel="prefetch" href="/kevin-blog/assets/js/34.fa08dd12.js"><link rel="prefetch" href="/kevin-blog/assets/js/35.d6823664.js"><link rel="prefetch" href="/kevin-blog/assets/js/36.5e074071.js"><link rel="prefetch" href="/kevin-blog/assets/js/37.f4a65a95.js"><link rel="prefetch" href="/kevin-blog/assets/js/38.4f127420.js"><link rel="prefetch" href="/kevin-blog/assets/js/39.a5427f94.js"><link rel="prefetch" href="/kevin-blog/assets/js/4.a60d4c06.js"><link rel="prefetch" href="/kevin-blog/assets/js/40.859a530c.js"><link rel="prefetch" href="/kevin-blog/assets/js/41.b61d8247.js"><link rel="prefetch" href="/kevin-blog/assets/js/42.cd204014.js"><link rel="prefetch" href="/kevin-blog/assets/js/43.8076c8fc.js"><link rel="prefetch" href="/kevin-blog/assets/js/44.8a85cf72.js"><link rel="prefetch" href="/kevin-blog/assets/js/45.f46f354b.js"><link rel="prefetch" href="/kevin-blog/assets/js/46.5990e5be.js"><link rel="prefetch" href="/kevin-blog/assets/js/47.9381b746.js"><link rel="prefetch" href="/kevin-blog/assets/js/48.77d95473.js"><link rel="prefetch" href="/kevin-blog/assets/js/49.fc6dff0d.js"><link rel="prefetch" href="/kevin-blog/assets/js/5.6b8c7ebc.js"><link rel="prefetch" href="/kevin-blog/assets/js/50.297dac6d.js"><link rel="prefetch" href="/kevin-blog/assets/js/51.c6ed15a6.js"><link rel="prefetch" href="/kevin-blog/assets/js/52.8bb5ec6f.js"><link rel="prefetch" href="/kevin-blog/assets/js/53.32ab5818.js"><link rel="prefetch" href="/kevin-blog/assets/js/54.1fe541f9.js"><link rel="prefetch" href="/kevin-blog/assets/js/55.6084b23b.js"><link rel="prefetch" href="/kevin-blog/assets/js/56.242cd75a.js"><link rel="prefetch" href="/kevin-blog/assets/js/57.a3aa61b8.js"><link rel="prefetch" href="/kevin-blog/assets/js/58.5dc813ec.js"><link rel="prefetch" href="/kevin-blog/assets/js/59.0649b9f5.js"><link rel="prefetch" href="/kevin-blog/assets/js/6.8f60ce79.js"><link rel="prefetch" href="/kevin-blog/assets/js/60.e912e60f.js"><link rel="prefetch" href="/kevin-blog/assets/js/61.2348484b.js"><link rel="prefetch" href="/kevin-blog/assets/js/62.43b03d30.js"><link rel="prefetch" href="/kevin-blog/assets/js/63.6e56096d.js"><link rel="prefetch" href="/kevin-blog/assets/js/64.c45908b4.js"><link rel="prefetch" href="/kevin-blog/assets/js/65.aab0a20e.js"><link rel="prefetch" href="/kevin-blog/assets/js/66.2555ebea.js"><link rel="prefetch" href="/kevin-blog/assets/js/68.5b1b38ff.js"><link rel="prefetch" href="/kevin-blog/assets/js/69.d735686b.js"><link rel="prefetch" href="/kevin-blog/assets/js/7.8fc0c0e7.js"><link rel="prefetch" href="/kevin-blog/assets/js/70.fd567fdf.js"><link rel="prefetch" href="/kevin-blog/assets/js/71.3dc39cbd.js"><link rel="prefetch" href="/kevin-blog/assets/js/72.6fe3454c.js"><link rel="prefetch" href="/kevin-blog/assets/js/73.80c96fab.js"><link rel="prefetch" href="/kevin-blog/assets/js/74.7b652913.js"><link rel="prefetch" href="/kevin-blog/assets/js/75.a9cc5506.js"><link rel="prefetch" href="/kevin-blog/assets/js/76.81bca567.js"><link rel="prefetch" href="/kevin-blog/assets/js/77.1851c464.js"><link rel="prefetch" href="/kevin-blog/assets/js/78.06a9be2e.js"><link rel="prefetch" href="/kevin-blog/assets/js/79.89ac9186.js"><link rel="prefetch" href="/kevin-blog/assets/js/8.d7f3575e.js"><link rel="prefetch" href="/kevin-blog/assets/js/80.76b8cfc2.js"><link rel="prefetch" href="/kevin-blog/assets/js/81.7c87b7a7.js"><link rel="prefetch" href="/kevin-blog/assets/js/82.1995f469.js"><link rel="prefetch" href="/kevin-blog/assets/js/83.dd77915d.js"><link rel="prefetch" href="/kevin-blog/assets/js/84.d167dd7d.js"><link rel="prefetch" href="/kevin-blog/assets/js/85.b858e7d4.js"><link rel="prefetch" href="/kevin-blog/assets/js/86.c4508e18.js"><link rel="prefetch" href="/kevin-blog/assets/js/87.e5015ac2.js"><link rel="prefetch" href="/kevin-blog/assets/js/88.03ea7184.js"><link rel="prefetch" href="/kevin-blog/assets/js/89.6c4aecd6.js"><link rel="prefetch" href="/kevin-blog/assets/js/9.541bf307.js"><link rel="prefetch" href="/kevin-blog/assets/js/90.e64c083e.js"><link rel="prefetch" href="/kevin-blog/assets/js/91.208ff0cf.js"><link rel="prefetch" href="/kevin-blog/assets/js/92.0247f769.js"><link rel="prefetch" href="/kevin-blog/assets/js/93.1d51e9e8.js"><link rel="prefetch" href="/kevin-blog/assets/js/94.52fd5e59.js"><link rel="prefetch" href="/kevin-blog/assets/js/95.3641a4fe.js"><link rel="prefetch" href="/kevin-blog/assets/js/96.a96da06a.js"><link rel="prefetch" href="/kevin-blog/assets/js/97.877152bf.js"><link rel="prefetch" href="/kevin-blog/assets/js/98.4fe249c2.js"><link rel="prefetch" href="/kevin-blog/assets/js/99.400d0dc4.js">
    <link rel="stylesheet" href="/kevin-blog/assets/css/0.styles.267bc68b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kevin-blog/" class="home-link router-link-active"><!----> <span class="site-name">Kevin-Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web" class="dropdown-title"><span class="title">Web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kevin-blog/ES6/Map 数据结构.html" class="nav-link">
  ES6
</a></li></ul></div></div><div class="nav-item"><a href="/kevin-blog/Python/DBUtils 数据库连接池模块.html" class="nav-link">
  Python
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Django" class="dropdown-title"><span class="title">Django</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kevin-blog/Django/Ajax.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/kevin-blog/Django ORM/ORM-ContentType.html" class="nav-link">
  ORM
</a></li><li class="dropdown-item"><!----> <a href="/kevin-blog/Django Rest-Framework/JWT - JSON Web Tokens.html" class="nav-link">
  Rest-Framework
</a></li></ul></div></div><div class="nav-item"><a href="/kevin-blog/Flask/Flask 文件上传.html" class="nav-link">
  Flask
</a></div><div class="nav-item"><a href="/kevin-blog/Git GitHub/Git.html" class="nav-link">
  Git GitHub
</a></div><div class="nav-item"><a href="/kevin-blog/Linux/CentOS 下载和安装.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/kevin-blog/MySQL/distinct 去重.html" class="nav-link">
  MySQL
</a></div><div class="nav-item"><a href="/kevin-blog/爬虫/Anaconda环境.html" class="nav-link">
  爬虫
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web" class="dropdown-title"><span class="title">Web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kevin-blog/ES6/Map 数据结构.html" class="nav-link">
  ES6
</a></li></ul></div></div><div class="nav-item"><a href="/kevin-blog/Python/DBUtils 数据库连接池模块.html" class="nav-link">
  Python
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Django" class="dropdown-title"><span class="title">Django</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kevin-blog/Django/Ajax.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/kevin-blog/Django ORM/ORM-ContentType.html" class="nav-link">
  ORM
</a></li><li class="dropdown-item"><!----> <a href="/kevin-blog/Django Rest-Framework/JWT - JSON Web Tokens.html" class="nav-link">
  Rest-Framework
</a></li></ul></div></div><div class="nav-item"><a href="/kevin-blog/Flask/Flask 文件上传.html" class="nav-link">
  Flask
</a></div><div class="nav-item"><a href="/kevin-blog/Git GitHub/Git.html" class="nav-link">
  Git GitHub
</a></div><div class="nav-item"><a href="/kevin-blog/Linux/CentOS 下载和安装.html" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/kevin-blog/MySQL/distinct 去重.html" class="nav-link">
  MySQL
</a></div><div class="nav-item"><a href="/kevin-blog/爬虫/Anaconda环境.html" class="nav-link">
  爬虫
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Django</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kevin-blog/Django/Ajax.html" class="sidebar-link">Ajax</a></li><li><a href="/kevin-blog/Django/App 概念.html" class="sidebar-link">App 概念</a></li><li><a href="/kevin-blog/Django/Cookie.html" class="sidebar-link">Cookie</a></li><li><a href="/kevin-blog/Django/Django 文件上传.html" class="sidebar-link">Django 文件上传</a></li><li><a href="/kevin-blog/Django/Django 日志配置.html" class="sidebar-link">Django 日志配置</a></li><li><a href="/kevin-blog/Django/Django使用Redis.html" class="sidebar-link">Django使用Redis</a></li><li><a href="/kevin-blog/Django/Django的时间问题.html" class="sidebar-link">Django的时间问题</a></li><li><a href="/kevin-blog/Django/Form 组件.html" class="sidebar-link">Form 组件</a></li><li><a href="/kevin-blog/Django/HTML协议.html" class="sidebar-link">HTML协议</a></li><li><a href="/kevin-blog/Django/HTML模板.html" class="sidebar-link">HTML模板</a></li><li><a href="/kevin-blog/Django/JWT - JSON Web Tokens.html" class="sidebar-link">JWT - JSON Web Tokens</a></li><li><a href="/kevin-blog/Django/MVC框架和MTV框架（了解即可）.html" class="sidebar-link">MVC框架和MTV框架（了解即可）</a></li><li><a href="/kevin-blog/Django/ModelForm 组件.html" class="sidebar-link">ModelForm 组件</a></li><li><a href="/kevin-blog/Django/RESTful 规范.html" class="sidebar-link">RESTful 规范</a></li><li><a href="/kevin-blog/Django/Session.html" class="sidebar-link">Session</a></li><li><a href="/kevin-blog/Django/Web框架的本质（重要+理解）.html" class="sidebar-link">Web框架的本质（重要+理解）</a></li><li><a href="/kevin-blog/Django/admin 的使用.html" class="sidebar-link">admin 的使用</a></li><li><a href="/kevin-blog/Django/auth 认证模块.html" class="sidebar-link">auth 认证模块</a></li><li><a href="/kevin-blog/Django/cache 缓存系统.html" class="sidebar-link">cache 缓存系统</a></li><li><a href="/kevin-blog/Django/csrf token.html" class="sidebar-link">csrf token</a></li><li><a href="/kevin-blog/Django/media 多媒体文件的配置.html" class="sidebar-link">media 多媒体文件的配置</a></li><li><a href="/kevin-blog/Django/rest-framework token认证.html" class="sidebar-link">rest-framework token认证</a></li><li><a href="/kevin-blog/Django/rest-framework 框架.html" class="active sidebar-link">rest-framework 框架</a></li><li><a href="/kevin-blog/Django/中间件.html" class="sidebar-link">中间件</a></li><li><a href="/kevin-blog/Django/使用Django的注意事项.html" class="sidebar-link">使用Django的注意事项</a></li><li><a href="/kevin-blog/Django/使用Python脚本调用Django环境.html" class="sidebar-link">使用Python脚本调用Django环境</a></li><li><a href="/kevin-blog/Django/内置分页（了解）.html" class="sidebar-link">内置分页（了解）</a></li><li><a href="/kevin-blog/Django/安装和启动.html" class="sidebar-link">安装和启动</a></li><li><a href="/kevin-blog/Django/自定义分页.html" class="sidebar-link">自定义分页</a></li><li><a href="/kevin-blog/Django/视图系统.html" class="sidebar-link">视图系统</a></li><li><a href="/kevin-blog/Django/跨域.html" class="sidebar-link">跨域</a></li><li><a href="/kevin-blog/Django/路由系统.html" class="sidebar-link">路由系统</a></li><li><a href="/kevin-blog/Django/配置文件.html" class="sidebar-link">配置文件</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div><span><div><div><div><div><div><div><div><div><br></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">rest-framework框架的介绍</span></h2><div><br></div><ul><li><div>rest-framework 是根据 RESTful 规范开发出来的一套 Django 的 API 框架</div></li></ul><div><br></div><ul><li><div>rest-framework 是建立在CBV基础上使用的 -&gt; 通俗理解: 如果要是用 rest-framework，那么就一定要使用 CBV 去编写视图</div></li></ul><div><br></div><ul><li><div>rest-framework 的作用: 开发符合 RESTful 规范的接口</div></li></ul><div><br></div><ul><li><div>rest-framework 的10个功能（按请求顺序排序）: 路由 视图 版本 认证 权限 频率 解析器 序列化 分页 渲染器</div></li></ul><div><br></div></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;font-weight:bold;line-height:1.5;background-color:#3eaf7c;border-radius:3px;text-align:center;color:white;text-shadow:rgb(34, 34, 34) 1px 1px 2px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-ligatures:normal;font-variant-caps:normal;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;font-weight:bold;line-height:1.5;background-color:#3eaf7c;border-radius:3px;color:white;text-shadow:rgb(34, 34, 34) 1px 1px 2px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-ligatures:normal;font-variant-caps:normal;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;">csrf token 的问题</span></h2><div><br></div><ul><li><div>在使用 rest-framework 编写接口的时候会默认忽略掉 csrf token 认证中间件</div></li></ul><div><br></div><ul><ul><li><div>原理: 在 .as_view() 返回 view 视图函数的时候会在 view 视图函数上加上 csrf_exempt 装饰器，使其忽略 csrf token 的认证</div></li></ul></ul><div><br></div><div><img data-filename="Image.png" src="/kevin-blog/Django/rest-framework 框架_files/Image.png" type="image/png"></div><div><br></div><ul><li><div>如果在编写接口的时候还是发生了 csrf token 问题的解决办法</div></li></ul><div><br></div><ul><ul><li><div>问题一: Postman 可以正常发送请求，但是在浏览器上无法正常发送</div></li></ul></ul><div><br></div><ul><ul><ul><li><div>解决办法一: 以 vue 项目为例: 查看 cookie 中是否存在 csrf token 的相关 cookie，如果存在清楚浏览器所有 cookie 即可</div></li></ul></ul></ul><div><br></div><ul><ul><ul><li><div>解决办法二: 以 vue 项目为例: 先注释掉 csrf token 中间件，然后查看浏览器是否可以正常发送请求，如果可以，删除掉 csrf token 中间件的注释，给视图类下的视图函数单独添加  csrf_exempt 装饰器</div></li></ul></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from django.utils.decorators import method_decorator</div><div>from django.views.decorators.csrf import <font color="#FA7A00">csrf_exempt</font></div><div><br></div><div>class Test(APIView):</div><div>　　@method_decorator(<font color="#FA7A00">csrf_exempt</font>)  <font color="#41AD1C"># 给类里面的方法加装饰器  需要导入一个方法method_decorator</font></div><div>　　def post(self, request):</div><div>　　　　return Response({'a': 1})</div></div><div><br></div><ul><ul><li><div>问题一: Postman 可以无法发送请求，浏览器上也无法正常发送</div></li></ul></ul><div><br></div><ul><ul><ul><li><div>解决办法: 先注释掉 csrf token 中间件，然后查看Postman是否可以正常发送请求，如果可以，删除掉 csrf token 中间件的注释，给视图类下的视图函数单独添加  csrf_exempt 装饰器</div></li></ul></ul></ul><div><br></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">本章节所使用的数据库</span></h2><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"><font style="font-size:9pt;"># models.py</font></span></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">from django.db import models</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;"><br></font></div><div>class User(models.Model):</div><div>    username = models.CharField(max_length=32)</div><div>    password = models.CharField(max_length=32)</div><div>    type_choices = ((1, '普通用户'), (2, 'VIP'), (3, 'SVIP'))</div><div>    user_type = models.IntegerField(choices=type_choices, default=1)</div><div><br></div><div>    def __str__(self):</div><div>        return self.username</div><div><br></div><div>    class Meta:</div><div>        verbose_name = &quot;用户表&quot;</div><div>        verbose_name_plural = verbose_name</div><div><br></div><div><br></div><div>class Token(models.Model):</div><div>    user = models.OneToOneField(to='User')</div><div>    token = models.CharField(max_length=128)</div><div><br></div><div>    def __str__(self):</div><div>        return self.token</div><div><br></div><div>    class Meta:</div><div>        verbose_name = &quot;Token表&quot;</div><div>        verbose_name_plural = verbose_name</div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">class Book(models.Model):</font></div><div><font style="font-size:9pt;">    title = models.CharField(max_length=32, verbose_name='书名')</font></div><div><font style="font-size:9pt;">    price = models.IntegerField(verbose_name='价格')</font></div><div><font style="font-size:9pt;">    pub_date = models.DateField(verbose_name='出版日期')</font></div><div><font style="font-size:9pt;"></font>production_date = models.DateTimeField(verbose_name='生产日期', null=True)</div><div><font style="font-size:9pt;">    publish = models.ForeignKey(&quot;Publish&quot;, verbose_name='出版社')</font></div><div><font style="font-size:9pt;">    authors = models.ManyToManyField(&quot;Author&quot;, verbose_name='作者')</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">    def __str__(self):</font></div><div><font style="font-size:9pt;">        return self.title</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">    class Meta:</font></div><div><font style="font-size:9pt;">        verbose_name = &quot;书籍表&quot;</font></div><div><font style="font-size:9pt;">        verbose_name_plural = verbose_name</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">class Publish(models.Model):</font></div><div><font style="font-size:9pt;">    name = models.CharField(max_length=32, verbose_name='出版社名称')</font></div><div><font style="font-size:9pt;">    email = models.EmailField(verbose_name='邮箱')</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">    def __str__(self):</font></div><div><font style="font-size:9pt;">        return self.name</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">    class Meta:</font></div><div><font style="font-size:9pt;">        verbose_name = &quot;出版社表&quot;</font></div><div><font style="font-size:9pt;">        verbose_name_plural = verbose_name</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">class Author(models.Model):</font></div><div><font style="font-size:9pt;">    name = models.CharField(max_length=32, verbose_name='姓名')</font></div><div><font style="font-size:9pt;">    age = models.IntegerField(verbose_name='年龄')</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">    def __str__(self):</font></div><div><font style="font-size:9pt;">        return self.name</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">    class Meta:</font></div><div><font style="font-size:9pt;">        verbose_name = &quot;作者表&quot;</font></div><div><font style="font-size:9pt;">        verbose_name_plural = verbose_name</font></div></div><div><br></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">rest-framework 的下载与配置</span></h2><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"> 下载 rest-</span><span style="font-size:14pt;font-weight:bold;">framework </span></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>pip3 install djangorestframework -i https://pypi.douban.com/simple <span style="color:rgb(65, 173, 28);"># 使用豆瓣的镜像</span></div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"> 注册 rest-</span><span style="font-size:14pt;font-weight:bold;">framework</span></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># settings.py</font></div><div><br></div><div>INSTALLED_APPS = [</div><div><font color="#41AD1C">……</font></div><div>    'rest_framework',</div><div>]</div></div><div><br></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">接口类的编写规范</span></h2><div><br></div><ul><li><div>在编写接口的时候要注意不能出现异常导致程序运行中断，而是使用 try 对异常进行捕获防治程序运行中断</div></li></ul><div><br></div><ul><li><div>编写好每个异常的状态码（即: code），每个状态码就代表着一个错误信息</div></li></ul><div><br></div><ul><li><div><span style="color:rgb(255, 0, 0);">注意: 在本章节中只有这里使用了接口类编写规范，其他栏目没有使用需要注意，且一定要按照该规范编写</span></div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># response.py</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 返回给前端的数据结构</font></div><div>class BaseResponse(object):</div><div>    def __init__(self):</div><div>        self.code = 0</div><div>        self.data = None</div><div>        self.msg = ''</div><div><br></div><div>    @property</div><div>    def dic(self):</div><div>        return self.__dict__</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># exceptions.py</font></div><div><br></div><div><font color="#41AD1C"># 自定义异常类</font></div><div>class CommonException(Exception):</div><div>    def __init__(self, code, msg):</div><div>        self.code = code</div><div>        self.msg = msg</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div><br></div><div>from django.core.exceptions import ObjectDoesNotExist <font color="#41AD1C"> # 如果查询不到数据会抛出该错误</font></div><div><br></div><div>from api.utils.response import BaseResponse</div><div>from api.utils.exceptions import CommonException  <font color="#41AD1C"># 自定义异常类</font></div><div><br></div><div><br></div><div>class Spec(APIView):</div><div>    def get(self):</div><div>        res = BaseResponse()</div><div>        try:</div><div>            obj1 = 表类.objects.get(pk=xxx)  <font color="#41AD1C"># .get() 方法如果查询不到就会抛出 ObjectDoesNotExist 异常</font></div><div>            obj2 = 表类.objects.filter(pk=xxx).first()  <font color="#41AD1C"># 如果查询不到不会抛出异常，只会返回 None</font></div><div><br></div><div>            if not obj2:</div><div>                raise CommonException(1002, 'xxx不存在2')</div><div><br></div><div>            res.data = {</div><div>                'xxx': obj1.xxx,</div><div>                'xxx': obj2.xxx</div><div>            }</div><div><br></div><div>        except ObjectDoesNotExist as e:</div><div>            res.msg = 'xxx不存在1'</div><div>            res.code = 1001</div><div>        except CommonException as e:</div><div>            res.msg = e.msg</div><div>            res.code = e.code</div><div>        except Exception as e:</div><div>            print(e)</div><div><font color="#FA7A00"># 捕获其他不知道的异常，然后写入日志中</font></div><div>        return Response(res.dic)</div></div><div><br></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">序列化组件</span></h2><div><br></div><div><span style="font-size:14pt;">只要继承了 APIView 就可以使用序列化组件</span></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"> 序列化组件的基本使用</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>序列化组件 的使用和 form 组件的使用类似，都需要定义一个类，而这个类就叫: 序列化类</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># serializer.py</font></div><div><br></div><div>from rest_framework import serializers</div><div><br></div><div><br></div><div>class PublishSerializers(serializers.Serializer):</div><div>    name = serializers.CharField()</div><div>    email = serializers.CharField()</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div>    def get(self, request):</div><div>        publish_obj = Publish.objects.all()</div><div><br></div><div>        ps = PublishSerializers(publish_obj, many=True)  <font color="#E30000"># 通过你所创建的 序列化类 序列化数据</font></div><div>        data = ps.data  <font color="#E30000"># Serializer对象.data 获取序列化后的数据</font> <font color="#41AD1C">-&gt; [OrderedDict([('name', '东莞出版社'), ('email', '123@qq.com')]), OrderedDict([('name', '广州出版社'), ('email', '123@qq.com')])]</font></div><div><br></div><div>        return Response(data)</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/publish/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>[</div><div>    {</div><div>        &quot;name&quot;: &quot;东莞出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;</div><div>    },</div><div>    {</div><div>        &quot;name&quot;: &quot;广州出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;</div><div>    }</div><div>]</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"> many 参数</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>many 参数: 说明所要序列化的数据是 queryset对象（查询到的数据列表）还是 查询到的数据对象</div></li></ul><div><br></div><ul><li><div>many=True -&gt; 所要序列化的数据是 queryset对象（查询到的数据列表）</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># serializer.py</span></div><div><br></div><div>from rest_framework import serializers</div><div><br></div><div><br></div><div>class PublishSerializers(serializers.Serializer):</div><div>    name = serializers.CharField()</div><div>    email = serializers.CharField()</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># views.py</span></div><div><br></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div>    def get(self, request):</div><div>        publish_obj = Publish.objects.all()</div><div><br></div><div>        ps = PublishSerializers(publish_obj, <font color="#FA7A00">many</font>=True)  <font color="#41AD1C"># 所要序列化的数据是 queryset对象（查询到的数据列表）</font></div><div>        data = ps.data</div><div><br></div><div>        return Response(data)</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/publish/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>[</div><div>    {</div><div>        &quot;name&quot;: &quot;东莞出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;</div><div>    },</div><div>    {</div><div>        &quot;name&quot;: &quot;广州出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;</div><div>    }</div><div>]</div></div><div><br></div><ul><li><div>many=False -&gt; 所要序列化的数据是查询到的数据对象，且 many 参数默认值为False，所以在序列化查询到的数据对象的时候 many 参数可以不用传</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># serializer.py</span></div><div><br></div><div>from rest_framework import serializers</div><div><br></div><div><br></div><div>class PublishSerializers(serializers.Serializer):</div><div>    name = serializers.CharField()</div><div>    email = serializers.CharField()</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># views.py</span></div><div><br></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div>    def get(self, request):</div><div>        publish_obj = Publish.objects.all().first()</div><div><br></div><div><font color="#41AD1C"># ps = PublishSerializers(publish_obj,</font> <font color="#FA7A00">many</font><font color="#41AD1C">=False)  # 所要序列化的数据是查询到的数据对象</font></div><div>        ps = PublishSerializers(publish_obj)  <font color="#41AD1C"># 所要序列化的数据是查询到的数据对象</font></div><div>        data = ps.data</div><div><br></div><div>        return Response(data)</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/publish/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>{</div><div>    &quot;name&quot;: &quot;东莞出版社&quot;,</div><div>    &quot;email&quot;: &quot;123@qq.com&quot;</div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">3.</span><span style="font-size:14pt;font-weight:bold;"> Response() 方法</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">rest-framework 所提供的 Response() 方法实际上也是继承了 </span>HttpResponse ，只是在 HttpResponse 的基础上扩展了一些功能</div></li><li><div>如果使用了 <span style="font-size:12pt;">rest-framework 那么就使用它所提供的 </span><span style="font-size:12pt;">Response() 方法将数据发送给前端</span></div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># serializer.py</span></div><div><br></div><div>from rest_framework import serializers</div><div><br></div><div><br></div><div>class PublishSerializers(serializers.Serializer):</div><div>    name = serializers.CharField()</div><div>    email = serializers.CharField()</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># views.py</span></div><div><br></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div>    def get(self, request):</div><div>        publish_obj = Publish.objects.all().first()</div><div>        ps = PublishSerializers(publish_obj)</div><div>        data = ps.data</div><div><br></div><div>        return <font color="#FA7A00">Response</font>(data)</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">Response() 方法可以直接对 字典、列表、元祖、字符串、数字 进行发送</span></div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div><br></div><div>    def get(self, request):</div><div>        return Response({'a': 1, 'b': 2})</div><div><font color="#41AD1C"> # return Response([1, 2, 3])</font></div><div><font style="color:rgb(65, 173, 28);">        # return Response((1, 2, 3))</font></div><div><font style="color:rgb(65, 173, 28);"></font><font color="#41AD1C"># return Response('字符串')</font></div><div><font color="#41AD1C">        # return Response(10)</font></div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">4.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;font-weight:bold;">序列化日期对象并且处理日期格式</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>format='日期格式'</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># serializer.py</font></div><div><br></div><div>from rest_framework import serializers</div><div><br></div><div><br></div><div>class BookSerializers(serializers.Serializer):</div><div>    title = serializers.CharField()</div><div>    price = serializers.CharField()</div><div>    pub_date = serializers.CharField()</div><div>    production_date = serializers.<font color="#FA7A00">DateTimeField</font>(<font color="#FA7A00">format='%Y-%m-%d %H:%M:%S'</font>)</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class BookView(APIView):</div><div>    def get(self, request):</div><div>        book_list = Book.objects.all()</div><div>        bs = BookSerializers(book_list, many=True)</div><div>        data = bs.data</div><div>        return Response(data)</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><font color="#41AD1C"><br></font></div><div>[</div><div>    {</div><div>        &quot;title&quot;: &quot;三国演义&quot;,</div><div>        &quot;price&quot;: &quot;100&quot;,</div><div>        &quot;pub_date&quot;: &quot;2019-08-11&quot;,</div><div>        &quot;<font color="#FA7A00">production_date</font>&quot;: &quot;2019-08-11 18:07:19&quot;</div><div>    },</div><div>    {</div><div>        &quot;title&quot;: &quot;红楼梦&quot;,</div><div>        &quot;price&quot;: &quot;200&quot;,</div><div>        &quot;pub_date&quot;: &quot;2019-08-11&quot;,</div><div>        &quot;<font color="#FA7A00">production_date</font>&quot;: &quot;2019-08-11 18:08:06&quot;</div><div>    }</div><div>]</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">4.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;font-weight:bold;">Serializer 类的 depth </span><span style="font-size:14pt;font-weight:bold;">参数说明</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>作用: 序列化 一对多 或 多对多 字段</div></li></ul><div><br></div><ul><li><div>depth 的缺点: 获取很多与当前接口无用的字段数据（即: 获取到一对多或多对多字段中的全部数据）</div></li></ul><div><br></div><ul><li><div>depth 值的说明: 必须为数值</div></li><ul><li><div>当前值为0: 序列化出来的是 一对多 或 多对多字段 所保存的 id 值</div></li><li><div>当前值为1: 序列化出来的是 一对多 或 多对多字段 所对应的表的数据</div></li><li><div>当前值为2: 如果 一对多 或 多对多字段 中还有 一对多 或 多对多字段，那么就序列化出该 一对多 或 多对多字段 所对应的表的数据</div></li><li><div>当前数值为n: ……</div></li></ul></ul><div><br></div><ul><li><div>depth 的默认值: 0</div></li></ul><div><br></div><ul><li><div>depth 官方取值范围推荐: 1-10</div></li></ul><div><br></div><ul><li><div>depth = 0</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="color:rgb(65, 173, 28);"># serializer.py</font></div><div><font color="#41AD1C"><br></font></div><div>from rest_framework import serializers</div><div>from .models import *</div><div><br></div><div><br></div><div>class BookSerializers(serializers.ModelSerializer):</div><div>    class Meta:</div><div>        model = Book</div><div>        fields = '__all__'</div><div><font color="#FA7A00">depth</font> = 1</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><font color="#41AD1C"><br></font></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .serializer import *</div><div>from .models import *</div><div><br></div><div><br></div><div>class BookView(APIView):</div><div>    def get(self, request):</div><div>        book_list = Book.objects.all()</div><div>        bs = BookSerializers(book_list, many=True)</div><div>        return Response(bs.data)</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># </span>depth = 0</div><div><br></div><div><font style="color:rgb(65, 173, 28);"># 接口: http://127.0.0.1:8001/book/</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: GET</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>[</div><div>    {</div><div>        &quot;id&quot;: 2,</div><div>        &quot;title&quot;: &quot;三体（第二部）&quot;,</div><div>        &quot;price&quot;: 100,</div><div>        &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>        &quot;<font color="#FA7A00">publish</font>&quot;: 1,</div><div>        &quot;<font color="#FA7A00">authors</font>&quot;: [</div><div>            1,</div><div>            2</div><div>        ]</div><div>    },</div><div>    {</div><div>        &quot;id&quot;: 5,</div><div>        &quot;title&quot;: &quot;三国演义&quot;,</div><div>        &quot;price&quot;: 100,</div><div>        &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>        &quot;<font color="#FA7A00">publish</font>&quot;: 1,</div><div>        &quot;<font color="#FA7A00">authors</font>&quot;: [</div><div>            1,</div><div>            2</div><div>        ]</div><div>    }</div><div>]</div><div><br></div><div><font color="#FA7A00"># --------------------------------------------------------------</font></div><div><font color="#FA7A00"><br></font></div><div><font color="#41AD1C">#</font> <font color="#000000">depth = 1</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8001/book/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><span style="font-size:9pt;color:rgb(51, 51, 51);font-family:Monaco;"><br></span></div><div>[</div><div>    {</div><div>        &quot;id&quot;: 2,</div><div>        &quot;title&quot;: &quot;三体（第二部）&quot;,</div><div>        &quot;price&quot;: 100,</div><div>        &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>        &quot;<font color="#FA7A00">publish</font>&quot;: {</div><div>            &quot;id&quot;: 1,</div><div>            &quot;name&quot;: &quot;东莞出版社&quot;,</div><div>            &quot;email&quot;: &quot;123@qq.com&quot;</div><div>        },</div><div>        &quot;<font color="#FA7A00">authors</font>&quot;: [</div><div>            {</div><div>                &quot;id&quot;: 1,</div><div>                &quot;name&quot;: &quot;Kevin&quot;,</div><div>                &quot;age&quot;: 18</div><div>            },</div><div>            {</div><div>                &quot;id&quot;: 2,</div><div>                &quot;name&quot;: &quot;Aimer&quot;,</div><div>                &quot;age&quot;: 20</div><div>            }</div><div>        ]</div><div>    },</div><div>    {</div><div>        &quot;id&quot;: 5,</div><div>        &quot;title&quot;: &quot;三国演义&quot;,</div><div>        &quot;price&quot;: 100,</div><div>        &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>        &quot;<font color="#FA7A00">publish</font>&quot;: {</div><div>            &quot;id&quot;: 1,</div><div>            &quot;name&quot;: &quot;东莞出版社&quot;,</div><div>            &quot;email&quot;: &quot;123@qq.com&quot;</div><div>        },</div><div>        &quot;<font color="#FA7A00">authors</font>&quot;: [</div><div>            {</div><div>                &quot;id&quot;: 1,</div><div>                &quot;name&quot;: &quot;Kevin&quot;,</div><div>                &quot;age&quot;: 18</div><div>            },</div><div>            {</div><div>                &quot;id&quot;: 2,</div><div>                &quot;name&quot;: &quot;Aimer&quot;,</div><div>                &quot;age&quot;: 20</div><div>            }</div><div>        ]</div><div>    }</div><div>]</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">5.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;font-weight:bold;">Serializer 类的 </span><span style="font-size:14pt;font-weight:bold;">source 参数说明</span></div><div><br></div><ul><li><div>source 参数一般用于序列化 choices 字段 和 一对多字段</div></li></ul><div><br></div><ul><li><div>source 参数可以序列化自身字段，但是没有意义</div></li><ul><li><div>即: username = serializers.CharField(source='username') 等同于 username = serializers.CharField()</div></li></ul></ul><div><br></div><ul><li><div>source 参数的值支持像模板语言中的链式操作</div></li><ul><li><div>source='get_choices字段_display' -&gt; source='get_user_type_display'</div></li><li><div>source='一对多字段名.字段' -&gt; source='publish.name'</div></li><li><div>source='多对多字段名.all' -&gt; source='authors.all'</div></li></ul></ul><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">6.</span><span style="font-size:14pt;font-weight:bold;"> 序列化 </span><span style="font-size:14pt;"><span style="font-size:14pt;font-weight:bold;">choices </span></span><span style="font-size:14pt;font-weight:bold;">字段的方法</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>使用 source 参数序列化 choices 字段</div></li></ul><div><br></div><ul><li><div>如果不使用 source 参数序列化 choices 字段，那么在序列化 choices 字段的时候默认会取与该字段所保存的数值</div></li></ul><div><br></div><ul><li><div>语法: source='get_choices字段_display'</div></li></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="color:rgb(65, 173, 28);"># serializer.py</font></div><div><font color="#41AD1C"><br></font></div><div>from rest_framework import serializers</div><div><br></div><div><br></div><div>class UserSerializers(serializers.Serializer):</div><div>    username = serializers.CharField()</div><div>    user_type = serializers.CharField(<font color="#FA7A00">source</font>='<font color="#FA7A00">get_</font>user_type<font color="#FA7A00">_display</font>')</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><font color="#41AD1C"><br></font></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .serializer import *</div><div>from .models import *</div><div><br></div><div><br></div><div>class UserView(APIView):</div><div>    def get(self, request):</div><div>        user_list = User.objects.all()</div><div>        us = UserSerializers(user_list, many=True)</div><div>        print(us.data)  <font color="#41AD1C"># [OrderedDict([('username', 'Kevin'), ('</font><font color="#FA7A00">user_type</font><font color="#41AD1C">', 'SVIP')]), OrderedDict([('username', 'Aimer'), ('</font><font color="#FA7A00">user_type</font><font color="#41AD1C">', 'VIP')]), OrderedDict([('username', 'Jack'), ('</font><font color="#FA7A00">user_type</font><font color="#41AD1C">', '普通用户')])]</font></div><div>        return Response(us.data)</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);">#</span> <font color="#41AD1C">接口: http://127.0.0.1:8001/user/</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: GET</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>[</div><div>    {</div><div>        &quot;username&quot;: &quot;Kevin&quot;,</div><div>        &quot;<font color="#FA7A00">user_type</font>&quot;: &quot;SVIP&quot;</div><div>    },</div><div>    {</div><div>        &quot;username&quot;: &quot;Aimer&quot;,</div><div>        &quot;<font color="#FA7A00">user_type</font>&quot;: &quot;VIP&quot;</div><div>    },</div><div>    {</div><div>        &quot;username&quot;: &quot;Jack&quot;,</div><div>        &quot;<font color="#FA7A00">user_type</font>&quot;: &quot;普通用户&quot;</div><div>    }</div><div>]</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">7.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;"><span style="font-size:14pt;font-weight:bold;">SerializerMethodField 自定义字段</span></span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">SerializerMethodField() 字段方法的作用: 自定义字段的返回值</span></div></li></ul><div><br></div><ul><li><div>使用场景: 当我们想返回一些自定义的值的时候，就可以使用 <span style="font-size:12pt;">SerializerMethodField</span></div></li></ul><div><br></div><ul><li><div><span style="font-size:12pt;">函数名定义规则: get_字段名</span></div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># serializer.py</font></div><div><font color="#41AD1C"><br></font></div><div>from rest_framework import serializers</div><div><br></div><div><br></div><div>class BookSerializers(serializers.Serializer):</div><div>    title = serializers.CharField()</div><div>    price = serializers.CharField()</div><div><br></div><div>    custom_field = serializers.<font color="#FA7A00">SerializerMethodField</font>()</div><div><br></div><div>    def <font color="#FA7A00">get_custom_field</font>(self, obj):</div><div><font color="#41AD1C">&quot;&quot;&quot;</font></div><div><font color="#41AD1C">        :param</font> <font color="#FA7A00">obj</font><font color="#41AD1C">:</font> <font color="#FA7A00">obj 就是数据库中的一条数据</font></div><div><font color="#41AD1C">        :</font><font color="#FA7A00">return</font><font color="#41AD1C">:</font> <font color="#FA7A00">所要显示的数据</font></div><div><font color="#41AD1C">        &quot;&quot;&quot;</font></div><div>        price = obj.price</div><div>        return price + 100</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># views.py</span></div><div><br></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class BookView(APIView):</div><div>    def get(self, request):</div><div>        book_list = Book.objects.all()</div><div>        bs = BookSerializers(book_list, many=True)</div><div>        print(bs.data)  <span style="color:rgb(65, 173, 28);">#</span><font color="#41AD1C"> [OrderedDict([('title', '三体'), ('price', '100'), ('</font><font color="#FA7A00">custom_field</font><font color="#41AD1C">', 200)]), OrderedDict([('title', '七大罪'), ('price', '50'), ('</font><font color="#FA7A00">custom_field</font><font color="#41AD1C">', 150)])]</font></div><div>        return Response(bs.data)</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: GET</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>[</div><div>    {</div><div>        &quot;title&quot;: &quot;三体&quot;,</div><div>        &quot;price&quot;: &quot;100&quot;,</div><div>        &quot;<font color="#FA7A00">custom_field</font>&quot;: 200</div><div>    },</div><div>    {</div><div>        &quot;title&quot;: &quot;七大罪&quot;,</div><div>        &quot;price&quot;: &quot;50&quot;,</div><div>        &quot;<font color="#FA7A00">custom_field</font>&quot;: 150</div><div>    }</div><div>]</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">8.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;font-weight:bold;">context </span><font style="font-size:14pt;"><span style="font-size:14pt;font-weight:bold;">参数</span><span style="font-size:14pt;font-weight:bold;">（即: </span><span style="font-size:14pt;font-weight:bold;color:rgb(227, 0, 0);">在 </span><span style="font-size:14pt;font-weight:bold;color:rgb(227, 0, 0);">serializers 中获取 request 对象</span><span style="font-size:14pt;font-weight:bold;">）</span></font></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>视图类没有使用 serializer_class 参数</div></li></ul><div><br></div><ul><ul><li><div>通过 context 参数 <span style="font-size:12pt;">serializers 可以接收视图传递过来的参数</span></div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class BookView(APIView):</div><div>    def get(self, request):</div><div>        book_list = Book.objects.all()</div><div>        bs = BookSerializers(book_list, many=True, <font color="#FA7A00">context</font>={'request': request, 'username': 'Kevin', 'age': 18})</div><div>        return Response(bs.data)</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="color:rgb(65, 173, 28);"># serializers.py</font></div><div><br></div><div>class BookSerializers(serializers.Serializer):</div><div>    title = serializers.CharField()</div><div>    price = serializers.CharField()</div><div><br></div><div>    custom_field = serializers.SerializerMethodField()</div><div><br></div><div>    def get_custom_field(self, obj):</div><div>        print(<font color="#FA7A00">self.context</font>) <font color="#41AD1C"> # {'request': &lt;rest_framework.request.Request object at 0x0000025F75F0D668&gt;, 'age': 18, 'username': 'Kevin'}</font></div><div>        request = <font color="#FA7A00">self.context</font>.get('request')</div><div>        username = <font color="#FA7A00">self.context</font>.get('username')</div><div>        age = <font color="#FA7A00">self.context</font>.get('age')</div><div>        return 1</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>视图类使用了 serializer_class 参数</div></li></ul><div><br></div><ul><ul><li><div>当视图类使用了 serializer_class 参数，那么 <span style="font-size:12pt;">serializers 默认只会接收到三个参数:</span></div></li></ul></ul><div><br></div><ul><ul><ul><li><div>request -&gt; request 对象，当前视图的请求对象</div></li><li><div>format -&gt; 当前请求期望返回的数据格式</div></li><li><div>view -&gt; 当前请求的类视图对象，相当于视图类中的 self</div></li></ul></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><font color="#41AD1C"><br></font></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div>from rest_framework import viewsets</div><div><br></div><div><br></div><div>class BookView(viewsets.ModelViewSet):</div><div>    queryset = Book.objects.all()</div><div><font color="#FA7A00">serializer_class</font> = BookSerializers</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># serializers.py</font></div><div><font color="#41AD1C"><br></font></div><div>class BookSerializers(serializers.Serializer):</div><div>    title = serializers.CharField()</div><div>    price = serializers.CharField()</div><div><br></div><div>    custom_field = serializers.SerializerMethodField()</div><div><br></div><div>    def get_custom_field(self, obj):</div><div>        print(<font color="#FA7A00">self.context</font>)  <font color="#41AD1C"># {'view': &lt;api.views.BookView object at 0x00000229E4FCA5C0&gt;, 'request': &lt;rest_framework.request.Request object at 0x00000229E5077898&gt;, 'format': None}</font></div><div>        request = <font color="#FA7A00">self.context</font>.get('request')</div><div>        response_format = <font color="#FA7A00">self.context</font>.get('format')</div><div>        view = <font color="#FA7A00">self.context</font>.get('view')</div><div>        return 1</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">9.</span><span style="font-size:14pt;font-weight:bold;"> 序列化一对多字段的方法 -&gt; 正向查询</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>使用 source 参数序列化一对多字段</div></li></ul><div><br></div><ul><li><div>如果不使用 source 参数序列化一对多字段，那么在序列化一对多字段的时候默认会取与该字段所关联的表类里面的 __str__ 的返回值</div></li></ul><div><br></div><ul><li><div>语法: source='一对多字段名.字段'</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># serializer.py</span></div><div><br></div><div>from rest_framework import serializers</div><div><br></div><div><br></div><div>class BookSerializers(serializers.Serializer):</div><div>    title = serializers.CharField()</div><div>    price = serializers.CharField()</div><div>    pub_date = serializers.CharField()</div><div>    publish = serializers.CharField(<font color="#FA7A00">source</font>='publish.name')  <font color="#41AD1C"># 序列化一对多字段，且在序列化一对多字段的时候默认取 publish 表下的 name 字段的数据</font></div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># views.py</span></div><div><br></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class BookView(APIView):</div><div>    def get(self, request):</div><div>        book_list = Book.objects.all()</div><div>        bs = BookSerializers(book_list, many=True)</div><div>        print(bs.data)  <font color="#41AD1C"># [OrderedDict([('title', '西游记'), ('price', '111'), ('pub_date', None), ('</font><font color="#FA7A00">publish</font><font color="#41AD1C">', '东莞出版社')]), OrderedDict([('title', '三体'), ('price', '222'), ('pub_date', None), ('</font><font color="#FA7A00">publish</font><font color="#41AD1C">', '东莞出版社')])]</font></div><div>        return Response(bs.data)</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>[</div><div>    {</div><div>        &quot;title&quot;: &quot;三体&quot;,</div><div>        &quot;price&quot;: &quot;222&quot;,</div><div>        &quot;pub_date&quot;: null,</div><div>        &quot;<font color="#FA7A00">publish</font>&quot;: &quot;东莞出版社&quot;</div><div>    },</div><div>    {</div><div>        &quot;title&quot;: &quot;三国演义&quot;,</div><div>        &quot;price&quot;: &quot;100&quot;,</div><div>        &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>        &quot;<font color="#FA7A00">publish</font>&quot;: &quot;东莞出版社&quot;</div><div>    }</div><div>]</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">10.</span><span style="font-size:14pt;font-weight:bold;"> 序列化一对多字段的方法 -&gt; 反向查询</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">使用 SerializerMethodField() 字段方法，自定义函数返回值，实现序列化一对多字段的反向查询</span></div></li></ul><div><font style="font-size:12pt;"><br></font></div><ul><li><div><span style="font-size:12pt;">SerializerMethodField() 字段方法的作用: 自定义字段的返回值</span></div></li></ul><div><font style="font-size:12pt;"><br></font></div><ul><li><div><span style="font-size:12pt;">函数名定义规则: get_字段名</span></div></li></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># serializer.py</font></div><div><font color="#41AD1C"><br></font></div><div>from rest_framework import serializers</div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"><br></font></div><div>class PublishSerializers(serializers.Serializer):</div><div>    name = serializers.CharField()</div><div>    email = serializers.CharField()</div><div><br></div><div>    book = serializers.<font color="#FA7A00">SerializerMethodField</font>()</div><div><br></div><div>    def <font color="#FA7A00">get_book</font>(self, obj):</div><div><font color="#41AD1C">&quot;&quot;&quot;</font></div><div><font color="#41AD1C">        :param obj: 当前数据的对象（即: 和查询到的数据对象是一样的）</font></div><div><font color="#41AD1C">        &quot;&quot;&quot;</font></div><div>        temp = []</div><div>        for book in obj.book_set.all():  <font color="#41AD1C"># 反向查询</font></div><div>            temp.append({</div><div>                'title': book.title,</div><div>                'price': book.price,</div><div>                'pub_date': book.pub_date,</div><div>            })</div><div>        return temp</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><font color="#41AD1C"><br></font></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .serializer import *</div><div>from .models import *</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div>    def get(self, request):</div><div>        publish_list = Publish.objects.all()</div><div>        ps = PublishSerializers(publish_list, many=True)</div><div>        return Response(ps.data)</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口: http://127.0.0.1:8001/publish/</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: GET</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>[</div><div>    {</div><div>        &quot;name&quot;: &quot;东莞出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;,</div><div>        &quot;<font color="#FA7A00">book</font>&quot;: [</div><div>            {</div><div>                &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>                &quot;price&quot;: 100,</div><div>                &quot;title&quot;: &quot;三体（第二部）&quot;</div><div>            },</div><div>            {</div><div>                &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>                &quot;price&quot;: 100,</div><div>                &quot;title&quot;: &quot;三国演义&quot;</div><div>            },</div><div>            {</div><div>                &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>                &quot;price&quot;: 100,</div><div>                &quot;title&quot;: &quot;红楼梦&quot;</div><div>            }</div><div>        ]</div><div>    },</div><div>    {</div><div>        &quot;name&quot;: &quot;广州出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;,</div><div>        &quot;<font color="#FA7A00">book</font>&quot;: []</div><div>    }</div><div>]</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">11.</span><span style="font-size:14pt;font-weight:bold;"> 序列化多对多字段的方法 -&gt; 正向查询</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>使用 SerializerMethodField() 字段方法，自定义函数返回值，实现序列化多对多字段的正向查询</div></li></ul><div><br></div><ul><li><div>SerializerMethodField() 字段方法的作用: 自定义字段的返回值</div></li></ul><div><br></div><ul><li><div>函数名定义规则: get_字段名</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># serializer.py</span></div><div><span style="font-size:9pt;color:rgb(51, 51, 51);font-family:Monaco;"><br></span></div><div>from rest_framework import serializers</div><div><br></div><div><br></div><div>class BookSerializers(serializers.Serializer):</div><div>    title = serializers.CharField()</div><div>    price = serializers.CharField()</div><div>    pub_date = serializers.CharField()</div><div>    authors = serializers.<font color="#FA7A00">SerializerMethodField</font>()</div><div><br></div><div>    def <font color="#FA7A00">get_authors</font>(self, obj):</div><div><font color="#41AD1C">&quot;&quot;&quot;</font></div><div><font color="#41AD1C">        :param obj: 当前数据的对象（即: 和查询到的数据对象是一样的）</font></div><div><font color="#41AD1C">        &quot;&quot;&quot;</font></div><div>        temp = []</div><div>        for author in obj.authors.all():</div><div>            temp.append(author.name)</div><div>        return temp</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># views.py</span></div><div><br></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class BookView(APIView):</div><div>    def get(self, request):</div><div>        book_list = Book.objects.all()</div><div>        bs = BookSerializers(book_list, many=True)</div><div>        print(bs.data)  <font color="#41AD1C"># [OrderedDict([('title', '西游记'), ('price', '111'), ('pub_date', None), ('</font><font color="#FA7A00">authors</font><font color="#41AD1C">', ['Kevin'])]), OrderedDict([('title', '三体'), ('price', '222'), ('pub_date', None), ('</font><font color="#FA7A00">authors</font><font color="#41AD1C">', ['Aimer'])])]</font></div><div>        return Response(bs.data)</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>[</div><div>    {</div><div>        &quot;title&quot;: &quot;三体&quot;,</div><div>        &quot;price&quot;: &quot;222&quot;,</div><div>        &quot;pub_date&quot;: null,</div><div>        &quot;<font color="#FA7A00">authors</font>&quot;: [</div><div>            &quot;Aimer&quot;</div><div>        ]</div><div>    },</div><div>    {</div><div>        &quot;title&quot;: &quot;三国演义&quot;,</div><div>        &quot;price&quot;: &quot;100&quot;,</div><div>        &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>        &quot;<font color="#FA7A00">authors</font>&quot;: [</div><div>            &quot;Kevin&quot;,</div><div>            &quot;Aimer&quot;</div><div>        ]</div><div>    }</div><div>]</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">12.</span><span style="font-size:14pt;font-weight:bold;"> 序列化多对多字段的方法 -&gt; 反向查询</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">使用 SerializerMethodField() 字段方法，自定义函数返回值，实现序列化多对多字段的反向查询</span></div></li></ul><div><font style="font-size:12pt;"><br></font></div><ul><li><div><span style="font-size:12pt;">SerializerMethodField() 字段方法的作用: 自定义字段的返回值</span></div></li></ul><div><font style="font-size:12pt;"><br></font></div><ul><li><div><span style="font-size:12pt;">函数名定义规则: get_字段名</span></div></li></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># serializer.py</font></div><div><font color="#41AD1C"><br></font></div><div>from rest_framework import serializers</div><div><br></div><div><br></div><div>class AuthorSerializers(serializers.Serializer):</div><div>    name = serializers.CharField()</div><div>    age = serializers.IntegerField()</div><div><br></div><div>    book = serializers.<font color="#FA7A00">SerializerMethodField</font>()</div><div><br></div><div>    def <font color="#FA7A00">get_book</font>(self, obj):</div><div><font color="#41AD1C">&quot;&quot;&quot;</font></div><div><font color="#41AD1C">        :param obj: 当前数据的对象（即: 和查询到的数据对象是一样的）</font></div><div><font color="#41AD1C">        &quot;&quot;&quot;</font></div><div>        temp = []</div><div>        for book in obj.book_set.all():  <font color="#41AD1C"># 反向查询</font></div><div>            temp.append({</div><div>                'title': book.title,</div><div>                'price': book.price,</div><div>                'pub_date': book.pub_date,</div><div>            })</div><div>        return temp</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size:9pt;font-family:Monaco;"><font color="#41AD1C"># views.py</font></span></div><div><span style="font-size:9pt;font-family:Monaco;"><font color="#41AD1C"><br></font></span></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .serializer import *</div><div>from .models import *</div><div><br></div><div><br></div><div>class AuthorView(APIView):</div><div>    def get(self, request):</div><div>        author_list = Author.objects.all()</div><div>        aus = AuthorSerializers(author_list, many=True)</div><div>        return Response(aus.data)</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口: http://127.0.0.1:8001/author/</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: GET</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>[</div><div>    {</div><div>        &quot;name&quot;: &quot;Kevin&quot;,</div><div>        &quot;age&quot;: 18,</div><div>        &quot;<font color="#FA7A00">book</font>&quot;: [</div><div>            {</div><div>                &quot;title&quot;: &quot;红楼梦&quot;,</div><div>                &quot;price&quot;: 100,</div><div>                &quot;pub_date&quot;: &quot;2012-12-12&quot;</div><div>            },</div><div>            {</div><div>                &quot;title&quot;: &quot;勿忘我&quot;,</div><div>                &quot;price&quot;: 100,</div><div>                &quot;pub_date&quot;: &quot;2012-12-12&quot;</div><div>            }</div><div>        ]</div><div>    },</div><div>    {</div><div>        &quot;name&quot;: &quot;Aimer&quot;,</div><div>        &quot;age&quot;: 20,</div><div>        &quot;<font color="#FA7A00">book</font>&quot;: [</div><div>            {</div><div>                &quot;title&quot;: &quot;三体（第二部）&quot;,</div><div>                &quot;price&quot;: 100,</div><div>                &quot;pub_date&quot;: &quot;2012-12-12&quot;</div><div>            },</div><div>            {</div><div>                &quot;title&quot;: &quot;三国演义&quot;,</div><div>                &quot;price&quot;: 100,</div><div>                &quot;pub_date&quot;: &quot;2012-12-12&quot;</div><div>            },</div><div>            {</div><div>                &quot;title&quot;: &quot;超人&quot;,</div><div>                &quot;price&quot;: 100,</div><div>                &quot;pub_date&quot;: &quot;2012-12-12&quot;</div><div>            }</div><div>        ]</div><div>    }</div><div>]</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">13.</span><span style="font-size:14pt;font-weight:bold;"> 验证数据是否有误</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>一般都是验证提交过来的数据</div></li></ul><div><br></div><ul><li><div>这里的验证数据功能和Form组件或者ModelForm是一样的</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># serializer.py</font></div><div><br></div><div>from rest_framework import serializers</div><div><br></div><div><br></div><div>class PublishSerializers(serializers.Serializer):</div><div>    name = serializers.CharField(error_messages={'required': '出版社名称不能为空'})</div><div>    email = serializers.CharField(error_messages={'required': '邮箱不能为空'})</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><font color="#41AD1C"><br></font></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div>    def post(self, request):</div><div>        ps = PublishSerializers(<font color="#FA7A00">data</font>=request.data)  <font color="#41AD1C"># 将提交过来的数据传入data参数中进行验证</font></div><div>        if ps.<font color="#FA7A00">is_valid</font>():  <font color="#41AD1C"># 验证提交过来的数据</font></div><div>            print(ps.<font color="#FA7A00">validated_data</font>)  <font color="#41AD1C"># 获取验证通过的数据 -&gt; OrderedDict([('name', '深圳出版社'), ('email', '123@qq.com')])</font></div><div>            publish = Publish.objects.create(**ps.validated_data)  <font color="#41AD1C"># 将数据保存到数据库</font></div><div>            p_ps = PublishSerializers(publish)  <font color="#41AD1C"># 序列化数据</font></div><div>            return Response(p_ps.data)</div><div>        else:</div><div>            print(ps.<font color="#FA7A00">errors</font>)  <font color="#41AD1C"># 获取验证失败后的错误信息</font></div><div>            return Response(ps.errors)</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口说明: 添加出版社</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/publish/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: POST</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 发送数据的编码格式: application/json -&gt; 即: json 格式</font></div><div><br></div><div><font color="#41AD1C"># 所要发送的数据: </font>{&quot;name&quot;:&quot;上海出版社&quot;,&quot;email&quot;:&quot;123@qq.com&quot;}</div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>{</div><div>    &quot;name&quot;: &quot;上海出版社&quot;,</div><div>    &quot;email&quot;: &quot;123@qq.com&quot;</div><div>}</div></div><div><br></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">APIView 的 request 对象 </span></h2><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"> APIView 的 request对象 说明</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>这里所指的request对象就是 FBV 或 CBV 中的 request 对象</div></li></ul><div><br></div><ul><li><div><span style="font-size:12pt;">APIView（在</span> rest-framework 中 CBV 所要继承的类<span style="font-size:12pt;">） 的 request 对象是在 View（即: 以前CBV中所继承的类） 的 request 对象的基础上进行封装的，所以在使用</span><span style="font-size:12pt;">在使用</span> rest-framework 中的 CBV 里的 request 对象是一个全新的 request 对象</div></li></ul><div><br></div><ul><li><div>View 的 request 对象有的功能，APIView 的 request 对象都有</div></li></ul><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"> APIView 的 request对象 所提供的常用属性:</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">request.GET -&gt; 获取GET请求参数</span></div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div><span style="font-size:9pt;color:rgb(51, 51, 51);font-family:Monaco;"><br></span></div><div><br></div><div>class BookView(APIView):</div><div>    def get(self, request):</div><div><br></div><div>        get_data = <font color="#FA7A00">request.GET</font></div><div><br></div><div><font color="#41AD1C"># 等同于</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C">        # get_data = request._request.GET</font></div><div><br></div><div>        print(get_data)  <font color="#41AD1C"># &lt;QueryDict: {'b': ['2'], 'a': ['1']}&gt;</font></div><div><br></div><div>        return HttpResponse('get请求')</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>request.query_params -&gt; <span style="font-size:12pt;">获取GET请求参数</span></div></li></ul><div><br></div><ul><ul><li><div>request.query_params 等同于 <span style="font-size:12pt;">request.GET</span></div></li><li><div>request.query_params 实际上是执行了 request._request.GET</div></li></ul></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div><br></div><div><br></div><div>class BookView(APIView):</div><div>    def get(self, request):</div><div><br></div><div>        get_data = <font style="color:rgb(250, 122, 0);">request.query_params</font></div><div><br></div><div>        print(get_data)  <font color="#41AD1C"># &lt;QueryDict: {'name': ['三国演义'], 'price': ['100']}&gt;</font></div><div>        print(get_data.get('name'))  <font color="#41AD1C"># 三国演义</font></div><div>        print(get_data.get('price'))  <font color="#41AD1C"># 100</font></div><div><br></div><div>        return HttpResponse('get请求')</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">request.data -&gt; 获取除GET请求外的其他请求参数（即: POST/PUT/</span>PATCH 等请求的参数<span style="font-size:12pt;">）</span></div></li></ul><div><br></div><ul><ul><li><div>在不使用 rest-framework 之前，request.POST 只能获取以 application/x-www-form-urlencoded 编码格式发送过来的数据，其他编码格式发送过来的数据（如: application/json）都只能通过 request.body 获取，然后自行解析，但是在 rest-framework 可以通过 request.data 获取不同编码格式发送过来的数据，并且帮我们进行解析</div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div><span style="font-size:9pt;color:rgb(51, 51, 51);font-family:Monaco;"><br></span></div><div><br></div><div>class BookView(APIView):</div><div><br></div><div>    def post(self, request):</div><div>        data = <font color="#FA7A00">request.data</font></div><div>        print(data)  <font color="#41AD1C"># 以 application/json 编码格式提交过来的数据 -&gt; {'name': 'Kevin', 'age': 18}</font></div><div>        return HttpResponse('post请求')</div></div><div><br></div><ul><li><div>request._request -&gt; 获取 View 的 request 对象（即: 旧的request对象）</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div><span style="font-size:9pt;color:rgb(51, 51, 51);font-family:Monaco;"><br></span></div><div><br></div><div>class BookView(APIView):</div><div>    def get(self, request):</div><div>        get_data = <font color="#FA7A00">request._request</font>.GET</div><div>        print(get_data)  <font color="#41AD1C"># &lt;QueryDict: {'b': ['2'], 'a': ['1']}&gt;</font></div><div>        return HttpResponse('get请求')</div><div><br></div><div><br></div><div>    def post(self, request):</div><div>        post_data = <font color="#FA7A00">request._request</font>.POST</div><div>        print(post_data)  <font color="#41AD1C"># &lt;QueryDict: {'age': ['18'], 'name': ['Kevin']}&gt;</font></div><div>        return HttpResponse('post请求')</div></div><div><br></div><div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">序列化数据的方式</span></h2><div><br></div><div><span style="font-size:18.6667px;">这里的序列化数据指的是将 </span><span style="font-size:18.6667px;color:rgb(250, 122, 0);">queryset对象</span><span style="font-size:18.6667px;"> 或 </span><span style="font-size:18.6667px;color:rgb(65, 173, 28);">查询到的数据对象</span><span style="font-size:18.6667px;"> 转换成 </span><span style="font-size:18.6667px;color:rgb(250, 122, 0);">列表</span><span style="font-size:18.6667px;"> 或 </span><span style="font-size:18.6667px;color:rgb(65, 173, 28);">字典，</span><span style="font-size:18.6667px;">然后将序列化好的数据发送给前端</span></div></div><div><span style="font-size:18.6667px;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"> 序列化 queryset 对象（查询到的数据列表）</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>方式一</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from django.http import JsonResponse</div><div>from rest_framework.views import APIView</div><div>from .models import *</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div>    def get(self, request):</div><div>        publish_queryset = Publish.objects.all().values('name', 'email')</div><div>        publish_list = list(publish_queryset)</div><div>        print(publish_list)  <font color="#41AD1C"># [{'name': '东莞出版社', 'email': '123@qq.com'}, {'name': '广州出版社', 'email': '123@qq.com'}]</font></div><div>        return JsonResponse(publish_list, safe=False)</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">方式二</span></div></li></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from django.http import JsonResponse</div><div>from rest_framework.views import APIView</div><div>from django.forms.models import model_to_dict</div><div>from .models import *</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div>    def get(self, request):</div><div>        publish_queryset = Publish.objects.all()</div><div>        publish_list = []</div><div>        for publish in publish_queryset:</div><div>            publish_list.append(model_to_dict(publish))</div><div>        print(publish_list)  <font color="#41AD1C"># [{'id': 1, 'name': '东莞出版社', 'email': '123@qq.com'}, {'id': 2, 'name': '广州出版社', 'email': '123@qq.com'}]</font></div><div>        return JsonResponse(publish_list, safe=False)</div></div><div><br></div><ul><li><div>方式三</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from django.core import serializers</div><div>from .models import *</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div>    def get(self, request):</div><div>        publish_queryset = Publish.objects.all()</div><div>        publish_list = serializers.serialize(&quot;json&quot;, publish_queryset)</div><div>        print(publish_list)  <font color="#41AD1C"># [{&quot;model&quot;: &quot;app01.publish&quot;, &quot;pk&quot;: 1, &quot;fields&quot;: {&quot;name&quot;: &quot;\u4e1c\u839e\u51fa\u7248\u793e&quot;, &quot;email&quot;: &quot;123@qq.com&quot;'+'}'+'}'}}, {&quot;model&quot;: &quot;app01.publish&quot;, &quot;pk&quot;: 2, &quot;fields&quot;: {&quot;name&quot;: &quot;\u5e7f\u5dde\u51fa\u7248\u793e&quot;, &quot;email&quot;: &quot;123@qq.com&quot;'+'}'+'}'}}]</font></div><div>        return HttpResponse(publish_list)</div></div><div><br></div><ul><li><div>方式四 -&gt; 推荐使用</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># serializer.py</font></div><div><br></div><div>from rest_framework import serializers</div><div><br></div><div><br></div><div>class PublishSerializers(serializers.Serializer):</div><div>    name = serializers.CharField()</div><div>    email = serializers.CharField()</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div>    def get(self, request):</div><div>        publish_queryset = Publish.objects.all().values('name', 'email')</div><div>        ps = PublishSerializers(publish_queryset, many=True)</div><div>        print(ps.data)  <font color="#41AD1C"># 获取序列化之后的数据 -&gt; [OrderedDict([('name', '东莞出版社'), ('email', '123@qq.com')]), OrderedDict([('name', '广州出版社'), ('email', '123@qq.com')])]</font></div><div>        return Response(ps.data)</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"> 序列化查询到的数据对象</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>方式一</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from django.http import JsonResponse</div><div>from rest_framework.views import APIView</div><div>from django.forms.models import model_to_dict</div><div>from .models import *</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div>    def get(self, request):</div><div>        publish_obj = Publish.objects.all().first()</div><div>        publish_dict = model_to_dict(publish_obj)</div><div>        print(publish_dict)  <font color="#41AD1C"># {'email': '123@qq.com', 'name': '东莞出版社', 'id': 1}</font></div><div>        return JsonResponse(publish_dict)</div></div><div><br></div><ul><li><div>方式二</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># serializer.py</span></div><div><br></div><div>from rest_framework import serializers</div><div><br></div><div><br></div><div>class PublishSerializers(serializers.Serializer):</div><div>    name = serializers.CharField()</div><div>    email = serializers.CharField()</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># views.py</span></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div>    def get(self, request):</div><div>        publish_obj = Publish.objects.all().first()</div><div>        ps = PublishSerializers(publish_obj)</div><div>        print(ps.data)  <font color="#41AD1C"># 获取序列化之后的数据 -&gt; {'email': '123@qq.com', 'name': '东莞出版社'}</font></div><div>        return Response(ps.data)</div></div><div><br></div></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">ModelSerializer</span></h2><div><br></div><div><span style="font-size:14pt;">只要继承了 APIView 就可以使用 </span><span style="font-size:14pt;">ModelSerializer</span><span style="font-size:14pt;"></span></div><div><br></div><div><span style="font-size:14pt;">ModelSerializer</span><span style="font-size:14pt;"> 的使用和 ModelForm 组件的使用类似</span></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;"><span style="font-size:14pt;font-weight:bold;">ModelSerializer的基本使用</span></span></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="color:rgb(65, 173, 28);font-size:9pt;"># serializer.py</font></div><div><font color="#41AD1C" style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">from rest_framework import serializers</font></div><div><font style="font-size:9pt;">from .models import *</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">class BookSerializers(serializers.ModelSerializer):</font></div><div><font style="font-size:9pt;">    class Meta:</font></div><div><font style="font-size:9pt;">        model = Book</font></div><div><font style="font-size:9pt;">        fields = '__all__'</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;"><font color="#41AD1C"># 自定义错误信息</font></font></div><div><font style="font-size:9pt;">        extra_kwargs = {</font></div><div><font style="font-size:9pt;">            &quot;title&quot;: {</font></div><div><font style="font-size:9pt;">                'error_messages': {</font></div><div><font style="font-size:9pt;">                    'required': '书籍名称不能为空'</font></div><div><font style="font-size:9pt;">                }</font></div><div><font style="font-size:9pt;">            },</font></div><div><font style="font-size:9pt;">            'price': {</font></div><div><font style="font-size:9pt;">                'error_messages': {</font></div><div><font style="font-size:9pt;">                    'required': '价格不能为空'</font></div><div><font style="font-size:9pt;">                }</font></div><div><font style="font-size:9pt;">            },</font></div><div><font style="font-size:9pt;">            'pub_date': {</font></div><div><font style="font-size:9pt;">                'error_messages': {</font></div><div><font style="font-size:9pt;">                    'required': '日期不能为空'</font></div><div><font style="font-size:9pt;">                }</font></div><div><font style="font-size:9pt;">            },</font></div><div><font style="font-size:9pt;">            'publish': {</font></div><div><font style="font-size:9pt;">                'error_messages': {</font></div><div><font style="font-size:9pt;">                    'required': '出版社不能为空'</font></div><div><font style="font-size:9pt;">                }</font></div><div><font style="font-size:9pt;">            },</font></div><div><font style="font-size:9pt;">            'author': {</font></div><div><font style="font-size:9pt;">                'error_messages': {</font></div><div><font style="font-size:9pt;">                    'required': '作者不能为空'</font></div><div><font style="font-size:9pt;">                }</font></div><div><font style="font-size:9pt;">            }</font></div><div><font style="font-size:9pt;">        }</font></div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class BookView(APIView):</div><div><font color="#41AD1C"> # 查看所有书籍</font></div><div>    def get(self, request):</div><div>        book_list = Book.objects.all()</div><div>        bs = BookSerializers(book_list, many=True)</div><div>        return Response(bs.data)</div><div><br></div><div><font color="#41AD1C"> # 添加书籍</font></div><div>    def post(self, request):</div><div>        bs = BookSerializers(data=request.data)</div><div>        if bs.is_valid():  <font color="#41AD1C"># 验证数据是否有误</font></div><div>            print(bs.validated_data)  <font color="#41AD1C"># 验证过后正确的数据: OrderedDict([('title', '三国演义'), ('price', 100), ('pub_date', datetime.date(2012, 12, 12)), ('publish', &lt;Publish: 东莞出版社&gt;), ('authors', [&lt;Author: Kevin&gt;, &lt;Author: Aimer&gt;])])</font></div><div>            bs.save()  <font color="#41AD1C"># 保存数据，实际上调用的是 rest-framework 中的 create 方法</font></div><div>            return Response(bs.data)</div><div>        else:</div><div>            return Response(bs.errors)  <font color="#41AD1C"># bs.errors 验证过后的错误信息</font></div><div><br></div><div><br></div><div>class BookDetailView(APIView):</div><div><font color="#41AD1C"> # 查看指定的书籍</font></div><div>    def get(self, request, id):</div><div>        book_obj = Book.objects.filter(pk=id).first()</div><div>        if book_obj:</div><div>            bs = BookSerializers(book_obj)</div><div>            return Response(bs.data)</div><div>        else:</div><div>            return Response({'static': 0, 'message': '没有该书籍'})</div><div><br></div><div><font color="#41AD1C"># 修改书籍</font></div><div>    def put(self, request, id):</div><div>        book_obj = Book.objects.filter(pk=id).first()</div><div>        bs = BookSerializers(book_obj, data=request.data)  <font color="#41AD1C"># 修改数据的时候一定要指定修改那条数据（即: book_obj），否则在执行 .save() 的时候就相当于新增数据</font></div><div>        if bs.is_valid():  <font color="#41AD1C"># 验证数据是否有误</font></div><div>            bs.save()  <font color="#41AD1C"># 保存数据，实际上调用的是 rest-framework 中的 update 方法</font></div><div>            return Response(bs.data)</div><div>        else:</div><div>            return Response(bs.errors)  <font color="#41AD1C"># bs.errors 验证过后的错误信息</font></div><div><br></div><div><font color="#41AD1C"># 删除书籍</font></div><div>    def delete(self, request, id):</div><div>        Book.objects.filter(pk=id).delete()</div><div>        return Response()</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># urls.py</font></div><div><br></div><div>urlpatterns = [</div><div><font color="#41AD1C">……</font></div><div>    url(r'book/$', BookView.as_view()),</div><div>    url(r'book/(\d+)', BookDetailView.as_view())</div><div>]</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口说明: 查看所有书籍</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>[</div><div>    {</div><div>        &quot;id&quot;: 2,</div><div>        &quot;title&quot;: &quot;三体&quot;,</div><div>        &quot;price&quot;: 222,</div><div>        &quot;pub_date&quot;: null,</div><div>        &quot;publish&quot;: 1,</div><div>        &quot;authors&quot;: [</div><div>            2</div><div>        ]</div><div>    },</div><div>    {</div><div>        &quot;id&quot;: 5,</div><div>        &quot;title&quot;: &quot;三国演义&quot;,</div><div>        &quot;price&quot;: 100,</div><div>        &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>        &quot;publish&quot;: 1,</div><div>        &quot;authors&quot;: [</div><div>            1,</div><div>            2</div><div>        ]</div><div>    }</div><div>]</div><div><br></div><div><font color="#FA7A00"># --------------------------------------------------------------</font></div><div><font color="#FA7A00"><br></font></div><div><font color="#41AD1C"># 接口说明: 添加书籍</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: POST</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 发送数据的编码格式: application/json -&gt; 即: json 格式</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 所要发送的数据: </font>{&quot;title&quot;:&quot;勿忘我&quot;,&quot;price&quot;:100,&quot;pub_date&quot;:&quot;2012-12-12&quot;,&quot;publish&quot;:1,&quot;authors&quot;:[1,2]}</div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>{</div><div>    &quot;id&quot;: 14,</div><div>    &quot;title&quot;: &quot;勿忘我&quot;,</div><div>    &quot;price&quot;: 100,</div><div>    &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>    &quot;publish&quot;: 1,</div><div>    &quot;authors&quot;: [</div><div>        1,</div><div>        2</div><div>    ]</div><div>}</div><div><br></div><div><font color="#FA7A00"># --------------------------------------------------------------</font></div><div><font color="#FA7A00"><br></font></div><div><font color="#41AD1C"># 接口说明: 查看指定书籍</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/2</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>{</div><div>    &quot;id&quot;: 2,</div><div>    &quot;title&quot;: &quot;三体&quot;,</div><div>    &quot;price&quot;: 222,</div><div>    &quot;pub_date&quot;: null,</div><div>    &quot;publish&quot;: 1,</div><div>    &quot;authors&quot;: [</div><div>        2</div><div>    ]</div><div>}</div><div><br></div><div><font style="color:rgb(250, 122, 0);"># --------------------------------------------------------------</font></div><div><br></div><div><font color="#41AD1C"># 接口说明: 修改书籍</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/2</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: PUT</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 发送数据的编码格式: application/json -&gt; 即: json 格式</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 所要发送的数据: </font>{&quot;title&quot;:&quot;三体（第二部）&quot;,&quot;price&quot;:100,&quot;pub_date&quot;:&quot;2012-12-12&quot;,&quot;publish&quot;:1,&quot;authors&quot;:[1,2]}</div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><font color="#41AD1C"><br></font></div><div>{</div><div>    &quot;id&quot;: 2,</div><div>    &quot;title&quot;: &quot;三体（第二部）&quot;,</div><div>    &quot;price&quot;: 100,</div><div>    &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>    &quot;publish&quot;: 1,</div><div>    &quot;authors&quot;: [</div><div>        2,</div><div>        1</div><div>    ]</div><div>}</div><div><br></div><div><font color="#FA7A00"># --------------------------------------------------------------</font></div><div><br></div><div><font color="#41AD1C"># 接口说明: 删除书籍</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/11</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: DELETE</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C">空</font></div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;font-weight:bold;">save() 方法的说明</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">执行 save() 之前一定要执行 is_valid() 方法，否则会报错</span></div></li></ul><div><font style="font-size:12pt;"><br></font></div><ul><li><div><span style="font-size:12pt;">.save() 方法的返回值就是所添加/修改的该条数据对象</span></div></li></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class BookView(APIView):</div><div><font color="#41AD1C"># 添加书籍</font></div><div>    def post(self, request):</div><div>        bs = BookSerializers(data=request.data)</div><div>        if bs.<font color="#FA7A00">is_valid</font>():  <font color="#41AD1C"># 验证数据是否有误</font></div><div><font color="#FA7A00">data_obj</font> = bs.save()</div><div>            print(data_obj.title, data_obj.price)  <font color="#41AD1C"># 三体 100</font></div><div>            return Response(bs.data)</div><div>        else:</div><div>            return Response(bs.errors)</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">3.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;font-weight:bold;">自定制字段</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>当 fields = '__all__' 的时候，但是又想对里面的某些字段进行单独配置的时候，可以直接在 ModelSerializer 类中重新编写该字段，那么该字段的配置就会覆盖掉之前的配置</div></li></ul><div><br></div><ul><li><div><span style="color:rgb(147, 150, 0);">建议:</span><span style="font-size:12pt;"> 如果使用了 ModelSerializer 就尽量不要自定制字段，否则容易出现问题</span></div></li></ul><div><br></div><ul><li><div><span style="color:rgb(227, 0, 0);">注意: </span></div></li><ul><li><div>当自定制一对多字段的时候，并且使用了source参数，那么就需要重写save()方法中的create()和update()方法 </div></li><li><div>当自定制多对多字段的时候，添加或修改数据多对多字段的数据会有问题</div></li></ul></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="color:rgb(65, 173, 28);"># serializer.py </font></div><div><br></div><div>class BookSerializers(serializers.ModelSerializer):</div><div>    class Meta:</div><div>        model = Book</div><div>        fields = '__all__'</div><div>        extra_kwargs = {</div><div>            &quot;title&quot;: {</div><div>                'error_messages': {</div><div>                    'required': '书籍名称不能为空'</div><div>                }</div><div>            },</div><div>            'price': {</div><div>                'error_messages': {</div><div>                    'required': '价格不能为空'</div><div>                }</div><div>            },</div><div>            'pub_date': {</div><div>                'error_messages': {</div><div>                    'required': '日期不能为空'</div><div>                }</div><div>            },</div><div>            'publish': {</div><div>                'error_messages': {</div><div>                    'required': '出版社不能为空'</div><div>                }</div><div>            },</div><div>            'author': {</div><div>                'error_messages': {</div><div>                    'required': '作者不能为空'</div><div>                }</div><div>            }</div><div>        }</div><div><br></div><div>    publish = serializers.CharField(source=&quot;publish.name&quot;)  <font style="color:rgb(65, 173, 28);"># 重新编写 publish 字段的配置</font></div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">4.</span><span style="font-size:14pt;font-weight:bold;"> 重写 save() 中的 create() 和 </span><span style="font-size:14pt;"><span style="font-size:14pt;font-weight:bold;">update()</span></span> <span style="font-size:14pt;font-weight:bold;">方法</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">.save()方法实际上调用的是 rest-framework 中的 create 或者 update 方法</span></div></li></ul><div><br></div><ul><li><div>重写create()/update()方法就是自己将提交过来的数据保存到数据库，并且返回当前保存的数据</div></li></ul><div><br></div><ul><li><div><span style="color:rgb(227, 0, 0);">什么时候需要重写</span></div></li></ul><div><br></div><ul><ul><li><div>当使用了自定制字段，并且再字段方法中传递了source参数 -&gt; 通俗理解: 当自定制一对多字段的时候，并且使用了source参数，那么就需要重写save()方法中的create()和update()方法 </div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># serializer.py</font></div><div><br></div><div>class BookSerializers(serializers.ModelSerializer):</div><div>    class Meta:</div><div>        model = Book</div><div>        fields = '__all__'</div><div>        extra_kwargs = {</div><div>            &quot;title&quot;: {</div><div>                'error_messages': {</div><div>                    'required': '书籍名称不能为空'</div><div>                }</div><div>            },</div><div>            'price': {</div><div>                'error_messages': {</div><div>                    'required': '价格不能为空'</div><div>                }</div><div>            },</div><div>            'pub_date': {</div><div>                'error_messages': {</div><div>                    'required': '日期不能为空'</div><div>                }</div><div>            },</div><div>            'publish': {</div><div>                'error_messages': {</div><div>                    'required': '出版社不能为空'</div><div>                }</div><div>            },</div><div>            'author': {</div><div>                'error_messages': {</div><div>                    'required': '作者不能为空'</div><div>                }</div><div>            }</div><div>        }</div><div><br></div><div>    publish = serializers.CharField(source=&quot;publish.pk&quot;)  <font color="#41AD1C"># 重新编写 publish 字段的配置</font></div><div><br></div><div><font color="#41AD1C"># </font><font color="#41AD1C">重写 save() 中的 create() 方法</font></div><div>    def create(self, validated_data):</div><div><font color="#41AD1C">&quot;&quot;&quot;</font></div><div><font color="#41AD1C">        :param validated_data: 通过验证的数据</font></div><div><font color="#41AD1C">        &quot;&quot;&quot;</font></div><div>        print(validated_data)</div><div><br></div><div>        book = Book.objects.create(title=validated_data['title'], price=validated_data['price'], pub_date=validated_data['pub_date'], publish_id=validated_data['publish']['pk'])</div><div>        book.authors.add(*validated_data[&quot;authors&quot;])</div><div><br></div><div>        return book</div><div><br></div><div><font color="#41AD1C"># </font><font color="#41AD1C">重写 save() 中的 update() 方法</font></div><div>    def update(self, instance, validated_data):</div><div><font color="#41AD1C">&quot;&quot;&quot;</font></div><div><font color="#41AD1C">        :param instance: 需要修改的查询到的数据对象</font></div><div><font color="#41AD1C">        :param validated_data: 通过验证的数据</font></div><div><font color="#41AD1C">        &quot;&quot;&quot;</font></div><div>        for key, val in validated_data.items():</div><div>            if hasattr(instance, key):</div><div>                if 'publish' == key:</div><div>                    instance.publish_id = validated_data['publish']['pk']</div><div>                elif 'authors' == key:</div><div>                    instance.authors.set(validated_data['authors'])</div><div>                else:</div><div>                    setattr(instance, key, val)</div><div>        instance.save()</div><div>        return instance</div></div><div><br></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">超链接API: Hyperlinked</span></h2><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;"><span style="font-size:14pt;font-weight:bold;">HyperlinkedIdentityField 字段方法</span></span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">HyperlinkedIdentityField 字段方法一般都是用在一对多字段上</span></div></li><li><div><span style="font-size:12pt;">HyperlinkedIdentityField 字段方法返回的是一个url路径</span></div></li><li><div><span style="font-size:12pt;">HyperlinkedIdentityField 字段方法一般在前后端分离的时候很少会使用</span></div></li><li><div>使用场景: 分页器</div></li><li><div><span style="color:rgb(227, 0, 0);">注意</span>: 如果你所定义的 序列化类 使用了 <span style="font-size:12pt;">HyperlinkedIdentityField 字段方法，那么在实例化 序列化</span>类 的时候一定要设置 context={'request': request}，否则会报错</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># urls.py</font></div><div><br></div><div>urlpatterns = [</div><div>    url(r'^admin/', admin.site.urls),</div><div>    url(r'publish/(?P&lt;<font color="#FA7A00">pk</font>&gt;\d+)', PublishDetailView.as_view(), <font color="#FA7A00">name</font>='publish_detail'),</div><div>    url(r'book/$', BookView.as_view())</div><div>]</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># serializer.py</font></div><div><font color="#41AD1C"><br></font></div><div>from rest_framework import serializers</div><div>from .models import *</div><div><br></div><div><br></div><div>class PublishSerializers(serializers.Serializer):</div><div>    name = serializers.CharField()</div><div>    email = serializers.CharField()</div><div><br></div><div><br></div><div>class BookSerializers(serializers.ModelSerializer):</div><div>    class Meta:</div><div>        model = Book</div><div>        fields = '__all__'</div><div><br></div><div><font color="#41AD1C"># view_name -&gt; url别名</font></div><div><font color="#41AD1C">    # lookup_field -&gt; 当前外键字段（一对多）在数据库中的字段名</font></div><div><font color="#41AD1C">    # lookup_url_kwarg -&gt; 分组命名匹配中的别名</font></div><div><br></div><div>    publish = serializers.<font color="#FA7A00">HyperlinkedIdentityField</font>(view_name='publish_detail', lookup_field='publish_id', lookup_url_kwarg='pk')</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class BookView(APIView):</div><div><font color="#41AD1C"># 查看所有书籍</font></div><div>    def get(self, request):</div><div>        book_list = Book.objects.all()</div><div>        bs = BookSerializers(book_list, many=True, <font color="#FA7A00">context</font>={'request': request})  <font style="color:rgb(65, 173, 28);"># 如果你所定义的 序列化类 使用了 HyperlinkedIdentityField 字段方法，那么在实例化 序列化类 的时候一定要设置 context={'request': request}，否则会报错</font></div><div>        return Response(bs.data)</div><div><br></div><div><br></div><div>class PublishDetailView(APIView):</div><div><font color="#41AD1C"># 查看指定的出版社</font></div><div>    def get(self, request, pk):</div><div>        publish_obj = Publish.objects.filter(pk=pk).first()</div><div>        if publish_obj:</div><div>            ps = PublishSerializers(publish_obj)</div><div>            return Response(ps.data)</div><div>        else:</div><div>            return Response({'static': 0, 'message': '没有该出版社'})</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>[</div><div>    {</div><div>        &quot;id&quot;: 2,</div><div><font color="#FA7A00">&quot;publish&quot;: &quot;http://127.0.0.1:8000/publish/1&quot;,</font></div><div>        &quot;title&quot;: &quot;三体&quot;,</div><div>        &quot;price&quot;: 222,</div><div>        &quot;pub_date&quot;: null,</div><div>        &quot;authors&quot;: [</div><div>            2</div><div>        ]</div><div>    },</div><div><br></div><div><font color="#41AD1C">……</font></div><div><br></div><div>]</div></div><div><br></div></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">视图四部曲</span></h2><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"> 混合使用</span></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div><br></div><div>class BookView(APIView):</div><div><font color="#41AD1C"># 查看所有书籍</font></div><div>    def get(self, request):</div><div>        book_list = Book.objects.all()</div><div>        bs = BookSerializers(book_list, many=True)</div><div>        return Response(bs.data)</div><div><br></div><div><font color="#41AD1C"># 添加书籍</font></div><div>    def post(self, request):</div><div>        bs = BookSerializers(data=request.data)</div><div>        if bs.is_valid():  <font color="#41AD1C"># 验证数据是否有误</font></div><div>            print(bs.validated_data)  <font color="#41AD1C"># 验证过后正确的数据: OrderedDict([('title', '三国演义'), ('price', 100), ('pub_date', datetime.date(2012, 12, 12)), ('publish', &lt;Publish: 东莞出版社&gt;), ('authors', [&lt;Author: Kevin&gt;, &lt;Author: Aimer&gt;])])</font></div><div>            bs.save()  <font color="#41AD1C"># 保存数据，实际上调用的是 rest-framework 中的 create 方法</font></div><div>            return Response(bs.data)</div><div>        else:</div><div>            return Response(bs.errors)  <font color="#41AD1C"># bs.errors 验证过后的错误信息</font></div><div><br></div><div><br></div><div>class BookDetailView(APIView):</div><div><font color="#41AD1C"># 查看指定的书籍</font></div><div>    def get(self, request, id):</div><div>        book_obj = Book.objects.filter(pk=id).first()</div><div>        if book_obj:</div><div>            bs = BookSerializers(book_obj)</div><div>            return Response(bs.data)</div><div>        else:</div><div>            return Response({'static': 0, 'message': '没有该书籍'})</div><div><br></div><div><font color="#41AD1C"># 修改书籍</font></div><div>    def put(self, request, id):</div><div>        book_obj = Book.objects.filter(pk=id).first()</div><div>        bs = BookSerializers(book_obj, data=request.data)  <font color="#41AD1C"># 修改数据的时候一定要指定修改那条数据（即: book_obj），否则在执行 .save() 的时候就相当于新增数据</font></div><div>        if bs.is_valid():  <font color="#41AD1C"># 验证数据是否有误</font></div><div>            bs.save()  <font color="#41AD1C"># 保存数据，实际上调用的是 rest-framework 中的 update 方法</font></div><div>            return Response(bs.data)</div><div>        else:</div><div>            return Response(bs.errors)  <font color="#41AD1C"># bs.errors 验证过后的错误信息</font></div><div><br></div><div><font color="#41AD1C"># 删除书籍</font></div><div>    def delete(self, request, id):</div><div>        Book.objects.filter(pk=id).delete()</div><div>        return Response()</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div><font color="#41AD1C"># 查看所有出版社</font></div><div>    def get(self, request):</div><div>        publish_list = Publish.objects.all()</div><div>        ps = PublishSerializers(publish_list, many=True)</div><div>        return Response(ps.data)</div><div><br></div><div><font color="#41AD1C"># 添加出版社</font></div><div>    def post(self, request):</div><div>        ps = PublishSerializers(data=request.data)</div><div>        if ps.is_valid():  <font color="#41AD1C"># 验证数据是否有误</font></div><div>            print(ps.validated_data)  <font color="#41AD1C"># 验证过后正确的数据: OrderedDict([('name', '台山出版社'), ('email', '123@qq.com')])</font></div><div>            ps.save()  <font color="#41AD1C"># 保存数据，实际上调用的是 rest-framework 中的 create 方法</font></div><div>            return Response(ps.data)</div><div>        else:</div><div>            return Response(ps.errors)  <font color="#41AD1C"># ps.errors 验证过后的错误信息</font></div><div><br></div><div><br></div><div>class PublishDetailView(APIView):</div><div><font color="#41AD1C"># 查看指定的出版社</font></div><div>    def get(self, request, id):</div><div>        publish_obj = Publish.objects.filter(pk=id).first()</div><div>        if publish_obj:</div><div>            ps = PublishSerializers(publish_obj)</div><div>            return Response(ps.data)</div><div>        else:</div><div>            return Response({'static': 0, 'message': '没有该出版社'})</div><div><br></div><div><font color="#41AD1C"># 修改出版社</font></div><div>    def put(self, request, id):</div><div>        publish_obj = Publish.objects.filter(pk=id).first()</div><div>        ps = PublishSerializers(publish_obj, data=request.data)  <font color="#41AD1C"># 修改数据的时候一定要指定修改那条数据（即: publish_obj），否则在执行 .save() 的时候就相当于新增数据</font></div><div>        if ps.is_valid():  <font color="#41AD1C"># 验证数据是否有误</font></div><div>            ps.save()  <font color="#41AD1C"># 保存数据，实际上调用的是 rest-framework 中的 update 方法</font></div><div>            return Response(ps.data)</div><div>        else:</div><div>            return Response(ps.errors)  <font color="#41AD1C"># ps.errors 验证过后的错误信息</font></div><div><br></div><div><font color="#41AD1C"># 删除出版社</font></div><div>    def delete(self, request, id):</div><div>        Publish.objects.filter(pk=id).delete()</div><div>        return Response()</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="color:rgb(65, 173, 28);"># serializer.py</font></div><div><br></div><div>from rest_framework import serializers</div><div>from .models import *</div><div><br></div><div><br></div><div>class PublishSerializers(serializers.ModelSerializer):</div><div>    class Meta:</div><div>        model = Publish</div><div>        fields = '__all__'</div><div><br></div><div><br></div><div>class BookSerializers(serializers.ModelSerializer):</div><div>    class Meta:</div><div>        model = Book</div><div>        fields = '__all__'</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># urls.py</font></div><div><font color="#41AD1C"><br></font></div><div>urlpatterns = [</div><div>    url(r'^admin/', admin.site.urls),</div><div><br></div><div>    url(r'book/$', BookView.as_view()),</div><div>    url(r'book/(\d+)', BookDetailView.as_view()),</div><div><br></div><div>    url(r'publish/$', PublishView.as_view()),</div><div>    url(r'publish/(\d+)', PublishDetailView.as_view()),</div><div>]</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;"><span style="font-size:14pt;font-weight:bold;">mixin类编写视图</span></span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>在 mixin 模块下提供了5个类，分别对应着 查询所有数据，查看指定数据，添加数据，修改数据，删除数据，其实这5个类就是将混合使用中的处理http请求的方法封装了起来</div></li></ul><div><br></div><ul><li><div>mixin 模块下的5个类:</div></li></ul><div><br></div><ul><ul><li><div>mixins.ListModelMixin -&gt; 查看所有数据</div></li><ul><li><div>mixins.ListModelMixin 下的 <span style="color:rgb(65, 173, 28);">list</span><span style="color:rgb(65, 173, 28);">()</span> 方法: 封装了查看所有数据的代码</div></li></ul></ul></ul><div><br></div><ul><ul><li><div>mixins.CreateModelMixin -&gt; 创建数据</div></li><ul><li><div>mixins.CreateModelMixin 下的<span style="color:rgb(65, 173, 28);"></span><span style="color:rgb(65, 173, 28);">create</span><span style="color:rgb(65, 173, 28);">()</span> 方法: 封装了添加数据的代码</div></li></ul></ul></ul><div><br></div><ul><ul><li><div>mixins.RetrieveModelMixin -&gt; 查询指定数据</div></li><ul><li><div>mixins.RetrieveModelMixin 下的 <span style="color:rgb(65, 173, 28);">retrieve()</span> 方法: 封装了查询指定数据的代码</div></li></ul></ul></ul><div><br></div><ul><ul><li><div>mixins.UpdateModelMixin -&gt; 修改数据</div></li><ul><li><div>mixins.UpdateModelMixin 下的 <span style="color:rgb(65, 173, 28);">update()</span> 方法: PUT请求 -&gt; 封装了修改数据的代码</div></li><li><div>mixins.UpdateModelMixin 下的 <span style="color:rgb(65, 173, 28);">partial_update()</span> 方法: PATCH -&gt; 封装了修改数据的代码</div></li></ul></ul></ul><div><br></div><ul><ul><li><div>mixins.DestroyModelMixin -&gt; 删除数据</div></li><ul><li><div>mixins.DestroyModelMixin 下的 <span style="color:rgb(65, 173, 28);">destroy()</span> 方法: 封装了删除数据的代码</div></li></ul></ul></ul><div><br></div><ul><li><div>generics 模块下的 GenericAPIView 类，其实就是继承 rest-framework 中的 APIView，并且在这基础上扩展了一些方法</div></li></ul><div><br></div><ul><li><div><span style="color:rgb(227, 0, 0);">注意</span>:</div></li></ul><div><br></div><ul><ul><li><div>在使用mixin类编写视图的时候一定要继承 GenericAPIView 类</div></li></ul></ul><div><br></div><ul><ul><li><div>在使用 mixins.UpdateModelMixin 类的时候，要在操作单条数据的url中加上名为 pk 的命名匹配 -&gt; url(r'book/(?P&lt;<span style="color:rgb(250, 122, 0);">pk</span>&gt;\d+)', BookDetailView.as_view())</div></li></ul></ul><div><br></div><ul><ul><li><div>在使用mixin类编写视图的时候一定要在该视图类下定义两个静态属性，且这两个静态属性的名字不能随便修改一定要使用这两个属性名: </div></li></ul></ul><div><br></div><ul><ul><ul><li><div>queryset -&gt; 指定操作那张表的数据</div></li><li><div>serializer_class -&gt; 指定序列化类</div></li></ul></ul></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size:9pt;font-family:Monaco;"><font style="color:rgb(65, 173, 28);"># views.py</font></span></div><div><span style="font-size:9pt;color:rgb(51, 51, 51);font-family:Monaco;"><br></span></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div>from rest_framework import <font color="#FA7A00">mixins</font></div><div>from rest_framework import <font color="#FA7A00">generics</font></div><div><br></div><div><br></div><div>class BookView(<font color="#FA7A00">mixins.ListModelMixin</font>, <font color="#FA7A00">mixins.CreateModelMixin</font>, <font color="#FA7A00">generics.GenericAPIView</font>):</div><div><br></div><div><font color="#41AD1C"># 不能随意修改这两个静态属性名，因为 mixins 模块下的 5 个类需要用到这两个静态属性</font></div><div><font color="#FA7A00">queryset</font> = Book.objects.all()  <font color="#41AD1C"># 指定操作那张表的数据</font></div><div><font color="#FA7A00">serializer_class</font> = BookSerializers  <font color="#41AD1C"># 指定序列化类</font></div><div><br></div><div><font color="#41AD1C"># 查看所有书籍</font></div><div>    def get(self, request, *args, **kwargs):</div><div>        return self.<font color="#FA7A00">list</font>(request, *args, **kwargs)  <font color="#41AD1C"># self.list() 是 mixins.ListModelMixin 所提供的方法，</font><font color="#41AD1C">封装了查看所有数据的代码</font><font color="#41AD1C">，self.list() 的返回值: Response(数据)</font></div><div><br></div><div><font color="#41AD1C"># 添加书籍</font></div><div>    def post(self, request, *args, **kwargs):</div><div>        return self.<font color="#FA7A00">create</font>(request, *args, **kwargs)  <font color="#41AD1C"># self.create() 是 mixins.CreateModelMixin 所提供的方法，</font><font color="#41AD1C">封装了添加数据的代码</font><font color="#41AD1C">，self.create() 的返回值: Response(数据)</font></div><div><br></div><div><br></div><div>class BookDetailView(<font color="#FA7A00">mixins.RetrieveModelMixin</font>, <font color="#FA7A00">mixins.UpdateModelMixin</font>, <font color="#FA7A00">mixins.DestroyModelMixin</font>, <font color="#FA7A00">generics.GenericAPIView</font>):</div><div><br></div><div><font color="#41AD1C"># 不能随意修改这两个静态属性名，因为 mixins 模块下的 5 个类需要用到这两个静态属性</font></div><div><font color="#FA7A00">queryset</font> = Book.objects.all()  <font color="#41AD1C"># 指定操作那张表的数据</font></div><div><font color="#FA7A00">serializer_class</font> = BookSerializers  <font color="#41AD1C"># 指定序列化类</font></div><div><br></div><div><font color="#41AD1C"># 查看指定的书籍</font></div><div>    def get(self, request, *args, **kwargs):</div><div>        return self.<font color="#FA7A00">retrieve</font>(request, *args, **kwargs)  <font color="#41AD1C"># self.retrieve() 是 mixins.RetrieveModelMixin 所提供的方法，</font><font color="#41AD1C">封装了查询指定数据的代码</font><font color="#41AD1C">，self.retrieve() 的返回值: Response(数据)</font></div><div><br></div><div><font color="#41AD1C"># 修改书籍</font></div><div>    def put(self, request, *args, **kwargs):</div><div>        return self.<font color="#FA7A00">update</font>(request, *args, **kwargs)  <font color="#41AD1C"># self.update() 是 mixins.UpdateModelMixin 所提供的方法，</font><font color="#41AD1C">封装了修改数据的代码</font><font color="#41AD1C">，self.update() 的返回值: Response(数据)</font></div><div><br></div><div><font color="#41AD1C"># 删除书籍</font></div><div>    def delete(self, request, *args, **kwargs):</div><div>        return self.<font color="#FA7A00">destroy</font>(request, *args, **kwargs)  <font color="#41AD1C"># self.destroy() 是 mixins.DestroyModelMixin 所提供的方法，</font><font color="#41AD1C">封装了删除数据的代码</font><font color="#41AD1C">，self.destroy() 的返回值: Response(数据)</font></div><div><br></div><div><br></div><div>class PublishView(mixins.ListModelMixin, mixins.CreateModelMixin, generics.GenericAPIView):</div><div><br></div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div><div><br></div><div><font color="#41AD1C"># 查看所有出版社</font></div><div>    def get(self, request, *args, **kwargs):</div><div>        return self.list(request, *args, **kwargs)</div><div><br></div><div><font color="#41AD1C"># 添加出版社</font></div><div>    def post(self, request, *args, **kwargs):</div><div>        return self.create(request, *args, **kwargs)</div><div><br></div><div><br></div><div>class PublishDetailView(mixins.RetrieveModelMixin, mixins.UpdateModelMixin, mixins.DestroyModelMixin, generics.GenericAPIView):</div><div><br></div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div><div><br></div><div><font color="#41AD1C"># 查看指定的出版社</font></div><div>    def get(self, request, *args, **kwargs):</div><div>        return self.retrieve(request, *args, **kwargs)</div><div><br></div><div><font color="#41AD1C"># 修改出版社</font></div><div>    def put(self, request, *args, **kwargs):</div><div>        return self.update(request, *args, **kwargs)</div><div><br></div><div><font color="#41AD1C"># 删除出版社</font></div><div>    def delete(self, request, *args, **kwargs):</div><div>        return self.destroy(request, *args, **kwargs)</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># serializer.py</font></div><div><br></div><div>from rest_framework import serializers</div><div>from .models import *</div><div><br></div><div><br></div><div>class PublishSerializers(serializers.ModelSerializer):</div><div>    class Meta:</div><div>        model = Publish</div><div>        fields = '__all__'</div><div><br></div><div><br></div><div>class BookSerializers(serializers.ModelSerializer):</div><div>    class Meta:</div><div>        model = Book</div><div>        fields = '__all__'</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># urls.py</font></div><div><br></div><div>urlpatterns = [</div><div>    url(r'^admin/', admin.site.urls),</div><div><br></div><div>    url(r'book/$', BookView.as_view()),</div><div>    url(r'book/(<font color="#FA7A00">?P&lt;pk&gt;</font>\d+)', BookDetailView.as_view()),</div><div><br></div><div>    url(r'publish/$', PublishView.as_view()),</div><div>    url(r'publish/(<font color="#FA7A00">?P&lt;pk&gt;</font>\d+)', PublishDetailView.as_view()),</div><div>]</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">3.</span><span style="font-size:14pt;font-weight:bold;"> 使用通用的基于类的视图</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>使用通用的基于类的视图说明:</div></li></ul><div><br></div><ul><ul><li><div><span style="font-size:12pt;">简化了mixin类编写视图的操作</span></div></li></ul></ul><div><br></div><ul><li><div>generics 模块下的类的功能说明:</div></li></ul><div><br></div><ul><ul><li><div>GenericAPIView 继承了 APIView，且在这基础上扩展了新的功能</div></li><li><div>----------------------------------------------------</div></li><li><div>generics.ListAPIView  提供了 查询所有数据 的功能</div></li><li><div>generics.CreateAPIView 提供了 添加数据 的功能</div></li><li><div>generics.ListCreateAPIView 提供了 查询所有数据、添加数据 的功能</div></li><li><div>generics.RetrieveAPIView 提供了 查询指定数据 的功能</div></li><li><div>generics.UpdateAPIView 提供了 修改数据 的功能</div></li><li><div>generics.DestroyAPIView 提供了 删除数据 的功能</div></li><li><div>generics.RetrieveUpdateAPIView 提供了 查询指定数据、修改数据 的功能</div></li><li><div>generics.RetrieveDestroyAPIView 提供了 查询指定数据、删除数据 的功能</div></li><li><div>generics.RetrieveUpdateDestroyAPIView 提供了 查询指定数据、修改数据、删除数据 的功能</div></li></ul></ul><div><br></div><ul><li><div>generics.ListAPIView 的说明:</div></li><ul><li><div>提供了 查询所有数据 的功能</div></li><li><div>---------------------------------------</div></li><li><div>继承了 mixins.ListModelMixin</div></li><li><div>提供了处理 GET 请求的方法</div></li><li><div>处理GET请求的方法调用了 mixins.ListModelMixin 下的 list() 方法</div></li></ul></ul><div><br></div><ul><li><div>generics.CreateAPIView 的说明:</div></li><ul><li><div>提供了 添加数据 的功能</div></li><li><div>---------------------------------------</div></li><li><div>继承了 mixins.CreateModelMixin</div></li><li><div>提供了处理 POST 请求的方法</div></li><li><div>处理POST请求的方法调用了 mixins.CreateModelMixin 下的 create() 方法</div></li></ul></ul><div><br></div><ul><li><div>generics.ListCreateAPIView 的说明:</div></li><ul><li><div>提供了 查询所有数据、添加数据 的功能</div></li><li><div>---------------------------------------</div></li><li><div>继承了 mixins.ListModelMixin / mixins.CreateModelMixin</div></li><li><div>提供了处理 GET / POST 请求的方法</div></li><li><div>处理GET请求的方法调用了 mixins.ListModelMixin 下的 list() 方法</div></li><li><div>处理POST请求的方法调用了 mixins.CreateModelMixin 下的 create() 方法</div></li></ul></ul><div><br></div><ul><li><div>generics.RetrieveAPIView 的说明:</div></li><ul><li><div>提供了 查询指定数据 的功能</div></li><li><div>---------------------------------------</div></li><li><div>继承了 mixins.RetrieveModelMixin</div></li><li><div>提供了处理 GET 请求的方法</div></li><li><div>处理GET请求的方法调用了 mixins.RetrieveModelMixin 下的 retrieve() 方法</div></li></ul></ul><div><br></div><ul><li><div>generics.UpdateAPIView 的说明:</div></li><ul><li><div>提供了 修改数据 的功能</div></li><li><div>---------------------------------------</div></li><li><div>继承了 mixins.UpdateModelMixin</div></li><li><div>提供了处理 PUT / PATCH 请求的方法</div></li><li><div>处理PUT请求的方法调用了 mixins.UpdateModelMixin 下的 update() 方法</div></li><li><div>处理PATCH请求的方法调用了 mixins.UpdateModelMixin 下的 partial_update() 方法</div></li></ul></ul><div><br></div><ul><li><div>generics.DestroyAPIView 的说明:</div></li><ul><li><div>提供了 删除数据 的功能</div></li><li><div>---------------------------------------</div></li><li><div>继承了 mixins.DestroyModelMixin</div></li><li><div>提供了处理 DELETE 请求的方法</div></li><li><div>处理DELETE请求的方法调用了 mixins.DestroyModelMixin 下的 destroy() 方法</div></li></ul></ul><div><br></div><ul><li><div>generics.RetrieveUpdateAPIView 的说明:</div></li><ul><li><div>提供了 查询指定数据、修改数据 的功能</div></li><li><div>---------------------------------------</div></li><li><div>继承了 mixins.RetrieveModelMixin / mixins.UpdateModelMixin</div></li><li><div>提供了处理 GET / PUT / PATCH 请求的方法</div></li><li><div>处理GET请求的方法调用了 mixins.RetrieveModelMixin 下的 retrieve() 方法</div></li><li><div>处理PUT请求的方法调用了 mixins.UpdateModelMixin 下的 update() 方法</div></li><li><div>处理PATCH请求的方法调用了 mixins.UpdateModelMixin 下的 partial_update() 方法</div></li></ul></ul><div><br></div><ul><li><div>generics.RetrieveDestroyAPIView 的说明:</div></li><ul><li><div>提供了 查询指定数据、删除数据 的功能</div></li><li><div>---------------------------------------</div></li><li><div>继承了 mixins.RetrieveModelMixin / mixins.DestroyModelMixin</div></li><li><div>提供了处理 GET / DELETE 请求的方法</div></li><li><div>处理GET请求的方法调用了 mixins.RetrieveModelMixin 下的 retrieve() 方法</div></li><li><div>处理DELETE请求的方法调用了 mixins.DestroyModelMixin 下的 destroy() 方法</div></li></ul></ul><div><br></div><ul><li><div>generics.RetrieveUpdateDestroyAPIView 的说明:</div></li><ul><li><div>提供了 查询指定数据、修改数据、删除数据 的功能</div></li><li><div>---------------------------------------</div></li><li><div>继承了 mixins.RetrieveModelMixin / mixins.UpdateModelMixin / mixins.DestroyModelMixin</div></li><li><div>提供了处理 GET / PUT / PATCH / DELETE 请求的方法</div></li><li><div>处理GET请求的方法调用了 mixins.RetrieveModelMixin 下的 retrieve() 方法</div></li><li><div>处理PUT请求的方法调用了 mixins.UpdateModelMixin 下的 update() 方法</div></li><li><div>处理PATCH请求的方法调用了 mixins.UpdateModelMixin 下的 partial_update() 方法</div></li><li><div>处理DELETE请求的方法调用了 mixins.DestroyModelMixin 下的 destroy() 方法</div></li></ul></ul><div><br></div><ul><li><div><span style="color:rgb(255, 0, 0);">注意</span>:</div></li><ul><li><div>一定要继承 generics 模块所提供的功能类</div></li></ul></ul><div><br></div><ul><ul><li><div>如果继承了 generics.UpdateAPIView 等涉及到修改数据的功能类，那么就要在操作单条数据的url中加上名为 pk 的命名匹配，因为修改数据的功能类继承了mixins.UpdateModelMixin类，且mixins.UpdateModelMixin类中的代码是通过“pk”这个名字去获取url中的参数，然后才能查询到指定的数据对象 -&gt; url(r'book/(?P&lt;<span style="color:rgb(250, 122, 0);">pk</span>&gt;\d+)', BookDetailView.as_view({'请求方式': '视图类的处理请求的方法名'}))</div></li></ul></ul><div><br></div><ul><ul><li><div>在编写视图的时候一定要在该视图类下定义两个静态属性，且这两个静态属性的名字不能随便修改一定要使用这两个属性名: </div></li></ul></ul><div><br></div><ul><ul><ul><li><div>queryset -&gt; 指定操作那张表的数据</div></li><li><div>serializer_class -&gt; 指定序列化类</div></li></ul></ul></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size:9pt;font-family:Monaco;"><font color="#41AD1C"># views.py</font></span></div><div><span style="font-size:9pt;font-family:Monaco;"><font color="#41AD1C"><br></font></span></div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div>from rest_framework import <font color="#FA7A00">generics</font></div><div><br></div><div><br></div><div>class BookView(<font color="#FA7A00">generics.ListCreateAPIView</font>):</div><div>    queryset = Book.objects.all()</div><div>    serializer_class = BookSerializers</div><div><br></div><div><br></div><div>class BookDetailView(<font color="#FA7A00">generics.RetrieveUpdateDestroyAPIView</font>):</div><div>    queryset = Book.objects.all()</div><div>    serializer_class = BookSerializers</div><div><br></div><div><br></div><div>class PublishView(<font color="#FA7A00">generics.ListCreateAPIView</font>):</div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div><div><br></div><div><br></div><div>class PublishDetailView(<font color="#FA7A00">generics.RetrieveUpdateDestroyAPIView</font>):</div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># urls.py</font></div><div><br></div><div>urlpatterns = [</div><div>    url(r'^admin/', admin.site.urls),</div><div><br></div><div>    url(r'book/$', BookView.as_view()),</div><div>    url(r'book/(<font color="#FA7A00">?P&lt;pk&gt;</font>\d+)', BookDetailView.as_view()),</div><div><br></div><div>    url(r'publish/$', PublishView.as_view()),</div><div>    url(r'publish/(<font color="#FA7A00">?P&lt;pk&gt;</font>\d+)', PublishDetailView.as_view()),</div><div>]</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">4.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;font-weight:bold;">终极版</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>终极版的说明:</div></li></ul><div><br></div><ul><ul><li><div>两条url使用同一个视图类</div></li><li><div>视图类不再继承mixins模块下的5个类，而是继承 ModelViewSet 类</div></li></ul></ul><div><br></div><ul><li><div>ModelViewSet类的说明:</div></li></ul><div><br></div><ul><ul><li><div>ModelViewSet类已经继承了mixins模块下的5个类</div></li></ul></ul><div><br></div><ul><li><div>.as_view() 新用法的说明:</div></li></ul><div><br></div><ul><ul><li><div>viewsets模块下的ViewSetMixin类通过重写 .as_view() 方法，实现了通过传递的字典（{'get':'list', 'post':'create'}）方式对处理http请求的方法进行分发</div></li></ul></ul><div><br></div><ul><li><div><span style="color:rgb(255, 0, 0);">注意</span>:</div></li></ul><div><br></div><ul><ul><li><div>一定要继承 ModelViewSet 类</div></li></ul></ul><div><br></div><ul><ul><li><div>要在操作单条数据的url中加上名为 pk 的命名匹配，因为ModelViewSet类继承了mixins.UpdateModelMixin类，且mixins.UpdateModelMixin类中的代码是通过“pk”这个名字去获取url中的参数，然后才能查询到指定的数据对象 -&gt; url(r'book/(?P&lt;<span style="color:rgb(250, 122, 0);">pk</span>&gt;\d+)', BookDetailView.as_view({'请求方式': '视图类的处理请求的方法名'}))</div></li></ul></ul><div><br></div><ul><ul><li><div>在编写视图的时候一定要在该视图类下定义两个静态属性，且这两个静态属性的名字不能随便修改一定要使用这两个属性名: </div></li></ul></ul><div><br></div><ul><ul><ul><li><div>queryset -&gt; 指定操作那张表的数据</div></li><li><div>serializer_class -&gt; 指定序列化类</div></li></ul></ul></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div>from rest_framework import <font color="#FA7A00">viewsets</font></div><div><br></div><div><br></div><div>class BookViewSet(<font color="#FA7A00">viewsets.ModelViewSet</font>):</div><div>    queryset = Book.objects.all()</div><div>    serializer_class = BookSerializers</div><div><br></div><div><br></div><div>class PublishViewSet(<font color="#FA7A00">viewsets.ModelViewSet</font>):</div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># urls.py</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#FA7A00"># url(r'book/$', BookViewSet.as_view({'请求类型': '视图类的处理请求的方法名'})</font></div><div><font color="#FA7A00"><br></font></div><div>urlpatterns = [</div><div>    url(r'^admin/', admin.site.urls),</div><div><br></div><div>    url(r'book/$', BookViewSet.<font color="#FA7A00">as_view</font>({</div><div>        &quot;get&quot;: &quot;list&quot;,  <font color="#41AD1C"># list 方法是 mixins.ListModelMixin 所提供的方法，</font><font color="#41AD1C">封装了查看所有数据的代码</font><font color="#41AD1C">，由于 viewsets.ModelViewSet 继承了 mixins.ListModelMixin 所以可以使用 list 方法</font></div><div>        &quot;post&quot;: &quot;create&quot;  <font color="#41AD1C"># create 方法是 mixins.CreateModelMixin 所提供的方法，</font><font color="#41AD1C">封装了添加数据的代码</font><font color="#41AD1C">，由于 viewsets.ModelViewSet 继承了 mixins.CreateModelMixin 所以可以使用 create 方法</font></div><div>    })),</div><div>    url(r'book/(<font color="#FA7A00">?P&lt;pk&gt;</font>\d+)', BookViewSet.<font color="#FA7A00">as_view</font>({</div><div>        'get': 'retrieve',  <font color="#41AD1C"># retrieve 方法是 mixins.RetrieveModelMixin 所提供的方法，</font><font color="#41AD1C">封装了查询指定数据的代码</font><font color="#41AD1C">，由于 viewsets.ModelViewSet 继承了 mixins.RetrieveModelMixin 所以可以使用 retrieve 方法</font></div><div>        'put': 'update',  <font color="#41AD1C"># update 方法是 mixins.UpdateModelMixin 所提供的方法，</font><font color="#41AD1C">封装了修改数据的代码</font><font color="#41AD1C">，由于 viewsets.ModelViewSet 继承了 mixins.UpdateModelMixin 所以可以使用 update 方法</font></div><div>        'patch': 'partial_update',  <font color="#41AD1C"># partial_update 方法是 mixins.UpdateModelMixin 所提供的方法，</font><font color="#41AD1C">封装了修改数据的代码</font><font color="#41AD1C">，由于 viewsets.ModelViewSet 继承了 mixins.UpdateModelMixin 所以可以使用 partial_update 方法</font></div><div>        'delete': 'destroy'  <font color="#41AD1C"># destroy 方法是 mixins.DestroyModelMixin 所提供的方法，</font><font color="#41AD1C">封装了删除数据的代码</font><font color="#41AD1C">，由于 viewsets.ModelViewSet 继承了 mixins.DestroyModelMixin 所以可以使用 destroy 方法</font></div><div>    })),</div><div><br></div><div>    url(r'publish/$', PublishViewSet.<font color="#FA7A00">as_view</font>({</div><div>        &quot;get&quot;: &quot;list&quot;,</div><div>        &quot;post&quot;: &quot;create&quot;</div><div>    })),</div><div>    url(r'publish/(<font color="#FA7A00">?P&lt;pk&gt;</font>\d+)', PublishViewSet.<font color="#FA7A00">as_view</font>({</div><div>        'get': 'retrieve',</div><div>        'put': 'update',</div><div>        'patch': 'partial_update',</div><div>        'delete': 'destroy'</div><div>    })),</div><div>]</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">4.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;"><span style="font-size:14pt;font-weight:bold;">重写 list、create、retrieve、update、partial_update、destroy 方法</span></span></div><div><br></div><ul><li><div>如果默认返回给前端的数据结构不合适的话，可以通过重写 list 等方法重新构造数据结构</div></li></ul><div><br></div><ul><li><div>原理: 在视图类下重写 list 等方法，那么就不会执行 mixin 模块下的5个类所分别提供的方法（即: <span style="font-size:medium;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:rgb(0, 0, 0);font-family:&quot;Courier New&quot;;font-variant-caps:normal;font-variant-ligatures:normal;">list、create、retrieve、update、partial_update、destroy</span>）</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># views.py</span></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div>from rest_framework import viewsets</div><div><br></div><div><br></div><div>class BookViewSet(viewsets.ModelViewSet):</div><div>    queryset = Book.objects.all()</div><div>    serializer_class = BookSerializers</div><div><br></div><div><font color="#FA7A00"># 重写编写 list 方法覆盖 mixins.ListModelMixin 类下的 list 方法</font></div><div>    def <font color="#FA7A00">list</font>(self, request, *args, **kwargs):</div><div>        ret = {</div><div>            'static': 1,</div><div>            'data': {</div><div>                'a': 1,</div><div>                'b': 2,</div><div>            }</div><div>        }</div><div>        return Response(ret)</div><div><br></div><div><font color="#FA7A00"># 重写编写 retrieve 方法覆盖 mixins.RetrieveModelMixin 类下的 retrieve 方法</font></div><div>    def <font color="#FA7A00">retrieve</font>(self, request, *args, **kwargs):</div><div>        ret = {</div><div>            'data': '你所查询到的单条数据'</div><div>        }</div><div>        return Response(ret)</div><div><br></div><div><br></div><div>class PublishViewSet(viewsets.ModelViewSet):</div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># urls.py</span></div><div><br></div><div>urlpatterns = [</div><div>    url(r'^admin/', admin.site.urls),</div><div><br></div><div>    url(r'book/$', BookViewSet.<font color="#000000">as_view</font>({</div><div>        &quot;get&quot;: &quot;list&quot;,  <span style="color:rgb(65, 173, 28);"># list 方法是 mixins.ListModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.ListModelMixin 所以可以使用 list 方法</span></div><div>        &quot;post&quot;: &quot;create&quot;  <span style="color:rgb(65, 173, 28);"># create 方法是 mixins.CreateModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.CreateModelMixin 所以可以使用 create 方法</span></div><div>    })),</div><div><font color="#000000"> url(r'book/(?P&lt;pk&gt;\d+)', BookViewSet.as_view</font>({</div><div>        'get': 'retrieve',  <span style="color:rgb(65, 173, 28);"># retrieve 方法是 mixins.RetrieveModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.RetrieveModelMixin 所以可以使用 retrieve 方法</span></div><div>        'put': 'update',  <span style="color:rgb(65, 173, 28);"># update 方法是 mixins.UpdateModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.UpdateModelMixin 所以可以使用 update 方法</span></div><div>        'patch': 'partial_update',  <span style="color:rgb(65, 173, 28);"># partial_update 方法是 mixins.UpdateModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.UpdateModelMixin 所以可以使用 partial_update 方法</span></div><div>        'delete': 'destroy'  <span style="color:rgb(65, 173, 28);"># destroy 方法是 mixins.DestroyModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.DestroyModelMixin 所以可以使用 destroy 方法</span></div><div>    })),</div><div><br></div><div><font color="#000000">url(r'publish/$', PublishViewSet.as_view</font>({</div><div>        &quot;get&quot;: &quot;list&quot;,</div><div>        &quot;post&quot;: &quot;create&quot;</div><div>    })),</div><div><font color="#000000">url(r'publish/(?P&lt;pk&gt;\d+)', PublishViewSet.as_view</font>({</div><div>        'get': 'retrieve',</div><div>        'put': 'update',</div><div>        'patch': 'partial_update',</div><div>        'delete': 'destroy'</div><div>    })),</div><div>]</div></div><div><br></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">.as_view() 的新用法</span></h2><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;font-weight:bold;">.as_view() 新用法的说明</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>.as_view() 新用法的作用就是两条url使用同一个视图类</div></li><li><div>.as_view() 新用法其实就是视图四部曲中的终极版</div></li></ul><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;font-weight:bold;">.as_view() 新的使用方式一</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>viewsets模块下的ViewSetMixin类通过重写 .as_view() 方法，实现了通过传递的字典（{'get':'list', 'post':'create'}）方式对处理http请求的方法进行分发</div></li></ul><div><br></div><ul><li><div>通过继承 ViewSetMixin 类 和 APIView 类 实现 .as_view() 的新用法</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><font color="#41AD1C"><br></font></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div><br></div><div>from rest_framework import viewsets</div><div><br></div><div><br></div><div>class BookViewSet(<font color="#FA7A00">viewsets.ViewSetMixin</font>, <font color="#FA7A00">APIView</font>):</div><div><br></div><div>    def list(self, request, *args, **kwargs):</div><div>        ret = {</div><div>            'data': '你所查询到的所有数据'</div><div>        }</div><div>        return Response(ret)</div><div><br></div><div>    def create(self, request, *args, **kwargs):</div><div>        ret = {</div><div>            'data': '你所添加的数据'</div><div>        }</div><div>        return Response(ret)</div><div><br></div><div>    def retrieve(self, request, *args, **kwargs):</div><div>        ret = {</div><div>            'data': '你所查询到的单条数据'</div><div>        }</div><div>        print(ret)</div><div>        return Response(ret)</div><div><br></div><div>    def update(self, request, *args, **kwargs):</div><div>        ret = {</div><div>            'data': '你所修改的数据'</div><div>        }</div><div>        return Response(ret)</div><div><br></div><div>    def partial_update(self, request, *args, **kwargs):</div><div>        ret = {</div><div>            'data': '你所修改的数据'</div><div>        }</div><div>        return Response(ret)</div><div><br></div><div>    def destroy(self, request, *args, **kwargs):</div><div>        ret = {</div><div>            'data': '删除数据成功'</div><div>        }</div><div>        return Response(ret)</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># urls.py</span></div><div><br></div><div>urlpatterns = [</div><div>    url(r'book/$', BookViewSet.<span style="color:rgb(0, 0, 0);">as_view</span>({</div><div>        &quot;get&quot;: &quot;list&quot;,  <span style="color:rgb(65, 173, 28);"># list 方法是 mixins.ListModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.ListModelMixin 所以可以使用 list 方法</span></div><div>        &quot;post&quot;: &quot;create&quot;  <span style="color:rgb(65, 173, 28);"># create 方法是 mixins.CreateModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.CreateModelMixin 所以可以使用 create 方法</span></div><div>    })),</div><div><span style="color:rgb(0, 0, 0);"> url(r'book/(?P&lt;pk&gt;\d+)', BookViewSet.as_view</span>({</div><div>        'get': 'retrieve',  <span style="color:rgb(65, 173, 28);"># retrieve 方法是 mixins.RetrieveModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.RetrieveModelMixin 所以可以使用 retrieve 方法</span></div><div>        'put': 'update',  <span style="color:rgb(65, 173, 28);"># update 方法是 mixins.UpdateModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.UpdateModelMixin 所以可以使用 update 方法</span></div><div>        'patch': 'partial_update',  <span style="color:rgb(65, 173, 28);"># partial_update 方法是 mixins.UpdateModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.UpdateModelMixin 所以可以使用 partial_update 方法</span></div><div>        'delete': 'destroy'  <span style="color:rgb(65, 173, 28);"># destroy 方法是 mixins.DestroyModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.DestroyModelMixin 所以可以使用 destroy 方法</span></div><div>    })),</div><div>]</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">3.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;font-weight:bold;">.as_view() 新的使用方式二</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">.as_view() 的使用方式二实际上就是视图四部曲中的终极版，通过继承 </span>ModelViewSet 类，实际上 ModelViewSet 类也是继承了 viewsets 模块下的 ViewSetMixin 类</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"><span style="font-size:9pt;font-family:Monaco;">这里就不做代码演示了不懂的可以看回 视图四部曲中的终极版 或者 查看 </span>ModelViewSet 类的源码</font></div></div><div><span style="font-size:14pt;"><br></span></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">认证组件</span></h2><div><br></div><div><span style="font-size:14pt;">只要继承了 APIView 就可以使用认证组件</span></div><div><br></div><div><span style="font-size:14pt;color:rgb(227, 0, 0);">认证: 每次请求都要带着token（即: 字符串）来进行验证，如果认证成功则返回相应的数据</span></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;">组件的</span><span style="font-size:14pt;">执行顺序: </span> <span style="font-size:14pt;color:rgb(255, 0, 0);">认证</span> <span style="font-size:14pt;">-&gt; 权限 -&gt; 频率</span></div><div><br></div><div><span style="box-sizing:border-box;-webkit-tap-highlight-color:transparent;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:14pt;white-space:pre-wrap;color:rgb(0, 0, 0);font-family:&quot;Courier New&quot;;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;">1.</span><span style="box-sizing:border-box;-webkit-tap-highlight-color:transparent;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:14pt;color:rgb(0, 0, 0);font-family:&quot;Courier New&quot;;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;"> 认证类的创建</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>认证类的固定写法一 -&gt; 没有继承 BaseAuthentication 认证类</div></li></ul><div><br></div><ul><ul><li><div>如果没有继承 BaseAuthentication 认证类，那么就需要在认证类中编写两个方法</div></li></ul></ul><div><br></div><ul><ul><ul><li><div>authenticate -&gt; 编写认证的逻辑代码</div></li><li><div>authenticate_header -&gt; 不知道有啥用，反正就是要写上 rest-framework 的源码规定的，否则就会报错 </div></li></ul></ul></ul><div><br></div><ul><ul><li><div><span style="color:rgb(227, 0, 0);">注意</span>:</div></li></ul></ul><div><br></div><ul><ul><ul><li><div>authenticate 方法必须有返回值</div></li></ul></ul></ul><div><br></div><ul><ul><ul><li><div>当验证失败的时候（即: if Fasle 的时候）要主动抛出异常，因为 rest-framework 是通过捕获异常来进行处理的</div></li></ul></ul></ul><div><br></div><ul><ul><li><div><span style="font-weight:bold;">authenticate 方法返回值说明:</span></div></li></ul></ul><div><br></div><ul><ul><ul><li><div><span style="font-size:12pt;font-weight:bold;">返回 </span><span style="font-weight:bold;">两个值 或者</span><span style="font-size:12pt;font-weight:bold;"></span><span style="font-weight:bold;">一个列表/元祖中包含两个值</span></div></li></ul></ul></ul><div><br></div><ul><ul><ul><ul><li><div>rest-framework 会将第一个值赋值给 <span style="color:rgb(250, 122, 0);">request.user</span>，第二个值会赋值给 <span style="color:rgb(250, 122, 0);">request.auth，</span>然后在视图类中就可以通过 request.user/auth 分别获取这两个值</div></li></ul></ul></ul></ul><div><br></div><ul><ul><ul><li><div><span style="font-weight:bold;">返回 None</span></div></li></ul></ul></ul><div><br></div><ul><ul><ul><ul><li><div>跳出当前认证，执行下一个认证</div></li></ul></ul></ul></ul><div><br></div><ul><ul><ul><li><div><span style="font-weight:bold;">返回 异常</span></div></li></ul></ul></ul><div><br></div><ul><ul><ul><ul><li><div>跳出当前认证，抛出异常信息</div></li></ul></ul></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># rf_auth.py</font></div><div><span style="font-size:9pt;color:rgb(51, 51, 51);font-family:Monaco;"><br></span></div><div>from rest_framework import exceptions</div><div><br></div><div><br></div><div>class <font color="#FA7A00">认证类的类名</font>(object):</div><div><br></div><div>    def authenticate(self, request):</div><div><font color="#41AD1C"># 认证的逻辑代码</font></div><div><br></div><div>        if <font color="#FA7A00">True/False</font>:</div><div>            return <font color="#FA7A00">返回值一</font>, <font color="#FA7A00">返回值二</font></div><div><font color="#FA7A00"></font>elif xxx:</div><div>            return <font color="#FA7A00">None </font> <font color="#41AD1C"># 跳出本次认证</font></div><div>        else:</div><div><font color="#41AD1C">#</font> raise exceptions.AuthenticationFailed(&quot;验证失败!&quot;)  <font color="#41AD1C"># 设置报错信息</font></div><div><font color="#41AD1C"></font> raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  <font color="#41AD1C"># 设置报错信息</font></div><div><br></div><div>    def authenticate_header(self, request):</div><div>        pass</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>认证类的固定写法二 -&gt; 继承 BaseAuthentication 类 -&gt; <span style="color:rgb(255, 0, 0);">常用</span></div></li></ul><div><br></div><ul><ul><li><div>BaseAuthentication 认证类其实就是一个初始化好的认证类</div></li></ul></ul><div><br></div><ul><ul><li><div>BaseAuthentication 认证类里面也有 <span style="font-size:medium;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:rgb(0, 0, 0);font-family:&quot;Courier New&quot;;font-variant-caps:normal;font-variant-ligatures:normal;">authenticate</span><span style="font-size:medium;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:rgb(0, 0, 0);font-family:&quot;Courier New&quot;;font-variant-caps:normal;font-variant-ligatures:normal;"> 和 </span>authenticate_header 方法，只不过这两个方法里面没有任何逻辑代码</div></li></ul></ul><div><br></div><ul><ul><li><div>在编写认证类的时候可以继承 BaseAuthentication 认证类，然后重写 <span style="font-size:medium;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:rgb(0, 0, 0);font-family:&quot;Courier New&quot;;font-variant-caps:normal;font-variant-ligatures:normal;">authenticate</span><span style="font-size:medium;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:rgb(0, 0, 0);font-family:&quot;Courier New&quot;;font-variant-caps:normal;font-variant-ligatures:normal;"> 方法，而自己编写的认证类就无需写 </span>authenticate_header 方法了，因为 BaseAuthentication 认证类里面有</div></li></ul></ul><div><br></div><ul><ul><li><div><span style="color:rgb(227, 0, 0);">注意</span>:</div></li></ul></ul><div><br></div><ul><ul><ul><li><div>authenticate 方法必须有返回值</div></li></ul></ul></ul><div><br></div><ul><ul><ul><li><div>当验证失败的时候（即: if Fasle 的时候）要主动抛出异常，因为 rest-framework 是通过捕获异常来进行处理的</div></li></ul></ul></ul><div><br></div><ul><ul><li><div><span style="font-weight:bold;">authenticate 方法返回值说明:</span></div></li></ul></ul><div><br></div><ul><ul><ul><li><div><span style="font-size:12pt;font-weight:bold;">返回 </span><span style="font-weight:bold;">两个值 或者</span><span style="font-size:12pt;font-weight:bold;"></span><span style="font-weight:bold;">一个列表/元祖中包含两个值</span></div></li></ul></ul></ul><div><br></div><ul><ul><ul><ul><li><div>rest-framework 会将第一个值赋值给 <span style="color:rgb(250, 122, 0);">request.user</span>，第二个值会赋值给 <span style="color:rgb(250, 122, 0);">request.auth，</span>然后在视图类中就可以通过 request.user/auth 分别获取这两个值</div></li></ul></ul></ul></ul><div><br></div><ul><ul><ul><li><div><span style="font-weight:bold;">返回 None</span></div></li></ul></ul></ul><div><br></div><ul><ul><ul><ul><li><div>跳出当前认证，执行下一个认证</div></li></ul></ul></ul></ul><div><br></div><ul><ul><ul><li><div><span style="font-weight:bold;">返回 异常</span></div></li></ul></ul></ul><div><br></div><ul><ul><ul><ul><li><div>跳出当前认证，抛出异常信息</div></li></ul></ul></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># rf_auth.py</span></div><div><br></div><div>from rest_framework.authentication import BaseAuthentication</div><div>from rest_framework import exceptions</div><div><br></div><div><br></div><div>class <span style="color:rgb(250, 122, 0);">认证类的类名</span>(BaseAuthentication):</div><div><br></div><div>    def authenticate(self, request):</div><div><span style="color:rgb(65, 173, 28);"># 认证的逻辑代码</span></div><div><br></div><div>        if <span style="color:rgb(250, 122, 0);">True/False</span>:</div><div>            return <span style="color:rgb(250, 122, 0);">返回值一</span>, <span style="color:rgb(250, 122, 0);">返回值二</span></div><div><span style="color:rgb(250, 122, 0);"></span><font color="#FA7A00"></font> <font color="#000000">elif xxx:</font></div><div><font color="#000000">            return</font> <font color="#FA7A00">None </font> <font color="#41AD1C"># 跳出本次认证</font></div><div>        else:</div><div><font color="#41AD1C">#</font> raise exceptions.AuthenticationFailed(&quot;验证失败!&quot;)  <span style="color:rgb(65, 173, 28);"># 设置报错信息</span></div><div><span style="color:rgb(65, 173, 28);"></span>raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  <font color="#41AD1C"># 设置报错信息</font></div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>认证类的例子</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># rf_auth.py</font></div><div><br></div><div>from rest_framework.authentication import BaseAuthentication</div><div>from rest_framework import exceptions</div><div>from .models import *</div><div><br></div><div><br></div><div>class TokenAuth(BaseAuthentication):</div><div>    def authenticate(self, request):</div><div>        token = request.GET.get(&quot;token&quot;)  <font color="#41AD1C"># 从get请求中获取token值进行判断</font></div><div>        token_obj = Token.objects.filter(token=token).first()  <font color="#41AD1C"># 判断是否有当前token值的记录</font></div><div>        if token_obj:</div><div>            return token_obj.user, token_obj.token</div><div>        else:</div><div><font color="#41AD1C">#</font> raise exceptions.AuthenticationFailed(&quot;验证失败!&quot;)  <font color="#41AD1C"># 设置报错信息</font></div><div><font color="#41AD1C"></font>raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  <font color="#41AD1C"># 设置报错信息</font></div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="box-sizing:border-box;-webkit-tap-highlight-color:transparent;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:14pt;white-space:pre-wrap;color:rgb(0, 0, 0);font-family:&quot;Courier New&quot;;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;">3.</span><span style="box-sizing:border-box;-webkit-tap-highlight-color:transparent;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:14pt;color:rgb(0, 0, 0);font-family:&quot;Courier New&quot;;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;"> 局部认证</span></div><div><span style="box-sizing:border-box;-webkit-tap-highlight-color:transparent;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">局部认证作用于当前视图的所有请求</span></div></li></ul><div><span style="box-sizing:border-box;-webkit-tap-highlight-color:transparent;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:14pt;"><br></span></div><ul><li><div>局部认证的配置（即: <span style="font-size:12pt;">authentication_classes = [认证类, 认证类]</span>）会覆盖掉该视图类在全局认证中的配置</div></li></ul><div><span style="box-sizing:border-box;-webkit-tap-highlight-color:transparent;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">authentication_classes = [认证类, 认证类]</span></div></li></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># rf_auth.py</font></div><div><br></div><div>from rest_framework.authentication import BaseAuthentication</div><div>from rest_framework import exceptions</div><div>from .models import *</div><div><br></div><div><br></div><div>class TokenAuth(BaseAuthentication):</div><div>    def authenticate(self, request):</div><div>        token = request.GET.get(&quot;token&quot;)  <font color="#41AD1C"># 从get请求中获取token值进行判断</font></div><div>        token_obj = Token.objects.filter(token=token).first()  <font color="#41AD1C"># 判断是否有当前token值的记录</font></div><div>        if token_obj:</div><div>            return token_obj.user, token_obj.token</div><div>        else:</div><div><font color="#41AD1C">#</font> raise exceptions.AuthenticationFailed(&quot;验证失败!&quot;)  <font color="#41AD1C"># 设置报错信息</font></div><div><font color="#41AD1C"></font>raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  <font color="#41AD1C"># 设置报错信息</font></div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>import hashlib</div><div>import time</div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div>from .rf_auth import *</div><div><br></div><div>from rest_framework import viewsets</div><div><br></div><div><br></div><div>class TestRequestView(APIView):</div><div><font color="#FA7A00">authentication_classes</font> = [TokenAuth]  <font color="#41AD1C"># 局部认证，只作用于当前视图</font></div><div><br></div><div>    def get(self, request):</div><div>        print(<font color="#FA7A00">request.user</font>)  <font color="#41AD1C"># Kevin -&gt; user对象 -&gt; TokenAuth 认证类下 authenticate 方法的返回值的第一个值</font></div><div>        print(<font color="#FA7A00">request.auth</font>)  <font color="#41AD1C"># aec82e5c956da440c11651d0e4dfd052 -&gt; token 值 </font>-&gt; <font color="#41AD1C">TokenAuth 认证类下 authenticate 方法的返回值的第二个值</font></div><div>        return Response('测试 request.user/auth 的值')</div><div><br></div><div><br></div><div>class BookViewSet(viewsets.ModelViewSet):</div><div><font color="#FA7A00">authentication_classes</font> = [TokenAuth]  <font style="color:rgb(65, 173, 28);"># 局部认证，只作用于当前视图下的所有请求</font></div><div><br></div><div>    queryset = Book.objects.all()</div><div>    serializer_class = BookSerializers</div><div><br></div><div><br></div><div>class PublishViewSet(viewsets.ModelViewSet):</div><div><font color="#FA7A00">authentication_classes</font> = [TokenAuth]  <font color="#41AD1C"># 局部认证，只作用于当前视图</font><font color="#41AD1C">下的所有请求</font></div><div><br></div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div><div><br></div><div><br></div><div><font color="#41AD1C"># 获取以用户名作为盐，以当前时间作为加密内容的字符串token</font></div><div>def get_token_str(username):</div><div>    now_time = str(time.time())</div><div>    md5 = hashlib.md5(bytes(username, encoding=&quot;utf8&quot;))  <font color="#41AD1C"># 加盐，使用用户名作为盐，保证token的唯一性</font></div><div>    md5.update(bytes(now_time, encoding='utf-8'))</div><div>    return md5.hexdigest()</div><div><br></div><div><br></div><div><font color="#FA7A00"># 登陆，并且返回当前用户的token</font></div><div>class LoginView(APIView):</div><div>    def post(self, request):</div><div>        username = request.data.get('username')</div><div>        password = request.data.get('password')</div><div>        user = User.objects.filter(username=username, password=password).first()</div><div>        ret = {</div><div>            'status': 0,</div><div>            'msg': None</div><div>        }</div><div>        if user:</div><div>            token_str = get_token_str(user.username)  <font color="#41AD1C"># 获取Token值</font></div><div><font color="#41AD1C"># 每次登陆成功后都要修改当前用户的token值</font></div><div>            Token.objects.update_or_create(user=user, defaults={'token': token_str})  <font color="#41AD1C"># 如果有 user=user 这条数据，那么就修改 token 值，否则就进行添加</font></div><div>            ret['status'] = 1</div><div>            ret['token'] = token_str</div><div>        else:</div><div>            ret['msg'] = '登陆失败'</div><div><br></div><div>        return Response(ret)</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口说明: 登陆，获取token值</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/login/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: POST</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 发送数据的编码格式: application/json -&gt; 即: json 格式</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 所要发送的数据: </font>{&quot;username&quot;:&quot;Kevin&quot;,&quot;password&quot;:&quot;123&quot;}</div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>{</div><div>    &quot;status&quot;: 1,</div><div>    &quot;msg&quot;: null,</div><div>    &quot;token&quot;: &quot;4a70be5742f536bd78dad811c5044827&quot;</div><div>}</div><div><br></div><div><span style="color:rgb(250, 122, 0);"># --------------------------------------------------------------</span></div><div><br></div><div><font color="#41AD1C"># 接口说明: 查看所有书籍（带token值）</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/?token=4a70be5742f536bd78dad811c5044827</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>[</div><div>    {</div><div>        &quot;id&quot;: 2,</div><div>        &quot;title&quot;: &quot;三体（第二部）&quot;,</div><div>        &quot;price&quot;: 100,</div><div>        &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>        &quot;publish&quot;: 1,</div><div>        &quot;authors&quot;: [</div><div>            1,</div><div>            2</div><div>        ]</div><div>    },</div><div><br></div><div><span style="font-size:9pt;font-family:Monaco;"><font color="#41AD1C">……</font></span></div><div><span style="font-size:9pt;color:rgb(51, 51, 51);font-family:Monaco;">]</span></div><div><span style="font-size:9pt;color:rgb(51, 51, 51);font-family:Monaco;"><br></span></div><div><font color="#FA7A00"># --------------------------------------------------------------</font></div><div><font color="#FA7A00"><br></font></div><div><font color="#41AD1C"># 接口说明: 查看所有书籍（不带token值）</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>{</div><div>    &quot;detail&quot;: &quot;验证失败!&quot;</div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">3.</span><span style="font-size:14pt;font-weight:bold;"> 局部请求认证</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>局部请求认证作用于当前视图的某几个请求</div></li></ul><div><br></div><ul><li><div>通过重写 rest-framework 源码中 get_authenticators 方法来实现局部请求认证</div></li></ul><div><br></div><ul><li><div><span style="font-weight:bold;">get_authenticators 返回值格式</span>: [认证类(), 认证类(), 认证类(), ……]</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># rf_auth.py</span></div><div><br></div><div>from rest_framework.authentication import BaseAuthentication</div><div>from rest_framework import exceptions</div><div>from .models import *</div><div><br></div><div><br></div><div>class TokenAuth(BaseAuthentication):</div><div>    def authenticate(self, request):</div><div>        token = request.GET.get(&quot;token&quot;)  <span style="color:rgb(65, 173, 28);"># 从get请求中获取token值进行判断</span></div><div>        token_obj = Token.objects.filter(token=token).first()  <span style="color:rgb(65, 173, 28);"># 判断是否有当前token值的记录</span></div><div>        if token_obj:</div><div>            return token_obj.user, token_obj.token</div><div>        else:</div><div><span style="color:rgb(65, 173, 28);">#</span> raise exceptions.AuthenticationFailed(&quot;验证失败!&quot;)  <span style="color:rgb(65, 173, 28);"># 设置报错信息</span></div><div><span style="color:rgb(65, 173, 28);"></span>raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  <span style="color:rgb(65, 173, 28);"># 设置报错信息</span></div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># views.py</span></div><div><br></div><div>import hashlib</div><div>import time</div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div>from .rf_auth import *</div><div><br></div><div>from rest_framework import viewsets</div><div><br></div><div>from rest_framework.authentication import <font color="#FA7A00">SessionAuthentication</font></div><div>from rest_framework.authentication import <font color="#FA7A00">BasicAuthentication</font></div><div><br></div><div><br></div><div>class BookView(APIView):</div><div><br></div><div><font color="#41AD1C"># </font><font color="#41AD1C">局部请求认证，只作用于当前视图的某几个请求</font></div><div>    def <font style="color:rgb(250, 122, 0);">get_authenticators</font>(self):  <font color="#41AD1C"># 通过重写 rest-framework 的 get_authenticators 方法从而实现局部请求认证</font></div><div>        if self.request.method == 'POST':  <font color="#41AD1C"># 当请求是 POST 请求的时候，返回自定义的认证类，否则返回 rest-framework 默认的两个认证类</font></div><div>            return [TokenAuth(), ]  <font color="#41AD1C"># 自定义的认证类</font></div><div>        else:</div><div>            return [<font color="#FA7A00">SessionAuthentication()</font>, <font color="#FA7A00">BasicAuthentication()</font>]  <font color="#41AD1C"># rest-framework 默认返回的两个认证类</font></div><div><br></div><div>    def get(self, request, *args, **kwargs):</div><div>        book_queryset = Book.objects.all()</div><div>        ser = BookSerializers(instance=book_queryset, many=True)</div><div>        return Response(ser.data)</div><div><br></div><div>    def post(self, request):</div><div>        ser = BookSerializers(data=request.data)</div><div>        if ser.is_valid():</div><div>            ser.save()</div><div>            return Response(ser.data)</div><div>        else:</div><div>            return Response(ser.errors)</div><div><br></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 获取以用户名作为盐，以当前时间作为加密内容的字符串token</span></div><div>def get_token_str(username):</div><div>    now_time = str(time.time())</div><div>    md5 = hashlib.md5(bytes(username, encoding=&quot;utf8&quot;))  <span style="color:rgb(65, 173, 28);"># 加盐，使用用户名作为盐，保证token的唯一性</span></div><div>    md5.update(bytes(now_time, encoding='utf-8'))</div><div>    return md5.hexdigest()</div><div><br></div><div><br></div><div><span style="color:rgb(250, 122, 0);"># 登陆，并且返回当前用户的token</span></div><div>class LoginView(APIView):</div><div>    def post(self, request):</div><div>        username = request.data.get('username')</div><div>        password = request.data.get('password')</div><div>        user = User.objects.filter(username=username, password=password).first()</div><div>        ret = {</div><div>            'status': 0,</div><div>            'msg': None</div><div>        }</div><div>        if user:</div><div>            token_str = get_token_str(user.username)  <span style="color:rgb(65, 173, 28);"># 获取Token值</span></div><div><span style="color:rgb(65, 173, 28);"># 每次登陆成功后都要修改当前用户的token值</span></div><div>            Token.objects.update_or_create(user=user, defaults={'token': token_str})  <span style="color:rgb(65, 173, 28);"># 如果有 user=user 这条数据，那么就修改 token 值，否则就进行添加</span></div><div>            ret['status'] = 1</div><div>            ret['token'] = token_str</div><div>        else:</div><div>            ret['msg'] = '登陆失败'</div><div><br></div><div>        return Response(ret)</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># 接口说明: 登陆，获取token值</span></div><div><br></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/login/</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: POST</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 发送数据的编码格式: application/json -&gt; 即: json 格式</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 所要发送的数据: </span>{&quot;username&quot;:&quot;Kevin&quot;,&quot;password&quot;:&quot;123&quot;}</div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>{</div><div>    &quot;status&quot;: 1,</div><div>    &quot;msg&quot;: null,</div><div>    &quot;token&quot;: &quot;4a70be5742f536bd78dad811c5044827&quot;</div><div>}</div><div><br></div><div><span style="color:rgb(250, 122, 0);"># --------------------------------------------------------------</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 接口说明: 查看所有书籍</span></div><div><br></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: GET</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>[</div><div>    {</div><div>        &quot;id&quot;: 2,</div><div>        &quot;title&quot;: &quot;三体（第二部）&quot;,</div><div>        &quot;price&quot;: 100,</div><div>        &quot;pub_date&quot;: &quot;2012-12-12&quot;,</div><div>        &quot;publish&quot;: 1,</div><div>        &quot;authors&quot;: [</div><div>            1,</div><div>            2</div><div>        ]</div><div>    },</div><div><br></div><div><span style="font-size:9pt;font-family:Monaco;"></span> <span style="font-size:9pt;font-family:Monaco;color:rgb(65, 173, 28);">……</span></div><div><span style="font-size:9pt;color:rgb(51, 51, 51);font-family:Monaco;">]</span></div><div><br></div><div><span style="color:rgb(250, 122, 0);"># --------------------------------------------------------------</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 接口说明: 添加书籍（带token值）</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);">#</span> <font color="#41AD1C">接口: http://127.0.0.1:8000/book/?token=4a70be5742f536bd78dad811c5044827</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: POST</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>{</div><div>    &quot;id&quot;: 3,</div><div>    &quot;title&quot;: &quot;七大罪&quot;,</div><div>    &quot;price&quot;: 50,</div><div>    &quot;pub_date&quot;: &quot;2020-04-08&quot;,</div><div>    &quot;production_date&quot;: &quot;2020-04-08T07:06:16Z&quot;,</div><div>    &quot;publish&quot;: 1,</div><div>    &quot;authors&quot;: [</div><div>        1,</div><div>        2</div><div>    ]</div><div>}</div><div><br></div><div><font color="#FA7A00"># --------------------------------------------------------------</font></div><div><br></div><div><font color="#41AD1C"># 接口说明: 添加书籍（不带token值）</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/book/</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: POST</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>{</div><div>    &quot;msg&quot;: &quot;验证失败&quot;,</div><div>    &quot;code&quot;: &quot;1000&quot;</div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">4.</span><span style="font-size:14pt;font-weight:bold;"> 全局认证</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">全局认证作用于所有视图类</span></div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># rf_auth.py</span></div><div><br></div><div>from rest_framework.authentication import BaseAuthentication</div><div>from rest_framework import exceptions</div><div>from .models import *</div><div><br></div><div><br></div><div>class TokenAuth(BaseAuthentication):</div><div>    def authenticate(self, request):</div><div>        token = request.GET.get(&quot;token&quot;)  <span style="color:rgb(65, 173, 28);"># 从get请求中获取token值进行判断</span></div><div>        token_obj = Token.objects.filter(token=token).first()  <span style="color:rgb(65, 173, 28);"># 判断是否有当前token值的记录</span></div><div>        if token_obj:</div><div>            return token_obj.user, token_obj.token</div><div>        else:</div><div><font color="#41AD1C">#</font> raise exceptions.AuthenticationFailed(&quot;验证失败!&quot;)  <span style="color:rgb(65, 173, 28);"># 设置报错信息</span></div><div><span style="color:rgb(65, 173, 28);"></span>raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  <font color="#41AD1C"># 设置报错信息</font></div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># settings.py</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 配置全局认证所需要的认证类的路径</font></div><div>REST_FRAMEWORK = {</div><div>    &quot;DEFAULT_AUTHENTICATION_CLASSES&quot;: [&quot;app01.rf_auth.TokenAuth&quot;]</div><div>}</div></div><div><br></div><ul><li><div>不进行认证的视图类设置</div></li></ul><div><br></div><ul><ul><li><div>如果设置了全局认证，但是又想某些视图不进行认证，那么可以在不想进行认证的视图类中设置 authentication_classes = []，因为在 rest-framework 源码中 局部认证的配置 会覆盖掉 全局认证的配置</div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><font color="#41AD1C"><br></font></div><div>import hashlib</div><div>import time</div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div>from .rf_auth import *</div><div><br></div><div>from rest_framework import viewsets</div><div><br></div><div><br></div><div>class BookViewSet(viewsets.ModelViewSet):</div><div>    queryset = Book.objects.all()</div><div>    serializer_class = BookSerializers</div><div><br></div><div><br></div><div>class PublishViewSet(viewsets.ModelViewSet):</div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div><div><br></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 获取以用户名作为盐，以当前时间作为加密内容的字符串token</font></div><div>def get_token_str(username):</div><div>    now_time = str(time.time())</div><div>    md5 = hashlib.md5(bytes(username, encoding=&quot;utf8&quot;))  <font color="#41AD1C"># 加盐，使用用户名作为盐，保证token的唯一性</font></div><div>    md5.update(bytes(now_time, encoding='utf-8'))</div><div>    return md5.hexdigest()</div><div><br></div><div><br></div><div><font color="#41AD1C"># 登陆，并且返回当前用户的token</font></div><div>class LoginView(APIView):</div><div><font color="#FA7A00">authentication_classes = []</font> <font color="#41AD1C"># 在全局认证下，当前视图不进行认证</font></div><div><br></div><div>    def post(self, request):</div><div>        username = request.data.get('username')</div><div>        password = request.data.get('password')</div><div>        user = User.objects.filter(username=username, password=password).first()</div><div>        ret = {</div><div>            'status': 0,</div><div>            'msg': None</div><div>        }</div><div>        if user:</div><div>            token_str = get_token_str(user.username)  <font color="#41AD1C"># 获取Token值</font></div><div><font color="#41AD1C"># 每次登陆成功后都要修改当前用户的token值</font></div><div>            Token.objects.update_or_create(user=user, defaults={'token': token_str})  <font color="#41AD1C"># 如果有 user=user 这条数据，那么就修改 token 值，否则就进行添加</font></div><div>            ret['status'] = 1</div><div>            ret['token'] = token_str</div><div>        else:</div><div>            ret['msg'] = '登陆失败'</div><div><br></div><div>        return Response(ret)</div></div><div><br></div></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">权限组件</span></h2><div><br></div><div><span style="font-size:14pt;">只要继承了 APIView 就可以使用权限组件</span></div><div><br></div><div><span style="font-size:14pt;">组件的</span><span style="font-size:14pt;">执行顺序: </span> <span style="font-size:14pt;">认证 -&gt;</span> <span style="font-size:14pt;color:rgb(255, 0, 0);">权限</span> <span style="font-size:14pt;">-&gt; 频率</span></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"> 权限类的创建</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>权限类的固定写法一 -&gt; 没有继承 BasePermission 权限类</div></li></ul><div><br></div><ul><ul><li><div>如果没有继承 BasePermission 权限类，那么就需要在权限类中编写两个方法</div></li></ul></ul><div><br></div><ul><ul><ul><li><div>has_permission -&gt; 编写权限的逻辑代码</div></li><li><div>has_object_permission -&gt; 不知道有啥用，反正就是要写上 rest-framework 的源码规定的，否则就会报错 </div></li></ul></ul></ul><div><br></div><ul><ul><li><div><span style="color:rgb(227, 0, 0);">注意</span>:</div></li></ul></ul><div><br></div><ul><ul><ul><li><div><span style="font-weight:bold;">has_permission 方法必须返回</span><span style="color:rgb(250, 122, 0);font-weight:bold;">True（也可以是能代表True的元素，即: 字符串、列表、字典等）</span><span style="font-weight:bold;">或则</span><span style="color:rgb(250, 122, 0);font-weight:bold;">False（也可以是能代表True的元素，即: 0、None等）</span><span style="font-weight:bold;">，因为是 rest-framework 的源码规定的</span></div></li></ul></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># rf_permission.py</font></div><div><br></div><div>class <font color="#FA7A00">权限类的类名</font>(object):</div><div><br></div><div>    message = <font color="#FA7A00">'错误信息'</font> <font color="#41AD1C"># 配置错误信息，如果不配置会使用默认的错误信息</font></div><div><br></div><div>    def has_permission(self, request, view):</div><div><br></div><div><font color="#41AD1C"> # 权限的逻辑代码</font></div><div><br></div><div>        if <font color="#FA7A00">True / False</font>:</div><div>            return <font color="#FA7A00">True</font></div><div>        else:</div><div>            return <font color="#FA7A00">False</font></div><div><br></div><div>    def has_object_permission(self, request, view, obj):</div><div><br></div><div>        return True</div></div><div><br></div><ul><li><div>权限类的固定写法二 -&gt; 继承 BasePermission 权限类 -&gt; <span style="color:rgb(255, 0, 0);">常用</span></div></li></ul><div><br></div><ul><ul><li><div>BasePermission 权限类其实就是一个初始化好的权限类</div></li></ul></ul><div><br></div><ul><ul><li><div>BasePermission 权限类里面也有 has_permission <span style="font-size:medium;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:rgb(0, 0, 0);font-family:&quot;Courier New&quot;;font-variant-caps:normal;font-variant-ligatures:normal;">和 </span>has_object_permission 方法，只不过这两个方法里面没有任何逻辑代码</div></li></ul></ul><div><br></div><ul><ul><li><div>在编写权限类的时候可以继承 BasePermission 权限类，然后重写 has_permission <span style="font-size:medium;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:rgb(0, 0, 0);font-family:&quot;Courier New&quot;;font-variant-caps:normal;font-variant-ligatures:normal;">方法，而自己编写的权限类就无需写 </span>has_object_permission 方法了，因为 BasePermission 权限类里面有</div></li></ul></ul><div><br></div><ul><ul><li><div><span style="color:rgb(227, 0, 0);">注意</span>:</div></li></ul></ul><div><br></div><ul><ul><ul><li><div><span style="font-weight:bold;">has_permission 方法必须返回</span><span style="color:rgb(250, 122, 0);font-weight:bold;">True（也可以是能代表True的元素，即: 字符串、列表、字典等）</span><span style="font-weight:bold;">或则</span><span style="color:rgb(250, 122, 0);font-weight:bold;">False（也可以是能代表True的元素，即: 0、None等）</span><span style="font-weight:bold;">，因为是 rest-framework 的源码规定的</span></div></li></ul></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># rf_permission.py</font></div><div><br></div><div>from rest_framework.permissions import BasePermission</div><div><br></div><div><br></div><div>class <font color="#FA7A00">权限类的类名</font>(BasePermission):</div><div><br></div><div>    message = <font color="#FA7A00">'错误信息'</font> <font color="#41AD1C"># 配置错误信息，如果不配置会使用默认的错误信息</font></div><div><br></div><div>    def has_permission(self, request, view):</div><div><br></div><div><font color="#41AD1C"> # 权限的逻辑代码</font></div><div><br></div><div>        if <font color="#FA7A00">True / False</font>:</div><div>            return <font color="#FA7A00">True</font></div><div>        else:</div><div>            return <font color="#FA7A00">False</font></div></div><div><br></div><ul><li><div>权限类的例子</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># rf_permission.py</font></div><div><span style="font-size:9pt;color:rgb(51, 51, 51);font-family:Monaco;"><br></span></div><div>from rest_framework.permissions import BasePermission</div><div><br></div><div><br></div><div>class SVIPPermission(BasePermission):</div><div><br></div><div>    message = &quot;SVIP才能访问!&quot;  <font color="#41AD1C"># 配置错误信息，如果不配置会使用默认的错误信息</font></div><div><br></div><div>    def has_permission(self, request, view):</div><div><font color="#41AD1C"> &quot;&quot;&quot;</font></div><div><font color="#41AD1C">        :param request: APIView 的 request</font></div><div><font color="#41AD1C">        :param view: 视图类的实例化对象 -&gt; APIView 类中的 self</font></div><div><font color="#41AD1C">        :return: True/False</font></div><div><font color="#41AD1C">        &quot;&quot;&quot;</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C">        # request.user / request.auth 可以使用是因为先执行了认证类然后再执行权限类，且在执行认证类的authenticate方法的时候已经把返回值分别赋值给 request.user / request.auth</font></div><div><br></div><div>        if request.user.user_type == 3:</div><div>            print(request.user)  <font color="#41AD1C"># 用户的数据对象</font></div><div>            print(request.auth)  <font color="#41AD1C"># token: 7a06fa70c1516f8cd9399e17285d9903</font></div><div>            return True</div><div>        else:</div><div>            return False</div></div><div><span style="font-size:14pt;"><br></span></div></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"> 局部权限</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>局部权限的配置（即: permission_classes <span style="font-size:12pt;">= [</span><span style="font-size:12pt;">权限</span><span style="font-size:12pt;">类,</span> <span style="font-size:12pt;">权限</span><span style="font-size:12pt;">类]</span>）会覆盖掉该视图类在全局权限中的配置</div></li></ul><div><br></div><ul><li><div>permission_classes<span style="color:rgb(250, 122, 0);"></span><span style="font-size:12pt;">= [权限类, 权限类]</span></div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># rf_permission.py</span></div><div><br></div><div>from rest_framework.permissions import BasePermission</div><div><br></div><div><br></div><div>class SVIPPermission(BasePermission):</div><div><br></div><div>    message = &quot;SVIP才能访问!&quot;  <span style="color:rgb(65, 173, 28);"># 配置错误信息，如果不配置会使用默认的错误信息</span></div><div><br></div><div>    def has_permission(self, request, view):</div><div><span style="color:rgb(65, 173, 28);"> &quot;&quot;&quot;</span></div><div><span style="color:rgb(65, 173, 28);">        :param request: APIView 的 request</span></div><div><span style="color:rgb(65, 173, 28);">        :param view: 视图类的实例化对象 -&gt; APIView 类中的 self</span></div><div><span style="color:rgb(65, 173, 28);">        :return: True/False</span></div><div><span style="color:rgb(65, 173, 28);">        &quot;&quot;&quot;</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);">        # request.user / request.auth 可以使用是因为先执行了认证类然后再执行权限类，且在执行认证类的authenticate方法的时候已经把返回值分别赋值给 request.user / request.auth</span></div><div><br></div><div>        if request.user.user_type == 3:</div><div>            print(request.user)  <span style="color:rgb(65, 173, 28);"># 用户的数据对象</span></div><div>            print(request.auth)  <span style="color:rgb(65, 173, 28);"># token: 7a06fa70c1516f8cd9399e17285d9903</span></div><div>            return True</div><div>        else:</div><div>            return False</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from .models import *</div><div>from .serializer import *</div><div>from .rf_auth import *</div><div>from .rf_permission import *</div><div><br></div><div>from rest_framework import viewsets</div><div><br></div><div><br></div><div>class BookViewSet(viewsets.ModelViewSet):</div><div>    authentication_classes = [TokenAuth]  <font color="#41AD1C"># 局部认证，只作用于当前视图</font></div><div><font style="color:rgb(250, 122, 0);">permission_classes</font> = [SVIPPermission]  <font color="#41AD1C"># 局部权限，只作用于当前视图</font></div><div><br></div><div>    queryset = Book.objects.all()</div><div>    serializer_class = BookSerializers</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">3.</span><span style="font-size:14pt;font-weight:bold;"> 全局权限</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">全局权限作用于所有视图类</span></div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># rf_permission.py</span></div><div><br></div><div>from rest_framework.permissions import BasePermission</div><div><br></div><div><br></div><div>class SVIPPermission(BasePermission):</div><div><br></div><div>    message = &quot;SVIP才能访问!&quot;  <span style="color:rgb(65, 173, 28);"># 配置错误信息，如果不配置会使用默认的错误信息</span></div><div><br></div><div>    def has_permission(self, request, view):</div><div><span style="color:rgb(65, 173, 28);"> &quot;&quot;&quot;</span></div><div><span style="color:rgb(65, 173, 28);">        :param request: APIView 的 request</span></div><div><span style="color:rgb(65, 173, 28);">        :param view: 视图类的实例化对象 -&gt; APIView 类中的 self</span></div><div><span style="color:rgb(65, 173, 28);">        :return: True/False</span></div><div><span style="color:rgb(65, 173, 28);">        &quot;&quot;&quot;</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);">        # request.user / request.auth 可以使用是因为先执行了认证类然后再执行权限类，且在执行认证类的authenticate方法的时候已经把返回值分别赋值给 request.user / request.auth</span></div><div><br></div><div>        if request.user.user_type == 3:</div><div>            print(request.user)  <span style="color:rgb(65, 173, 28);"># 用户的数据对象</span></div><div>            print(request.auth)  <span style="color:rgb(65, 173, 28);"># token: 7a06fa70c1516f8cd9399e17285d9903</span></div><div>            return True</div><div>        else:</div><div>            return False</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># settings.py</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 配置全局权限所需要的权限类的路径</font></div><div>REST_FRAMEWORK = {</div><div><font color="#41AD1C"># &quot;DEFAULT_AUTHENTICATION_CLASSES&quot;: [&quot;app01.rf_auth.TokenAuth&quot;],  # 全局认证</font></div><div>    &quot;DEFAULT_PERMISSION_CLASSES&quot;: [&quot;app01.rf_permission.SVIPPermission&quot;]  <font color="#41AD1C"># 全局权限</font></div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">不进行权限认证的视图类设置</span></div></li></ul><div><font style="font-size:12pt;"><br></font></div><ul><ul><li><div><span style="font-size:12pt;">如果设置了全局权限，但是又想某些视图不进行权限认证，那么可以在不想进行权限认证的视图类中设置</span> permission_classes<span style="color:rgb(250, 122, 0);"></span><span style="font-size:12pt;">= []，因为在 rest-framework 源码中 局部权限的配置 会覆盖掉 全局权限的配置</span></div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># views.py</span></div><div><br></div><div>import hashlib</div><div>import time</div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div>from .rf_auth import *</div><div><br></div><div>from rest_framework import viewsets</div><div><br></div><div><br></div><div>class BookViewSet(viewsets.ModelViewSet):</div><div>    queryset = Book.objects.all()</div><div>    serializer_class = BookSerializers</div><div><br></div><div><br></div><div>class PublishViewSet(viewsets.ModelViewSet):</div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div><div><br></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 获取以用户名作为盐，以当前时间作为加密内容的字符串token</span></div><div>def get_token_str(username):</div><div>    now_time = str(time.time())</div><div>    md5 = hashlib.md5(bytes(username, encoding=&quot;utf8&quot;))  <span style="color:rgb(65, 173, 28);"># 加盐，使用用户名作为盐，保证token的唯一性</span></div><div>    md5.update(bytes(now_time, encoding='utf-8'))</div><div>    return md5.hexdigest()</div><div><br></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 登陆，并且返回当前用户的token</span></div><div>class LoginView(APIView):</div><div><font color="#FA7A00">permission_classes = []</font> <font color="#41AD1C"># 在全局权限下，当前视图不进行权限认证</font></div><div><br></div><div>    def post(self, request):</div><div>        username = request.data.get('username')</div><div>        password = request.data.get('password')</div><div>        user = User.objects.filter(username=username, password=password).first()</div><div>        ret = {</div><div>            'status': 0,</div><div>            'msg': None</div><div>        }</div><div>        if user:</div><div>            token_str = get_token_str(user.username)  <span style="color:rgb(65, 173, 28);"># 获取Token值</span></div><div><span style="color:rgb(65, 173, 28);"># 每次登陆成功后都要修改当前用户的token值</span></div><div>            Token.objects.update_or_create(user=user, defaults={'token': token_str})  <span style="color:rgb(65, 173, 28);"># 如果有 user=user 这条数据，那么就修改 token 值，否则就进行添加</span></div><div>            ret['status'] = 1</div><div>            ret['token'] = token_str</div><div>        else:</div><div>            ret['msg'] = '登陆失败'</div><div><br></div><div>        return Response(ret)</div></div><div><span style="font-size:14pt;"><br></span></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">频率组件</span></h2><div><br></div><div><span style="font-size:14pt;">只要继承了 APIView 就可以使用频率组件</span></div><div><br></div><div><span style="font-size:14pt;">组件的</span><span style="font-size:14pt;">执行顺序: </span> <span style="font-size:14pt;">认证 -&gt; 权限 -&gt; <span style="font-size:14pt;color:rgb(255, 0, 0);">频率</span></span></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"> 频率类的固定写法</span></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># rf_throttle.py</font></div><div><br></div><div>class <font color="#FA7A00">频率类的类名</font>(object):</div><div><br></div><div>    def allow_request(self, request, view):</div><div><br></div><div><font color="#41AD1C"> # 频率的逻辑代码</font></div><div><br></div><div>        if <font color="#FA7A00">True / False</font>:</div><div>            return <font color="#FA7A00">True</font></div><div>        else:</div><div>            return <font color="#FA7A00">False</font></div><div><br></div><div>    def wait(self):</div><div><font color="#41AD1C"># 钩子函数（即: 回调函数）</font></div><div><font color="#41AD1C">        # 当超过设置的访问频率时调用（即: 当allow_request返回False时调用）</font></div><div><font color="#41AD1C">        # 返回需要等待的时间</font></div><div><br></div><div>        return <font color="#FA7A00">'时间字符串'</font></div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"> 局部频率 -&gt; 自己编写频率类</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>局部频率的配置（即: throttle_classes <span style="font-size:12pt;">= [频率</span><span style="font-size:12pt;">类, </span><span style="font-size:12pt;">频率</span><span style="font-size:12pt;">类]</span>）会覆盖掉该视图类在全局频率中的配置</div></li></ul><div><br></div><ul><li><div>throttle_classes <span style="font-size:12pt;">= [</span><span style="font-size:12pt;">频率</span><span style="font-size:12pt;">类, </span><span style="font-size:12pt;">频率</span><span style="font-size:12pt;">类]</span></div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="color:rgb(65, 173, 28);"># rf_throttle.py</font></div><div><font color="#41AD1C"><br></font></div><div>import time</div><div><br></div><div>VISIT_RECORD = {</div><div><font color="#41AD1C"># '127.0.0.1:8080':[最新的时间，……，最初的时间]</font></div><div>}</div><div><br></div><div><br></div><div>class MyThrottle(object):</div><div><font color="#41AD1C"> &quot;&quot;&quot;</font></div><div><font color="#41AD1C">    一分钟允许访问5次</font></div><div><font color="#41AD1C">    原理:</font></div><div><font color="#41AD1C">        拿到用户IP地址</font></div><div><font color="#41AD1C">        编写访问记录 {'ip地址':[最新的时间，……，最初的时间]}</font></div><div><font color="#41AD1C">        确保用户所对应的记录列表的最新时间和最初时间的时间差 &lt;= 规定时间</font></div><div><font color="#41AD1C">        判断用户所对应的记录列表的长度 &lt; 允许访问次数</font></div><div><font color="#41AD1C">    &quot;&quot;&quot;</font></div><div><br></div><div>    allow_time = 60  <font color="#41AD1C"># 时间</font></div><div>    visits = 5  <font color="#41AD1C"># 允许访问次数</font></div><div><br></div><div>    def __init__(self):</div><div>        self.history_list = []</div><div><br></div><div>    def allow_request(self, request, view):</div><div><font color="#41AD1C">&quot;&quot;&quot;</font></div><div><font color="#41AD1C">        :param request: APIView 的 request</font></div><div><font color="#41AD1C">        :param view: 视图类的实例化对象 -&gt; APIView 类中的 self</font></div><div><font color="#41AD1C">        :return: True/False</font></div><div><font color="#41AD1C">        &quot;&quot;&quot;</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 获取用户的IP地址</font></div><div>        ip = request.META.get('REMOTE_ADDR', '')</div><div>        if ip not in VISIT_RECORD:</div><div>            VISIT_RECORD[ip] = [time.time()]</div><div>        else:</div><div>            history = VISIT_RECORD[ip]</div><div><br></div><div>            if len(history) &lt;= self.visits:</div><div>                history.insert(0, time.time())  <font color="#41AD1C"># 将最新的时间添加到列表的第一位</font></div><div><br></div><div>            self.history_list = history  <font color="#41AD1C"># 因为 history 是列表，所以 self.history_list = history 是引用关系，没有进行深度拷贝，所以下面 history.pop() 执行 self.history_list 无需重新赋值</font></div><div><br></div><div>            while time.time() - history[-1] &gt; self.allow_time:</div><div><font color="#41AD1C"> # 确保列表时间是允许的范围内（即: 列表的时间差不能超过60秒）</font></div><div><font color="#41AD1C">                # 循环计算最新的时间和最初的时间是否在60秒，如果不是删除则删除最初的时间</font></div><div>                history.pop()</div><div><br></div><div><font color="#41AD1C"># 判断列表的长度有没有超过允许访问次数</font></div><div>            if len(history) &gt; self.visits:</div><div>                return False</div><div><br></div><div>        return True</div><div><br></div><div>    def wait(self):</div><div><font color="#41AD1C"># 钩子函数（即: 回调函数）</font></div><div><font color="#41AD1C">        # 当超过设置的访问频率时调用（即: 当allow_request返回False时调用）</font></div><div><font color="#41AD1C">        # 返回值等待时间</font></div><div>        return self.allow_time - (time.time() - self.history_list[-1])</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from .models import *</div><div>from .serializer import *</div><div>from .rf_auth import *</div><div>from .rf_permission import *</div><div>from .rf_throttle import *</div><div><br></div><div>from rest_framework import viewsets</div><div>from rest_framework import <font color="#FA7A00">exceptions</font></div><div><br></div><div><br></div><div><font color="#FA7A00"># 修改频率组件的错误信息</font></div><div>class MyExceptions(exceptions.Throttled):</div><div>    default_detail = '连接次数过多'</div><div>    extra_detail_plural = extra_detail_singular = '请在{wait}秒后访问'</div><div><br></div><div>    def __init__(self, wait=None, detail=None, code=None):</div><div>        super().__init__(wait=wait, detail=detail, code=code)</div><div><br></div><div><br></div><div>class BookViewSet(viewsets.ModelViewSet):</div><div>    authentication_classes = [TokenAuth]  <font color="#41AD1C"># 局部认证，只作用于当前视图</font></div><div>    permission_classes = [SVIPPermission]  <font color="#41AD1C"># 局部权限，只作用于当前视图</font></div><div><font color="#FA7A00">throttle_classes</font> = [MyThrottle]  <font color="#41AD1C"># 局部频率，只作用于当前视图</font></div><div><br></div><div>    queryset = Book.objects.all()</div><div>    serializer_class = BookSerializers</div><div><br></div><div><font color="#FA7A00"># 修改频率组件的错误信息</font></div><div>    def throttled(self, request, wait):</div><div>        raise MyExceptions(wait=wait)</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"> 全局频率 -&gt; 自己编写频率类</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">全局频率作用于所有视图类</span></div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># rf_throttle.py</font></div><div><br></div><div>import time</div><div><br></div><div>VISIT_RECORD = {</div><div><span style="color:rgb(65, 173, 28);"># '127.0.0.1:8080':[最新的时间，……，最初的时间]</span></div><div>}</div><div><br></div><div><br></div><div>class MyThrottle(object):</div><div><span style="color:rgb(65, 173, 28);"> &quot;&quot;&quot;</span></div><div><span style="color:rgb(65, 173, 28);">    一分钟允许访问5次</span></div><div><span style="color:rgb(65, 173, 28);">    原理:</span></div><div><span style="color:rgb(65, 173, 28);">        拿到用户IP地址</span></div><div><span style="color:rgb(65, 173, 28);">        编写访问记录 {'ip地址':[最新的时间，……，最初的时间]}</span></div><div><span style="color:rgb(65, 173, 28);">        确保用户所对应的记录列表的最新时间和最初时间的时间差 &lt;= 规定时间</span></div><div><span style="color:rgb(65, 173, 28);">        判断用户所对应的记录列表的长度 &lt; 允许访问次数</span></div><div><span style="color:rgb(65, 173, 28);">    &quot;&quot;&quot;</span></div><div><br></div><div>    allow_time = 60  <span style="color:rgb(65, 173, 28);"># 时间</span></div><div>    visits = 5  <span style="color:rgb(65, 173, 28);"># 允许访问次数</span></div><div><br></div><div>    def __init__(self):</div><div>        self.history_list = []</div><div><br></div><div>    def allow_request(self, request, view):</div><div><span style="color:rgb(65, 173, 28);">&quot;&quot;&quot;</span></div><div><span style="color:rgb(65, 173, 28);">        :param request: APIView 的 request</span></div><div><span style="color:rgb(65, 173, 28);">        :param view: 视图类的实例化对象 -&gt; APIView 类中的 self</span></div><div><span style="color:rgb(65, 173, 28);">        :return: True/False</span></div><div><span style="color:rgb(65, 173, 28);">        &quot;&quot;&quot;</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 获取用户的IP地址</span></div><div>        ip = request.META.get('REMOTE_ADDR', '')</div><div>        if ip not in VISIT_RECORD:</div><div>            VISIT_RECORD[ip] = [time.time()]</div><div>        else:</div><div>            history = VISIT_RECORD[ip]</div><div><br></div><div>            if len(history) &lt;= self.visits:</div><div>                history.insert(0, time.time())  <span style="color:rgb(65, 173, 28);"># 将最新的时间添加到列表的第一位</span></div><div><br></div><div>            self.history_list = history  <span style="color:rgb(65, 173, 28);"># 因为 history 是列表，所以 self.history_list = history 是引用关系，没有进行深度拷贝，所以下面 history.pop() 执行 self.history_list 无需重新赋值</span></div><div><br></div><div>            while time.time() - history[-1] &gt; self.allow_time:</div><div><span style="color:rgb(65, 173, 28);"> # 确保列表时间是允许的范围内（即: 列表的时间差不能超过60秒）</span></div><div><span style="color:rgb(65, 173, 28);">                # 循环计算最新的时间和最初的时间是否在60秒，如果不是删除则删除最初的时间</span></div><div>                history.pop()</div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 判断列表的长度有没有超过允许访问次数</span></div><div>            if len(history) &gt; self.visits:</div><div>                return False</div><div><br></div><div>        return True</div><div><br></div><div>    def wait(self):</div><div><span style="color:rgb(65, 173, 28);"># 钩子函数（即: 回调函数）</span></div><div><span style="color:rgb(65, 173, 28);">        # 当超过设置的访问频率时调用（即: 当allow_request返回False时调用）</span></div><div><span style="color:rgb(65, 173, 28);">        # 返回值等待时间</span></div><div>        return self.allow_time - (time.time() - self.history_list[-1])</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># settings.py</font></div><div><br></div><div>REST_FRAMEWORK = {</div><div><font color="#41AD1C"> # &quot;DEFAULT_AUTHENTICATION_CLASSES&quot;: [&quot;app01.rf_auth.TokenAuth&quot;],  # 全局认证</font></div><div><font color="#41AD1C">    # &quot;DEFAULT_PERMISSION_CLASSES&quot;: [&quot;app01.rf_permission.SVIPPermission&quot;]  # 全局权限</font></div><div>    &quot;DEFAULT_THROTTLE_CLASSES&quot;: [&quot;app01.rf_throttle.MyThrottle&quot;]  <font color="#41AD1C"># 全局频率</font></div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">不进行频率认证的视图类设置</span></div></li></ul><div><br></div><ul><ul><li><div><span style="font-size:12pt;">如果设置了全局频率，但是又想某些视图不进行频率认证，那么可以在不想进行频率认证的视图类中设置</span> throttle_classes <span style="font-size:12pt;">= []，因为在 rest-framework 源码中 局部频率的配置 会覆盖掉 全局频率的配置</span></div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># views.py</span></div><div><br></div><div>import hashlib</div><div>import time</div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div>from .rf_auth import *</div><div><br></div><div>from rest_framework import viewsets</div><div><br></div><div><br></div><div>class BookViewSet(viewsets.ModelViewSet):</div><div>    queryset = Book.objects.all()</div><div>    serializer_class = BookSerializers</div><div><br></div><div><br></div><div>class PublishViewSet(viewsets.ModelViewSet):</div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div><div><br></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 获取以用户名作为盐，以当前时间作为加密内容的字符串token</span></div><div>def get_token_str(username):</div><div>    now_time = str(time.time())</div><div>    md5 = hashlib.md5(bytes(username, encoding=&quot;utf8&quot;))  <span style="color:rgb(65, 173, 28);"># 加盐，使用用户名作为盐，保证token的唯一性</span></div><div>    md5.update(bytes(now_time, encoding='utf-8'))</div><div>    return md5.hexdigest()</div><div><br></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 登陆，并且返回当前用户的token</span></div><div>class LoginView(APIView):</div><div><font color="#FA7A00">throttle_classes = []</font> <font color="#41AD1C"># 在全局频率下，当前视图不进行频率认证</font></div><div><br></div><div>    def post(self, request):</div><div>        username = request.data.get('username')</div><div>        password = request.data.get('password')</div><div>        user = User.objects.filter(username=username, password=password).first()</div><div>        ret = {</div><div>            'status': 0,</div><div>            'msg': None</div><div>        }</div><div>        if user:</div><div>            token_str = get_token_str(user.username)  <span style="color:rgb(65, 173, 28);"># 获取Token值</span></div><div><span style="color:rgb(65, 173, 28);"># 每次登陆成功后都要修改当前用户的token值</span></div><div>            Token.objects.update_or_create(user=user, defaults={'token': token_str})  <span style="color:rgb(65, 173, 28);"># 如果有 user=user 这条数据，那么就修改 token 值，否则就进行添加</span></div><div>            ret['status'] = 1</div><div>            ret['token'] = token_str</div><div>        else:</div><div>            ret['msg'] = '登陆失败'</div><div><br></div><div>        return Response(ret)</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">4.</span><span style="font-size:14pt;font-weight:bold;"> 局部频率 -&gt;  使用 </span><span style="font-size:14pt;"><span style="font-size:14pt;font-weight:bold;">rest-framework 所提供的频率类</span></span></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size:9pt;color:rgb(65, 173, 28);"># rf_throttle.py</font></div><div><font color="#41AD1C" style="font-size:9pt;"><br></font></div><div>from rest_framework.throttling import <font color="#FA7A00">SimpleRateThrottle</font></div><div><br></div><div><br></div><div>class MyThrottle(<font color="#FA7A00">SimpleRateThrottle</font>):</div><div>    rate = '5/m'  <font color="#41AD1C"># 每分钟允许访问5次</font></div><div><br></div><div><font color="#41AD1C"># 获取用户IP地址</font></div><div>    def get_cache_key(self, request, view):</div><div>        return self.get_ident(request)</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from .rf_throttle import *</div><div>from rest_framework import viewsets</div><div><br></div><div><br></div><div>class BookViewSet(viewsets.ModelViewSet):</div><div><font color="#FA7A00">throttle_classes</font> = [MyThrottle]</div><div>    queryset = Book.objects.all()</div><div>    serializer_class = BookSerializers</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">5.</span><span style="font-size:14pt;font-weight:bold;"> 全局频率 -&gt; </span><span style="font-size:14pt;font-weight:bold;">使用 </span><span style="font-size:14pt;font-weight:bold;">rest-framework 所提供的频率类</span></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># rf_throttle.py</font></div><div><br></div><div>from rest_framework.throttling import SimpleRateThrottle</div><div><br></div><div><br></div><div>class MyThrottle(SimpleRateThrottle):</div><div>    scope = '<font color="#FA7A00">visit_rate</font>'  <font color="#41AD1C"># 设置全局频率的属性名</font></div><div><br></div><div><font color="#41AD1C"># 获取用户IP地址</font></div><div>    def get_cache_key(self, request, view):</div><div>        return self.get_ident(request)</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># settings.py</font></div><div><br></div><div>REST_FRAMEWORK = {</div><div><font color="#41AD1C"># &quot;DEFAULT_AUTHENTICATION_CLASSES&quot;: [&quot;app01.rf_auth.TokenAuth&quot;],  # 全局认证</font></div><div><font color="#41AD1C">    # &quot;DEFAULT_PERMISSION_CLASSES&quot;: [&quot;app01.rf_permission.SVIPPermission&quot;]  # 全局权限</font></div><div>    &quot;DEFAULT_THROTTLE_CLASSES&quot;: [&quot;app01.rf_throttle.MyThrottle&quot;],  <font color="#41AD1C"># 全局频率</font></div><div>    &quot;DEFAULT_THROTTLE_RATES&quot;: {</div><div>        '<font color="#FA7A00">visit_rate</font>': '5/m'  <font color="#41AD1C"># 每分钟允许访问5次</font></div><div>    }</div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">分页</span></h2><div><br></div><div><span style="font-size:14pt;">只要继承了 APIView 就可以使用分页组件</span></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;"><span style="font-size:14pt;font-weight:bold;">PageNumberPagination 的分页类使用</span></span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>方式一</div></li></ul><div><br></div><ul><ul><li><div>视图四部曲中在混合使用方式中使用分页</div></li></ul></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C" style="font-size:9pt;"># views.py</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">from django.shortcuts import render, HttpResponse</font></div><div><font style="font-size:9pt;">from rest_framework.views import APIView</font></div><div><font style="font-size:9pt;">from rest_framework.response import Response</font></div><div><font style="font-size:9pt;">from .models import *</font></div><div><font style="font-size:9pt;">from .serializer import *</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">from rest_framework.pagination import PageNumberPagination</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">class MyPageNumberPagination(PageNumberPagination):</font></div><div><font style="font-size:9pt;">    page_size = 1  <font color="#41AD1C"># 每页显示多少条数据</font></font></div><div><font style="font-size:9pt;">    page_query_param = 'page'  <font color="#41AD1C"># url的参数名，即: ?page=1</font></font></div><div><font style="font-size:9pt;">    page_size_query_param = 'size'  <font color="#41AD1C"># url的参数名，即: ?page=1&amp;size=2，如果在url加上该参数就代表临时显示2条数据</font></font></div><div><font style="font-size:9pt;">    max_page_size = 5  <font color="#41AD1C"># 设置最大的临时显示数，一般和 page_size_query_param 搭配使用，即: size 所设置的数值不能超过 max_page_size 所设置的数值</font></font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">class PublishView(APIView):</font></div><div><font style="font-size:9pt;"><font color="#41AD1C"># 查看所有出版社</font></font></div><div><font style="font-size:9pt;">    def get(self, request):</font></div><div><font style="font-size:9pt;">        publish_list = Publish.objects.all()</font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;"><font color="#41AD1C"># 分页</font></font></div><div><font style="font-size:9pt;">        pnp = MyPageNumberPagination()  <font color="#41AD1C"># 实例化分页对象</font></font></div><div><font style="font-size:9pt;">        publish_list_page = pnp.paginate_queryset(publish_list, request, self)  <font color="#41AD1C"># 使用分页对象下的 paginate_queryset 方法处理 queryset 对象（即: 查询到的数据列表）</font></font></div><div><font style="font-size:9pt;"><br></font></div><div><font style="font-size:9pt;">        ps = PublishSerializers(publish_list_page, many=True)  <font color="#41AD1C"># 序列化被 paginate_queryset 方法处理后的 queryset 对象（即: 查询到的数据列表）</font></font></div><div><font style="font-size:9pt;">        return Response(ps.data)</font></div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># 接口说明: 查看出版社（带分页）</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/publish/?page=1</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 分页说明: 每页显示1条数据</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>[</div><div>    {</div><div>        &quot;id&quot;: 1,</div><div>        &quot;name&quot;: &quot;东莞出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;</div><div>    }</div><div>]</div><div><br></div><div><font color="#FA7A00"># --------------------------------------------------------------</font></div><div><font color="#FA7A00"><br></font></div><div><font color="#41AD1C"># 接口说明: 查看出版社（带分页）</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/publish/?page=1&amp;size=3</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 请求类型: GET</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 分页说明: 每页显示1条数据，临时显示3条数据</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 结果:</font></div><div><br></div><div>[</div><div>    {</div><div>        &quot;id&quot;: 1,</div><div>        &quot;name&quot;: &quot;东莞出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;</div><div>    },</div><div>    {</div><div>        &quot;id&quot;: 2,</div><div>        &quot;name&quot;: &quot;广州出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;</div><div>    },</div><div>    {</div><div>        &quot;id&quot;: 4,</div><div>        &quot;name&quot;: &quot;深圳出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;</div><div>    }</div><div>]</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">方式二</span></div></li></ul><div><br></div><ul><ul><li><div>视图四部曲中除了混合使用方式外的其他方式使用分页</div></li></ul></ul><div><br></div><ul><ul><li><div>pagination_class = 分页类</div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from .models import *</div><div>from .serializer import *</div><div>from rest_framework import viewsets</div><div><br></div><div>from rest_framework.pagination import PageNumberPagination</div><div><br></div><div><br></div><div>class MyPageNumberPagination(PageNumberPagination):</div><div>    page_size = 1  <font color="#41AD1C"># 每页显示多少条数据</font></div><div>    page_query_param = 'page'  <font color="#41AD1C"># url的参数名，即: ?page=1</font></div><div>    page_size_query_param = 'size'  <font color="#41AD1C"># url的参数名，即: ?page=1&amp;size=2，如果在url加上该参数就代表临时显示2条数据</font></div><div>    max_page_size = 5  <font color="#41AD1C"># 设置最大的临时显示数，一般和 page_size_query_param 搭配使用，即: size 所设置的数值不能超过 max_page_size 所设置的数值</font></div><div><br></div><div><br></div><div>class PublishViewSet(viewsets.ModelViewSet):</div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div><div><br></div><div><font color="#FA7A00">pagination_class</font> = MyPageNumberPagination</div></div><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># 接口说明: 查看出版社（带分页）</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 接</span><font color="#41AD1C">口: http://127.0.0.1:8000/publish/?page=1</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: GET</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 分页说明: 每页显示1条数据</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>{</div><div>    &quot;count&quot;: 11,  <font color="#41AD1C"># 总页数</font></div><div>    &quot;next&quot;: &quot;http://127.0.0.1:8000/publish/?page=2&quot;,  <font style="color:rgb(65, 173, 28);"># 下一页的网址，没有则为 null</font></div><div>    &quot;previous&quot;: null,  <font color="#41AD1C"># 上一页的网址，没有则为 null</font></div><div>    &quot;results&quot;: [</div><div>        {</div><div>            &quot;id&quot;: 1,</div><div>            &quot;name&quot;: &quot;东莞出版社&quot;,</div><div>            &quot;email&quot;: &quot;123@qq.com&quot;</div><div>        }</div><div>    ]</div><div>}</div><div><br></div><div><span style="color:rgb(250, 122, 0);"># --------------------------------------------------------------</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 接口说明: 查看出版社（带分页）</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 接口:</span><font color="#41AD1C"> http://127.0.0.1:8000/publish/?page=1&amp;size=3</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: GET</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 分页说明: 每页显示1条数据，临时显示3条数据</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>{</div><div>    &quot;count&quot;: 11,  <font color="#41AD1C"># 总页数</font></div><div>    &quot;next&quot;: &quot;http://127.0.0.1:8000/publish/?page=2&amp;size=3&quot;,  <font color="#41AD1C"># 下一页的网址，没有则为 null</font></div><div>    &quot;previous&quot;: null,  <font color="#41AD1C"># 上一页的网址，没有则为 null</font></div><div>    &quot;results&quot;: [</div><div>        {</div><div>            &quot;id&quot;: 1,</div><div>            &quot;name&quot;: &quot;东莞出版社&quot;,</div><div>            &quot;email&quot;: &quot;123@qq.com&quot;</div><div>        },</div><div>        {</div><div>            &quot;id&quot;: 2,</div><div>            &quot;name&quot;: &quot;广州出版社&quot;,</div><div>            &quot;email&quot;: &quot;123@qq.com&quot;</div><div>        },</div><div>        {</div><div>            &quot;id&quot;: 4,</div><div>            &quot;name&quot;: &quot;深圳出版社&quot;,</div><div>            &quot;email&quot;: &quot;123@qq.com&quot;</div><div>        }</div><div>    ]</div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">配置全局的分页参数 -&gt; 不建议使用</span></div></li></ul><div><br></div><ul><ul><li><div>如果配置了全局的分页参数可以不用创建分页类，直接使用 PageNumberPagination 分页类</div></li></ul></ul><div><br></div><ul><ul><li><div>只有 PAGE_SIZE 这个参数可以进行设置</div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># settings.py</font></div><div><br></div><div>REST_FRAMEWORK = {</div><div><font color="#41AD1C"># &quot;DEFAULT_AUTHENTICATION_CLASSES&quot;: [&quot;app01.rf_auth.TokenAuth&quot;],  # 全局认证</font></div><div><font color="#41AD1C">    # &quot;DEFAULT_PERMISSION_CLASSES&quot;: [&quot;app01.rf_permission.SVIPPermission&quot;]  # 全局权限</font></div><div><font color="#41AD1C">    # 'DEFAULT_PARSER_CLASSES': ['rest_framework.parsers.JSONParser']  # 全局解析器</font></div><div>    'PAGE_SIZE': 1,  <font color="#41AD1C"># 分页 -&gt; 一页显示多少条数据</font></div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div><font color="#41AD1C"># 方式一</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div>from rest_framework.pagination import PageNumberPagination</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div><font color="#41AD1C"> # 查看所有出版社</font></div><div>    def get(self, request):</div><div>        publish_list = Publish.objects.all()</div><div><br></div><div><font color="#41AD1C"># 分页</font></div><div>        pnp = PageNumberPagination()  <font color="#41AD1C"># 实例化分页对象</font></div><div>        publish_list_page = pnp.paginate_queryset(publish_list, request, self)  <font color="#41AD1C"># 使用分页对象下的 paginate_queryset 方法处理 queryset 对象（即: 查询到的数据列表）</font></div><div><br></div><div>        ps = PublishSerializers(publish_list_page, many=True)  <font color="#41AD1C"># 序列化被 paginate_queryset 方法处理后的 queryset 对象（即: 查询到的数据列表）</font></div><div>        return Response(ps.data)</div><div><font color="#FA7A00"><br></font></div><div><font color="#FA7A00"># -----------------------------------------</font></div><div><br></div><div><font color="#41AD1C"># 方式二</font></div><div><br></div><div>from .models import *</div><div>from .serializer import *</div><div>from rest_framework import viewsets</div><div><br></div><div>from rest_framework.pagination import PageNumberPagination</div><div><br></div><div><br></div><div>class PublishViewSet(viewsets.ModelViewSet):</div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div><div><br></div><div><font color="#000000">pagination_class</font> = PageNumberPagination</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"></span><span style="font-size:14pt;font-weight:bold;">LimitOffsetPagination</span><span style="font-size:14pt;font-weight:bold;"> 的偏移分页类使用</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">LimitOffsetPagination的使用方式和PageNumberPagination的使用方式是一样，只是</span><span style="font-size:12pt;">LimitOffsetPagination分页</span><span style="font-size:12pt;">类的参数和功能不一样而已</span></div></li></ul><div><br></div><ul><li><div>方式一</div></li></ul><div><br></div><ul><ul><li><div>视图四部曲中在混合使用方式中使用分页</div></li></ul></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div>from rest_framework.pagination import LimitOffsetPagination</div><div><br></div><div><br></div><div>class MyLimitOffsetPagination(LimitOffsetPagination):</div><div>    default_limit = 2  <font color="#41AD1C"># 显示多少条数据</font></div><div>    limit_query_param = 'limit'  <font color="#41AD1C"># url的参数名，即: ?limit=2</font></div><div>    offset_query_param = 'offset'  <font color="#41AD1C"># url的参数名，即: ?limit=2&amp;offset=1，如果在url加上该参数就代表从1开始偏移几位</font></div><div>    max_limit = 5  <font color="#41AD1C"># 限制最多显示多少条数据</font></div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div><font color="#41AD1C"># 查看所有出版社</font></div><div>    def get(self, request):</div><div>        publish_list = Publish.objects.all()</div><div><br></div><div><font color="#41AD1C"># 分页</font></div><div>        lop = MyLimitOffsetPagination()  <font color="#41AD1C"># 实例化分页对象</font></div><div>        publish_list_page = lop.paginate_queryset(publish_list, request, self)  <font color="#41AD1C"># 使用分页对象下的 paginate_queryset 方法处理 queryset 对象（即: 查询到的数据列表）</font></div><div><br></div><div>        ps = PublishSerializers(publish_list_page, many=True)  <font color="#41AD1C"># 序列化被 paginate_queryset 方法处理后的 queryset 对象（即: 查询到的数据列表）</font></div><div>        return Response(ps.data)</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># 接口说明: 查看出版社（带分页）</span></div><div><br></div><div><font color="#41AD1C"># 接口: http://127.0.0.1:8000/publish/?offset=2</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: GET</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 分页说明: 显示2条数据，从1开始偏移2条数据</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>[</div><div>    {</div><div>        &quot;id&quot;: 3,</div><div>        &quot;name&quot;: &quot;深圳出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;</div><div>    },</div><div>    {</div><div>        &quot;id&quot;: 4,</div><div>        &quot;name&quot;: &quot;深圳出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;</div><div>    }</div><div>]</div><div><br></div><div><span style="color:rgb(250, 122, 0);"># --------------------------------------------------------------</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 接口说明: 查看出版社（带分页）</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 接</span><font color="#41AD1C">口: http://127.0.0.1:8000/publish/?limit=3&amp;offset=2</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: GET</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 分页说明: 显示3条数据，从1开始偏移2条数据</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>[</div><div>    {</div><div>        &quot;id&quot;: 3,</div><div>        &quot;name&quot;: &quot;深圳出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;</div><div>    },</div><div>    {</div><div>        &quot;id&quot;: 4,</div><div>        &quot;name&quot;: &quot;深圳出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;</div><div>    },</div><div>    {</div><div>        &quot;id&quot;: 5,</div><div>        &quot;name&quot;: &quot;深圳出版社&quot;,</div><div>        &quot;email&quot;: &quot;123@qq.com&quot;</div><div>    }</div><div>]</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">方式二</span></div></li></ul><div><br></div><ul><ul><li><div>视图四部曲中除了混合使用方式外的其他方式使用分页</div></li></ul></ul><div><br></div><ul><ul><li><div>pagination_class = 分页类</div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size:9pt;font-family:Monaco;"><font color="#41AD1C"># views.py</font></span></div><div><span style="font-size:9pt;font-family:Monaco;"><font color="#41AD1C"><br></font></span></div><div>from .models import *</div><div>from .serializer import *</div><div>from rest_framework import viewsets</div><div><br></div><div>from rest_framework.pagination import LimitOffsetPagination</div><div><br></div><div><br></div><div>class MyLimitOffsetPagination(LimitOffsetPagination):</div><div>    default_limit = 2 <font color="#41AD1C"> # 显示多少条数据</font></div><div>    limit_query_param = 'limit'  <font color="#41AD1C"># url的参数名，即: ?limit=2</font></div><div>    offset_query_param = 'offset'  <font color="#41AD1C"># url的参数名，即: ?limit=2&amp;offset=1，如果在url加上该参数就代表从1开始偏移几位</font></div><div>    max_limit = 5  <font color="#41AD1C"># 限制最多显示多少条数据</font></div><div><br></div><div><br></div><div>class PublishViewSet(viewsets.ModelViewSet):</div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div><div><br></div><div><font color="#FA7A00">pagination_class</font> = MyLimitOffsetPagination</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># 接口说明: 查看出版社（带分页）</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 接</span><font color="#41AD1C">口: http://127.0.0.1:8000/publish/?offset=1</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: GET</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 分页说明: 默认显示2条数据，从1开始偏移1条数据</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>{</div><div>    &quot;count&quot;: 11,  <font color="#41AD1C"># 总页数</font></div><div>    &quot;next&quot;: &quot;http://127.0.0.1:8000/publish/?limit=2&amp;offset=3&quot;,  <font style="color:rgb(65, 173, 28);"># 下一页的网址，没有则显示null</font></div><div>    &quot;previous&quot;: &quot;http://127.0.0.1:8000/publish/?limit=2&quot;,  <font style="color:rgb(65, 173, 28);"># 上一页的网址，没有则显示null</font></div><div>    &quot;results&quot;: [</div><div>        {</div><div>            &quot;id&quot;: 2,</div><div>            &quot;name&quot;: &quot;广州出版社&quot;,</div><div>            &quot;email&quot;: &quot;123@qq.com&quot;</div><div>        },</div><div>        {</div><div>            &quot;id&quot;: 4,</div><div>            &quot;name&quot;: &quot;深圳出版社&quot;,</div><div>            &quot;email&quot;: &quot;123@qq.com&quot;</div><div>        }</div><div>    ]</div><div>}</div><div><br></div><div><span style="color:rgb(250, 122, 0);"># --------------------------------------------------------------</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 接口说明: 查看出版社（带分页）</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 接</span><font color="#41AD1C">口: http://127.0.0.1:8000/publish/?limit=3&amp;offset=2</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 请求类型: GET</span></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 分页说明: </span><font color="#41AD1C">显示3条数据，从1开始偏移2条数据</font></div><div><br></div><div><span style="color:rgb(65, 173, 28);"># 结果:</span></div><div><br></div><div>{</div><div>    &quot;count&quot;: 11,  <font color="#41AD1C"># 总页数</font></div><div>    &quot;next&quot;: &quot;http://127.0.0.1:8000/publish/?limit=3&amp;offset=5&quot;,  <font color="#41AD1C"># 下一页的网址，没有则显示null</font></div><div>    &quot;previous&quot;: &quot;http://127.0.0.1:8000/publish/?limit=3&quot;,  <font color="#41AD1C"># 上一页的网址，没有则显示null</font></div><div>    &quot;results&quot;: [</div><div>        {</div><div>            &quot;id&quot;: 4,</div><div>            &quot;name&quot;: &quot;深圳出版社&quot;,</div><div>            &quot;email&quot;: &quot;123@qq.com&quot;</div><div>        },</div><div>        {</div><div>            &quot;id&quot;: 5,</div><div>            &quot;name&quot;: &quot;深圳出版社&quot;,</div><div>            &quot;email&quot;: &quot;123@qq.com&quot;</div><div>        },</div><div>        {</div><div>            &quot;id&quot;: 6,</div><div>            &quot;name&quot;: &quot;深圳出版社&quot;,</div><div>            &quot;email&quot;: &quot;123@qq.com&quot;</div><div>        }</div><div>    ]</div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">配置全局的分页参数 -&gt; 不建议使用</span></div></li></ul><div><br></div><ul><ul><li><div>如果配置了全局的分页参数可以不用创建分页类，直接使用 LimitOffsetPagination 分页类</div></li></ul></ul><div><br></div><ul><ul><li><div>只有 PAGE_SIZE 这个参数可以进行设置</div></li></ul></ul><div><br></div><ul><ul><li><div>这里的 PAGE_SIZE 参数指的是 default_limit 参数</div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># settings.py</span></div><div><br></div><div>REST_FRAMEWORK = {</div><div><span style="color:rgb(65, 173, 28);"># &quot;DEFAULT_AUTHENTICATION_CLASSES&quot;: [&quot;app01.rf_auth.TokenAuth&quot;],  # 全局认证</span></div><div><span style="color:rgb(65, 173, 28);">    # &quot;DEFAULT_PERMISSION_CLASSES&quot;: [&quot;app01.rf_permission.SVIPPermission&quot;]  # 全局权限</span></div><div><span style="color:rgb(65, 173, 28);">    # 'DEFAULT_PARSER_CLASSES': ['rest_framework.parsers.JSONParser']  # 全局解析器</span></div><div>    'PAGE_SIZE': 2,  <span style="color:rgb(65, 173, 28);"># 分页 -&gt; 显示多少条数据</span></div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 方式一</font></div><div><font color="#41AD1C"><br></font></div><div>from django.shortcuts import render, HttpResponse</div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div>from .models import *</div><div>from .serializer import *</div><div><br></div><div>from rest_framework.pagination import LimitOffsetPagination</div><div><br></div><div><br></div><div>class PublishView(APIView):</div><div><font color="#41AD1C"> # 查看所有出版社</font></div><div>    def get(self, request):</div><div>        publish_list = Publish.objects.all()</div><div><br></div><div><font color="#41AD1C"># 分页</font></div><div>        lop = LimitOffsetPagination()  <font color="#41AD1C"># 实例化分页对象</font></div><div>        publish_list_page = lop.paginate_queryset(publish_list, request, self)  <font color="#41AD1C"># 使用分页对象下的 paginate_queryset 方法处理 queryset 对象（即: 查询到的数据列表）</font></div><div><br></div><div>        ps = PublishSerializers(publish_list_page, many=True)  <font color="#41AD1C"># 序列化被 paginate_queryset 方法处理后的 queryset 对象（即: 查询到的数据列表）</font></div><div>        return Response(ps.data)</div><div><font color="#41AD1C"><br></font></div><div><font color="#FA7A00"># -------------------------------------------</font></div><div><font color="#41AD1C"><br></font></div><div><font color="#41AD1C"># 方式二</font></div><div><font color="#41AD1C"><br></font></div><div>from .models import *</div><div>from .serializer import *</div><div>from rest_framework import viewsets</div><div><br></div><div>from rest_framework.pagination import LimitOffsetPagination</div><div><br></div><div><br></div><div>class PublishViewSet(viewsets.ModelViewSet):</div><div>    queryset = Publish.objects.all()</div><div>    serializer_class = PublishSerializers</div><div><br></div><div>    pagination_class = LimitOffsetPagination</div></div><div><span style="font-size:14pt;"><br></span></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">版本</span></h2><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;">只要继承了 APIView 就可以使用版本</span></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"> 版本的作用</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">根据版本的不同返回相应的数据结构</span></div></li></ul><div><br></div><ul><li><div><span style="font-size:12pt;">限制只能使用哪几个版本的接口</span></div></li></ul><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"> 局部版本</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">局部版本的配置（即:</span> versioning_class <span style="font-size:12pt;">= 版本类）会覆盖掉该视图类在全局版本中的配置</span></div></li></ul><div><font style="font-size:12pt;"><br></font></div><ul><li><div>versioning_class <span style="font-size:12pt;">= 版本类</span></div></li></ul><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">QueryParameterVersioning 版本类 -&gt; 从 url 参数中获取版本号</span></div></li></ul><div><br></div><ul><ul><li><div>url版本参数的默认参数名: version</div></li></ul></ul><div><br></div><ul><ul><li><div>访问的url: <a href="http://127.0.0.1:8000/api/book/?version=v1">http://127.0.0.1:8000/api/book/?version=v1</a></div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div><br></div><div>from rest_framework.versioning import <font color="#FA7A00">QueryParameterVersioning</font>, URLPathVersioning</div><div><br></div><div><br></div><div>class BookViewSet(APIView):</div><div><br></div><div><font color="#FA7A00">versioning_class</font> = QueryParameterVersioning  <font color="#41AD1C"># 局部版本</font></div><div><br></div><div>    def get(self, request, *args, **kwargs):</div><div><br></div><div>        print(request.version)  <font color="#41AD1C"># v1 -&gt; 获取当前版本号</font></div><div>        print(request.versioning_scheme)  <font color="#41AD1C"># QueryParameterVersioning 的实例化对象</font></div><div><br></div><div>        if request.version == 'v1':</div><div>            return Response('v1版本的数据')</div><div>        else:</div><div>            return Response('其他版本的数据')</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">URLPathVersioning </span><span style="font-size:12pt;">版本类</span> <span style="font-size:12pt;">-&gt; 使用url正则匹配获取版本号 -&gt; 推荐使用</span></div></li></ul><div><br></div><ul><ul><li><div>命名匹配的默认名称: version</div></li></ul></ul><div><br></div><ul><ul><li><div>访问的url:  <a href="http://127.0.0.1:8000/api/v1/book/">http://127.0.0.1:8000/api/v1/book/</a></div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><font color="#41AD1C"><br></font></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div><br></div><div>from rest_framework.versioning import QueryParameterVersioning, <font color="#FA7A00">URLPathVersioning</font></div><div><br></div><div><br></div><div>class BookViewSet(APIView):</div><div><br></div><div><font color="#FA7A00">versioning_class</font> = URLPathVersioning  <font color="#41AD1C"># 局部版本</font></div><div><br></div><div>    def get(self, request, *args, **kwargs):</div><div><br></div><div>        print(request.version)  <font color="#41AD1C"># v1 -&gt; 获取当前版本号</font></div><div>        print(request.versioning_scheme)  <font color="#41AD1C"># QueryParameterVersioning 的实例化对象</font></div><div><br></div><div>        if request.version == 'v1':</div><div>            return Response('v1版本的数据')</div><div>        else:</div><div>            return Response('其他版本的数据')</div></div><div><span style="font-size:14pt;"><br></span></div><ul><ul><li><div><span style="color:rgb(227, 0, 0);font-weight:bold;">注意:</span><span style="font-weight:bold;"> url必须使用命名匹配</span></div></li></ul></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># urls.py</font></div><div><font color="#41AD1C"><br></font></div><div>urlpatterns = [</div><div><font color="#41AD1C">#</font> url(r'api/<font color="#FA7A00">(?P&lt;version&gt;[v1|v2]+)</font>/book', BookViewSet.as_view()),</div><div><font color="#41AD1C"># 等同于</font></div><div>    url(r'api/<font style="color:rgb(250, 122, 0);">(?P&lt;version&gt;\w+)</font>/book', BookViewSet.as_view()),  <font color="#41AD1C"># 使用该正则的前提必须设置了允许的版本</font></div><div>]</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">request.version 和 request.</span>versioning_scheme 的说明</div></li></ul><div><br></div><ul><ul><li><div>如果使用了版本，那么 request 就会被绑定两个属性: <span style="font-size:12pt;">version 和 </span>versioning_scheme </div></li></ul></ul><div><br></div><ul><ul><ul><li><div><span style="font-size:12pt;">version: 当前版本，用于</span><span style="font-size:12pt;">根据版本的不同返回相应的数据结构</span></div></li><li><div>versioning_scheme: 当前使用的版本类的实例化对象</div></li></ul></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color:rgb(65, 173, 28);"># views.py</span></div><div><br></div><div>from rest_framework.views import APIView</div><div>from rest_framework.response import Response</div><div><br></div><div>from rest_framework.versioning import QueryParame<font color="#000000">terVersioning, URLPathVersioning</font></div><div><br></div><div><br></div><div>class BookViewSet(APIView):</div><div><br></div><div>    versioning_class = URLPathVersioning  </div><div><br></div><div>    def get(self, request, *args, **kwargs):</div><div><br></div><div>        print(<font color="#FA7A00">request.version</font>)  <span style="color:rgb(65, 173, 28);"># v1 -&gt; 获取当前版本号</span></div><div>        print(<font color="#FA7A00">request.versioning_scheme</font>)  <span style="color:rgb(65, 173, 28);"># QueryParameterVersioning 的实例化对象</span></div><div><br></div><div>        if request.version == 'v1':</div><div>            return Response('v1版本的数据')</div><div>        else:</div><div>            return Response('其他版本的数据')</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>version 参数名的修改</div></li></ul><div><br></div><ul><ul><li><div>version 参数名必须要在全局设置中修改（即: settings.py）</div></li></ul></ul><div><br></div><ul><ul><li><div><span style="font-size:12pt;">QueryParameterVersioning 的 </span>url版本参数名 “version” 和 <span style="font-size:12pt;">URLPathVersioning 命名匹配的 “</span>version<span style="font-size:12pt;">”，使用的都是同一个配置项中的参数名</span></div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># settings.py</font></div><div><br></div><div>REST_FRAMEWORK = {</div><div>    &quot;VERSION_PARAM&quot;: 'v',  <font color="#41AD1C"># 参数名</font></div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">默认版本号</span></div></li></ul><div><br></div><ul><ul><li><div>该设置必须在全局中进行设置（即: settings.py）</div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># settings.py</font></div><div><font color="#41AD1C"><br></font></div><div>REST_FRAMEWORK = {</div><div>    &quot;VERSION_PARAM&quot;: 'version', <font color="#41AD1C"> # 参数名</font></div><div><font color="#41AD1C"><br></font></div><div>    'DEFAULT_VERSION': 'v1',  <font color="#41AD1C"># 默认版本号</font></div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">允许的版本</span></div></li></ul><div><br></div><ul><ul><li><div>说明: 允许调用当前接口的哪些版本</div></li></ul></ul><div><br></div><ul><ul><li><div>该设置必须在全局中进行设置（即: settings.py）</div></li></ul></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># settings.py</font></div><div><br></div><div>REST_FRAMEWORK = {</div><div>    &quot;VERSION_PARAM&quot;: 'version',  <font color="#41AD1C"># 参数名</font></div><div>    'DEFAULT_VERSION': 'v1',  <font color="#41AD1C"># 默认版本号</font></div><div><font color="#41AD1C"><br></font></div><div>    'ALLOWED_VERSIONS': ['v1', 'v2'],  <font color="#41AD1C"># 允许的版本</font></div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"> 全局版本</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">全局版本作用于所有视图类</span></div></li></ul><div><br></div><ul><li><div>可以通过设置局部版本来覆盖全局版本的设置</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># settings.py</font></div><div><br></div><div>REST_FRAMEWORK = {</div><div><font color="#41AD1C">……</font></div><div>    &quot;DEFAULT_VERSIONING_CLASS&quot;: &quot;rest_framework.versioning.URLPathVersioning&quot;,  <font color="#41AD1C"># 使用什么版本类</font></div><div>    &quot;VERSION_PARAM&quot;: 'version', <font color="#41AD1C"> # 参数名</font></div><div>    'DEFAULT_VERSION': 'v1',  <font color="#41AD1C"># 默认版本号</font></div><div>    'ALLOWED_VERSIONS': ['v1', 'v2'],  <font color="#41AD1C"># 允许的版本</font></div><div>}</div></div><div><span style="font-size:14pt;"><br></span></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">解析器</span></h2><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"> 解析器的说明</span></div><div><br></div><ul><li><div>根据 Content-Type 类型对发送过来的数据进行解析</div></li></ul><div><br></div><ul><li><div>可以通过编写中间件的方式实现解析器的功能</div></li></ul><div><br></div><ul><li><div>rest_framework 提供了4个解析器:</div></li></ul><div><br></div><ul><ul><li><div>JSONParser -&gt;  Content-Type = application/json</div></li><li><div>FormParser -&gt;  Content-Type = application/x-www-form-urlencoded</div></li><li><div>MultiPartParser -&gt; Content-Type = multipart/form-data</div></li><li><div>FileUploadParser -&gt; Content-Type = */*</div></li></ul></ul><div><br></div><ul><li><div><span style="color:rgb(227, 0, 0);">在使用 rest_framework 的时候所有视图类默认支持 JSONParser、FormParser、MultiPartParser 解析器</span></div></li></ul><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"> 局部解析器</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>局部解析器的配置（即: parser_classes = [解析器, 解析器]）会覆盖掉该视图类在全局解析器中的配置</div></li></ul><div><br></div><ul><li><div>parser_classes = [解析器, 解析器]</div></li></ul><div><br></div><ul><li><div><span style="color:rgb(227, 0, 0);">注意: </span>在日常开发中尽量不要去配置局部解析器和全局解析器，因为 rest_framework 默认所设置的3个解析器已经够用了</div></li></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from rest_framework import viewsets</div><div>from rest_framework.parsers import JSONParser, FormParser  <font color="#41AD1C"># 导入解析器</font></div><div><br></div><div><br></div><div>class BookViewSet(viewsets.ModelViewSet):</div><div><font color="#FA7A00">parser_classes</font> = [JSONParser]  <font color="#41AD1C"># 该视图类只使用 JSONParser 解析器</font></div><div><br></div><div>    queryset = Book.objects.all()</div><div>    serializer_class = BookSerializers</div></div><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">3.</span><span style="font-size:14pt;font-weight:bold;"> 全局解析器</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">全局解析器的设置作用于所有视图类</span></div></li></ul><div><br></div><ul><li><div>可以通过设置局部解析器来覆盖全局解析器的设置</div></li></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># settings.py</font></div><div><br></div><div>REST_FRAMEWORK = {</div><div><font color="#41AD1C"># &quot;DEFAULT_AUTHENTICATION_CLASSES&quot;: [&quot;app01.rf_auth.TokenAuth&quot;],  # 全局认证</font></div><div><font color="#41AD1C">    # &quot;DEFAULT_PERMISSION_CLASSES&quot;: [&quot;app01.rf_permission.SVIPPermission&quot;]  # 全局权限</font></div><div>    'DEFAULT_PARSER_CLASSES': ['rest_framework.parsers.JSONParser']  <font color="#41AD1C"># 全局解析器</font></div><div>}</div></div><div><br></div></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">渲染器</span></h2><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">1.</span><span style="font-size:14pt;font-weight:bold;"> 渲染器的说明</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>渲染器就是设置所要返回的数据在浏览器的显示格式</div></li></ul><div><br></div><ul><li><div><span style="color:rgb(227, 0, 0);font-weight:bold;">注意:</span><span style="font-weight:bold;"> 不要使用 JSONRenderer 除外的渲染器，因为容易出 BUG （通俗理解: 只使用 JSONRenderer 渲染器）</span></div></li></ul><div><br></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">2.</span><span style="font-size:14pt;font-weight:bold;"> 局部渲染器</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">局部渲染器的配置（即:</span> renderer_classes <span style="font-size:12pt;">= [渲染器,</span> <span style="font-size:12pt;">渲染器</span><span style="font-size:12pt;">]）会覆盖掉该视图类在全局渲染器中的配置</span></div></li></ul><div><font style="font-size:12pt;"><br></font></div><ul><li><div>renderer_classes <span style="font-size:12pt;">= [渲染器,</span> <span style="font-size:12pt;">渲染器</span><span style="font-size:12pt;">]</span></div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># views.py</font></div><div><br></div><div>from .serializer import *</div><div>from .models import *</div><div>from rest_framework import viewsets</div><div><br></div><div>from rest_framework.renderers import <font style="color:rgb(250, 122, 0);">JSONRenderer</font>, <font color="#FA7A00">BrowsableAPIRenderer</font>, <font color="#FA7A00">AdminRenderer</font></div><div><br></div><div><br></div><div>class BookViewSet(viewsets.ModelViewSet):</div><div><font color="#41AD1C">&quot;&quot;&quot;</font></div><div><font color="#41AD1C">        常用的渲染器:</font></div><div><font color="#41AD1C">            JSONRenderer: 显示JSON格式（即: 没有任何样式）</font></div><div><font color="#41AD1C">            BrowsableAPIRenderer: 使用 rest-framework 所提供的 html 模板显示 JSON 格式，默认显示格式</font></div><div><font color="#41AD1C">            AdminRenderer: 显示表格的形式</font></div><div><font color="#41AD1C">    &quot;&quot;&quot;</font></div><div><br></div><div><font color="#41AD1C">#</font> <font color="#FA7A00">renderer_classes</font> = [<font color="#FA7A00">JSONRenderer</font>, <font color="#FA7A00">BrowsableAPIRenderer</font>, <font style="color:rgb(250, 122, 0);">AdminRenderer</font>]  <font color="#41AD1C"># 局部渲染器，同时使用 JSONRenderer、BrowsableAPIRenderer、AdminRenderer 渲染器</font></div><div><font color="#FA7A00">renderer_classes</font> = [<font color="#FA7A00">JSONRenderer</font>]  <font color="#41AD1C"># 该视图类只使用 JSONRenderer 渲染器</font></div><div><br></div><div>    queryset = Book.objects.all()</div><div>    serializer_class = BookSerializers</div></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>JSONRenderer 在浏览器的显示效果</div></li></ul><div><br></div><ul><ul><li><div>访问的url: <a href="http://127.0.0.1:8000/book/?format=json">http://127.0.0.1:8000/book/?format=json</a></div></li></ul></ul><div><br></div><div><img data-filename="Image.png" src="/kevin-blog/Django/rest-framework 框架_files/Image [1].png" type="image/png"></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>BrowsableAPIRenderer 在浏览器的显示效果，默认显示格式</div></li></ul><div><br></div><ul><ul><li><div>访问的url: <a href="http://127.0.0.1:8000/book/?format=api">http://127.0.0.1:8000/book/?format=api</a></div></li></ul></ul><div><br></div><div><img data-filename="Image.png" src="/kevin-blog/Django/rest-framework 框架_files/Image [2].png" type="image/png"></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div>AdminRenderer 在浏览器的显示效果</div></li></ul><div><br></div><ul><ul><li><div>访问的url:  <a href="http://127.0.0.1:8000/book/?format=admin">http://127.0.0.1:8000/book/?format=admin</a></div></li></ul></ul><div><br></div><div><img data-filename="Image.png" src="/kevin-blog/Django/rest-framework 框架_files/Image [3].png" type="image/png"></div><div><span style="font-size:14pt;"><br></span></div><div><span style="font-size:14pt;white-space:pre-wrap;font-weight:bold;">3.</span><span style="font-size:14pt;font-weight:bold;"> 全局渲染器</span></div><div><span style="font-size:14pt;"><br></span></div><ul><li><div><span style="font-size:12pt;">全局渲染器的设置作用于所有视图类</span></div></li></ul><div><br></div><ul><li><div>可以通过设置局部渲染器来覆盖全局渲染器的设置</div></li></ul><div><span style="font-size:14pt;"><br></span></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># settings.py</font></div><div><br></div><div>REST_FRAMEWORK = {</div><div><font color="#41AD1C"># &quot;DEFAULT_AUTHENTICATION_CLASSES&quot;: [&quot;app01.rf_auth.TokenAuth&quot;],  # 全局认证</font></div><div><font color="#41AD1C">    # &quot;DEFAULT_PERMISSION_CLASSES&quot;: [&quot;app01.rf_permission.SVIPPermission&quot;]  # 全局权限</font></div><div><font color="#41AD1C">    # &quot;DEFAULT_THROTTLE_CLASSES&quot;: [&quot;app01.rf_throttle.MyThrottle&quot;],  # 全局频率</font></div><div><br></div><div><font color="#41AD1C">#</font> &quot;DEFAULT_RENDERER_CLASSES&quot;: ['rest_framework.renderers.JSONRenderer', 'rest_framework.renderers.BrowsableAPIRenderer', 'rest_framework.renderers.AdminRenderer']  <font color="#41AD1C"># 全局渲染器</font></div><div>    &quot;DEFAULT_RENDERER_CLASSES&quot;: ['rest_framework.renderers.JSONRenderer']  <font color="#41AD1C"># 全局渲染器</font></div><div>}</div></div><div><br></div><h2 style="margin:10px 0px 12px;padding:0px 0px 0px 15px;font-size:21px;background-color:#3eaf7c;border-radius:3px;text-align:center;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;"><span style="font-size:21px;background-color:#3eaf7c;border-radius:3px;text-shadow:rgb(34, 34, 34) 1px 1px 2px;letter-spacing:normal;orphans:2;text-indent:0px;text-transform:none;white-space:normal;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;color:white;font-family:&quot;Helvetica Neue&quot;, Helvetica, Verdana, Arial, sans-serif;font-variant-caps:normal;font-variant-ligatures:normal;font-weight:bold;line-height:1.5;">注册url的新方法</span></h2><div><br></div><ul><li><div><span style="font-size:12pt;">rest-framework 提供了新的url注册方法</span></div></li></ul><div><br></div><ul><li><div><span style="color:rgb(227, 0, 0);">使用前提: 视图类必须继承 ModelViewSet（即: 必须使用视图四部曲中的终极版）</span></div></li></ul><div><br></div><ul><li><div><span style="font-size:12pt;">rest-framework 的url注册方法会在原本的两条url基础上在添加多两条url</span></div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#41AD1C"># urls.py</font></div><div><font color="#41AD1C"><br></font></div><div>from django.conf.urls import url, include</div><div>from django.contrib import admin</div><div>from app01.views import *</div><div><br></div><div>from rest_framework import <font color="#FA7A00">routers</font></div><div><br></div><div><font color="#41AD1C"># 实例化默认路由对象</font></div><div>router = routers.DefaultRouter()</div><div><font color="#41AD1C"># 注册路由:</font></div><div><font color="#41AD1C"></font><font color="#FA7A00"># 默认路由对象.register('url前缀', 视图类)</font></div><div><font color="#41AD1C">    # url前缀是一个字符串，而不是一个url正则路径</font></div><div>router.register(r'book', BookViewSet)</div><div>router.register(r'publish', PublishViewSet)</div><div><br></div><div>urlpatterns = [</div><div><font color="#FA7A00">url(r'', include(router.urls))</font>,  <font color="#41AD1C"># 注册路由</font></div><div>    url(r'login', LoginView.as_view()),</div><div>]</div></div><div><br></div><ul><li><div>所生成的url正则路径</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>^book/$ [name='book-list']  <font color="#41AD1C"># 平时我们使用的操作或查看所有数据的url</font></div><div>^book\.(?P&lt;format&gt;[a-z0-9]+)/?$ [name='book-list']  <font color="#41AD1C"># rest-framework 新增的</font></div><div>^book/(?P&lt;pk&gt;[^/.]+)/$ [name='book-detail']  <font color="#41AD1C"># 平时我们使用的操作或查看指定数据的url</font></div><div>^book/(?P&lt;pk&gt;[^/.]+)\.(?P&lt;format&gt;[a-z0-9]+)/?$ [name='book-detail']  <font color="#41AD1C"># rest-framework 新增的</font></div><div><br></div><div>^publish/$ [name='publish-list']  <font color="#41AD1C"># 平时我们使用的操作或查看所有数据的url</font></div><div>^publish\.(?P&lt;format&gt;[a-z0-9]+)/?$ [name='publish-list']  <font color="#41AD1C"># rest-framework 新增的</font></div><div>^publish/(?P&lt;pk&gt;[^/.]+)/$ [name='publish-detail']  <font color="#41AD1C"># 平时我们使用的操作或查看指定数据的url</font></div><div>^publish/(?P&lt;pk&gt;[^/.]+)\.(?P&lt;format&gt;[a-z0-9]+)/?$ [name='publish-detail']  <font color="#41AD1C"># rest-framework 新增的</font></div></div><div><br></div><ul><li><div>所生成url路径</div></li></ul><div><br></div><div style="box-sizing:border-box;padding:8px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;color:rgb(51, 51, 51);border-radius:4px;background-color:rgb(251, 250, 248);border:1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>http://127.0.0.1:8000/book/</div><div>http://127.0.0.1:8000/book.json</div><div>http://127.0.0.1:8000/book/2/</div><div>http://127.0.0.1:8000/book/2.json</div><div><br></div><div>http://127.0.0.1:8000/publish/</div><div>http://127.0.0.1:8000/publish.json</div><div>http://127.0.0.1:8000/publish/1/</div><div>http://127.0.0.1:8000/publish/1.json</div><div><br></div><div><font color="#41AD1C"><span style="font-size:9pt;font-family:Monaco;"># 在url正则路径中没有，但是 </span>rest-framework 默认添加上的url路径</font></div><div><br></div><div>http://127.0.0.1:8000/book/?format=api</div><div>http://127.0.0.1:8000/book/?format=json</div><div><br></div><div>http://127.0.0.1:8000/book/2/?format=api</div><div>http://127.0.0.1:8000/book/2/?format=json</div></div><div><br></div></div><div><br></div><div><br></div><div><br></div></span></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/kevin-blog/Django/rest-framework token认证.html" class="prev">
        rest-framework token认证
      </a></span> <span class="next"><a href="/kevin-blog/Django/中间件.html">
        中间件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/kevin-blog/assets/js/app.dd46475d.js" defer></script><script src="/kevin-blog/assets/js/2.97d04891.js" defer></script><script src="/kevin-blog/assets/js/67.80828b1b.js" defer></script>
  </body>
</html>
