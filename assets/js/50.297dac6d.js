(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{404:function(t,o,i){"use strict";i.r(o);var e=i(25),r=Object(e.a)({},(function(){var t=this,o=t.$createElement,i=t._self._c||o;return i("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[i("div",[i("span",[i("div",[i("div",[i("div",[i("div",[i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("自定义使用 Redis")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# utils/redis_pool.py")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用模块的单例模式创建连接池")])],1),i("div",[i("br")]),i("div",[t._v("import redis")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(" POOL = redis.ConnectionPool(host='127.0.0.1', port=6379, max_connections=1000, decode_responses=True)  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置连接池")])],1),i("div",[t._v("POOL = redis.ConnectionPool(max_connections=1000, decode_responses=True)  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置连接池")])],1)]),i("div",[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),i("div",[i("br")]),i("div",[t._v("import redis")]),i("div",[t._v("from django.shortcuts import render, HttpResponse")]),i("div",[t._v("from utils.redis_pool import POOL")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def index(request):")]),i("div",[t._v("    conn = redis.Redis(connection_pool=POOL)  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 去连接池中获取连接")])],1),i("div",[t._v("    conn.set('index', 'index的缓存数据')  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置缓存")])],1),i("div",[t._v("    return HttpResponse('设置缓存成功_index')")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def order(request):")]),i("div",[t._v("    conn = redis.Redis(connection_pool=POOL)  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 去连接池中获取连接")])],1),i("div",[t._v("    conn.set('order', 'order的缓存数据')  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置缓存")])],1),i("div",[t._v("    return HttpResponse('设置缓存成功_order')")])]),i("div",[i("br")]),i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("使用第三方组件")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("django-redis的安装")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("pip3 install django-redis -i https://pypi.douban.com/simple "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用豆瓣的镜像")])],1)]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("在Django中配置redis")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("可以配置其他或多个缓存 -> 如: Memcache、Redis、等 -> ")]),i("span",{staticStyle:{"font-size":"12pt"}},[t._v("前提是要下载好对应的django处理该缓存的模块")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[t._v("CACHES = {")]),i("div",[t._v("    'default': {")]),i("div",[t._v("        'BACKEND': 'django_redis.cache.RedisCache',")]),i("div",[t._v("        'LOCATION': 'redis://127.0.0.1:6379', "),i("font",{attrs:{color:"#41AD1C"}},[t._v(" # ip+端口号的设置，本地ip: 127.0.0.1，默认redis端口号: 6379")])],1),i("div",[t._v("        'OPTIONS': {")]),i("div",[t._v("            'CLIENT_CLASS': 'django_redis.client.DefaultClient',")]),i("div",[t._v("            'CONNECTION_POOL_KWARGS': {")]),i("div",[t._v("                'max_connections': 1000,  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 最大连接数")])],1),i("div",[t._v("                'decode_responses': True,  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 是否自动进行解码, ")]),i("font",{attrs:{color:"#FF0000"}},[t._v("注意: 在使用全站/单视图/局部缓存的时候不能设置该配置否则会报utf-8的错误")])],1),i("div",[t._v("            }")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(" 'PASSWORD': '密码',  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 密码: 如果没有可以不进行配置")])],1),i("div",[t._v("        }")]),i("div",[t._v("    },")]),i("div",[i("font",{attrs:{color:"#41AD1C"}}),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 为了演示所创建的缓存配置，ip+端口都是乱写的")])],1),i("div",[t._v("    'r2_cache': {")]),i("div",[t._v("        'BACKEND': 'django_redis.cache.RedisCache',")]),i("div",[t._v("        'LOCATION': 'redis://47.0.0.1:6379',")]),i("div",[t._v("        'OPTIONS': {")]),i("div",[t._v("            'CLIENT_CLASS': 'django_redis.client.DefaultClient',")]),i("div",[t._v("            'CONNECTION_POOL_KWARGS': {")]),i("div",[t._v("                'max_connections': 100,")]),i("div",[t._v("                'decode_responses': True,")]),i("div",[t._v("            }")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(" "),i("font",{attrs:{color:"#000000"}},[t._v("'PASSWORD': '密码',")])],1),i("div",[t._v("        }")]),i("div",[t._v("    },")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v(" # ……")])],1),i("div",[t._v("}")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("在Django中使用redis")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),i("div",[i("br")]),i("div",[t._v("from django.shortcuts import render, HttpResponse")]),i("div",[t._v("from django_redis import get_redis_connection  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取连接池中的连接方法")])],1),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def index(request):")]),i("div",[t._v("    conn = get_redis_connection('default')  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用 django_redis 模块所提供的 get_redis_connection 方法，获取 default 缓存连接池的连接")])],1),i("div",[t._v("    conn.set('index', 'index的缓存数据')  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置缓存")])],1),i("div",[t._v("    return HttpResponse('设置缓存成功_index')")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def order(request):")]),i("div",[t._v("    conn = get_redis_connection('r2_cache')  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用 django_redis 模块所提供的 get_redis_connection 方法，获取 r2_cache 缓存连接池的连接")])],1),i("div",[t._v("    conn.set('order', 'order的缓存数据')  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置缓存")])],1),i("div",[t._v("    return HttpResponse('设置缓存成功_order')")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# test.py")])],1),i("div",[i("br")]),i("div",[t._v("from django_redis import get_redis_connection  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取连接池中的连接方法")])],1),i("div",[i("br")]),i("div",[t._v("conn = get_redis_connection('default')  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用 django_redis 模块所提供的 get_redis_connection 方法，获取 default 缓存连接池的连接")])],1),i("div",[t._v("index_data = conn.get('index')  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取缓存")])],1),i("div",[t._v("print(index_data)  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# index的缓存数据")])],1)]),i("div",[i("br")]),i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("高级使用")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("全站缓存 -> 谨慎使用")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("注意: 全站缓存在浏览器上是无法清除的，因为缓存是写在服务器上")])])])]),i("div",[i("font",{staticStyle:{"font-size":"12pt"}},[i("br")])],1),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("全站缓存的原理: 使用中间件，经过一系列的认证等操作，如果内容在缓存中存在，则使用FetchFromCacheMiddleware获取内容并返回给用户，当返回给用户之前，判断缓存中是否已经存在，如果不存在则UpdateCacheMiddleware会将缓存保存至缓存，从而实现全站缓存")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("中间件示意图")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("img",{attrs:{"data-filename":"未命名文件 (1).png",src:"/kevin-blog/Django/Django使用Redis_files/未命名文件 (1).png",type:"image/png"}})]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("中间件的配置")])])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[t._v("FetchFromCacheMiddleware 中间件的说明:")])]),i("ul",[i("li",[i("div",[t._v("FetchFromCacheMiddleware 中间件的作用: 检测缓存中是否有当前页面的缓存，如果有直接进行返回，如果没有就会从数据库中获取对应的数据，然后返回")])]),i("li",[i("div",[t._v("FetchFromCacheMiddleware 中间件中只有 process_request 方法")])]),i("li",[i("div",[t._v("FetchFromCacheMiddleware 中间件必须放在所有中间件的后面，因为必须要经过认证等中间件后才能获取到页面")])])])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[t._v("UpdateCacheMiddleware 中间件的说明:")])]),i("ul",[i("li",[i("div",[t._v("UpdateCacheMiddleware 中间件的作用: 将从数据库中获取到的数据添加到缓存中")])]),i("li",[i("div",[t._v("UpdateCacheMiddleware 中间件中只有 process_response 方法")])]),i("li",[i("div",[t._v("UpdateCacheMiddleware 中间件必须放在所有中间件的第一位，因为在返回给浏览器之前必须执行session等中间件设置 session、cookie、状态码等，最后才执行 UpdateCacheMiddleware 中间件设置缓存，让后返回给浏览器")])])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[t._v("MIDDLEWARE = [")]),i("div",[t._v("    'django.middleware.cache.UpdateCacheMiddleware',")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 其他中间件……")])],1),i("div",[t._v("    'django.middleware.cache.FetchFromCacheMiddleware',")]),i("div",[t._v("]")]),i("div",[i("br")]),i("div",[t._v("CACHE_MIDDLEWARE_ALIAS = 'default'  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 缓存别名（即: 使用哪一个你所配置的缓存），默认值default")])],1),i("div",[t._v("CACHE_MIDDLEWARE_SECONDS = 10  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 缓存时间，单位秒")])],1),i("div",[t._v('CACHE_MIDDLEWARE_KEY_PREFIX = ""  '),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 如果缓存被多个使用相同 Django 安装的站点共享，配置此参数为站点名称或其它能代表站点的唯一字符串，以防止key冲突。如果不在意，可为空")])],1)]),i("div",[i("br")])]),i("ul",[i("li",[i("div",[t._v("缓存的配置 -> 使用redis缓存，可以不进行配置使用Django默认的")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[t._v("CACHES = {")]),i("div",[t._v("    'default': {")]),i("div",[t._v("        'BACKEND': 'django_redis.cache.RedisCache',")]),i("div",[t._v("        'LOCATION': 'redis://127.0.0.1:6379',  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# ip+端口号的设置，本地ip: 127.0.0.1，默认redis端口号: 6379")])],1),i("div",[t._v("        'OPTIONS': {")]),i("div",[t._v("            'CLIENT_CLASS': 'django_redis.client.DefaultClient',")]),i("div",[t._v("            'CONNECTION_POOL_KWARGS': {")]),i("div",[t._v("                'max_connections': 1000,  # 最大连接数")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 'decode_responses': True,  # 是否自动进行解码, ")]),i("font",{attrs:{color:"#FF0000"}},[t._v("注意: 在使用全站/单视图/局部缓存的时候不能设置该配置否则会报utf-8的错误")])],1),i("div",[t._v("            }")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(" 'PASSWORD': '密码', "),i("font",{attrs:{color:"#41AD1C"}},[t._v(" # 密码: 如果没有可以不进行配置")])],1),i("div",[t._v("        }")]),i("div",[t._v("    }")]),i("div",[t._v("}")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[t._v("测试是否缓存了")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[t._v("如果时间没有改变，则代表缓存成功")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),i("div",[i("br")]),i("div",[t._v("import time")]),i("div",[t._v("from django.shortcuts import render, HttpResponse")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def index(request):")]),i("div",[t._v("    ctime = str(time.time())")]),i("div",[t._v("    return HttpResponse('index_%s' % ctime)")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def order(request):")]),i("div",[t._v("    ctime = str(time.time())")]),i("div",[t._v("    return HttpResponse('order_%s' % ctime)")])]),i("div",[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("单视图缓存")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("注意: 单视图缓存在浏览器上是无法清除的，因为缓存是写在服务器上")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("单视图缓存的优先级比全局缓存要高，如果设置了但是视图缓存，那么全局缓存对该视图则无效")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[t._v("缓存的配置 -> 使用redis缓存，可以不进行配置使用Django默认的")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# settings.py")])]),i("div",[i("br")]),i("div",[t._v("CACHES = {")]),i("div",[t._v("    'default': {")]),i("div",[t._v("        'BACKEND': 'django_redis.cache.RedisCache',")]),i("div",[t._v("        'LOCATION': 'redis://127.0.0.1:6379',  "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# ip+端口号的设置，本地ip: 127.0.0.1，默认redis端口号: 6379")])]),i("div",[t._v("        'OPTIONS': {")]),i("div",[t._v("            'CLIENT_CLASS': 'django_redis.client.DefaultClient',")]),i("div",[t._v("            'CONNECTION_POOL_KWARGS': {")]),i("div",[t._v("                'max_connections': 1000,  # 最大连接数")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 'decode_responses': True,  # 是否自动进行解码, ")]),i("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[t._v("注意: 在使用全站/单视图/局部缓存的时候不能设置该配置否则会报utf-8的错误")])]),i("div",[t._v("            }")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("#")]),t._v(" 'PASSWORD': '密码', "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v(" # 密码: 如果没有可以不进行配置")])]),i("div",[t._v("        }")]),i("div",[t._v("    }")]),i("div",[t._v("}")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("使用Django所提供的装饰器实现单视图缓存")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[i("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1)]),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[t._v("import time")]),i("div",[t._v("from django.shortcuts import render, HttpResponse")]),i("div",[t._v("from django.views.decorators.cache import cache_page  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 局部缓存的装饰器")])],1),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#FA7A00"}},[t._v("@cache_page(10)")]),t._v(" "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用装饰器设置局部缓存，参数: 超时时间，单位秒")])],1),i("div",[t._v("def index(request):")]),i("div",[t._v("    ctime = str(time.time())")]),i("div",[t._v("    return HttpResponse('index_%s' % ctime)")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def order(request):")]),i("div",[t._v("    ctime = str(time.time())")]),i("div",[t._v("    return HttpResponse('order_%s' % ctime)")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("局部")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("视图缓存")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("注意: 局部缓存在浏览器上是无法清除的，因为缓存是写在服务器上")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("局部视图缓存，即缓存页面的某一部分内容")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[t._v("缓存的配置 -> 使用redis缓存，可以不进行配置使用Django默认的")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# settings.py")])]),i("div",[i("br")]),i("div",[t._v("CACHES = {")]),i("div",[t._v("    'default': {")]),i("div",[t._v("        'BACKEND': 'django_redis.cache.RedisCache',")]),i("div",[t._v("        'LOCATION': 'redis://127.0.0.1:6379',  "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# ip+端口号的设置，本地ip: 127.0.0.1，默认redis端口号: 6379")])]),i("div",[t._v("        'OPTIONS': {")]),i("div",[t._v("            'CLIENT_CLASS': 'django_redis.client.DefaultClient',")]),i("div",[t._v("            'CONNECTION_POOL_KWARGS': {")]),i("div",[t._v("                'max_connections': 1000,  # 最大连接数")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 'decode_responses': True,  # 是否自动进行解码, ")]),i("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[t._v("注意: 在使用全站/单视图/局部缓存的时候不能设置该配置否则会报utf-8的错误")])]),i("div",[t._v("            }")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("#")]),t._v(" 'PASSWORD': '密码', "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v(" # 密码: 如果没有可以不进行配置")])]),i("div",[t._v("        }")]),i("div",[t._v("    }")]),i("div",[t._v("}")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("局部视图缓存的使用")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[t._v("import time")]),i("div",[t._v("from django.shortcuts import render, HttpResponse")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def index(request):")]),i("div",[t._v("    ctime = str(time.time())")]),i("div",[t._v("    return render(request, 'index.html', {'ctime': ctime})")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 用法")])],1),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("1. 引入TemplateTag")])],1),i("div",[i("br")]),i("div",[t._v("{% load cache %}")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("2. 使用缓存")])],1),i("div",[i("br")]),i("div",[t._v("{% cache 缓存时间（单位秒） '缓存key' %}")]),i("div",[t._v("    缓存内容")]),i("div",[t._v("{% endcache %}")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# index.html")])],1),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#FA7A00"}},[t._v("{% load cache %}")])],1),i("div",[t._v("<!DOCTYPE html>")]),i("div",[t._v('<html lang="en">')]),i("div",[t._v("<head>")]),i("div",[t._v('    <meta charset="UTF-8">')]),i("div",[t._v("    <title>Title</title>")]),i("div",[t._v("</head>")]),i("div",[t._v("<body>")]),i("div",[i("font",{attrs:{color:"#FA7A00"}},[t._v("{% cache 10 'time' %}")])],1),i("div",[t._v("        <h1>"+t._s("{{ ctime }}")+"</h1>")]),i("div",[i("font",{attrs:{color:"#FA7A00"}},[t._v("{% endcache %}")])],1),i("div",[t._v("    <p>"+t._s("{{ ctime }}")+"</p>")]),i("div",[t._v("</body>")]),i("div",[t._v("</html>")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])])]),i("div",[i("br")])])])])}),[],!1,null,null,null);o.default=r.exports}}]);