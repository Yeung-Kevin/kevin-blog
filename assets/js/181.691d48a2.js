(window.webpackJsonp=window.webpackJsonp||[]).push([[181],{537:function(o,t,i){"use strict";i.r(t);var r=i(25),e=Object(r.a)({},(function(){var o=this,t=o.$createElement,i=o._self._c||t;return i("ContentSlotsDistributor",{attrs:{"slot-key":o.$parent.slotKey}},[i("div",[i("span",[i("div",[i("div",[i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[o._v("存储过程是一个SQL语句集合，当主动去调用存储过程时，其中内部的SQL语句会按照逻辑执行")])]),i("div",[i("font",{staticStyle:{"font-size":"14pt"}},[i("br")])],1),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[o._v("存储过程和函数有点类似，在函数体里不能写SQL语句，而存储过程可以，且存储过程没有返回值这一概念（下面提到的返回值只是为了方便说明）")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[o._v("存储过程和触发器一样需要修改SQL语句终止符")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("1.")]),o._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("不带参数的存储过程")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 基本语法")])],1),i("div",[i("br")]),i("div",[o._v("delimiter //")]),i("div",[o._v("create procedure 存储过程名称 ()")]),i("div",[o._v("begin")]),i("div",[o._v("    SQL语句;")]),i("div",[o._v("    SQL语句;")]),i("div",[o._v("end //")]),i("div",[o._v("delimiter ;")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建存储过程")])],1),i("div",[i("br")]),i("div",[o._v("delimiter //")]),i("div",[o._v("create procedure p1 ()")]),i("div",[o._v("begin")]),i("div",[o._v("    select * from t1;")]),i("div",[o._v("    insert into t1(name, age, sex) values('Amy', 18, '女');")]),i("div",[o._v("end //")]),i("div",[o._v("delimiter ;")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 调用存储过程")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# call 存储过程名称()")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[i("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[i("font",{attrs:{color:"#000000"}},[o._v("call p1()")])],1)])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/MySQL/存储过程_files/Image.png",type:"image/png"}})]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("2.")]),o._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("带参数的存储过程")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"12pt",color:"rgb(51, 51, 51)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[o._v("对于存储过程，可以接收参数，其参数有三类:")])])])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(51, 51, 51)"}},[o._v("in -> 仅用于接收传入的参数且不进行返回操作时使用")])])])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(51, 51, 51)"}},[o._v("out -> 仅用于返回值使用，就算外部传入了值 out 也接收不到，且 out ")]),i("span",{staticStyle:{color:"rgb(51, 51, 51)"}},[o._v("只会接收一个变量名")]),i("span",{staticStyle:{color:"rgb(51, 51, 51)"}},[o._v("也必须要接受一个")]),i("span",{staticStyle:{color:"rgb(51, 51, 51)"}},[o._v("变量名")]),o._v("，而这个变量名就是存储过程外部的变量名，只要将存储过程中的值赋值给这个变量名，存储过程外部就可以通过这个变量名获取到存储变量内部的值 -> 一般用于标识存储过程的执行结果")])])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(51, 51, 51)"}},[o._v("inputout -> 即可以接受传入的参数也可以进行返回值操作")])])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 基本语法")])],1),i("div",[i("br")]),i("div",[o._v("delimiter //")]),i("div",[o._v("create procedure 存储过程名称 (")]),i("div",[o._v("    in 参数名称 SQL的数据类型,")]),i("div",[o._v("    out 参数名称 SQL的数据类型,")]),i("div",[o._v("    inputout 参数名称 SQL的数据类型,")]),i("div",[o._v(")")]),i("div",[o._v("begin")]),i("div",[o._v("    SQL语句;")]),i("div",[o._v("    SQL语句;")]),i("div",[o._v("end //")]),i("div",[o._v("delimiter ;")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("in -> "),i("span",{staticStyle:{color:"rgb(51, 51, 51)"}},[o._v("仅用于接收传入的参数且不进行返回操作时使用")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# in 的用法")])],1),i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 创建存储过程")])],1),i("div",[i("br")]),i("div",[o._v("delimiter //")]),i("div",[o._v("create procedure p1 (")]),i("div",[o._v("    in d1 int "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 定义所接收到参数的SQL数据类型")])],1),i("div",[o._v(")")]),i("div",[o._v("begin")]),i("div",[o._v("    select * from t1 where id < d1;")]),i("div",[o._v("end //")]),i("div",[o._v("delimiter ;")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 调用存储过程")])],1),i("div",[i("br")]),i("div",[o._v("call p1(5)")])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/MySQL/存储过程_files/Image [1].png",type:"image/png"}})]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("out -> "),i("span",{staticStyle:{color:"rgb(51, 51, 51)"}},[o._v("仅用于返回值使用，")]),o._v("无法接收传入的参数，"),i("span",{staticStyle:{color:"rgb(51, 51, 51)"}},[o._v("只会接收一个变量名")]),i("span",{staticStyle:{color:"rgb(51, 51, 51)"}},[o._v("也必须要接受一个")]),i("span",{staticStyle:{color:"rgb(51, 51, 51)"}},[o._v("变量名")]),o._v("，而这个变量名就是存储过程外部的变量名，只要将存储过程中的值赋值给这个变量名，存储过程外部就可以通过这个变量名获取到存储变量内部的值")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# out 的用法")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建存储过程")])],1),i("div",[i("br")]),i("div",[o._v("delimiter //")]),i("div",[o._v("create procedure p1 (")]),i("div",[o._v("    out d1 int "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 定义返回值的SQL数据类型")])],1),i("div",[o._v(")")]),i("div",[o._v("begin")]),i("div",[o._v("    select d1; "),i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("-- 就算外部有值传入out也无法接受到，只会接收一个全局变量")])],1),i("div",[o._v("    set d1 = 123; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 对接收到的全局进行赋值")])],1),i("div",[o._v("end //")]),i("div",[o._v("delimiter ;")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 调用存储过程")])],1),i("div",[i("br")]),i("div",[o._v("set @v1 = 456; "),i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("-- 定义session级别的变量 -> 全局变量")])],1),i("div",[i("br")]),i("div",[o._v("call p1(@v1); "),i("font",{attrs:{color:"#E30000"}},[o._v("-- out 必须接收一个")]),i("font",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("session级别的变量")])],1),i("div",[i("br")]),i("div",[o._v("select @v1; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 查询存储过程的返回值")])],1)]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/MySQL/存储过程_files/Image [2].png",type:"image/png"}})]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/MySQL/存储过程_files/Image [3].png",type:"image/png"}})]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("inout ->  "),i("span",{staticStyle:{"font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(51, 51, 51)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal"}},[o._v("即可以接受传入的参数也可以进行返回值操作")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# inout 的使用")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建存储过程")])],1),i("div",[i("br")]),i("div",[o._v("delimiter //")]),i("div",[o._v("create procedure p1 (")]),i("div",[o._v("    inout d1 int "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 定义所接收到参数的SQL数据类型和返回值的SQL数据类型")])],1),i("div",[o._v(")")]),i("div",[o._v("begin")]),i("div",[o._v("    select d1; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 查询外部传入的值，inout是可以接受到外部传入的值和全局变量")])],1),i("div",[o._v("    set d1 = 123; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 对接收到的全局变量进行赋值")])],1),i("div",[o._v("end //")]),i("div",[o._v("delimiter ;")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 调用存储过程")])],1),i("div",[i("br")]),i("div",[o._v("set @v1 = 456; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- ")]),i("font",{attrs:{color:"#41AD1C"}},[o._v("定义session级别的变量 -> 全局变量")])],1),i("div",[i("br")]),i("div",[o._v("call p1(@v1); "),i("font",{attrs:{color:"#E30000"}},[o._v("-- inout 必须接收一个")]),i("font",{attrs:{color:"#E30000"}},[o._v("session级别的变量")])],1),i("div",[i("br")]),i("div",[o._v("select @v1; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 查询存储过程的返回值")])],1)]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/MySQL/存储过程_files/Image [4].png",type:"image/png"}})]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/MySQL/存储过程_files/Image [5].png",type:"image/png"}})]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("3.")]),o._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("事务")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 通过存储过程实现事务")])],1)]),i("div",[i("br")]),i("div",[o._v("delimiter \\\\")]),i("div",[o._v("create procedure p1(")]),i("div",[o._v("    out p_return_code tinyint")]),i("div",[o._v(")")]),i("div",[o._v("begin")]),i("div",[i("br")]),i("div",[o._v("    declare exit handler for sqlexception -- "),i("font",{attrs:{color:"#41AD1C"}},[o._v("如果出现异常就会执行下方代码块的异常代码")])],1),i("div",[o._v("    begin")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 执行异常代码")])],1),i("div",[o._v("        set p_return_code = 1;")]),i("div",[o._v("        rollback; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 回滚，回到初始状态")])],1),i("div",[o._v("    end;")]),i("div",[i("br")]),i("div",[o._v("    start transaction; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 开始事务")])],1),i("div",[o._v("        delete from t1; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 执行SQL语句")])],1),i("div",[o._v("    commit; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 进行提交")])],1),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v(" -- 成功，没有出现异常")])],1),i("div",[o._v("    set p_return_code = 2;")]),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[o._v("end\\\\")]),i("div",[o._v("delimiter ;")])]),i("div",[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 调用事务 -> 返回 2 则没有出现异常，返回 1 则出现异常，通过返回值进行判断处理其他事情")])],1),i("div",[i("br")]),i("div",[o._v("set @v1 = null;")]),i("div",[i("br")]),i("div",[o._v("call p1(@v1);")]),i("div",[i("br")]),i("div",[o._v("select @v1;")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("4.")]),o._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("游标")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[o._v("相当于 for 循环")])])]),i("li",[i("div",[o._v("性能不高")])]),i("li",[i("div",[o._v("游标循环是不会自己结束的，需要进行判断手动结束循环")])]),i("li",[i("div",[o._v("使用场景: 对表中每一条数据进行单独的操作的时候才会使用到游标（一般是DBA才会使用的，因为DBA不会写Python代码使用循环，只能通过游标实现循环）")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 以Python的形式写SQL语句 -> 方便理解下方代码")])],1),i("div",[i("br")]),i("div",[o._v("for row_id, row_num in my_cursor:")]),i("div",[o._v("    insert into B(num) values(row_id + row_num)")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 通过存储过程实现数据的循环")])],1)]),i("div",[i("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 循环表A的数据然后对表A的 id 和 num 进行相加然后翻进表B中")])],1)]),i("div",[i("br")]),i("div",[o._v("delimiter //")]),i("div",[o._v("create procedure p1()")]),i("div",[o._v("begin")]),i("div",[i("br")]),i("div",[o._v("    declare row_id int; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 定义变量1")])],1),i("div",[o._v("    declare row_num varchar(50); "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 定义变量2")])],1),i("div",[o._v("    declare done int default false; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 定义 done 变量，默认值为 false，用于判断循环是否可以结束了")])],1),i("div",[o._v("    declare temp int;")]),i("div",[i("br")]),i("div",[o._v("    declare my_cursor cursor for select id, num from A; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 声明一个名为 my_cursor 的游标，cursor for 是关键字，从A表中获取数据放到游标中然后进行循环")])],1),i("div",[o._v("    declare continue handler for not found set done = true; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 检测游标里是否还有数据，如果没有变量 done 变成 true")])],1),i("div",[i("br")]),i("div",[o._v("    open my_cursor; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 打开游标")])],1),i("div",[o._v("        xxoo: loop "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 开始循环")])],1),i("div",[i("br")]),i("div",[o._v("            fetch my_cursor into row_id, row_num; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 从游标中获取一行数据然后赋值给 row_id, row_num")])],1),i("div",[i("br")]),i("div",[o._v("            if done then "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 判断 done 是否为true，如果为 true 则代表游标中已经没有数据可以结束循环了")])],1),i("div",[o._v("                leave xxoo; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 跳出循环")])],1),i("div",[o._v("            end if;")]),i("div",[i("br")]),i("div",[o._v("            set temp = row_id + row_num;")]),i("div",[o._v("            insert into B(num) values(temp);")]),i("div",[i("br")]),i("div",[o._v("        end loop xxoo;")]),i("div",[o._v("    close my_cursor; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 关闭游标")])],1),i("div"),i("div",[o._v("end  //")]),i("div",[o._v("delimiter ;")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 调用存储过程")])],1),i("div",[i("br")]),i("div",[o._v("call p1();")])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/MySQL/存储过程_files/Image [6].png",type:"image/png"}})]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/MySQL/存储过程_files/Image [7].png",type:"image/png"}})]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/MySQL/存储过程_files/Image [8].png",type:"image/png"}})]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("5.")]),o._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("动态执行 Mysql 语句")])]),i("div",[i("font",{staticStyle:{"font-size":"12pt"}},[i("br")])],1),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[o._v("通过动态执行 MySQL 语句，在数据库级别上")]),i("span",{staticStyle:{"font-size":"12pt"}},[o._v("实现")]),i("span",{staticStyle:{"font-size":"12pt"}},[o._v("防止SQL注入")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("student表的所有数据")])])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/MySQL/存储过程_files/Image [9].png",type:"image/png"}})]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 定义存储过程，动态执行 Mysql 语句，在数据库级别上实现防止SQL注入")])],1),i("div",[i("br")]),i("div",[o._v("delimiter \\\\")]),i("div",[o._v("create procedure p1 (")]),i("div",[o._v("    in sid int")]),i("div",[o._v(")")]),i("div",[o._v("begin")]),i("div",[o._v("    set @xo = sid; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 声明session级别的变量")])],1),i("div",[o._v("    prepare xxx from 'select * from student where sid < ?'; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 定义SQL语句 -> ? 代表占位符")])],1),i("div",[o._v("    execute xxx using @xo; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 格式化SQL语句，将SQL语句的 ? 占位符替换成 @xo 变量，且这个变量必须是session级别的变量，如果不是就会报错")])],1),i("div",[o._v("    deallocate prepare xxx; "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-- 执行格式化完成后的SQL语句")])],1),i("div",[o._v("end\\\\")]),i("div",[o._v("delimiter ;")])]),i("div",[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 调用存储过程")])],1),i("div",[i("br")]),i("div",[o._v("call p1(5);")])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/MySQL/存储过程_files/Image [10].png",type:"image/png"}})]),i("div",[i("br")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);