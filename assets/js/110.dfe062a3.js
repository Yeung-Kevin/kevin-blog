(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{464:function(o,r,i){"use strict";i.r(r);var t=i(25),e=Object(t.a)({},(function(){var o=this,r=o.$createElement,i=o._self._c||r;return i("ContentSlotsDistributor",{attrs:{"slot-key":o.$parent.slotKey}},[i("div",[i("span",[i("div",[i("a",{attrs:{href:"/kevin-blog/Flask/flask 最终的目录结构_files/flask_directory_structure.rar"}},[i("img",{attrs:{alt:"flask_directory_structure.rar",src:"/kevin-blog/Flask/flask 最终的目录结构_files/46e8ffc6fcf1b9ba48131de73c1cb22e.png"}})]),i("br")]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Flask/flask 最终的目录结构_files/Image.png",type:"image/png"}})]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 所用到的模块")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# requirements.txt")])],1),i("div",[i("br")]),i("div",[o._v("alembic==1.3.1")]),i("div",[o._v("SQLAlchemy==1.3.8")]),i("div",[o._v("Flask==1.1.1")]),i("div",[o._v("Flask_Script==2.0.6  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 用于生成命令")])],1),i("div",[o._v("Flask_SQLAlchemy==2.4.0")]),i("div",[o._v("redis==3.3.4")]),i("div",[o._v("Flask_Session==0.3.1")]),i("div",[o._v("Flask_Migrate==2.5.2  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 对数据库表进行增删改")])],1)]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# manage.py")])],1),i("div",[i("br")]),i("div",[o._v("from flask_script import Manager")]),i("div",[o._v("from flask_migrate import Migrate, MigrateCommand")]),i("div",[o._v("from flask_directory_structure import create_app, db")]),i("div",[i("br")]),i("div",[o._v("app = create_app()")]),i("div",[o._v("manage = Manager(app)")]),i("div",[o._v("Migrate(app, db)")]),i("div",[o._v("manage.add_command('db', MigrateCommand)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 添加数据库迁移命令")])],1),i("div",[i("br")]),i("div",[o._v("if __name__ == '__main__':")]),i("div",[i("font",{attrs:{color:"#FA7A00"}},[o._v("manage.run()")]),o._v(" "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 必须使用 manage.run() 进行启动，否则 migrate 的数据库迁移的命令无法使用")])],1)]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 通过 Manage 和 Migrate 模块所生成的命令")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[i("font",{staticStyle:{color:"rgb(0, 0, 0)"}},[o._v("python manage.py runserver ")]),o._v(" "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 启动项目")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[o._v("python manage.py db init  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 初始化 migrations 文件夹用于记录表的修改情况，只执行一次")])],1),i("div",[i("br")]),i("div",[o._v("python manage.py db migrate  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 类似于 Django 中的 makemigrations")])],1),i("div",[i("br")]),i("div",[o._v("python manage.py db upgrade  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 类似于 Django 中的 migrate")])],1)]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# settings.py")])],1),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[o._v("from redis import Redis")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[o._v("class BaseConfig(object):")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# session 配置")])],1),i("div",[o._v("    SESSION_TYPE = 'redis'  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# session所保存的位置")])],1),i("div",[o._v("    SESSION_REDIS = Redis()  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 配置redis连接对象（即: 设置该连接那个redis），如果不设置默认使用本地ip+6379端口的redis进行连接")])],1),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# SQLAlchemy 配置")])],1),i("div",[o._v("    SQLALCHEMY_DATABASE_URI = 'mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8'  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接那个数据库")])],1),i("div",[o._v("    SQLALCHEMY_MAX_OVERFLOW = 10  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 允许溢出多少个连接（即：连接池的连接已满后，还可以创建多少条连接）")])],1),i("div",[o._v("    SQLALCHEMY_POOL_SIZE = 5  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中的连接数")])],1),i("div",[o._v("    SQLALCHEMY_POOL_TIMEOUT = 10  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中没有线程后最多等待的时间（单位：秒），如果超过指定时间还没有连接就报错")])],1),i("div",[o._v("    SQLALCHEMY_POOL_RECYCLE = -1  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 多久之后对线程池中的线程进行一次连接的回收（重置）（单位：秒）-> -1表示不重置")])],1),i("div",[o._v("    SQLALCHEMY_TRACK_MODIFICATIONS = False  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 关闭信号的追踪，如果不关闭会有一个无关紧要的异常")])],1),i("div",[i("br")]),i("div",[i("br")]),i("div",[o._v("class ProConfig(BaseConfig):")]),i("div",[o._v("    pass")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# flask_directory_structure/__init__.py")])],1),i("div",[i("br")]),i("div",[o._v("from flask import Flask")]),i("div",[o._v("from flask_session import Session")]),i("div",[o._v("from flask_sqlalchemy import SQLAlchemy  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 需要依赖app中的配置文件")])],1),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 实例化 SQLAlchemy ->")]),o._v(" "),i("font",{attrs:{color:"#E30000"}},[o._v("一定要设置为全局变量，且在视图文件和models文件上面")])],1),i("div",[o._v("db = SQLAlchemy() "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 创建一个 SQLAlchemy 所用到的所有东西的一个对象，唯独少了数据库连接")])],1),i("div",[i("br")]),i("div",[o._v("from .views.account import ac")]),i("div",[o._v("from .views.home import hm")]),i("div",[i("font",{attrs:{color:"#FA7A00"}},[o._v("from .models import *")]),o._v(" "),i("font",{attrs:{color:"#E30000"}},[o._v("# 如果不导入 flask_sqlalchemy 就不会创建表，因为 models.py 没有被执行")])],1),i("div",[i("br")]),i("div",[i("br")]),i("div",[o._v("def create_app():")]),i("div",[o._v("    app = Flask(__name__)")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 设置 app 的配置项")])],1),i("div",[o._v("    app.config.from_object('settings.ProConfig')")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 注册蓝图")])],1),i("div",[o._v("    app.register_blueprint(ac)")]),i("div",[o._v("    app.register_blueprint(hm)")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 实例化 Flask-Session")])],1),i("div",[o._v("    Session(app)")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 从app配置文件中获取相关的 SQLAlchemy 配置")])],1),i("div",[o._v("    db.init_app(app) "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 通过读取app的配置文件获取到数据库的连接")])],1),i("div",[i("br")]),i("div",[o._v("    return app")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# flask_directory_structure/models.py")])],1),i("div",[i("br")]),i("div",[o._v("from sqlalchemy import Column, Integer, VARCHAR")]),i("div",[i("font",{attrs:{color:"#FA7A00"}},[o._v("from flask_directory_structure import db")])],1),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("#  Users 表的类")])],1),i("div",[o._v("class Users("),i("font",{attrs:{color:"#FA7A00"}},[o._v("db.Model")]),o._v("):  "),i("font",{attrs:{color:"#E30000"}},[o._v("# 创建表的类一定要继承 db.Model")])],1),i("div",[o._v("    __tablename__ = 'users'  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 表名")])],1),i("div",[o._v("    id = Column(Integer, primary_key=True, autoincrement=True)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 整型 设置主键 设置自增列")])],1),i("div",[o._v("    name = Column(VARCHAR(32), nullable=False, index=True)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# varchar类型(长度：32) 不允许为空 将name字段设置为索引")])],1),i("div",[o._v("    age = Column(Integer)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 整形")])],1),i("div",[o._v("    address = Column(VARCHAR(32))  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# varchar类型(长度：32)")])],1)]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# flask_directory_structure/views/account.py")])],1),i("div",[i("br")]),i("div",[o._v("from flask import Blueprint, render_template")]),i("div",[o._v("from flask_directory_structure import db")]),i("div",[o._v("from flask_directory_structure import models")]),i("div",[i("br")]),i("div",[o._v("ac = Blueprint('ac', __name__)")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[o._v("@ac.route('/login')")]),i("div",[o._v("def login():")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# db.session 为每个线程去数据库连接池中获取一个连接，实际上是调用了 scoped_session")])],1),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 添加数据")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("#")]),o._v(" db.session.add(models.Users(name='Kevin', age=18, address='横沥'))")],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("#")]),o._v(" db.session.commit()")],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("#")]),o._v(" db.session.remove()")],1),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# 查询数据")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("#")]),o._v(" result = db.session.query(models.Users.name, models.Users.address).all()")],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("#")]),o._v(" print(result)")],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("#")]),o._v(" db.session.remove()")],1),i("div",[i("br")]),i("div",[o._v("    return render_template('login.html')")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# flask_directory_structure/templates/login.html")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[o._v("<!DOCTYPE html>")]),i("div",[o._v('<html lang="en">')]),i("div",[o._v("<head>")]),i("div",[o._v('    <meta charset="UTF-8">')]),i("div",[o._v("    <title>login</title>")]),i("div",[o._v('    <link rel="stylesheet" href="/static/reset.css">')]),i("div",[o._v("</head>")]),i("div",[o._v("<body>")]),i("div",[o._v("登陆")]),i("div",[o._v("</body>")]),i("div",[o._v("</html>")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# flask_directory_structure/views/home.py")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[o._v("from flask import Blueprint, render_template")]),i("div",[i("br")]),i("div",[o._v("hm = Blueprint('hm', __name__)")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[o._v("@hm.route('/home')")]),i("div",[o._v("def home():")]),i("div",[o._v("    return render_template('home.html')")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# flask_directory_structure/templates/home.html")])],1),i("div",[i("br")]),i("div",[o._v("<!DOCTYPE html>")]),i("div",[o._v('<html lang="en">')]),i("div",[o._v("<head>")]),i("div",[o._v('    <meta charset="UTF-8">')]),i("div",[o._v("    <title>home</title>")]),i("div",[o._v('    <link rel="stylesheet" href="/static/reset.css">')]),i("div",[o._v("</head>")]),i("div",[o._v("<body>")]),i("div",[o._v("首页")]),i("div",[o._v("</body>")]),i("div",[o._v("</html>")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[o._v("# flask_directory_structure/static/reset.css")])],1),i("div",[i("br")]),i("div",[o._v("html, body, div, span, applet, object, iframe,")]),i("div",[o._v("h1, h2, h3, h4, h5, h6, p, blockquote, pre,")]),i("div",[o._v("a, abbr, acronym, address, big, cite, code,")]),i("div",[o._v("del, dfn, em, img, ins, kbd, q, s, samp,")]),i("div",[o._v("small, strike, strong, sub, sup, tt, var,")]),i("div",[o._v("b, u, i, center,")]),i("div",[o._v("dl, dt, dd, ol, ul, li,")]),i("div",[o._v("fieldset, form, label, legend,")]),i("div",[o._v("table, caption, tbody, tfoot, thead, tr, th, td,")]),i("div",[o._v("article, aside, canvas, details, embed,")]),i("div",[o._v("figure, figcaption, footer, header, hgroup,")]),i("div",[o._v("menu, nav, output, ruby, section, summary,")]),i("div",[o._v("time, mark, audio, video {")]),i("div",[o._v("    margin: 0;")]),i("div",[o._v("    padding: 0;")]),i("div",[o._v("    border: 0;")]),i("div",[o._v("    font-size: 100%;")]),i("div",[o._v("    font: inherit;")]),i("div",[o._v("    vertical-align: baseline;")]),i("div",[o._v("}")]),i("div",[i("br")]),i("div",[o._v("/* HTML5 display-role reset for older browsers */")]),i("div",[o._v("article, aside, details, figcaption, figure,")]),i("div",[o._v("footer, header, hgroup, menu, nav, section {")]),i("div",[o._v("    display: block;")]),i("div",[o._v("}")]),i("div",[i("br")]),i("div",[o._v("body {")]),i("div",[o._v("    line-height: 1;")]),i("div",[o._v("}")]),i("div",[i("br")]),i("div",[o._v("ol, ul {")]),i("div",[o._v("    list-style: none;")]),i("div",[o._v("}")]),i("div",[i("br")]),i("div",[o._v("blockquote, q {")]),i("div",[o._v("    quotes: none;")]),i("div",[o._v("}")]),i("div",[i("br")]),i("div",[o._v("blockquote:before, blockquote:after,")]),i("div",[o._v("q:before, q:after {")]),i("div",[o._v("    content: '';")]),i("div",[o._v("    content: none;")]),i("div",[o._v("}")]),i("div",[i("br")]),i("div",[o._v("table {")]),i("div",[o._v("    border-collapse: collapse;")]),i("div",[o._v("    border-spacing: 0;")]),i("div",[o._v("}")])]),i("div",[i("br")])])])])}),[],!1,null,null,null);r.default=e.exports}}]);