(window.webpackJsonp=window.webpackJsonp||[]).push([[222],{577:function(o,t,i){"use strict";i.r(t);var e=i(25),r=Object(e.a)({},(function(){var o=this,t=o.$createElement,i=o._self._c||t;return i("ContentSlotsDistributor",{attrs:{"slot-key":o.$parent.slotKey}},[i("div",[i("span",[i("div",[i("div",[i("div",[i("div",[i("div",[i("div",[i("div",[i("div",[i("div",[i("div",[i("div",[i("div",[i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[o._v("socket = 套接字")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[o._v("socket: 实现软件或程序之间的通信")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)"}},[o._v("在进行网络传输或通信的时候只能传递通过字符串转码后的bytes类型，然后再对bytes类型进行解码获取传递的数据")])])]),i("div",[i("font",{staticStyle:{"font-size":"14pt"}},[i("br")])],1),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold","line-height":"1.75"}},[o._v("1.")]),i("span",{staticStyle:{"font-weight":"bold"}}),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("socket层")])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"827651-20180107205809034-380661986.png",src:"/kevin-blog/Python/socket 模块_files/827651-20180107205809034-380661986.png",type:"image/png"}})]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold","line-height":"1.75"}},[o._v("2.")]),i("span",{staticStyle:{"font-weight":"bold"}}),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("套接字的两个种族")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[o._v("基于文件类型的套接字家族 -> 现在几乎不用")])])]),i("ul",[i("li",[i("div",[o._v("套接字家族的名称: "),i("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[o._v("AF_UNX")])])]),i("li",[i("div",[o._v("UNX一切皆文件，以文件作为介质进行传输")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("基于网络类型的套接字家族 -> 现在常用")])]),i("ul",[i("li",[i("div",[o._v("套接字家族的名称: "),i("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[o._v("AF_INET")])])]),i("li",[i("div",[o._v("AF_INET6被用于ipv6，还有一些其他的地址家族，不过，他们要么是只用于某个平台，要么就是已经被废弃，或者是很少被使用，或者是根本没有实现，所有地址家族中，AF_INET是使用最广泛的一个，python支持很多种地址家族，但是由于我们只关心网络编程，所以大部分时候我么只使用AF_INET")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold","line-height":"1.75"}},[o._v("3.")]),i("span",{staticStyle:{"font-weight":"bold"}}),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("基于TCP协议的socket")])])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"827651-20171027102242789-2142796571.jpg",src:"/kevin-blog/Python/socket 模块_files/827651-20171027102242789-2142796571.jpg",type:"image/jpeg"}})]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[o._v("先启动服务端文件再启动客户端文件")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[o._v("客户端文件无需执行 conn, addr = sk.accept() 直接使用 sk 对象进行消息的收发")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("有收必有发，收发必相等 -> 如果客户端执行了 send 服务端必须也执行 recv 反之，因为如果客户端或服务端的 conn.recv(1024) 没有接收到消息就会进行阻塞(阻塞: 一直等待，无法运行下面的代码，直到接收到消息)")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("sk.listen(num) -> 监听链接，如果listen传入一个数值，那么就代表只允许多少个客户端进行连接，如果不传则就没有限制，python3.2一下的一定要传")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("recv(num) 只会接受num个字节内的内容，但是num最好不要超过4096")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("不支持多个客户端和服务端进行同时通讯")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("在 Pycharm 下切换文件查看打印内容")])])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Python/socket 模块_files/Image.png",type:"image/png"}})]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py 服务端")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("创建socket")]),o._v(" -> 买手机")],1),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("避免服务器重启时报address already in use, 因为服务重启的时候电脑不会立刻关闭端口，而是过一会才关闭，此时端口就会被占用，也有可能是超过了网络最大链接数")])],1),i("div",[o._v("# sk.bind(('ip地址', 端口))")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("把地址绑定到socket，传入的值必须是元组")]),o._v(" -> 绑定手机卡")],1),i("div",[o._v("sk.listen()  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("TCP开始"),i("font",[o._v("监听链接")])],1),i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("，如果listen传入一个数值，那么就代表只允许多少个客户端进行连接，如果不传则就没有限制，python3.2一下的一定要传")]),o._v(" -> 开始监听有没有人给你打电话")],1),i("div",[o._v("conn, addr = sk.accept()  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("等待")]),i("font",{attrs:{color:"#41AD1C"}},[o._v("接收客户端的链接 返回值: 链接, 地址")]),o._v(" -> 等待别人给你打电话，并且接听别人的电话")],1),i("div",[i("br")]),i("div",[o._v("# ——————————————————————————————————")]),i("div",[i("br")]),i("div",[o._v("ret = conn.recv(1024)  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("接收客户端发送过来的消息（返回值: bytes类型），")]),i("font",{attrs:{color:"#E30000"}},[i("b",[o._v("如果没有接收到就会进行阻塞（阻塞: 一直等待，无法运行下面的代码，直到接收到消息）")])]),i("font",{attrs:{color:"#41AD1C"}},[o._v("，")]),i("font",{attrs:{color:"#E30000"}},[i("b",[o._v("只会接收1024个字节内的内容，如果超过了1024个字节那么再次 conn.recv 就可以获取多余的内容")])]),o._v(" -> 听别人说话")],1),i("div",[o._v("print(ret.decode('utf-8'))  # 打印客户端发送过来的消息")]),i("div",[o._v("conn.send(bytes('客户端，你好', encoding='utf-8'))  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("向客户端发送消息（发送的消息必须是bytes类型）")]),o._v("-> 和别人说话")],1),i("div",[o._v("ret = conn.recv(1024).decode('utf-8')  # "),i("font",{attrs:{color:"#E30000"}},[o._v("可以在 recv 后面直接进行解码")]),o._v(" -> 听别人说话")],1),i("div",[o._v("print(ret)  # 打印客户端发送过来的消息")]),i("div",[i("br")]),i("div",[o._v("# ——————————————————————————————————")]),i("div",[i("br")]),i("div",[o._v("conn.close()  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("关闭客户端的socket")]),o._v(" -> 挂电话")],1),i("div",[o._v("sk.close()  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("关闭服务器的socket(可选)")]),o._v(" -> 关手机")],1)]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py 客户端")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("创建客户端socket")]),o._v(" -> 买手机")],1),i("div",[o._v("sk.connect(('127.0.0.1', 8080))  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("尝试链接服务端，传入的值必须是元组")]),o._v(" -> 拨打别人的电话")],1),i("div",[i("br")]),i("div",[o._v("# ——————————————————————————————————")]),i("div",[i("br")]),i("div",[o._v("sk.send(bytes('服务端，你好', encoding='utf-8'))  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("向客户端发送消息")]),o._v(" -> 和别人说话")],1),i("div",[o._v("ret = sk.recv(1024).decode('utf-8')  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("接收服务端发送过来的消息（返回值: bytes类型）")]),o._v("，"),i("b",[i("font",{attrs:{color:"#E30000"}},[o._v("如果没有接收到就会进行阻塞（阻塞: 一直等待，无法运行下面的代码，直到接收到消息）")])],1),i("font",{attrs:{color:"#41AD1C"}},[o._v("，")]),i("font",{attrs:{color:"#E30000"}},[o._v("只会接收1024个字节内的内容，如果超过了1024个字节那么再次 conn.recv 就可以获取多余的内容，可以在 recv 后面直接进行解码")]),o._v(" -> 听别人说话")],1),i("div",[o._v("print(ret)  # 打印服务端发送过来的消息")]),i("div",[o._v("sk.send(bytes('服务端，再见', encoding='utf-8'))  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("向客户端发送消息")]),o._v(" -> 和别人说话")],1),i("div",[i("br")]),i("div",[o._v("# ——————————————————————————————————")]),i("div",[i("br")]),i("div",[o._v("sk.close()  # "),i("font",{attrs:{color:"#41AD1C"}},[o._v("关闭客户端的stroke")]),o._v(" -> 挂电话")],1)]),i("div",[i("br")])]),i("ul",[i("li",[i("div",[o._v("小型的聊天功能")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py 服务端")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[o._v("sk.listen()")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    ret = conn.recv(1024).decode('utf-8')")]),i("div",[o._v("    print(ret)")]),i("div",[o._v("    if ret == '再见':")]),i("div",[o._v("        conn.send(bytes('再见', encoding='utf-8'))")]),i("div",[o._v("        break")]),i("div",[o._v("    info = input('请输入要向客户端发送的内容：')")]),i("div",[o._v("    conn.send(bytes(info, encoding='utf-8'))")]),i("div",[i("br")]),i("div",[o._v("conn.close()")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py 客户端")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.connect(('127.0.0.1', 8080))")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    info = input('请输入要向服务端发送的内容：')")]),i("div",[o._v("    sk.send(bytes(info, encoding='utf-8'))")]),i("div",[o._v("    ret = sk.recv(1024).decode('utf-8')")]),i("div",[o._v("    print(ret)")]),i("div",[o._v("    if ret == '再见':")]),i("div",[o._v("        sk.send(bytes('再见', encoding='utf-8'))")]),i("div",[o._v("        break")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("如果客户端1向服务端发送了一条消息，然后客户端2也向服务端发送了一条消息，那么服务端只会收到客户端1的消息并且与客户端1进行通信，只有当客户端1结束了通信服务端才能收到客户端2的消息并且与客户端2进行通讯，以此类推，因为当")]),i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("服务端与客户端进行了链接通信，如果另一台客户端也想与服务端链接通信，那么要将之前的客户端结束通讯后才能与服务端进行链接通信 ->")]),o._v(" "),i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("通俗理解不支持多个客户端和服务端进行同时通讯")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py -> 代码没有进行优化，只是为了方便理解")]),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[o._v("sk.listen()")]),i("div",[i("br")]),i("div",[o._v("# ————————————— 第一台客户端执行的通信代码 ———————————————")]),i("div",[i("br")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    ret = conn.recv(1024).decode('utf-8')")]),i("div",[o._v("    print(ret)")]),i("div",[o._v("    if ret == '再见':")]),i("div",[o._v("        conn.send(bytes('再见', encoding='utf-8'))")]),i("div",[o._v("        break")]),i("div",[o._v("    info = input('请输入要向客户端发送的内容：')")]),i("div",[o._v("    conn.send(bytes(info, encoding='utf-8'))")]),i("div",[i("br")]),i("div",[o._v("conn.close()")]),i("div",[i("br")]),i("div",[o._v("# ————————————— 第二台客户端执行的通信代码 -> 和上面代码一样 ———————————————")]),i("div",[i("br")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    ret = conn.recv(1024).decode('utf-8')")]),i("div",[o._v("    print(ret)")]),i("div",[o._v("    if ret == '再见':")]),i("div",[o._v("        conn.send(bytes('再见', encoding='utf-8'))")]),i("div",[o._v("        break")]),i("div",[o._v("    info = input('请输入要向客户端发送的内容：')")]),i("div",[o._v("    conn.send(bytes(info, encoding='utf-8'))")]),i("div",[i("br")]),i("div",[o._v("conn.close()")]),i("div",[i("br")]),i("div",[o._v("sk.close()  "),i("font",{attrs:{color:"#E30000"}},[o._v("# 如果服务端socket没有关闭，客户端就可以与服务端继续建立链接（通俗理解：就是可以继续执行 conn, addr = sk.accept() 代码）")])],1)]),i("div",[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py -> 优化后代码")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[o._v("sk.listen()")]),i("div",[i("br")]),i("div",[o._v("# ————————————————————————————")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    conn, addr = sk.accept()")]),i("div",[i("br")]),i("div",[o._v("    while True:")]),i("div",[o._v("        ret = conn.recv(1024).decode('utf-8')")]),i("div",[o._v("        print(ret)")]),i("div",[o._v("        if ret == '再见':")]),i("div",[o._v("            conn.send(bytes('再见', encoding='utf-8'))")]),i("div",[o._v("            break")]),i("div",[o._v("        info = input('请输入要向客户端发送的内容：')")]),i("div",[o._v("        conn.send(bytes(info, encoding='utf-8'))")]),i("div",[i("br")]),i("div",[o._v("    conn.close()")]),i("div",[i("br")]),i("div",[o._v("sk.close()  # 如果服务端socket没有关闭，客户端就可以与服务端继续建立链接（通俗理解：就是可以继续执行 conn, addr = sk.accept() 代码）")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client1.py 客户端1")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.connect(('127.0.0.1', 8080))")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    info = input('请输入要向服务端发送的内容：')")]),i("div",[o._v("    sk.send(bytes('客户端1：' + info, encoding='utf-8'))")]),i("div",[o._v("    ret = sk.recv(1024).decode('utf-8')")]),i("div",[o._v("    print(ret)")]),i("div",[o._v("    if ret == '再见':")]),i("div",[o._v("        sk.send(bytes('再见', encoding='utf-8'))")]),i("div",[o._v("        break")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client2.py 客户端2")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.connect(('127.0.0.1', 8080))")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    info = input('请输入要向服务端发送的内容：')")]),i("div",[o._v("    sk.send(bytes('客户端2：' + info, encoding='utf-8'))")]),i("div",[o._v("    ret = sk.recv(1024).decode('utf-8')")]),i("div",[o._v("    print(ret)")]),i("div",[o._v("    if ret == '再见':")]),i("div",[o._v("        sk.send(bytes('再见', encoding='utf-8'))")]),i("div",[o._v("        break")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold","line-height":"1.75"}},[o._v("4.")]),i("span",{staticStyle:{"font-weight":"bold"}}),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("基于UDP协议的socket")])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"827651-20171027102242789-2142796572.jpg",src:"/kevin-blog/Python/socket 模块_files/827651-20171027102242789-2142796572.jpg",type:"image/jpeg"}})]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[o._v("先启动服务端文件再启动客户端文件")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("在使用 sk.sendto('byte类型的消息',('接收消息方的ip',接收消息方的端口)) 一定要传地址元组，一般地址元组都是使用从 recvfrom 返回的地址，或者客户端第一次向服务端发送消息时自己写的服务端的地址元组")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("有收必有发，收发必相等 -> 如果客户端执行了 sendto 服务端必须也执行 recvfrom 反之，因为如果客户端或服务端的 sk.")]),i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("recvfrom")]),i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("(1024) 没有接收到消息就会进行阻塞(阻塞: 一直等待，无法运行下面的代码，直到接收到消息)")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("recvfrom(num) 只会接受num个字节内的内容，但是num最好不要超过4096")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("支持多个客户端和服务端进行同时通讯")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("在 Pycharm 下切换文件查看打印内容")])])]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Python/socket 模块_files/Image [1].png",type:"image/png"}})]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py 服务端")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket(type=socket.SOCK_DGRAM)")]),i("div",[i("br")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[i("br")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[i("br")]),i("div",[o._v("# ————————————————————————————————————")]),i("div",[i("br")]),i("div",[o._v("msg, addr = sk.recvfrom(1024)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 接收客户端发送过来的消息 返回值: 元组 ('bytes类型的消息', 发送消息方的地址元组) -> (b'\\xe5\\xae\\……', ('127.0.0.1', 59608))")])],1),i("div",[i("br")]),i("div",[o._v("print(addr)")]),i("div",[o._v("print(msg.decode('utf-8'))")]),i("div",[i("br")]),i("div",[o._v("sk.sendto(bytes('服务端发送给客户端的消息', encoding='utf-8'), addr)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 向客户端发送消息，参数: bytes类型的消息, 接收消息方的地址元组 -> 一般使用 sk.recvfrom(1024) 的返回值 addr 就可以，因为 addr 就是接收消息方的地址元组")])],1),i("div",[i("br")]),i("div",[o._v("msg, add = sk.recvfrom(1024)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 接收客户端发送过来的消息 返回值: 元组 ('bytes类型的消息', 发送消息方的地址元组) -> (b'\\xe5\\xae\\……', ('127.0.0.1', 59608))")])],1),i("div",[i("br")]),i("div",[o._v("print(addr)")]),i("div",[o._v("print(msg.decode('utf-8'))")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py 客户端")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket(type=socket.SOCK_DGRAM)")]),i("div",[i("br")]),i("div",[o._v("ip_port = ('127.0.0.1', 8080)")]),i("div",[i("br")]),i("div",[o._v("# ————————————————————————————————————")]),i("div",[i("br")]),i("div",[o._v("sk.sendto(bytes('客户端发送给服务端的消息1', encoding='utf-8'), ip_port)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 向服务端发送消息，参数: bytes类型的消息, 接收消息方的地址元组 -> 第一次发送一般都是向服务端发送，所以接收消息方的地址元组都要自己写的")])],1),i("div",[i("br")]),i("div",[o._v("msg, addr = sk.recvfrom(1024) "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 接收客户端发送过来的消息 返回值: 元组 ('bytes类型的消息',发送方消息方的地址元组) -> (b'\\xe5\\xae\\……', ('127.0.0.1', 8080))")])],1),i("div",[i("br")]),i("div",[o._v("print(addr)")]),i("div",[o._v("print(msg.decode('utf-8'))")]),i("div",[i("br")]),i("div",[o._v("sk.sendto(bytes('客户端发送给服务端的消息2', encoding='utf-8'), addr) "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 向服务端发送消息，参数: bytes类型的消息, 接收消息方的地址元组 -> 这一次的地址元组可以使用 sk.recvfrom(1024) 的返回值 addr")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("仿qq通信")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py 服务端")]),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket(type=socket.SOCK_DGRAM)")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    msg, addr = sk.recvfrom(1024)")]),i("div",[o._v("    print(addr)")]),i("div",[o._v("    print(msg.decode('utf-8'))")]),i("div",[o._v("    info = input('>>>')")]),i("div",[o._v("    sk.sendto(bytes(info, encoding='utf-8'), addr)")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client1.py 客户端1")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket(type=socket.SOCK_DGRAM)")]),i("div",[o._v("ip_port = ('127.0.0.1', 8080)")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    info = input('客户端1：')")]),i("div",[o._v("    sk.sendto(bytes('\\033[34m来自客户端1的消息:%s\\33[0m' % info, encoding='utf-8'), ip_port)")]),i("div",[o._v("    msg, addr = sk.recvfrom(1024)")]),i("div",[o._v("    print(addr)")]),i("div",[o._v("    print(msg.decode('utf-8'))")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client2.py 客户端2")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket(type=socket.SOCK_DGRAM)")]),i("div",[o._v("ip_port = ('127.0.0.1', 8080)")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    info = input('客户端2：')")]),i("div",[o._v("    sk.sendto(bytes('\\033[32m来自客户端2的消息:%s\\33[0m' % info, encoding='utf-8'), ip_port)")]),i("div",[o._v("    msg, addr = sk.recvfrom(1024)")]),i("div",[o._v("    print(addr)")]),i("div",[o._v("    print(msg.decode('utf-8'))")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("服务端接收从客户端发送过来的时间格式，然后服务端按照时间格式发送一个时间个客户端")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py 服务端")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[o._v("import time")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket(type=socket.SOCK_DGRAM)")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[o._v("while True:")]),i("div",[o._v("    time_format, addr = sk.recvfrom(1024)")]),i("div",[o._v("    t = time_format.decode('utf-8')")]),i("div",[o._v("    sk.sendto(bytes(time.strftime(t), encoding='utf-8'), addr)")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py 客户端")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket(type=socket.SOCK_DGRAM)")]),i("div",[o._v("ip_port = ('127.0.0.1', 8080)")]),i("div",[o._v("while True:")]),i("div",[o._v("    time_format = input('请输入时间格式：')")]),i("div",[o._v("    sk.sendto(time_format.encode('utf-8'), ip_port)")]),i("div",[o._v("    t, addr = sk.recvfrom(1024)")]),i("div",[o._v("    print(t.decode('utf-8'))")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap",color:"rgb(227, 0, 0)","font-weight":"bold","line-height":"1.75"}},[o._v("5.")]),i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}}),i("span",{staticStyle:{"font-size":"18.6667px",color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("如果客户端断开了链接且服务端还在继续接收客户端的信息，那么接收到的是空信息，不会报错的")])]),i("div",[i("span",{staticStyle:{"font-size":"18.6667px"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[o._v("sk.listen()")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    msg = conn.recv(1024).decode('utf-8')")]),i("div",[o._v("    print(msg)")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.connect(('127.0.0.1', 8080))")]),i("div",[i("br")]),i("div",[o._v("sk.send(b'hello')")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap",color:"rgb(227, 0, 0)","font-weight":"bold","line-height":"1.75"}},[o._v("6.")]),i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[i("span",{staticStyle:{"font-size":"18.6667px",color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("黏包")])])]),i("div",[i("font",{staticStyle:{"font-size":"12pt"}},[i("br")])],1),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[o._v("只有TCP协议有黏包现象，UDP协议永远不会黏包，但是UDP协议过消息或数据过长，那么他会丢弃过长的那部分或报错")])])])]),i("div",[i("span",{staticStyle:{"font-size":"18.6667px"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[o._v("黏包现象:")])])])]),i("ol",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[o._v("如果发送的消息过大接收端得到的结果很有可能是一部分，接收端再执行接收消息的时候又会先接收到之前剩余的部分再接收新消息 -> ")]),o._v("客户端向服务端发送一段很大的数据，如果接收端的recv(num)中的num的值小于发送过来的数据的字节数的话，那么接收端就会从缓存区中取只在num个字节内的值，如果服务端再次接受数据的时候就会从缓存取中先获取上次没有接收完的数据，然后再取新数据")])]),i("li",[i("div",[o._v("同时执行 sk.send(b'hello') 和 sk.send(b'world') 所收到的结果是 helloworld，因为两次发送的消息过小且时间间隔短，那么就会将两次消息合并在一起发送")])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("黏包成因:")])]),i("ul",[i("li",[i("div",[o._v("黏包现象1的解释：因为TCP协议中有拆包机制 -> 如果本机的MTU（网络发送的最大数据包）大于网关的MTU，那么大的数据包最会被拆开来传递 -> 通俗理解: 如果发送的消息或数据过大TCP就会拆开传递")])]),i("li",[i("div",[o._v("黏包现象2的解释：因为在TCP协议中使用了优化算法（Nagle算法），它会将多次时间间隔较小且数据量小的数据，合并成一个大的数据块来进行传递")])])])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"827651-20180107213012565-1511102109.png",src:"/kevin-blog/Python/socket 模块_files/827651-20180107213012565-1511102109.png",type:"image/png"}})]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[o._v("recv(num)一旦被调用，就会尝试获取缓冲区中的数据，只要有数据，就会直接返回，如果 num 为1024那么就会从缓存区中取1024字节的数据，如果缓存区只有400字节的数据，那么也只会取400字节的数据，而多出来的数据只能在下次 recv(num) 是获取")])]),i("li",[i("div",[o._v("通俗理解: 同时执行多个 send() 的时候，且 send() 之间没有执行recv() 就会有可能出现黏包现象")])]),i("li",[i("div",[o._v("总结: 主要还是因为接收端不知道一次要 recv(num) 多少个字节所构成的，如果每次执行 recv(num) 的时候都知道准确的消息字节数的话就不会发生黏包问题了，不连续 send() 的，且send()的后面跟着 recv(num) 也不会出现黏包问题")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("TCP协议的黏包现象1:")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py 服务端")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[o._v("sk.listen()")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[i("br")]),i("div",[o._v("msg = conn.recv(2)  # 限制了只获取2个字节的内容")]),i("div",[o._v("print(msg.decode('utf-8'))  # he 因为消息过长只会获取到一部分")]),i("div",[o._v("msg = conn.recv(10)  # 限制了只获取10个字节的内容")]),i("div",[o._v("print(msg.decode('utf-8'))  # llo-Kevin 获取上次没有获取到的部分")]),i("div",[i("br")]),i("div",[o._v("conn.close()")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py 客户端")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.connect(('127.0.0.1', 8080))")]),i("div",[i("br")]),i("div",[o._v("sk.send(bytes('hello-Kevin', encoding='utf-8'))")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("TCP协议的黏包现象2:")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[o._v("# server.py 服务端")])]),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[o._v("sk.listen()")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[i("br")]),i("div",[o._v("msg1 = conn.recv(1024)")]),i("div",[o._v("print(msg1)  # b'helloworld'")]),i("div",[o._v("msg1 = conn.recv(1024)")]),i("div",[o._v("print(msg1)  # b'' -> 当发送端关闭 socket 的时候就会发送一个空的值过来")]),i("div",[o._v("msg1 = conn.recv(1024)")]),i("div",[o._v("print(msg1)  # b''")]),i("div",[i("br")]),i("div",[o._v("conn.close()")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py 客户端")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.connect(('127.0.0.1', 8080))")]),i("div",[i("br")]),i("div",[o._v("sk.send(b'hello')")]),i("div",[o._v("sk.send(b'world')")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("基于TCP实现黏包例子: 远程执行命令 -> 在server端发送命令行命令给client端执行并且把执行结果返回个服务端 -> subprocess模块，执行系统命令会分别返回执行成功和失败的结果")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[o._v("sk.listen()")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    cmd = input('请输入正确或者错误的系统命令：')")]),i("div",[o._v("    conn.send(cmd.encode('utf-8'))")]),i("div",[o._v("    ret = conn.recv(1024).decode('utf-8')")]),i("div",[o._v("    print(ret)")]),i("div",[o._v("conn.close()")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[o._v("import subprocess")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.connect(('127.0.0.1', 8080))")]),i("div",[o._v("while True:")]),i("div",[o._v("    cmd = sk.recv(1024).decode('utf-8')")]),i("div",[o._v("    ret = subprocess.Popen(")]),i("div",[o._v("        cmd,")]),i("div",[o._v("        shell=True,")]),i("div",[o._v("        stdout=subprocess.PIPE,")]),i("div",[o._v("        stderr=subprocess.PIPE")]),i("div",[o._v("    )")]),i("div",[o._v("    stdout = '执行成功的返回值:' + (ret.stdout.read()).decode('gbk')")]),i("div",[o._v("    stderr = '执行失败的返回值:' + (ret.stderr.read()).decode('gbk')")]),i("div",[o._v("    print(stdout)")]),i("div",[o._v("    print(stderr)")]),i("div",[o._v("    sk.send(stdout.encode('utf-8'))")]),i("div",[o._v("    sk.send(stderr.encode('utf-8'))")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[o._v("UDP协议永远不会黏包，但是UDP协议过消息或数据过长，那么他会丢弃过长的那部分，如果接受到的消息字节数大于 ")]),o._v("recvfrom() 所设置的数就会报错")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[o._v("基于UDP实现丢弃过长部分: 远程执行命令 -> 在server端发送命令行命令给client端执行并且把执行结果返回个服务端 -> subprocess模块，执行系统命令会分别返回执行成功和失败的结果")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[o._v("# server.py")])]),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket(type=socket.SOCK_DGRAM)")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[o._v("msg, addr = sk.recvfrom(1024)")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    cmd = input('请输入正确或者错误的系统命令：')  # 输入循序 ls -> ipconfig -> dir")]),i("div",[o._v("    sk.sendto(cmd.encode('utf-8'), addr)")]),i("div",[o._v("    msg, addr = sk.recvfrom(10240)")]),i("div",[o._v("    print(msg.decode('utf-8'))")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[o._v("import subprocess")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket(type=socket.SOCK_DGRAM)")]),i("div",[o._v("ip_sort = ('127.0.0.1', 8080)")]),i("div",[o._v("sk.sendto(bytes('为了服务端能获取到客户端的地址才发此条消息', encoding='utf-8'), ip_sort)")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    cmd, addr = sk.recvfrom(1024)")]),i("div",[o._v("    ret = subprocess.Popen(")]),i("div",[o._v("        cmd.decode('utf-8'),")]),i("div",[o._v("        shell=True,")]),i("div",[o._v("        stdout=subprocess.PIPE,")]),i("div",[o._v("        stderr=subprocess.PIPE")]),i("div",[o._v("    )")]),i("div",[o._v("    stdout = '执行成功的返回值:' + (ret.stdout.read()).decode('gbk')")]),i("div",[o._v("    stderr = '执行失败的返回值:' + (ret.stderr.read()).decode('gbk')")]),i("div",[o._v("    print(stdout)")]),i("div",[o._v("    print(stderr)")]),i("div",[o._v("    sk.sendto(stdout.encode('utf-8'), addr)")]),i("div",[o._v("    sk.sendto(stderr.encode('utf-8'), addr)")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[o._v("报错现象 -> 解决方法:接收端的 recvfrom 的值设置大于接收到消息的字节数")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[o._v("# server.py 服务端")])]),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket(type=socket.SOCK_DGRAM)")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[i("br")]),i("div",[o._v("msg, addr = sk.recvfrom(1024)")]),i("div",[o._v("print(msg.decode('utf-8'))  # 报错")]),i("div",[i("br")]),i("div",[o._v("msg, addr = sk.recvfrom(1024)")]),i("div",[o._v("print(msg.decode('utf-8'))")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py 客户端")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("s1 = r''' 驱动器 C 中的卷没有标签。")]),i("div",[o._v("卷的序列号是 000B-A3DF")]),i("div",[i("br")]),i("div",[o._v("C:\\Users\\KX201711 的目录")]),i("div",[i("br")]),i("div",[o._v("2019/02/12  08:27    <DIR>          .")]),i("div",[o._v("2019/02/12  08:27    <DIR>          ..")]),i("div",[o._v("2019/01/23  16:58    <DIR>          .android")]),i("div",[o._v("2018/10/13  14:55    <DIR>          .AndroidStudio2.3")]),i("div",[o._v("2018/10/15  10:43    <DIR>          .AndroidStudio3.2")]),i("div",[o._v("2018/06/22  16:00    <DIR>          .atom")]),i("div",[o._v("2018/10/22  16:46         7,430,209 .babel.json")]),i("div",[o._v("2019/01/14  15:13             8,979 .bash_history")]),i("div",[o._v("2019/02/15  08:34    <DIR>          .BigNox")]),i("div",[o._v("2017/11/13  08:24    <DIR>          .config")]),i("div",[o._v("2018/08/03  16:59                37 .dbshell")]),i("div",[o._v("2018/10/16  09:52    <DIR>          .electron")]),i("div",[o._v("2018/10/15  15:50                16 .emulator_console_auth_token")]),i("div",[o._v("2018/10/15  14:44    <DIR>          .expo")]),i("div",[o._v("2017/11/18  13:41    <DIR>          .gem")]),i("div",[o._v("2017/11/18  14:16               121 .gemrc")]),i("div",[o._v("2018/08/20  08:31               174 .gitconfig")]),i("div",[o._v("2018/10/13  16:44    <DIR>          .gradle")]),i("div",[o._v("2018/07/10  08:12                42 .minttyrc")]),i("div",[o._v("2018/08/03  09:25                 0 .mongorc.js")]),i("div",[o._v("2018/03/17  10:33             9,350 .v8flags.6.2.414.50.dba84d59341dcb557c327ad510bd5ce2.json")]),i("div",[o._v("2019/01/07  13:56            11,876 .viminfo")]),i("div",[o._v("2018/01/19  16:00    <DIR>          新建文件夹")]),i("div",[o._v("              21 个文件    846,679,223 字节")]),i("div",[o._v("              50 个目录 28,960,673,792 可用字节'''")]),i("div",[i("br")]),i("div",[o._v("s2 = r'''")]),i("div",[o._v("Windows IP 配置")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[o._v("以太网适配器 以太网:")]),i("div",[i("br")]),i("div",[o._v("   连接特定的 DNS 后缀 . . . . . . . : www.tendawifi.com")]),i("div",[o._v("   本地链接 IPv6 地址. . . . . . . . : fe80::295f:b971:88c8:f39d%11")]),i("div",[o._v("   IPv4 地址 . . . . . . . . . . . . : 192.168.0.138")]),i("div",[o._v("   子网掩码  . . . . . . . . . . . . : 255.255.255.0")]),i("div",[o._v("   默认网关. . . . . . . . . . . . . : 192.168.0.1")]),i("div",[i("br")]),i("div",[o._v("以太网适配器 VirtualBox Host-Only Network:")]),i("div",[i("br")]),i("div",[o._v("   连接特定的 DNS 后缀 . . . . . . . :")]),i("div",[o._v("   本地链接 IPv6 地址. . . . . . . . : fe80::d10d:58d8:d36e:107f%6")]),i("div",[o._v("   IPv4 地址 . . . . . . . . . . . . : 192.168.56.1")]),i("div",[o._v("   子网掩码  . . . . . . . . . . . . : 255.255.255.0")]),i("div",[o._v("   默认网关. . . . . . . . . . . . . :")]),i("div",[i("br")]),i("div",[o._v("以太网适配器 VirtualBox Host-Only Network #2:")]),i("div",[i("br")]),i("div",[o._v("   连接特定的 DNS 后缀 . . . . . . . :")]),i("div",[o._v("   本地链接 IPv6 地址. . . . . . . . : fe80::e8:372e:bf52:6d95%5")]),i("div",[o._v("   IPv4 地址 . . . . . . . . . . . . : 192.168.224.2")]),i("div",[o._v("   子网掩码  . . . . . . . . . . . . : 255.255.255.0")]),i("div",[o._v("   默认网关. . . . . . . . . . . . . :'''")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket(type=socket.SOCK_DGRAM)")]),i("div",[o._v("ip_port = ('127.0.0.1', 8080)")]),i("div",[o._v("sk.sendto(bytes(s1, encoding='utf-8'), ip_port)")]),i("div",[o._v("sk.sendto(bytes(s2, encoding='utf-8'), ip_port)")])]),i("div",[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap",color:"rgb(227, 0, 0)","font-weight":"bold","line-height":"1.75"}},[o._v("7.")]),i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}}),i("span",{staticStyle:{"font-size":"18.6667px",color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("黏包的解决方案一")])]),i("div",[i("span",{staticStyle:{"font-size":"18.6667px"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[o._v("问题的根源在于，接收端不知道发送端将要传送数据的字节长度，所以解决黏包的方法就是围绕，如何让发送端在发送数据前，把自己将要发送的")]),i("span",{staticStyle:{"font-size":"12pt"}},[o._v("总")]),i("span",{staticStyle:{"font-size":"12pt"}},[o._v("字节大小让接收端知晓，然后接收端通过总字节数限制一次接受多少数据")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("注意要以bytes类型去计算所要发送消息的字节长度，因为 recv 是按字节长度去获取的")])])])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"827651-20180107211210612-35513522.png",src:"/kevin-blog/Python/socket 模块_files/827651-20180107211210612-35513522.png",type:"image/png"}})]),i("div",[i("br")]),i("ul",[i("li",[i("div",[o._v("使用这种方式所存在的问题就是多了一次 send 和 recv 的交互")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# 解决远程执行命令例子中的黏包问题")]),i("div",[i("br")]),i("div",[o._v("# server.py")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8081))")]),i("div",[o._v("sk.listen()")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    cmd = input('请输入正确或者错误的系统命令：')")]),i("div",[o._v("    conn.send(cmd.encode('utf-8'))")]),i("div",[o._v("    num = conn.recv(1024).decode('utf-8')"),i("font",{attrs:{color:"#E30000"}},[o._v("  # 接收内容的总字节数")])],1),i("div",[o._v("    conn.send(b'ok')"),i("font",{attrs:{color:"#E30000"}},[o._v("  # 发送确认消息")])],1),i("div",[o._v("    ret = conn.recv(int(num)).decode('gbk')"),i("font",{attrs:{color:"#E30000"}},[o._v("  # 通过总字节数设置可以接受多少数据，比如接收到的消息的总字节数为5，那么 recv 只会接收5个字节数的消息，这样就不会发生黏包问题")])],1),i("div",[o._v("    print(ret)")]),i("div",[i("br")]),i("div",[o._v("conn.close()")]),i("div",[o._v("sk.close()")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[o._v("import subprocess")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.connect(('127.0.0.1', 8081))")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    cmd = sk.recv(1024).decode('utf-8')")]),i("div",[o._v("    ret = subprocess.Popen(")]),i("div",[o._v("        cmd,")]),i("div",[o._v("        shell=True,")]),i("div",[o._v("        stdout=subprocess.PIPE,")]),i("div",[o._v("        stderr=subprocess.PIPE")]),i("div",[o._v("    )")]),i("div",[o._v("    stdout = ret.stdout.read()")]),i("div",[o._v("    stderr = ret.stderr.read()")]),i("div",[o._v("    sk.send(str(len(stdout) + len(stderr)).encode('utf-8'))  "),i("font",[i("font",{attrs:{color:"#E30000"}},[o._v("# 将内容的总字节数首先发送给服务端 ->")]),o._v(" "),i("b",[i("font",{staticStyle:{"font-size":"11pt"},attrs:{color:"#AD0000"}},[o._v("注意要以bytes类型去计算所要发送消息的字节长度，因为 recv 是按字节长度去获取的")])],1)],1)],1),i("div",[o._v("    sk.recv(1024) "),i("font",{attrs:{color:"#E30000"}},[o._v(" # 接收确认消息，如果没有接收此消息，那么在这里就会发生黏包问题")])],1),i("div",[o._v("    sk.send(stdout)")]),i("div",[o._v("    sk.send(stderr)")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("span",{staticStyle:{"box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","white-space":"pre-wrap",color:"rgb(227, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.75"}},[o._v("8.")]),i("span",{staticStyle:{"box-sizing":"border-box","font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(227, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}}),i("span",{staticStyle:{"box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"18.6667px",color:"rgb(227, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[o._v("黏包的解决方案二")])])]),i("div",[i("span",{staticStyle:{"box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"18.6667px"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[o._v("使用struct模块将要发送的内容的总字节数转换为固定的bytes类型传给接收端，然后接受端以固定的字节数接收该bytes类型，这样就算发送端连续执行send()发送数据出现了黏包问题，客户端也可以通过")]),i("span",{staticStyle:{"font-size":"12pt"}},[o._v("固定的字节数接收到该数据，这样也解决了黏包解决方案一中")]),o._v("多了一次 send 和 recv 的交互的问题")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# 解决远程执行命令例子中的黏包问题")]),i("div",[i("br")]),i("div",[o._v("# server.py")]),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[o._v("import socket")]),i("div",[o._v("import struct")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8081))")]),i("div",[o._v("sk.listen()")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    cmd = input('请输入正确或者错误的系统命令：')")]),i("div",[o._v("    conn.send(cmd.encode('utf-8'))")]),i("div",[o._v("    num = conn.recv(4)  "),i("font",{attrs:{color:"#FF0000"}},[o._v("# b'A\\x00\\x00\\x00' 接收固定长度的bytes类型的内容总字节数 -> 以4个字节去读取内容总字节数，因为int类型通过struct模块转化后得到的bytes类型的长度是4")])],1),i("div",[o._v("    num = struct.unpack('i', num)[0] "),i("font",{attrs:{color:"#FF0000"}},[o._v(" # (65,)[0] 对固定长度的bytes类型进行解码，获取到内容总字节数")])],1),i("div",[o._v("    ret = conn.recv(int(num)).decode('gbk')  "),i("font",{staticStyle:{color:"rgb(255, 0, 0)"}},[o._v("# 通过总字节数设置可以接受多少数据，比如接收到的消息的总字节数为5，那么 recv 只会接收5个字节数的消息，这样就不会发生黏包问题")])],1),i("div",[o._v("    print(ret)")]),i("div",[i("br")]),i("div",[o._v("conn.close()")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[o._v("import subprocess")]),i("div",[o._v("import struct")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.connect(('127.0.0.1', 8081))")]),i("div",[i("br")]),i("div",[o._v("while True:")]),i("div",[o._v("    cmd = sk.recv(1024).decode('utf-8')")]),i("div",[o._v("    ret = subprocess.Popen(")]),i("div",[o._v("        cmd,")]),i("div",[o._v("        shell=True,")]),i("div",[o._v("        stdout=subprocess.PIPE,")]),i("div",[o._v("        stderr=subprocess.PIPE")]),i("div",[o._v("    )")]),i("div",[o._v("    stdout = ret.stdout.read()")]),i("div",[o._v("    stderr = ret.stderr.read()")]),i("div",[o._v("    len_num = len(stdout) + len(stderr)")]),i("div",[o._v("    bytes_num = struct.pack('i', len_num)"),i("font",{attrs:{color:"#FF0000"}},[o._v("  # b'A\\x00\\x00\\x00' 将内容总字节数转化为固定长度的bytes类型")])],1),i("div",[o._v("    sk.send(bytes_num)"),i("font",{attrs:{color:"#FF0000"}},[o._v("  # 发送固定长度的bytes类型给服务端")])],1),i("div",[o._v("    sk.send(stdout)")]),i("div",[o._v("    sk.send(stderr)")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",[i("font",{staticStyle:{"font-size":"14pt"}},[i("span",{staticStyle:{"box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","white-space":"pre-wrap","font-size":"14pt",color:"rgb(227, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.75"}},[o._v("9.")]),i("span",{staticStyle:{"box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(227, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[o._v(" 报头和报文")])])],1),i("div",[i("span",{staticStyle:{"box-sizing":"border-box","font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[o._v("在网络上传输的所有数据都叫数据包")])])]),i("li",[i("div",[o._v("数据包里面的所有数据都叫报文")])]),i("li",[i("div",[o._v("所有的报文都会有报头 / 所有的协议都会有报头")])]),i("li",[i("div",[o._v("报头，在数据的传输过程中不止只有你的数据，还有ip地址 端口 mac地址……这些就是报头 -> 通俗理解: 除了你要传输的数据之外的消息就叫报头")])]),i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("报头的作用: 比如客户端要向服务端发送一个文件且服务端想知道该文件的相关信息，例如：文件的名字/大小/类型，这时候我们就可以定制一个报文发送个服务端 -> 上面提到的解决黏包问题的总字节数一般都会放在报头（字典）中发送给接收端解决黏包问题")])])]),i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("报头也可以理解为发送端最先发送的关于该数据的相关信息的消息，一般都是字典 -> 上面解决黏包方法中先发送一个总字节数的固定长度的bytes类型给服务端，而当中的固定长度的bytes类型就是报头")])])]),i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("报头是最先发送的也是接收端最先接收到的")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[o._v("import struct")]),i("div",[o._v("import json")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8081))")]),i("div",[o._v("sk.listen()")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[i("br")]),i("div",[o._v("h_fixed_len_bytes = conn.recv(4) "),i("font",{staticStyle:{color:"rgb(255, 0, 0)"}},[o._v(" # 接收固定长度的bytes类型的报头总字节数")])],1),i("div",[o._v("h_fixed_len = struct.unpack('i', h_fixed_len_bytes)  "),i("font",{staticStyle:{color:"rgb(255, 0, 0)"}},[o._v("# (76,) 对固定长度的bytes类型进行解码，获取到报头总字节数")])],1),i("div",[o._v("h_json = conn.recv(h_fixed_len[0]).decode('utf-8')  "),i("font",{staticStyle:{color:"rgb(255, 0, 0)"}},[o._v("# 通过总字节数设置可以接受多少数据从而获取到字符串类型的报头")])],1),i("div",[o._v("header = json.loads(h_json)  "),i("font",{staticStyle:{color:"rgb(255, 0, 0)"}},[o._v("# 将字符串类型的报头装换为Python代码")])],1),i("div",[o._v("print(header)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# {'msg_len': 24, 'msg_info': '关于msg的相关消息'}")])],1),i("div",[o._v("msg_len = int(header['msg_len'])  "),i("font",{attrs:{color:"#FF0000"}},[o._v("# 通过报头获取到要接收的信息的总字节数")])],1),i("div",[o._v("msg = conn.recv(msg_len).decode('utf-8')  "),i("font",{attrs:{color:"#FF0000"}},[o._v("# 通过总字节数获取到客户端发送过来的消息")])],1),i("div",[o._v("print(msg)  # 服务端接收的消息")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("span",{staticStyle:{"box-sizing":"border-box","font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py -> 将要发送的内容的总字节数放在报头中发送给服务端，服务端通过报头中的总字节数接收相关字节数长度的内容")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[o._v("import struct")]),i("div",[o._v("import json")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.connect(('127.0.0.1', 8081))")]),i("div",[i("br")]),i("div",[o._v("msg = bytes('服务端接收的消息', encoding='utf-8')  "),i("font",{attrs:{color:"#FF0000"}},[o._v("# 需要发送给服务端的数据 -> 报文")])],1),i("div",[i("br")]),i("div",[o._v("header = {  "),i("b",[i("font",{attrs:{color:"#AD0000"}},[o._v("# 定制报头")])],1)]),i("div",[o._v("    'msg_len': len(msg), "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 需要发送给服务端的数据的总字节数")])],1),i("div",[o._v("    'msg_info': '关于msg的相关消息'")]),i("div",[o._v("}")]),i("div",[o._v("h_json = json.dumps(header) "),i("font",{attrs:{color:"#FF0000"}},[o._v(" # 将报头转换为json字符串")]),o._v(" "),i("font",{attrs:{color:"#41AD1C"}},[o._v('-> {"msg_info": "\\u5173\\……", "msg_len": 24}')])],1),i("div",[o._v("h_bytes = bytes(h_json, encoding='utf-8')  "),i("font",{attrs:{color:"#FF0000"}},[o._v("# 将json字符串转换为bytes类型")]),o._v(" "),i("font",{attrs:{color:"#41AD1C"}},[o._v('-> b\'{"msg_info": "\\\\u5173\\\\……, "msg_len": 24}\'')])],1),i("div",[o._v("h_bytes_len = len(h_bytes)  "),i("font",{attrs:{color:"#FF0000"}},[o._v("# 得到报头的总字节数")]),o._v(" "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-> 76")])],1),i("div",[o._v("h_fixed_len_bytes = struct.pack('i', h_bytes_len) "),i("font",{staticStyle:{color:"rgb(255, 0, 0)"}},[o._v(" # 将报头的总字节数转化为固定长度的bytes类型")]),o._v(" "),i("font",{attrs:{color:"#41AD1C"}},[o._v("-> b'L\\x00\\x00\\x00'")])],1),i("div",[i("br")]),i("div",[o._v("sk.send(h_fixed_len_bytes)  "),i("font",{staticStyle:{color:"rgb(255, 0, 0)"}},[o._v("# 发送固定长度的bytes类型的报头总字节数")])],1),i("div",[o._v("sk.send(bytes(h_json, encoding='utf-8'))  "),i("font",{attrs:{color:"#FF0000"}},[o._v("# 发送报头")])],1),i("div",[o._v("sk.send(msg)  "),i("font",{attrs:{color:"#FF0000"}},[o._v("# 发送报文")])],1),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("span",{staticStyle:{"box-sizing":"border-box","font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","white-space":"pre-wrap",color:"rgb(227, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.75"}},[o._v("10.")]),i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(227, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[o._v(" 实现大文件的上传或下载 -> 大文件的传输")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("div",[i("a",{attrs:{href:"/kevin-blog/Python/socket 模块_files/file_transfer.rar"}},[i("img",{attrs:{alt:"file_transfer.rar",src:"/kevin-blog/Python/socket 模块_files/05a0e34f01789af58d65e1463761ea80.png"}})])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py -> 接收端")]),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[o._v("import socket")]),i("div",[o._v("import struct")]),i("div",[o._v("import json")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8081))")]),i("div",[o._v("sk.listen()")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[o._v("buffer = 1024  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 每次写入多少字节的数据，这里最好写1024因为数值越大就越容易出错")])],1),i("div",[i("br")]),i("div",[o._v("bytes_header_len = conn.recv(4)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 接收固定长度的bytes类型的报头总字节数")])],1),i("div",[o._v("header_len = struct.unpack('i', bytes_header_len)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 对固定长度的bytes类型进行解码，获取到报头总字节数")])],1),i("div",[o._v("json_header = conn.recv(header_len[0]).decode('utf-8')  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 通过总字节数设置可以接受多少数据从而获取到字符串类型的报头")])],1),i("div",[o._v("header = json.loads(json_header)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将字符串类型的报头装换为Python代码")])],1),i("div",[i("br")]),i("div",[o._v("filesize = header['filesize']  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 从报头中获取文件的大小（总字节数）")])],1),i("div",[o._v("with open(r'movie\\%s' % header['filename'], 'wb') as f:  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 以bytes类型的方式写入文件，因为传送过来的数据是bytes类型的 -> 根目录下一定要有movie文件夹")])],1),i("div",[o._v("    while filesize:")]),i("div",[o._v("        if filesize >= buffer:")]),i("div",[o._v("            print(filesize, 1)")]),i("div",[o._v("            content = conn.recv(buffer)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 按照固定的字节去接收数据")])],1),i("div",[o._v("            f.write(content)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将数据写入到文件中")])],1),i("div",[o._v("            filesize -= buffer  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 因为上面已经接收了1024个字节，所以 总节数-buffer = 剩下的未接收的字节数")])],1),i("div",[o._v("        else:")]),i("div",[o._v("            print(filesize, 2)")]),i("div",[o._v("            content = conn.recv(filesize)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 接收最后剩下字节数且该字节数已经小于buffer的数据")])],1),i("div",[o._v("            f.write(content)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将数据写入到文件中")])],1),i("div",[o._v("            filesize = 0")]),i("div",[o._v("            print(filesize, 3)")]),i("div",[i("br")]),i("div",[o._v("conn.close()")]),i("div",[o._v("sk.close()")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py -> 发送端")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[o._v("import struct")]),i("div",[o._v("import json")]),i("div",[o._v("import os")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.connect(('127.0.0.1', 8081))")]),i("div",[o._v("buffer = 1024 "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 每次发送多少字节的数据，这里最好写1024因为数值越大就越容易出错")])],1),i("div",[i("br")]),i("div",[o._v("header = {  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 定制报文 -> 要发送文件的相关信息")])],1),i("div",[o._v("    'filepath': r'D:\\Movie',")]),i("div",[o._v("    'filename': r'Ghost blowing light.mp4'")]),i("div",[o._v("}")]),i("div",[o._v("file_path = os.path.join(header['filepath'], header['filename'])  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 拼接文件夹名和文件名从而获得文件的完整路径")])],1),i("div",[o._v("filesize = os.path.getsize(file_path)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 获取文件大小（总字节数）")])],1),i("div",[o._v("header['filesize'] = filesize "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 将文件大小（总字节数）添加到报头里")])],1),i("div",[o._v("json_header = json.dumps(header)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将报头转为字符串")])],1),i("div",[o._v("bytes_header = bytes(json_header, encoding='utf-8') "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 将报头转化为bytes类型")])],1),i("div",[o._v("header_len = len(bytes_header)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 获取报头的总字节数")])],1),i("div",[o._v("bytes_header_len = struct.pack('i', header_len)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将报头的总字节数转化为固定长度的bytes类型")])],1),i("div",[o._v("sk.send(bytes_header_len)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 发送固定长度的bytes类型的报头总字节数")])],1),i("div",[o._v("sk.send(bytes_header)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 发送报头")])],1),i("div",[i("br")]),i("div",[o._v("with open(file_path, 'rb') as f: "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # bytes类型读取文件，因为 sk.send() 就是发送bytes类型的")])],1),i("div",[o._v("    while filesize:")]),i("div",[o._v("        if filesize >= buffer:")]),i("div",[o._v("            print(filesize, 1)")]),i("div",[o._v("            content = f.read(buffer)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 按照固定的字节去读取文件")])],1),i("div",[o._v("            sk.send(content)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将读取到的文件发送个服务端")])],1),i("div",[o._v("            filesize -= buffer  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 因为上面已经读取了1024个字节，所以 总节数-buffer = 剩下的未读的字节数")])],1),i("div",[o._v("        else:")]),i("div",[o._v("            print(filesize, 2)")]),i("div",[o._v("            content = f.read(filesize)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 读取最后剩下字节数且该字节数已经小于buffer的内容")])],1),i("div",[o._v("            sk.send(content)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将读取到的文件发送个服务端")])],1),i("div",[o._v("            filesize = 0")]),i("div",[o._v("            print(filesize, 3)")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","white-space":"pre-wrap",color:"rgb(227, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.75"}},[o._v("11.")]),i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(227, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[o._v(" 实现大文件的上传或下载后验证文件的一致性（验证两个文件是否一致）")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("div",[i("a",{attrs:{href:"/kevin-blog/Python/socket 模块_files/file_consistency.rar"}},[i("img",{attrs:{alt:"file_consistency.rar",src:"/kevin-blog/Python/socket 模块_files/9f1bb3f2abdda0100a68c3579d60b9b2.png"}})])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[o._v("import struct")]),i("div",[o._v("import json")]),i("div",[o._v("import hashlib")]),i("div",[i("br")]),i("div",[o._v("md5 = hashlib.md5()")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8081))")]),i("div",[o._v("sk.listen()")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[o._v("buffer = 1024  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 每次写入多少字节的数据，这里最好写1024因为数值越大就越容易出错")])],1),i("div",[i("br")]),i("div",[o._v("bytes_header_len = conn.recv(4)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 接收固定长度的bytes类型的报头总字节数")])],1),i("div",[o._v("header_len = struct.unpack('i', bytes_header_len)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 对固定长度的bytes类型进行解码，获取到报头总字节数")])],1),i("div",[o._v("json_header = conn.recv(header_len[0]).decode('utf-8') "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 通过总字节数设置可以接受多少数据从而获取到字符串类型的报头")])],1),i("div",[o._v("header = json.loads(json_header)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将字符串类型的报头装换为Python代码")])],1),i("div",[i("br")]),i("div",[o._v("filesize = header['filesize']  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 从报头中获取文件的大小（总字节数）")])],1),i("div",[o._v("with open(r'movie\\%s' % header['filename'], 'wb') as f:  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 以bytes类型的方式写入文件，因为传送过来的数据是bytes类型的 -> 根目录下一定要有movie文件夹")])],1),i("div",[o._v("    while filesize:")]),i("div",[o._v("        if filesize >= buffer:")]),i("div",[o._v("            print(filesize, 1)")]),i("div",[o._v("            content = conn.recv(buffer)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 按照固定的字节去接收数据")])],1),i("div",[o._v("            md5.update(content)  "),i("font",{attrs:{color:"#E30000"}},[o._v("# 使用多次 update 获取 md5 值")])],1),i("div",[o._v("            f.write(content)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将数据写入到文件中")])],1),i("div",[o._v("            filesize -= buffer  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 因为上面已经接收了1024个字节，所以 总节数-buffer = 剩下的未接收的字节数")])],1),i("div",[o._v("        else:")]),i("div",[o._v("            print(filesize, 2)")]),i("div",[o._v("            content = conn.recv(filesize)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 接收最后剩下字节数且该字节数已经小于buffer的数据")])],1),i("div",[o._v("            md5.update(content) "),i("font",{attrs:{color:"#E30000"}},[o._v(" # 使用多次 update 获取 md5 值")])],1),i("div",[o._v("            f.write(content)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将数据写入到文件中")])],1),i("div",[o._v("            filesize = 0")]),i("div",[o._v("            print(filesize, 3)")]),i("div",[i("br")]),i("div",[o._v("ciphertext = md5.hexdigest()  "),i("font",{attrs:{color:"#E30000"}},[o._v("# 得到上传完后文件的md5值")])],1),i("div",[o._v("print(ciphertext, 1)")]),i("div",[i("br")]),i("div",[o._v("client_ciphertext = conn.recv(1024).decode('utf-8')  "),i("font",{attrs:{color:"#E30000"}},[o._v("# 接收客户端发送过来的原文件的md5值")])],1),i("div",[o._v("print(client_ciphertext, 2)")]),i("div",[i("br")]),i("div",[o._v("if ciphertext == client_ciphertext:  "),i("font",{attrs:{color:"#E30000"}},[o._v("# 使用 md5 进行文件的一致性验证")])],1),i("div",[o._v("    print('上传完后的文件和原文件一致')")]),i("div",[i("br")]),i("div",[o._v("conn.close()")]),i("div",[o._v("sk.close()")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[o._v("import struct")]),i("div",[o._v("import json")]),i("div",[o._v("import os")]),i("div",[o._v("import hashlib")]),i("div",[i("br")]),i("div",[o._v("md5 = hashlib.md5()")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.connect(('127.0.0.1', 8081))")]),i("div",[o._v("buffer = 1024  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 每次发送多少字节的数据，这里最好写1024因为数值越大就越容易出错")])],1),i("div",[i("br")]),i("div",[o._v("header = {  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 定制报文 -> 要发送文件的相关信息")])],1),i("div",[o._v("    'filepath': r'D:\\Movie',")]),i("div",[o._v("    'filename': r'Ghost blowing light.mp4'")]),i("div",[o._v("}")]),i("div",[o._v("file_path = os.path.join(header['filepath'], header['filename'])  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 拼接文件夹名和文件名从而获得文件的完整路径")])],1),i("div",[o._v("filesize = os.path.getsize(file_path)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 获取文件大小（总字节数）")])],1),i("div",[o._v("header['filesize'] = filesize  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将文件大小（总字节数）添加到报头里")])],1),i("div",[o._v("json_header = json.dumps(header)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将报头转为字符串")])],1),i("div",[o._v("bytes_header = bytes(json_header, encoding='utf-8') "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 将报头转化为bytes类型")])],1),i("div",[o._v("header_len = len(bytes_header)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 获取报头的总字节数")])],1),i("div",[o._v("bytes_header_len = struct.pack('i', header_len)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将报头的总字节数转化为固定长度的bytes类型")])],1),i("div",[o._v("sk.send(bytes_header_len) "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 发送固定长度的bytes类型的报头总字节数")])],1),i("div",[o._v("sk.send(bytes_header) "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 发送报头")])],1),i("div",[i("br")]),i("div",[o._v("with open(file_path, 'rb') as f: "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # bytes类型读取文件，因为 sk.send() 就是发送bytes类型的")])],1),i("div",[o._v("    while filesize:")]),i("div",[o._v("        if filesize >= buffer:")]),i("div",[o._v("            print(filesize, 1)")]),i("div",[o._v("            content = f.read(buffer)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 按照固定的字节去读取文件")])],1),i("div",[o._v("            md5.update(content) "),i("font",{attrs:{color:"#E30000"}},[o._v(" # 使用多次 update 获取 md5 值")])],1),i("div",[o._v("            sk.send(content)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将读取到的文件发送个服务端")])],1),i("div",[o._v("            filesize -= buffer  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 因为上面已经读取了1024个字节，所以 总节数-buffer = 剩下的未读的字节数")])],1),i("div",[o._v("        else:")]),i("div",[o._v("            print(filesize, 2)")]),i("div",[o._v("            content = f.read(filesize)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 读取最后剩下字节数且该字节数已经小于buffer的内容")])],1),i("div",[o._v("            md5.update(content)  "),i("font",{attrs:{color:"#E30000"}},[o._v("# 使用多次 update 获取 md5 值")])],1),i("div",[o._v("            sk.send(content)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将读取到的文件发送个服务端")])],1),i("div",[o._v("            filesize = 0")]),i("div",[o._v("            print(filesize, 3)")]),i("div",[i("br")]),i("div",[o._v("ciphertext = md5.hexdigest()  "),i("font",{attrs:{color:"#E30000"}},[o._v("# 得到原文件 md5 值")])],1),i("div",[o._v("print(ciphertext)")]),i("div",[o._v("sk.send(bytes(ciphertext, encoding='utf-8'))  "),i("font",{attrs:{color:"#E30000"}},[o._v("# 将原文件 md5 值发送给服务端进行文件的一致性验证")])],1),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","white-space":"pre-wrap",color:"rgb(227, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.75"}},[o._v("12.")]),i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(227, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[o._v(" 验证客户端的合法性")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[o._v("当服务端不想随便被任何一个客户端进行链接，只能通过密钥和服务端发送过来的消息进行加密，然后将加密后的内容发送个服务端进行验证")])])]),i("li",[i("div",[o._v("使用 hmac加密模块进行加密，也可以使用hashlib加密模块")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py")]),i("div",[i("br")]),i("div",[o._v("import os")]),i("div",[o._v("import hmac")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("key = '123'  # 密钥/盐")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[o._v("sk.listen()")]),i("div",[i("br")]),i("div",[o._v("def check_conn(conn):")]),i("div",[o._v("    msg = os.urandom(32)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 随机生成长度为32位的bytes类型")])],1),i("div",[o._v("    conn.send(msg)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将随机生成长度为32位的bytes类型发送个客户端，进行和密钥的加密")])],1),i("div",[o._v("    h = hmac.new(bytes(key, encoding='utf-8'), msg, digestmod='MD5')  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将密钥和随机生成长度为32位的bytes类型进行md5加密")])],1),i("div",[o._v("    digest = h.digest()  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 获取加密后的值，以二进制的形式返回，且是bytes类型")])],1),i("div",[o._v("    client_digest = conn.recv(1024)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 接收客户端通过密钥加密后的信息")])],1),i("div",[o._v("    return hmac.compare_digest(digest, client_digest)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 比较服务端和客户端加密后的信息是否一致")])],1),i("div",[i("br")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[o._v("res = check_conn(conn)")]),i("div",[i("br")]),i("div",[o._v("if res:")]),i("div",[o._v("    print('合法客户端')")]),i("div",[o._v("else:")]),i("div",[o._v("    print('不合法客户端')")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py")]),i("div",[i("br")]),i("div",[o._v("import os")]),i("div",[o._v("import hmac")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("key = '123'  # 密钥/盐")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.connect(('127.0.0.1', 8080))")]),i("div",[i("br")]),i("div",[o._v("msg = sk.recv(1024)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 接收服务端随机生成长度为32位的bytes类型")])],1),i("div",[o._v("h = hmac.new(bytes(key, encoding='utf-8'), msg, digestmod='MD5')  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将密钥和服务端发送过来的消息进行加密")])],1),i("div",[o._v("digest = h.digest() "),i("font",{attrs:{color:"#41AD1C"}},[o._v(" # 获取加密后的值，以二进制的形式返回，且是bytes类型")])],1),i("div",[o._v("sk.send(digest)  "),i("font",{attrs:{color:"#41AD1C"}},[o._v("# 将加密后的值发送给服务端进行验证，判断该客户端是否合法")])],1),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","white-space":"pre-wrap","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.75"}},[o._v("13.")]),i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}}),o._v(" "),i("span",{staticStyle:{"font-size":"14pt"}},[i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("socket")])]),i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[o._v("的其他方法")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[o._v("sk.sendall() -> 将所有数据一次性发送过去，有可能会会出现丢包 -> 还是建议使用 send")])])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[o._v("sendall 和 send 的区别就是 send 如果要发送的数据过大就会将数据拆开发送（简称拆包），而sendall则不会")])])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[o._v("# server.py")])]),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[o._v("sk.listen()")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[i("br")]),i("div",[o._v("msg = conn.recv(1024).decode('utf-8')")]),i("div",[o._v("print(msg)")]),i("div",[i("br")]),i("div",[o._v("conn.close()")]),i("div",[o._v("sk.close()")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# client.py")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.connect(('127.0.0.1', 8080))")]),i("div",[i("br")]),i("div",[o._v("sk.sendall(bytes('先服务端发送的数据', encoding='utf-8'))")]),i("div",[i("br")]),i("div",[o._v("sk.close()")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","box-sizing":"border-box","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])])]),i("ul",[i("li",[i("div",[o._v("sk.setblocking(True/False) ->  设置socket的阻塞和非阻塞模式")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[o._v("非阻塞模式就是遇见 listen 或 recv 都不进行阻塞直接往下执行")])])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[o._v("True: 阻塞 False: 非阻塞 默认值: True ")])])])]),i("div"),i("ul",[i("ul",[i("li",[i("div",[o._v("将 socket 设置为非阻塞模式的时候，所有本来阻塞的程序都会变成非阻塞（如 sk.accept conn.recv），当程序执行的时候就会报错")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[o._v("# server.py -> 当 server 被启动的时候就会报错")]),i("div",[i("br")]),i("div",[o._v("import socket")]),i("div",[i("br")]),i("div",[o._v("sk = socket.socket()")]),i("div",[o._v("sk.setblocking(False)  # 设置 socket 的阻塞和非阻塞模式")]),i("div",[o._v("sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)")]),i("div",[o._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[o._v("sk.listen()")]),i("div",[o._v("conn, addr = sk.accept()")]),i("div",[i("br")]),i("div",[o._v("msg = conn.recv(1024).decode('utf-8')")]),i("div",[o._v("print(msg)")]),i("div",[i("br")]),i("div",[o._v("conn.close()")]),i("div",[o._v("sk.close()")])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Python/socket 模块_files/Image [2].png",type:"image/png"}})]),i("div",[i("br")])]),i("div",[i("br")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);