(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{400:function(t,o,e){"use strict";e.r(o);var i=e(25),r=Object(i.a)({},(function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("div",[e("span",[e("div",[e("div",[e("span",{staticStyle:{"font-family":'"Helvetica Neue"'}},[e("br")])]),e("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[e("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("认证组件")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[t._v("只要继承了 APIView 就可以使用认证组件")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)"}},[t._v("认证: 每次请求都要带着token（即: 字符串）来进行验证，如果认证成功则返回相应的数据")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[t._v("组件的")]),e("span",{staticStyle:{"font-size":"14pt"}},[t._v("执行顺序: ")]),t._v(" "),e("span",{staticStyle:{"font-size":"14pt",color:"rgb(255, 0, 0)"}},[t._v("认证")]),t._v(" "),e("span",{staticStyle:{"font-size":"14pt"}},[t._v("-> 权限 -> 频率")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","white-space":"pre-wrap",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v("1.")]),e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v(" 认证类的创建")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[t._v("认证类的固定写法一 -> 没有继承 BaseAuthentication 认证类")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[t._v("如果没有继承 BaseAuthentication 认证类，那么就需要在认证类中编写两个方法")])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[t._v("authenticate -> 编写认证的逻辑代码")])]),e("li",[e("div",[t._v("authenticate_header -> 不知道有啥用，反正就是要写上 rest-framework 的源码规定的，否则就会报错 ")])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("注意")]),t._v(":")])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[t._v("authenticate 方法必须有返回值")])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[t._v("当验证失败的时候（即: if Fasle 的时候）要主动抛出异常，因为 rest-framework 是通过捕获异常来进行处理的")])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("authenticate 方法返回值说明:")])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt","font-weight":"bold"}},[t._v("返回 ")]),e("span",{staticStyle:{"font-weight":"bold"}},[t._v("两个值 或者")]),e("span",{staticStyle:{"font-size":"12pt","font-weight":"bold"}}),e("span",{staticStyle:{"font-weight":"bold"}},[t._v("一个列表/元祖中包含两个值")])])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("ul",[e("li",[e("div",[t._v("rest-framework 会将第一个值赋值给 "),e("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("request.user")]),t._v("，第二个值会赋值给 "),e("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("request.auth，")]),t._v("然后在视图类中就可以通过 request.user/auth 分别获取这两个值")])])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("返回 None")])])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("ul",[e("li",[e("div",[t._v("跳出当前认证，执行下一个认证")])])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("返回 异常")])])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("ul",[e("li",[e("div",[t._v("跳出当前认证，抛出异常信息")])])])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# rf_auth.py")])],1),e("div",[e("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[e("br")])]),e("div",[t._v("from rest_framework import exceptions")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[t._v("class "),e("font",{attrs:{color:"#FA7A00"}},[t._v("认证类的类名")]),t._v("(object):")],1),e("div",[e("br")]),e("div",[t._v("    def authenticate(self, request):")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 认证的逻辑代码")])],1),e("div",[e("br")]),e("div",[t._v("        if "),e("font",{attrs:{color:"#FA7A00"}},[t._v("True/False")]),t._v(":")],1),e("div",[t._v("            return "),e("font",{attrs:{color:"#FA7A00"}},[t._v("返回值一")]),t._v(", "),e("font",{attrs:{color:"#FA7A00"}},[t._v("返回值二")])],1),e("div",[e("font",{attrs:{color:"#FA7A00"}}),t._v("elif xxx:")],1),e("div",[t._v("            return "),e("font",{attrs:{color:"#FA7A00"}},[t._v("None ")]),t._v(" "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 跳出本次认证")])],1),e("div",[t._v("        else:")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(' raise exceptions.AuthenticationFailed("验证失败!")  '),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}}),t._v(" raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1),e("div",[e("br")]),e("div",[t._v("    def authenticate_header(self, request):")]),e("div",[t._v("        pass")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[t._v("认证类的固定写法二 -> 继承 BaseAuthentication 类 -> "),e("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[t._v("常用")])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[t._v("BaseAuthentication 认证类其实就是一个初始化好的认证类")])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[t._v("BaseAuthentication 认证类里面也有 "),e("span",{staticStyle:{"font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("authenticate")]),e("span",{staticStyle:{"font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v(" 和 ")]),t._v("authenticate_header 方法，只不过这两个方法里面没有任何逻辑代码")])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[t._v("在编写认证类的时候可以继承 BaseAuthentication 认证类，然后重写 "),e("span",{staticStyle:{"font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("authenticate")]),e("span",{staticStyle:{"font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v(" 方法，而自己编写的认证类就无需写 ")]),t._v("authenticate_header 方法了，因为 BaseAuthentication 认证类里面有")])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("注意")]),t._v(":")])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[t._v("authenticate 方法必须有返回值")])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[t._v("当验证失败的时候（即: if Fasle 的时候）要主动抛出异常，因为 rest-framework 是通过捕获异常来进行处理的")])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("authenticate 方法返回值说明:")])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt","font-weight":"bold"}},[t._v("返回 ")]),e("span",{staticStyle:{"font-weight":"bold"}},[t._v("两个值 或者")]),e("span",{staticStyle:{"font-size":"12pt","font-weight":"bold"}}),e("span",{staticStyle:{"font-weight":"bold"}},[t._v("一个列表/元祖中包含两个值")])])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("ul",[e("li",[e("div",[t._v("rest-framework 会将第一个值赋值给 "),e("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("request.user")]),t._v("，第二个值会赋值给 "),e("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("request.auth，")]),t._v("然后在视图类中就可以通过 request.user/auth 分别获取这两个值")])])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("返回 None")])])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("ul",[e("li",[e("div",[t._v("跳出当前认证，执行下一个认证")])])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("返回 异常")])])])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("ul",[e("li",[e("div",[t._v("跳出当前认证，抛出异常信息")])])])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# rf_auth.py")])]),e("div",[e("br")]),e("div",[t._v("from rest_framework.authentication import BaseAuthentication")]),e("div",[t._v("from rest_framework import exceptions")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[t._v("class "),e("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("认证类的类名")]),t._v("(BaseAuthentication):")]),e("div",[e("br")]),e("div",[t._v("    def authenticate(self, request):")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 认证的逻辑代码")])]),e("div",[e("br")]),e("div",[t._v("        if "),e("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("True/False")]),t._v(":")]),e("div",[t._v("            return "),e("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("返回值一")]),t._v(", "),e("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("返回值二")])]),e("div",[e("span",{staticStyle:{color:"rgb(250, 122, 0)"}}),e("font",{attrs:{color:"#FA7A00"}}),t._v(" "),e("font",{attrs:{color:"#000000"}},[t._v("elif xxx:")])],1),e("div",[e("font",{attrs:{color:"#000000"}},[t._v("            return")]),t._v(" "),e("font",{attrs:{color:"#FA7A00"}},[t._v("None ")]),t._v(" "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 跳出本次认证")])],1),e("div",[t._v("        else:")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(' raise exceptions.AuthenticationFailed("验证失败!")  '),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 设置报错信息")])],1),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}}),t._v("raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1)]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[t._v("认证类的例子")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# rf_auth.py")])],1),e("div",[e("br")]),e("div",[t._v("from rest_framework.authentication import BaseAuthentication")]),e("div",[t._v("from rest_framework import exceptions")]),e("div",[t._v("from .models import *")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[t._v("class TokenAuth(BaseAuthentication):")]),e("div",[t._v("    def authenticate(self, request):")]),e("div",[t._v('        token = request.GET.get("token")  '),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 从get请求中获取token值进行判断")])],1),e("div",[t._v("        token_obj = Token.objects.filter(token=token).first()  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 判断是否有当前token值的记录")])],1),e("div",[t._v("        if token_obj:")]),e("div",[t._v("            return token_obj.user, token_obj.token")]),e("div",[t._v("        else:")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(' raise exceptions.AuthenticationFailed("验证失败!")  '),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}}),t._v("raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1)]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","white-space":"pre-wrap",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v("3.")]),e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v(" 局部认证")])]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt"}},[t._v("局部认证作用于当前视图的所有请求")])])])]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[t._v("局部认证的配置（即: "),e("span",{staticStyle:{"font-size":"12pt"}},[t._v("authentication_classes = [认证类, 认证类]")]),t._v("）会覆盖掉该视图类在全局认证中的配置")])])]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt"}},[t._v("authentication_classes = [认证类, 认证类]")])])])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# rf_auth.py")])],1),e("div",[e("br")]),e("div",[t._v("from rest_framework.authentication import BaseAuthentication")]),e("div",[t._v("from rest_framework import exceptions")]),e("div",[t._v("from .models import *")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[t._v("class TokenAuth(BaseAuthentication):")]),e("div",[t._v("    def authenticate(self, request):")]),e("div",[t._v('        token = request.GET.get("token")  '),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 从get请求中获取token值进行判断")])],1),e("div",[t._v("        token_obj = Token.objects.filter(token=token).first()  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 判断是否有当前token值的记录")])],1),e("div",[t._v("        if token_obj:")]),e("div",[t._v("            return token_obj.user, token_obj.token")]),e("div",[t._v("        else:")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(' raise exceptions.AuthenticationFailed("验证失败!")  '),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}}),t._v("raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1)]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),e("div",[e("br")]),e("div",[t._v("import hashlib")]),e("div",[t._v("import time")]),e("div",[e("br")]),e("div",[t._v("from django.shortcuts import render, HttpResponse")]),e("div",[t._v("from rest_framework.views import APIView")]),e("div",[t._v("from rest_framework.response import Response")]),e("div",[t._v("from .models import *")]),e("div",[t._v("from .serializer import *")]),e("div",[t._v("from .rf_auth import *")]),e("div",[e("br")]),e("div",[t._v("from rest_framework import viewsets")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[t._v("class TestRequestView(APIView):")]),e("div",[e("font",{attrs:{color:"#FA7A00"}},[t._v("authentication_classes")]),t._v(" = [TokenAuth]  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 局部认证，只作用于当前视图")])],1),e("div",[e("br")]),e("div",[t._v("    def get(self, request):")]),e("div",[t._v("        print("),e("font",{attrs:{color:"#FA7A00"}},[t._v("request.user")]),t._v(")  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# Kevin -> user对象 -> TokenAuth 认证类下 authenticate 方法的返回值的第一个值")])],1),e("div",[t._v("        print("),e("font",{attrs:{color:"#FA7A00"}},[t._v("request.auth")]),t._v(")  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# aec82e5c956da440c11651d0e4dfd052 -> token 值 ")]),t._v("-> "),e("font",{attrs:{color:"#41AD1C"}},[t._v("TokenAuth 认证类下 authenticate 方法的返回值的第二个值")])],1),e("div",[t._v("        return Response('测试 request.user/auth 的值')")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[t._v("class BookViewSet(viewsets.ModelViewSet):")]),e("div",[e("font",{attrs:{color:"#FA7A00"}},[t._v("authentication_classes")]),t._v(" = [TokenAuth]  "),e("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 局部认证，只作用于当前视图下的所有请求")])],1),e("div",[e("br")]),e("div",[t._v("    queryset = Book.objects.all()")]),e("div",[t._v("    serializer_class = BookSerializers")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[t._v("class PublishViewSet(viewsets.ModelViewSet):")]),e("div",[e("font",{attrs:{color:"#FA7A00"}},[t._v("authentication_classes")]),t._v(" = [TokenAuth]  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 局部认证，只作用于当前视图")]),e("font",{attrs:{color:"#41AD1C"}},[t._v("下的所有请求")])],1),e("div",[e("br")]),e("div",[t._v("    queryset = Publish.objects.all()")]),e("div",[t._v("    serializer_class = PublishSerializers")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取以用户名作为盐，以当前时间作为加密内容的字符串token")])],1),e("div",[t._v("def get_token_str(username):")]),e("div",[t._v("    now_time = str(time.time())")]),e("div",[t._v('    md5 = hashlib.md5(bytes(username, encoding="utf8"))  '),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 加盐，使用用户名作为盐，保证token的唯一性")])],1),e("div",[t._v("    md5.update(bytes(now_time, encoding='utf-8'))")]),e("div",[t._v("    return md5.hexdigest()")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#FA7A00"}},[t._v("# 登陆，并且返回当前用户的token")])],1),e("div",[t._v("class LoginView(APIView):")]),e("div",[t._v("    def post(self, request):")]),e("div",[t._v("        username = request.data.get('username')")]),e("div",[t._v("        password = request.data.get('password')")]),e("div",[t._v("        user = User.objects.filter(username=username, password=password).first()")]),e("div",[t._v("        ret = {")]),e("div",[t._v("            'status': 0,")]),e("div",[t._v("            'msg': None")]),e("div",[t._v("        }")]),e("div",[t._v("        if user:")]),e("div",[t._v("            token_str = get_token_str(user.username)  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取Token值")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 每次登陆成功后都要修改当前用户的token值")])],1),e("div",[t._v("            Token.objects.update_or_create(user=user, defaults={'token': token_str})  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 如果有 user=user 这条数据，那么就修改 token 值，否则就进行添加")])],1),e("div",[t._v("            ret['status'] = 1")]),e("div",[t._v("            ret['token'] = token_str")]),e("div",[t._v("        else:")]),e("div",[t._v("            ret['msg'] = '登陆失败'")]),e("div",[e("br")]),e("div",[t._v("        return Response(ret)")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 登陆，获取token值")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/login/")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: POST")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 发送数据的编码格式: application/json -> 即: json 格式")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 所要发送的数据: ")]),t._v('{"username":"Kevin","password":"123"}')],1),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),e("div",[e("br")]),e("div",[t._v("{")]),e("div",[t._v('    "status": 1,')]),e("div",[t._v('    "msg": null,')]),e("div",[t._v('    "token": "4a70be5742f536bd78dad811c5044827"')]),e("div",[t._v("}")]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("# --------------------------------------------------------------")])]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 查看所有书籍（带token值）")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/?token=4a70be5742f536bd78dad811c5044827")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),e("div",[e("br")]),e("div",[t._v("[")]),e("div",[t._v("    {")]),e("div",[t._v('        "id": 2,')]),e("div",[t._v('        "title": "三体（第二部）",')]),e("div",[t._v('        "price": 100,')]),e("div",[t._v('        "pub_date": "2012-12-12",')]),e("div",[t._v('        "publish": 1,')]),e("div",[t._v('        "authors": [')]),e("div",[t._v("            1,")]),e("div",[t._v("            2")]),e("div",[t._v("        ]")]),e("div",[t._v("    },")]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[e("font",{attrs:{color:"#41AD1C"}},[t._v("……")])],1)]),e("div",[e("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[t._v("]")])]),e("div",[e("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[e("br")])]),e("div",[e("font",{attrs:{color:"#FA7A00"}},[t._v("# --------------------------------------------------------------")])],1),e("div",[e("font",{attrs:{color:"#FA7A00"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 查看所有书籍（不带token值）")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),e("div",[e("br")]),e("div",[t._v("{")]),e("div",[t._v('    "detail": "验证失败!"')]),e("div",[t._v("}")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 局部请求认证")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[t._v("局部请求认证作用于当前视图的某几个请求")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[t._v("通过重写 rest-framework 源码中 get_authenticators 方法来实现局部请求认证")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("get_authenticators 返回值格式")]),t._v(": [认证类(), 认证类(), 认证类(), ……]")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# rf_auth.py")])]),e("div",[e("br")]),e("div",[t._v("from rest_framework.authentication import BaseAuthentication")]),e("div",[t._v("from rest_framework import exceptions")]),e("div",[t._v("from .models import *")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[t._v("class TokenAuth(BaseAuthentication):")]),e("div",[t._v("    def authenticate(self, request):")]),e("div",[t._v('        token = request.GET.get("token")  '),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 从get请求中获取token值进行判断")])]),e("div",[t._v("        token_obj = Token.objects.filter(token=token).first()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 判断是否有当前token值的记录")])]),e("div",[t._v("        if token_obj:")]),e("div",[t._v("            return token_obj.user, token_obj.token")]),e("div",[t._v("        else:")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("#")]),t._v(' raise exceptions.AuthenticationFailed("验证失败!")  '),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 设置报错信息")])]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}}),t._v("raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 设置报错信息")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])]),e("div",[e("br")]),e("div",[t._v("import hashlib")]),e("div",[t._v("import time")]),e("div",[e("br")]),e("div",[t._v("from django.shortcuts import render, HttpResponse")]),e("div",[t._v("from rest_framework.views import APIView")]),e("div",[t._v("from rest_framework.response import Response")]),e("div",[t._v("from .models import *")]),e("div",[t._v("from .serializer import *")]),e("div",[t._v("from .rf_auth import *")]),e("div",[e("br")]),e("div",[t._v("from rest_framework import viewsets")]),e("div",[e("br")]),e("div",[t._v("from rest_framework.authentication import "),e("font",{attrs:{color:"#FA7A00"}},[t._v("SessionAuthentication")])],1),e("div",[t._v("from rest_framework.authentication import "),e("font",{attrs:{color:"#FA7A00"}},[t._v("BasicAuthentication")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[t._v("class BookView(APIView):")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# ")]),e("font",{attrs:{color:"#41AD1C"}},[t._v("局部请求认证，只作用于当前视图的某几个请求")])],1),e("div",[t._v("    def "),e("font",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("get_authenticators")]),t._v("(self):  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 通过重写 rest-framework 的 get_authenticators 方法从而实现局部请求认证")])],1),e("div",[t._v("        if self.request.method == 'POST':  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 当请求是 POST 请求的时候，返回自定义的认证类，否则返回 rest-framework 默认的两个认证类")])],1),e("div",[t._v("            return [TokenAuth(), ]  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 自定义的认证类")])],1),e("div",[t._v("        else:")]),e("div",[t._v("            return ["),e("font",{attrs:{color:"#FA7A00"}},[t._v("SessionAuthentication()")]),t._v(", "),e("font",{attrs:{color:"#FA7A00"}},[t._v("BasicAuthentication()")]),t._v("]  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# rest-framework 默认返回的两个认证类")])],1),e("div",[e("br")]),e("div",[t._v("    def get(self, request, *args, **kwargs):")]),e("div",[t._v("        book_queryset = Book.objects.all()")]),e("div",[t._v("        ser = BookSerializers(instance=book_queryset, many=True)")]),e("div",[t._v("        return Response(ser.data)")]),e("div",[e("br")]),e("div",[t._v("    def post(self, request):")]),e("div",[t._v("        ser = BookSerializers(data=request.data)")]),e("div",[t._v("        if ser.is_valid():")]),e("div",[t._v("            ser.save()")]),e("div",[t._v("            return Response(ser.data)")]),e("div",[t._v("        else:")]),e("div",[t._v("            return Response(ser.errors)")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 获取以用户名作为盐，以当前时间作为加密内容的字符串token")])]),e("div",[t._v("def get_token_str(username):")]),e("div",[t._v("    now_time = str(time.time())")]),e("div",[t._v('    md5 = hashlib.md5(bytes(username, encoding="utf8"))  '),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 加盐，使用用户名作为盐，保证token的唯一性")])]),e("div",[t._v("    md5.update(bytes(now_time, encoding='utf-8'))")]),e("div",[t._v("    return md5.hexdigest()")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("# 登陆，并且返回当前用户的token")])]),e("div",[t._v("class LoginView(APIView):")]),e("div",[t._v("    def post(self, request):")]),e("div",[t._v("        username = request.data.get('username')")]),e("div",[t._v("        password = request.data.get('password')")]),e("div",[t._v("        user = User.objects.filter(username=username, password=password).first()")]),e("div",[t._v("        ret = {")]),e("div",[t._v("            'status': 0,")]),e("div",[t._v("            'msg': None")]),e("div",[t._v("        }")]),e("div",[t._v("        if user:")]),e("div",[t._v("            token_str = get_token_str(user.username)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 获取Token值")])]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 每次登陆成功后都要修改当前用户的token值")])]),e("div",[t._v("            Token.objects.update_or_create(user=user, defaults={'token': token_str})  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 如果有 user=user 这条数据，那么就修改 token 值，否则就进行添加")])]),e("div",[t._v("            ret['status'] = 1")]),e("div",[t._v("            ret['token'] = token_str")]),e("div",[t._v("        else:")]),e("div",[t._v("            ret['msg'] = '登陆失败'")]),e("div",[e("br")]),e("div",[t._v("        return Response(ret)")])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口说明: 登陆，获取token值")])]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/login/")])],1),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: POST")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 发送数据的编码格式: application/json -> 即: json 格式")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 所要发送的数据: ")]),t._v('{"username":"Kevin","password":"123"}')]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),e("div",[e("br")]),e("div",[t._v("{")]),e("div",[t._v('    "status": 1,')]),e("div",[t._v('    "msg": null,')]),e("div",[t._v('    "token": "4a70be5742f536bd78dad811c5044827"')]),e("div",[t._v("}")]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("# --------------------------------------------------------------")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口说明: 查看所有书籍")])]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/")])],1),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: GET")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),e("div",[e("br")]),e("div",[t._v("[")]),e("div",[t._v("    {")]),e("div",[t._v('        "id": 2,')]),e("div",[t._v('        "title": "三体（第二部）",')]),e("div",[t._v('        "price": 100,')]),e("div",[t._v('        "pub_date": "2012-12-12",')]),e("div",[t._v('        "publish": 1,')]),e("div",[t._v('        "authors": [')]),e("div",[t._v("            1,")]),e("div",[t._v("            2")]),e("div",[t._v("        ]")]),e("div",[t._v("    },")]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}}),t._v(" "),e("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco",color:"rgb(65, 173, 28)"}},[t._v("……")])]),e("div",[e("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[t._v("]")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("# --------------------------------------------------------------")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口说明: 添加书籍（带token值）")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("#")]),t._v(" "),e("font",{attrs:{color:"#41AD1C"}},[t._v("接口: http://127.0.0.1:8000/book/?token=4a70be5742f536bd78dad811c5044827")])],1),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: POST")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),e("div",[e("br")]),e("div",[t._v("{")]),e("div",[t._v('    "id": 3,')]),e("div",[t._v('    "title": "七大罪",')]),e("div",[t._v('    "price": 50,')]),e("div",[t._v('    "pub_date": "2020-04-08",')]),e("div",[t._v('    "production_date": "2020-04-08T07:06:16Z",')]),e("div",[t._v('    "publish": 1,')]),e("div",[t._v('    "authors": [')]),e("div",[t._v("        1,")]),e("div",[t._v("        2")]),e("div",[t._v("    ]")]),e("div",[t._v("}")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#FA7A00"}},[t._v("# --------------------------------------------------------------")])],1),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 添加书籍（不带token值）")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: POST")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),e("div",[e("br")]),e("div",[t._v("{")]),e("div",[t._v('    "msg": "验证失败",')]),e("div",[t._v('    "code": "1000"')]),e("div",[t._v("}")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("4.")]),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 全局认证")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt"}},[t._v("全局认证作用于所有视图类")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# rf_auth.py")])]),e("div",[e("br")]),e("div",[t._v("from rest_framework.authentication import BaseAuthentication")]),e("div",[t._v("from rest_framework import exceptions")]),e("div",[t._v("from .models import *")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[t._v("class TokenAuth(BaseAuthentication):")]),e("div",[t._v("    def authenticate(self, request):")]),e("div",[t._v('        token = request.GET.get("token")  '),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 从get请求中获取token值进行判断")])]),e("div",[t._v("        token_obj = Token.objects.filter(token=token).first()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 判断是否有当前token值的记录")])]),e("div",[t._v("        if token_obj:")]),e("div",[t._v("            return token_obj.user, token_obj.token")]),e("div",[t._v("        else:")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(' raise exceptions.AuthenticationFailed("验证失败!")  '),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 设置报错信息")])],1),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}}),t._v("raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1)]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 配置全局认证所需要的认证类的路径")])],1),e("div",[t._v("REST_FRAMEWORK = {")]),e("div",[t._v('    "DEFAULT_AUTHENTICATION_CLASSES": ["app01.rf_auth.TokenAuth"]')]),e("div",[t._v("}")])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[t._v("不进行认证的视图类设置")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[t._v("如果设置了全局认证，但是又想某些视图不进行认证，那么可以在不想进行认证的视图类中设置 authentication_classes = []，因为在 rest-framework 源码中 局部认证的配置 会覆盖掉 全局认证的配置")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[t._v("import hashlib")]),e("div",[t._v("import time")]),e("div",[e("br")]),e("div",[t._v("from django.shortcuts import render, HttpResponse")]),e("div",[t._v("from rest_framework.views import APIView")]),e("div",[t._v("from rest_framework.response import Response")]),e("div",[t._v("from .models import *")]),e("div",[t._v("from .serializer import *")]),e("div",[t._v("from .rf_auth import *")]),e("div",[e("br")]),e("div",[t._v("from rest_framework import viewsets")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[t._v("class BookViewSet(viewsets.ModelViewSet):")]),e("div",[t._v("    queryset = Book.objects.all()")]),e("div",[t._v("    serializer_class = BookSerializers")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[t._v("class PublishViewSet(viewsets.ModelViewSet):")]),e("div",[t._v("    queryset = Publish.objects.all()")]),e("div",[t._v("    serializer_class = PublishSerializers")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取以用户名作为盐，以当前时间作为加密内容的字符串token")])],1),e("div",[t._v("def get_token_str(username):")]),e("div",[t._v("    now_time = str(time.time())")]),e("div",[t._v('    md5 = hashlib.md5(bytes(username, encoding="utf8"))  '),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 加盐，使用用户名作为盐，保证token的唯一性")])],1),e("div",[t._v("    md5.update(bytes(now_time, encoding='utf-8'))")]),e("div",[t._v("    return md5.hexdigest()")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 登陆，并且返回当前用户的token")])],1),e("div",[t._v("class LoginView(APIView):")]),e("div",[e("font",{attrs:{color:"#FA7A00"}},[t._v("authentication_classes = []")]),t._v(" "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 在全局认证下，当前视图不进行认证")])],1),e("div",[e("br")]),e("div",[t._v("    def post(self, request):")]),e("div",[t._v("        username = request.data.get('username')")]),e("div",[t._v("        password = request.data.get('password')")]),e("div",[t._v("        user = User.objects.filter(username=username, password=password).first()")]),e("div",[t._v("        ret = {")]),e("div",[t._v("            'status': 0,")]),e("div",[t._v("            'msg': None")]),e("div",[t._v("        }")]),e("div",[t._v("        if user:")]),e("div",[t._v("            token_str = get_token_str(user.username)  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取Token值")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[t._v("# 每次登陆成功后都要修改当前用户的token值")])],1),e("div",[t._v("            Token.objects.update_or_create(user=user, defaults={'token': token_str})  "),e("font",{attrs:{color:"#41AD1C"}},[t._v("# 如果有 user=user 这条数据，那么就修改 token 值，否则就进行添加")])],1),e("div",[t._v("            ret['status'] = 1")]),e("div",[t._v("            ret['token'] = token_str")]),e("div",[t._v("        else:")]),e("div",[t._v("            ret['msg'] = '登陆失败'")]),e("div",[e("br")]),e("div",[t._v("        return Response(ret)")])]),e("div",[e("span",{staticStyle:{"font-family":'"Helvetica Neue"'}},[e("br")])])]),e("div",[e("br")]),e("div",[e("br")])])])])}),[],!1,null,null,null);o.default=r.exports}}]);