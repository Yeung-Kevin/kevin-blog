(window.webpackJsonp=window.webpackJsonp||[]).push([[202],{557:function(o,r,e){"use strict";e.r(r);var t=e(25),i=Object(t.a)({},(function(){var o=this,r=o.$createElement,e=o._self._c||r;return e("ContentSlotsDistributor",{attrs:{"slot-key":o.$parent.slotKey}},[e("div",[e("span",[e("div",[e("div",[e("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[e("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[o._v("SQLAchemy 的介绍")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[o._v("在日常开发中不会直接使用ORM框架，一般会在使用Django的时候使用Django自身的ORM框架，这里的只对ORM框架中SQLAchemy做了解就可以了，因为SQLAchemy的用法和Django中的ORM框架很类似")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"18.6667px",color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("在 ORM 框架中 一个类就是一张表，一个属性代表一个字段，一个对象就是一行数据")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"18.6667px"}},[o._v("ORM 框架有两类：")])]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[o._v("db first -> 先创建数据库和表，通过代码自动生成类和对象")])])]),e("li",[e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[o._v("code first -> 手动编写类和对象，然后通过类和对象生成表和数据")])])]),e("li",[e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[o._v("SQLAchemy 属于 code first 这一类，而 ")]),e("span",{staticStyle:{"font-size":"14pt"}},[o._v("Django 这两类都支持")])])])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("1.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("sqlalchemy的安装")])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("pip3 install sqlalchemy -i https://pypi.douban.com/simple "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 使用豆瓣的镜像")])])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("2.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("pymysql的安装")])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("pip3 install pymysql -i https://pypi.douban.com/simple "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 使用豆瓣的镜像")])])]),e("div",[e("br")]),e("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[e("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[o._v("单表操作")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("1.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("注意: ")]),e("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("SQLAchemy本身是无法操作数据库（因为")]),e("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("SQLAchemy本身只负责将代码转换为SQL语句")]),e("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("），必须使用 DBAPI（即: 第三方的操作数据库的模块，如：pymysql，mysqldb，……）来进行数据库的操作，")]),e("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("所以在使用")]),e("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("SQLAchemy前一定要下载")]),e("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("第三方的操作数据库的模块")])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)","font-size":"9pt","font-family":"Monaco"}},[o._v("# 根据配置文件的不同，调用不同的DBAPI，从而实现 ")]),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("sqlalchemy 对数据库的操作，（在操作数据库的时候，就要使用对应的第三方模块去操作数据库，而 SQLAchemy 想去使用这些模块就要进行相关的配置）如：")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# mysql 数据库")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("    # pymysql 模块")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(227, 0, 0)"}}),e("span",{staticStyle:{color:"rgb(0, 0, 0)"}},[o._v("mysql+pymysql://")]),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("数据库")]),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("用户名")]),e("span",{staticStyle:{color:"rgb(0, 0, 0)"}},[o._v(":")]),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("密码，如果没有密码可以空着不填")]),e("span",{staticStyle:{color:"rgb(0, 0, 0)"}},[o._v("@")]),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("ip地址")]),e("span",{staticStyle:{color:"rgb(0, 0, 0)"}},[o._v(":")]),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("端口号")]),e("span",{staticStyle:{color:"rgb(0, 0, 0)"}},[o._v("/")]),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("数据库名称")]),e("span",{staticStyle:{color:"rgb(0, 0, 0)"}},[o._v("?")]),e("span",{staticStyle:{color:"rgb(0, 0, 0)"}},[o._v("charset=utf8")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("    # ")]),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("mysqldb 模块")])]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}})]),e("div",[o._v("    mysql+mysqldb://"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("数据库用户名")]),o._v(":"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("密码，如果没有密码可以空着不填")]),o._v("@"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("ip地址")]),o._v(":"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("端口号")]),o._v("/"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("数据库名称")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# mysqlconnector 模块")])]),e("div"),e("div",[o._v("    mysql+mysqlconnector://"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("数据库用户名")]),o._v(":"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("密码，如果没有密码可以空着不填")]),o._v("@"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("ip地址")]),o._v(":"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("端口号")]),o._v("/"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("数据库名称")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# oracle 数据库")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("    # cx_oracle 模块")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}}),o._v("oracle+cx_oracle://"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("数据库用户名")]),o._v(":"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("密码，如果没有密码可以空着不填")]),o._v("@"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("ip地址")]),o._v(":"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("端口号")]),o._v("/"),e("span",{staticStyle:{color:"rgb(222, 87, 0)"}},[o._v("数据库名称")]),o._v("?key=value&key=value...")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("2.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("基本使用")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt",color:"rgb(227, 0, 0)"}},[o._v("注意: SQLAchemy 只支持创建表和删除表，不支持修改表，如果想修改表就要删除表后再重新添加 或者 使用第三方模块")])])])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt"}},[o._v("创建表 和 删除表")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[e("font",{attrs:{color:"#41AD1C"}},[o._v("# models.py")])],1)]),e("div",[e("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[e("br")])]),e("div",[o._v("from sqlalchemy.ext.declarative import declarative_base")]),e("div",[o._v("from sqlalchemy import create_engine")]),e("div",[o._v("from sqlalchemy import Column, Integer, String, VARCHAR, CHAR, ForeignKey, UniqueConstraint, Index")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("'''")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    Column -> 创建字段的方法")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    Integer -> 整型")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    String -> 字符串类型，包含了 char 和 varchar")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    ForeignKey -> 外键")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    UniqueConstraint -> 联合唯一索引")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    Index -> 联合普通索引")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    CHAR -> char")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    VARCHAR -> varchar")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("'''")])],1),e("div",[e("br")]),e("div",[o._v("Base = declarative_base()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建一个 Base 对象")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("#  Users 表的类")])],1),e("div",[o._v("class Users(Base):  "),e("font",{attrs:{color:"#FA7A00"}},[o._v("# 创建表的类一定要继承 Base")])],1),e("div",[o._v("    __tablename__ = 'users'  "),e("font",{attrs:{color:"#FA7A00"}},[o._v("# 表名")])],1),e("div",[o._v("    id = Column(Integer, primary_key=True, autoincrement=True)  "),e("font",{attrs:{color:"#FA7A00"}},[o._v("# 整型 设置主键 设置自增列")])],1),e("div",[o._v("    name = Column(VARCHAR(32), nullable=False, index=True)  "),e("font",{attrs:{color:"#FA7A00"}},[o._v("# varchar类型(长度：32) 不允许为空 将name字段设置为索引")])],1),e("div",[o._v("    age = Column(Integer)  "),e("font",{attrs:{color:"#FA7A00"}},[o._v("# 整形")])],1),e("div",[o._v("    address = Column(VARCHAR(32))  "),e("font",{attrs:{color:"#FA7A00"}},[o._v("# varchar类型(长度：32)")])],1),e("div",[o._v("    email = Column(String(32), unique=True)  "),e("font",{attrs:{color:"#FA7A00"}},[o._v("# varchar类型(长度：32) 或 char类型(长度：32) 将email字段设置为唯一索引")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建表")])],1),e("div",[o._v("def create_table():")]),e("div",[o._v("    engine = create_engine(")]),e("div",[o._v('        "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("        max_overflow=0,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 允许溢出多少个连接（即：连接池的连接已满后，还可以创建多少条连接）")])],1),e("div",[o._v("        pool_size=5,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中的连接数")])],1),e("div",[o._v("        pool_timeout=10,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中没有线程后最多等待的时间（单位：秒），如果超过指定时间还没有连接就报错")])],1),e("div",[o._v("        pool_recycle=-1  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 多久之后对线程池中的线程进行一次连接的回收（重置）（单位：秒）-> -1表示不重置")])],1),e("div",[o._v("    )")]),e("div",[o._v("    Base.metadata.create_all(engine)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 找到所有继承了 Base 的类，将这些类转换成SQL语句，然后通过第三方模块pymysql执行SQL语句创建表")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 删除表")])],1),e("div",[o._v("def drop_table():")]),e("div",[o._v("    engine = create_engine(")]),e("div",[o._v('        "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("        max_overflow=0,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 允许溢出多少个连接（即：连接池的连接已满后，还可以创建多少条连接）")])],1),e("div",[o._v("        pool_size=5,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中的连接数")])],1),e("div",[o._v("        pool_timeout=10,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中没有线程后最多等待的时间（单位：秒），如果超过指定时间还没有连接就报错")])],1),e("div",[o._v("        pool_recycle=-1  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 多久之后对线程池中的线程进行一次连接的回收（重置）（单位：秒）-> -1表示不重置")])],1),e("div",[o._v("    )")]),e("div",[o._v("    Base.metadata.drop_all(engine)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 找到所有继承了 Base 的类，将这些类转换成SQL语句，然后通过第三方模块pymysql执行SQL语句删除表")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[o._v("if __name__ == '__main__':")]),e("div",[o._v("    create_table()")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v(" #")]),o._v(" drop_table()")],1)]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("操作数据")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# xxx.py")])],1),e("div",[e("br")]),e("div",[o._v("from sqlalchemy.orm import sessionmaker")]),e("div",[o._v("from sqlalchemy import create_engine")]),e("div",[o._v("from models import Users")]),e("div",[e("br")]),e("div",[o._v("engine = create_engine(")]),e("div",[o._v('    "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("    max_overflow=0,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 允许溢出多少个连接（即：连接池的连接已满后，还可以创建多少条连接）")])],1),e("div",[o._v("    pool_size=5, "),e("font",{attrs:{color:"#41AD1C"}},[o._v(" # 连接池中的连接数")])],1),e("div",[o._v("    pool_timeout=10,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中没有线程后最多等待的时间（单位：秒），如果超过指定时间还没有连接就报错")])],1),e("div",[o._v("    pool_recycle=-1  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 多久之后对线程池中的线程进行一次连接的回收（重置）（单位：秒）-> -1表示不重置")])],1),e("div",[o._v(")")]),e("div",[e("br")]),e("div",[o._v("SessionFactory = sessionmaker(bind=engine)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池")])],1),e("div",[o._v("session = SessionFactory()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 从连接池中获取一条连接对表进行操作")])],1),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 添加数据")])],1),e("div",[o._v("data_objs = [")]),e("div",[o._v("    Users(name='Kevin', age=18, address='横沥', email='12@qq.com'),")]),e("div",[o._v("    Users(name='Yeung', age=23, address='横沥', email='13@qq.com'),")]),e("div",[o._v("    Users(name='Aimer', age=25, address='南城', email='23@qq.com'),")]),e("div",[o._v("    Users(name='Timmy', age=25, address='万江', email='32@qq.com'),")]),e("div",[o._v("    Users(name='Jack', age=30, address='石排', email='31@qq.com'),")]),e("div",[o._v("]")]),e("div",[o._v("session.add_all(data_objs)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 批量添加数据 insert into users(name,age,address,utid) values('Kevin',18,'横沥',3), ('Yeung',23,'横沥',3), ……")])],1),e("div",[o._v("session.commit()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 事务: 提交数据到数据库 -> 一定执行 .commit() 方法 将数据提交到数据库，不然会没有效果")])],1),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 查询数据")])],1),e("div",[o._v("ret = session.query(Users.name, Users.address).all()")]),e("div",[o._v("print(ret)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# [('Kevin', '横沥'), ('Yeung', '横沥'), ……]")])],1),e("div",[e("br")]),e("div",[o._v("session.close()  "),e("font",{attrs:{color:"#FA7A00"}},[o._v("# 将连接交还给连接池")])],1)]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("3.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("当前栏目所使用的表")])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# models.py")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[o._v("from sqlalchemy.ext.declarative import declarative_base")]),e("div",[o._v("from sqlalchemy import create_engine")]),e("div",[o._v("from sqlalchemy import Column, Integer, VARCHAR")]),e("div",[e("br")]),e("div",[o._v("Base = declarative_base()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建一个 Base 对象")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("#  Users 表的类")])],1),e("div",[o._v("class Users(Base):  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建表的类一定要继承 Base")])],1),e("div",[o._v("    __tablename__ = 'users'  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 表名")])],1),e("div",[o._v("    id = Column(Integer, primary_key=True, autoincrement=True)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 整型 设置主键 设置自增列")])],1),e("div",[o._v("    name = Column(VARCHAR(32), nullable=False, index=True)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# varchar类型(长度：32) 不允许为空 将name字段设置为索引")])],1),e("div",[o._v("    age = Column(Integer)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 整形")])],1),e("div",[o._v("    address = Column(VARCHAR(32))  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# varchar类型(长度：32)")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建表")])],1),e("div",[o._v("def create_table():")]),e("div",[o._v("    engine = create_engine(")]),e("div",[o._v('        "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("        max_overflow=0,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 允许溢出多少个连接（即：连接池的连接已满后，还可以创建多少条连接）")])],1),e("div",[o._v("        pool_size=5,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中的连接数")])],1),e("div",[o._v("        pool_timeout=10,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中没有线程后最多等待的时间（单位：秒），如果超过指定时间还没有连接就报错")])],1),e("div",[o._v("        pool_recycle=-1  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 多久之后对线程池中的线程进行一次连接的回收（重置）（单位：秒）-> -1表示不重置")])],1),e("div",[o._v("    )")]),e("div",[o._v("    Base.metadata.create_all(engine)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 找到所有继承了 Base 的类，将这些类转换成SQL语句，然后通过第三方模块pymysql执行SQL语句创建表")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 删除表")])],1),e("div",[o._v("def drop_table():")]),e("div",[o._v("    engine = create_engine(")]),e("div",[o._v('        "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("        max_overflow=0,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 允许溢出多少个连接（即：连接池的连接已满后，还可以创建多少条连接）")])],1),e("div",[o._v("        pool_size=5,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中的连接数")])],1),e("div",[o._v("        pool_timeout=10, "),e("font",{attrs:{color:"#41AD1C"}},[o._v(" # 连接池中没有线程后最多等待的时间（单位：秒），如果超过指定时间还没有连接就报错")])],1),e("div",[o._v("        pool_recycle=-1  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 多久之后对线程池中的线程进行一次连接的回收（重置）（单位：秒）-> -1表示不重置")])],1),e("div",[o._v("    )")]),e("div",[o._v("    Base.metadata.drop_all(engine)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 找到所有继承了 Base 的类，将这些类转换成SQL语句，然后通过第三方模块pymysql执行SQL语句删除表")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[o._v("if __name__ == '__main__':")]),e("div",[o._v("    create_table()")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("#")]),o._v(" drop_table()")],1)]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# xxx.py")])],1),e("div",[e("br")]),e("div",[o._v("from sqlalchemy.orm import sessionmaker")]),e("div",[o._v("from sqlalchemy import create_engine")]),e("div",[o._v("from models import Users")]),e("div",[e("br")]),e("div",[o._v("engine = create_engine(")]),e("div",[o._v('    "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("    max_overflow=0,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 允许溢出多少个连接（即：连接池的连接已满后，还可以创建多少条连接）")])],1),e("div",[o._v("    pool_size=5,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中的连接数")])],1),e("div",[o._v("    pool_timeout=10,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中没有线程后最多等待的时间（单位：秒），如果超过指定时间还没有连接就报错")])],1),e("div",[o._v("    pool_recycle=-1  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 多久之后对线程池中的线程进行一次连接的回收（重置）（单位：秒）-> -1表示不重置")])],1),e("div",[o._v(")")]),e("div",[e("br")]),e("div",[o._v("SessionFactory = sessionmaker(bind=engine)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池")])],1),e("div",[o._v("session = SessionFactory()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 从连接池中获取一条连接对表进行操作")])],1),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 添加数据")])],1),e("div",[o._v("data_objs = [")]),e("div",[o._v("    Users(name='Kevin', age=18, address='横沥'),")]),e("div",[o._v("    Users(name='Yeung', age=23, address='横沥'),")]),e("div",[o._v("    Users(name='Aimer', age=25, address='南城'),")]),e("div",[o._v("    Users(name='Timmy', age=25, address='万江'),")]),e("div",[o._v("    Users(name='Jack', age=30, address='石排'),")]),e("div",[o._v("]")]),e("div",[o._v("session.add_all(data_objs)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 批量添加数据 -> insert into users(name,age,address,utid) values('Kevin',18,'横沥',3), ('Yeung',23,'横沥',3), ……")])],1),e("div",[o._v("session.commit()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 事务: 提交数据到数据库 -> 一定执行 .commit() 方法 将数据提交到数据库，不然会没有效果")])],1),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 查询数据")])],1),e("div",[o._v("ret = session.query(Users.name, Users.address).all()")]),e("div",[o._v("print(ret)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# [('Kevin', '横沥'), ('Yeung', '横沥'), ……]")])],1),e("div",[e("br")]),e("div",[o._v("session.close()  "),e("font",{attrs:{color:"#FA7A00"}},[o._v("# 将连接交还给连接池")])],1)]),e("div",[e("br")]),e("div",[e("img",{attrs:{"data-filename":"TIM截图20191002163813.jpg",src:"/kevin-blog/Python/SQLAchemy 模块_files/TIM截图20191002163813.jpg",type:"image/jpeg"}})]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("4.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("添加数据")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt",color:"rgb(227, 0, 0)"}},[o._v("注意: 在进行添加/修改/删除数据的时候一定执行 .commit() 方法 将数据提交到数据库，不然会没有效果")])])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt"}},[o._v("添加一条数据")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 表的类名(字段名='数据')")])]),e("div",[e("br")]),e("div",[o._v("data_obj1 = Users(name='Aimer', age=25, address='南城', utid=1)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 创建一个对象，该对象就代表着一条数据  # ")]),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("insert into users(name,age,address,utid) values('Kevin',18,'横沥',3)")])]),e("div",[o._v("session.add(data_obj1)")]),e("div",[o._v("session.commit()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 事务: 提交数据到数据库 -> 一定执行 .commit() 方法 将数据提交到数据库，不然会没有效果")])],1)]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("批量添加数据")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("data_objs = [")]),e("div",[o._v("    Users(name='Kevin', age=18, address='横沥', utid=3),")]),e("div",[o._v("    Users(name='Yeung', age=23, address='横沥', utid=3),")]),e("div",[o._v("    Users(name='Aimer', age=25, address='南城', utid=1),")]),e("div",[o._v("    Users(name='Timmy', age=25, address='万江', utid=2),")]),e("div",[o._v("    Users(name='Jack', age=30, address='石排', utid=1),")]),e("div",[o._v("]")]),e("div",[o._v("session.add_all(data_objs)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# insert into users(name,age,address,utid) values('Kevin',18,'横沥',3), ('Yeung',23,'横沥',3), ……")])]),e("div",[o._v("session.commit()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 事务: 提交数据到数据库 -> 一定执行 .commit() 方法 将数据提交到数据库，不然会没有效果")])],1)]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("5.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("查询数据")])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt"}},[o._v("获取查询到的数据")])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v(".all() -> 获取查询到的所有数据")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ret = session.query(Users.name, Users.address).all()")]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Kevin', '横沥'), ('Yeung', '横沥'), ……]")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v(".first() -> 获取查询到的所有数据的第一条数据")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ret = session.query(Users.name, Users.address).first()")]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# ('Kevin', '横沥')")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt"}},[o._v("在查询数据的时候如果不加 .all() 或 .first() 会返回一个迭代器，直接循环迭代器获取查询到数据")])])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ret = session.query(Users.name, Users.address)")]),e("div",[o._v("for row in ret:")]),e("div",[o._v("    print(row)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# ('Kevin', '横沥')")])]),e("div",[o._v("    print(row[0])  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# Kevin")])]),e("div",[o._v("    print(row.name)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# Kevin")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt",color:"rgb(227, 0, 0)"}},[o._v("注意: 在查询数据的时候如果不加 .all() 或 .first() 打印会返回一条 SQL 语句")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{"font-size":"9pt"}},[o._v("ret = session.query(Users)")])]),e("div",[e("span",{staticStyle:{"font-size":"9pt"}},[o._v("print(ret)  ")]),e("span",{staticStyle:{"font-size":"9pt",color:"rgb(65, 173, 28)"}},[o._v("# select id, name from users;")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt"}},[o._v("查询该表的所有数据 -> 相当于 select * from 表名; ->")]),o._v(" "),e("span",{staticStyle:{"font-size":"12pt",color:"rgb(227, 0, 0)"}},[o._v("不建议使用")])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("注意: 如果直接传入一个类名查询该表的所有字段的数据，那么返回值是一个对象列表，需要循环该对象列表获取该表所需要字段的数据")])])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# session.query(表的类名).all()")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 将表的类名传入到 query 中，就可以查询到该表的所有数据")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [<__main__.Users object at 0x00000281308CE898>, ……]")])]),e("div",[o._v("for row in ret:")]),e("div",[o._v("    print(row.name, row.age, row.address)")])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("查询某几列的数据 -> 相当于 select 字段名,字段名 from 表名;")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# session.query(表的类名.字段名, 表的类名.字段名, ……).all()")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users;")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Kevin', '横沥'), ('Yeung', '横沥'), ……]")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("给表起别名")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 导入 aliased")])]),e("div",[e("br")]),e("div",[o._v("from sqlalchemy.orm import aliased")])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# aliased(表的类名, name='别名')")])]),e("div",[e("br")]),e("div",[o._v("users_alias = aliased(Users, name='users_alias')")]),e("div",[e("br")]),e("div",[o._v("ret = session.query(users_alias.name, users_alias.address).all()")]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Kevin', '横沥'), ('Yeung', '横沥'), ……]")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("给要查询的字段起别名")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("使用 .label('字段别名') 给字段起别名")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ret = session.query(Users.name"),e("font",{attrs:{color:"#FA7A00"}},[o._v(".label('")]),o._v("cname"),e("font",{attrs:{color:"#FA7A00"}},[o._v("')")]),o._v(", Users.address"),e("font",{attrs:{color:"#FA7A00"}},[o._v(".label('")]),o._v("dz"),e("font",{attrs:{color:"#FA7A00"}},[o._v("')")]),o._v(").all()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# select name as cname, address as dz from users;")])],1),e("div",[o._v("print(ret)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# [('Kevin', '横沥'), ('Yeung', '横沥'), ……]")])],1)]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("条件查询 -> filter")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("filter 在进行比较的时候直接使用 表的类名.字段名 == 'xxx'")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# .filter(表的类名.字段名 ==/>/</>=/<= 'xxx')")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).filter(Users.id > 3).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users where id > 3;")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Timmy', '万江'), ('Jack', '石排')]")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# .filter(表的类名.字段名 ")]),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("==/>/</>=/<=")]),o._v(" "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("'xxx')")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).filter(Users.id == 3).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users where id = 3;")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Aimer', '南城')]")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# .filter(表的类名.字段名 == 'xxx', 表的类名.字段名 > 'xxx', 表的类名.字段名 < 'xxx', ……)")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).filter(Users.id >= 3, Users.id <= 5, Users.age == 25).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users where id >= 3 and id <= 5 and age = 25;")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Aimer', '南城'), ('Timmy', '万江')]")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("条件查询 -> filter_by")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("注意: filter_by 只能进行 = 的条件查询，不能进行其他的条件查询，如: > <")])])]),e("li",[e("div",[o._v("filter_by 在进行比较的时候直接使用 字段名 = 'xxx'")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# .filter_by(字段名='xxx')")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).filter_by(id=3).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users where id = 3; ")])]),e("div",[o._v("print(ret) "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v(" # [('Aimer', '南城')]")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# .filter_by(字段名='xxx', 字段名='xxx', ……)")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).filter_by(id=1, name='Kevin').all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users where id = 1 and name = 'Kevin';")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Kevin', '横沥')]")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("or_ 和 and_")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("注意: filter 和 filter_by 默认使用 and 进行条件查询，如果要使用 or 就要将 or_ 导入进来，且 filter_by 不能使用 or_ 和 and_")])])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco",color:"rgb(65, 173, 28)"}},[o._v("# 导入 or_ 和 and_")])]),e("div",[e("br")]),e("div",[o._v("from sqlalchemy import or_, and_")])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# or_(表的类名.字段名 == 'xxx', 表的类名.字段名 > 'xxx', 表的类名.字段名 < 'xxx', ……)")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).filter(or_(Users.id == 5, Users.id == 6)).all() "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v(" # select name,address from users where id = 5 or id = 6;")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Jack', '石排')]")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# and_(表的类名.字段名 == 'xxx', 表的类名.字段名 > 'xxx', 表的类名.字段名 < 'xxx', ……)")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).filter(and_(Users.id == 1, Users.name == 'Kevin')).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users where id = 1 and name = 'Kevin';")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Kevin', '横沥')]")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# or_ 和 and_ 混合使用")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[o._v("ret = session.query(Users.name, Users.address).filter(")]),e("div",[o._v("    or_(")]),e("div",[o._v("        Users.age <= 18,")]),e("div",[o._v("        and_(Users.name == 'Yeung', Users.age == '23'),")]),e("div",[o._v("    )")]),e("div",[o._v(").all() "),e("font",{attrs:{color:"#41AD1C"}},[o._v(" # select name,address from users where age <= 18 or (name='Yeung' and age = 23);")])],1),e("div",[o._v("print(ret)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# [('Kevin', '横沥'), ('Yeung', '横沥')]")])],1)]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("between")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco",color:"rgb(65, 173, 28)"}},[o._v("# .between(num, num)")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).filter(Users.id.between(1, 3)).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users where id between 1 and 3;")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Kevin', '横沥'), ('Yeung', '横沥'), ('Aimer', '南城')]")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("in_")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# .in_([xx, xx, xx, ……])")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).filter(Users.id.in_([1, 3])).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users where id in(1,3);")])]),e("div",[o._v("print(ret) "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v(" # ")]),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("[('Kevin', '横沥'), ('Aimer', '南城')]")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# ~表的类名.字段名.in_([xx, xx, xx, ……]) ")]),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("等于 not in")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).filter(~Users.id.in_([1, 3])).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users where id not in(1,3);")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Yeung', '横沥'), ('Timmy', '万江'), ('Jack', '石排')]")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("模糊查询")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("% 通配符 -> 代表任意多个字符")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco",color:"rgb(65, 173, 28)"}},[o._v("# .like('%xxx%')")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).filter(Users.name.like('%e%')).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users where name like '%e%';")])]),e("div",[o._v("print(ret) "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v(" # [('Kevin', '横沥'), ('Yeung', '横沥'), ('Aimer', '南城')]")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("_ 通配符 -> 代表任意一个字符")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# .like('xxx_')")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[o._v("ret = session.query(Users.name, Users.address).filter(Users.name.like('Yeun_')).all()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# select name,address from users where name like 'Yeun_';")])],1),e("div",[o._v("print(ret)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# [('Yeung', '横沥')]")])],1)]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# % 和 _ 通配符的混合使用")])],1),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).filter(Users.name.like('%e_')).all()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# select name,address from users where name like '%e_';")])],1),e("div",[o._v("print(ret)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# [('Aimer', '南城')]")])],1)]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# ~表的类名.字段名.like('%xxx%') 等于 not like")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address).filter(~Users.name.like('%e%')).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users where name not like '%e%';")])]),e("div",[o._v("print(ret) "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v(" # [('Timmy', '万江'), ('Jack', '石排')]")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("分页")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 直接在查询到的数据后面进行切片")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address)[0:2]  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users limit 0,2")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Kevin', '横沥'), ('Yeung', '横沥')]")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("排序")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ret = session.query(Users.id, Users.name, Users.age).order_by(Users.age.desc()).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select id,name,age from users order by age desc;")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [(5, 'Jack', 30), (3, 'Aimer', 25), (4, 'Timmy', 25), (2, 'Yeung', 23), (1, 'Kevin', 18)]")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 对相同数据的进行二次排序")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.id, Users.name, Users.age).order_by(Users.age.desc(), Users.id.desc()).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select id,name,age from users order by age desc, id desc;")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [(5, 'Jack', 30), (4, 'Timmy', 25), (3, 'Aimer', 25), (2, 'Yeung', 23), (1, 'Kevin', 18)]")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("聚合函数")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("通过 func 使用聚合函数")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 导入 func")])]),e("div",[e("br")]),e("div",[o._v("from sqlalchemy.sql import func")])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ret = session.query(")]),e("div",[o._v("    func.max(Users.age),")]),e("div",[o._v("    func.min(Users.age),")]),e("div",[o._v("    func.count(Users.id),")]),e("div",[o._v("    func.sum(Users.age),")]),e("div",[o._v("    func.avg(Users.age)")]),e("div",[o._v(").all()")]),e("div",[e("br")]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [(30, 18, 5, Decimal('121'), Decimal('24.2000'))]")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("分组")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 导入 func，使用聚合函数")])]),e("div",[e("br")]),e("div",[o._v("from sqlalchemy.sql import func")])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ret = session.query(")]),e("div",[o._v("    Users.age,")]),e("div",[o._v("    func.count(Users.age)")]),e("div",[o._v(").group_by(Users.age).all()")]),e("div",[e("br")]),e("div",[o._v("print(ret) "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v(" # [(18, 1), (23, 1), (25, 2), (30, 1)]")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("having（）")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ret = session.query(")]),e("div",[o._v("    Users.age,")]),e("div",[o._v("    func.count(Users.age)")]),e("div",[o._v(").group_by(Users.age).having(func.count(Users.age) >= 2).all()")]),e("div",[e("br")]),e("div",[o._v("print(ret) "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v(" # [(25, 2)]")])])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("6.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("修改数据")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt",color:"rgb(227, 0, 0)"}},[o._v("注意: 在进行添加/修改/删除数据的时候一定执行 .commit() 方法 将数据提交到数据库，不然会没有效果")])])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("返回值: 受影响行数的数量")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# .update()")])]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 写法一")])],1),e("div",[o._v('ret = session.query(Users).filter(Users.id > 2).update({Users.name: "临时用户"})  '),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# update users set name = '临时用户' where id > 2;")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 写法二")])]),e("div",[o._v('ret = session.query(Users).filter(Users.id > 2).update({"name": "临时用户"})  '),e("font",{attrs:{color:"#41AD1C"}},[o._v("# update users set name = '临时用户' where id > 2;")])],1),e("div",[e("br")]),e("div",[o._v("session.commit()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 事务: 提交数据到数据库 -> 一定执行 .commit() 方法 将数据提交到数据库，不然会没有效果")])],1),e("div",[e("span",{staticStyle:{color:"rgb(0, 0, 0)"}},[o._v("print(ret) ")]),o._v(" "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 3")])])]),e("div",[e("br")]),e("div",[e("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Python/SQLAchemy 模块_files/Image.png",type:"image/png"}})]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("在字符串类型的数据后面拼接上其他字符串")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("session.query(Users).filter(Users.id > 2).update({Users.name: Users.name + '_test'}, synchronize_session=False)")]),e("div",[o._v("session.commit()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 事务: 提交数据到数据库 -> 一定执行 .commit() 方法 将数据提交到数据库，不然会没有效果")])],1)]),e("div",[e("br")]),e("div",[e("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Python/SQLAchemy 模块_files/Image [1].png",type:"image/png"}})]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("在数字类型的数据基础上进行运算")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("session.query(Users).filter(Users.id > 2).update({Users.age: Users.age * 100}, synchronize_session='evaluate')")]),e("div",[o._v("session.commit()  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 事务: 提交数据到数据库 -> 一定执行 .commit() 方法 将数据提交到数据库，不然会没有效果")])],1)]),e("div",[e("br")]),e("div",[e("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Python/SQLAchemy 模块_files/Image [2].png",type:"image/png"}})]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("7.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("删除数据")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt",color:"rgb(227, 0, 0)"}},[o._v("注意: 在进行添加/修改/删除数据的时候一定执行 .commit() 方法 将数据提交到数据库，不然会没有效果")])])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt"}},[o._v("返回值: 受影响行数的数量")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# .delete()")])]),e("div",[e("br")]),e("div",[o._v("session.query(Users).filter(Users.id > 2).delete()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# delete from users where id>2;")])]),e("div",[o._v("session.commit() "),e("font",{attrs:{color:"#41AD1C"}},[o._v(" # 事务: 提交数据到数据库 -> 一定执行 .commit() 方法 将数据提交到数据库，不然会没有效果")])],1)]),e("div",[e("br")]),e("div",[e("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Python/SQLAchemy 模块_files/Image [3].png",type:"image/png"}})]),e("div",[e("br")]),e("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[e("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[o._v("一对多")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("1.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("创建一对多的表结构")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("from sqlalchemy.ext.declarative import declarative_base")]),e("div",[o._v("from sqlalchemy import create_engine")]),e("div",[o._v("from sqlalchemy import Column, Integer, VARCHAR, ForeignKey")]),e("div",[o._v("from sqlalchemy.orm import relationship")]),e("div",[e("br")]),e("div",[o._v("Base = declarative_base()")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 用户表")])],1),e("div",[o._v("class Users(Base):")]),e("div",[o._v("    __tablename__ = 'users'")]),e("div",[o._v("    id = Column(Integer, primary_key=True, autoincrement=True)")]),e("div",[o._v("    name = Column(VARCHAR(32), nullable=False, index=True)")]),e("div",[o._v("    age = Column(Integer)")]),e("div",[o._v("    address = Column(VARCHAR(32))")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 语法: ForeignKey('小写的表名（表类名）.字段名')")])],1),e("div",[e("font",{attrs:{color:"#FA7A00"}},[o._v("utid = Column(Integer, ForeignKey('usertype.id'))")]),o._v(" "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建外键")])],1),e("div",[e("font",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    # 语法: 正向查询所使用的字段名")])],1),e("font",{attrs:{color:"#41AD1C"}},[o._v(" = relationship('表类名', backref='反向查询所使用的名字')")])],1),e("div",[e("font",{staticStyle:{color:"rgb(250, 122, 0)"}},[o._v("user_type = relationship('UserType', backref='xxoo') ")]),o._v(" "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 简化连表获取数据操作的字段，且不会在数据库中生成字段")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 用户类型表")])],1),e("div",[o._v("class UserType(Base):")]),e("div",[o._v("    __tablename__ = 'usertype'")]),e("div",[o._v("    id = Column(Integer, primary_key=True, autoincrement=True)")]),e("div",[o._v("    title = Column(VARCHAR(32))")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建表")])],1),e("div",[o._v("def create_table():")]),e("div",[o._v("    engine = create_engine(")]),e("div",[o._v('        "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("        max_overflow=0,")]),e("div",[o._v("        pool_size=5,")]),e("div",[o._v("        pool_timeout=10,")]),e("div",[o._v("        pool_recycle=-1")]),e("div",[o._v("    )")]),e("div",[o._v("    Base.metadata.create_all(engine)")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 删除表")])],1),e("div",[o._v("def drop_table():")]),e("div",[o._v("    engine = create_engine(")]),e("div",[o._v('        "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("        max_overflow=0,")]),e("div",[o._v("        pool_size=5,")]),e("div",[o._v("        pool_timeout=10,")]),e("div",[o._v("        pool_recycle=-1")]),e("div",[o._v("    )")]),e("div",[o._v("    Base.metadata.drop_all(engine)")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[o._v("if __name__ == '__main__':")]),e("div",[o._v("    create_table()")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("#")]),o._v(" drop_table()")],1)]),e("div",[e("br")]),e("div",[e("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Python/SQLAchemy 模块_files/Image [4].png",type:"image/png"}})]),e("div",[e("br")]),e("div",[e("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Python/SQLAchemy 模块_files/Image [5].png",type:"image/png"}})]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("2.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("查询数据")])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("连表")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("方法一")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ret = session.query(Users.name, Users.age, UserType.title).filter(Users.utid == UserType.id).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select users.name, users.age, usertype.title from users, usertype where users.utid = usertype.id;")])]),e("div",[o._v("print(ret) "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Aimer', 25, '超级会员'), ('Jack', 30, '超级会员'), ('Timmy', 25, '白金会员'), ('Kevin', 18, '黑金会员'), ('Yeung', 23, '黑金会员')]")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("方法二 -> .join() -> 在默认情况下 .join() 会使用 inner join 进行连表查询")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 如果不加条件进行连表 .join() 会默认使用外键进行判断连表")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address, UserType.title).join(UserType).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select users.name, users.address, usertype.title from users inner join usertype on users.utid = usertype.id;")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Aimer', '南城', '超级会员'), ('Jack', '石排', '超级会员'), ('Timmy', '万江', '白金会员'), ('Kevin', '横沥', '黑金会员'), ('Yeung', '横沥', '黑金会员')]")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco",color:"rgb(65, 173, 28)"}},[o._v("# 使用条件进行连表，在大多数情况都会使用外键进行判断连表，所以可以直接省略条件判断，这里只是为了做演示而已")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address, UserType.title).join(UserType, Users.utid == UserType.id).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select users.name, users.address, usertype.title from users inner join usertype on users.utid = usertype.id;")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Aimer', '南城', '超级会员'), ('Jack', '石排', '超级会员'), ('Timmy', '万江', '白金会员'), ('Kevin', '横沥', '黑金会员'), ('Yeung', '横沥', '黑金会员')]")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# isouter=True 将 inner join 该变成 left join")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users.name, Users.address, UserType.title).join(UserType, isouter=True).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select users.name, users.address, usertype.title from users left join usertype on usertype.id = users.utid;")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Aimer', '南城', '超级会员'), ('Jack', '石排', '超级会员'), ('Timmy', '万江', '白金会员'), ('Kevin', '横沥', '黑金会员'), ('Yeung', '横沥', '黑金会员')]")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("方法三 -> .union() 和 .union_all() -> 上下连表")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# .union() -> 没有去重功能")])]),e("div",[e("br")]),e("div",[o._v("q1 = session.query(Users.name).filter(Users.id <= 2)")]),e("div",[o._v("q2 = session.query(UserType.title)")]),e("div",[o._v("ret = q1.union(q2).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name from users where id <= 2 union select title from usertype;")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Kevin',), ('Yeung',), ('超级会员',), ('白金会员',), ('黑金会员',)]")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# .union_all() -> 自带去重功能")])]),e("div",[e("br")]),e("div",[o._v("q1 = session.query(Users.name).filter(Users.id <= 2)")]),e("div",[o._v("q2 = session.query(UserType.title)")]),e("div",[o._v("ret = q1.union_all(q2).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name from users where id <= 2 union all select title from usertype;")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Kevin',), ('Yeung',), ('超级会员',), ('白金会员',), ('黑金会员',)]")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("relationship() -> 简化连表获取数据的操作 -> 在 ")]),e("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("django 中也有类似操作")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 导入 relationship")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(0, 0, 0)"}},[o._v("from sqlalchemy.orm import ")]),o._v("relationship")])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("relationship('从表的类名', backref='从表使用的变量名')")])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[o._v('backref="从表使用的变量名"，所定义的变量名是给当从表获取主表数据的时候使用')])]),e("li",[e("div",[o._v("在主表类中（即：有外键的类）中调用 relationship() 方法，且 relationship() 不会影响表的创建")])])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("class Users(Base):")]),e("div",[o._v("    __tablename__ = 'users'")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("…………")])]),e("div",[e("br")]),e("div",[o._v("    user_type = relationship('UserType', backref='xxoo')")])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("正向查询 -> 主表获取从表的数据")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("# 当调用了 relationship() 方法的时候，会将从表的所有数据放进 user_type 变量里面，")]),e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("当要获取")]),e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("与主表数据相关的从表数据")]),e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("的")]),e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("时候，user_type 就会返回与主表数据相关的从表数据的对象")])]),e("div",[e("br")]),e("div",[o._v("ret = session.query(Users).all()")]),e("div",[o._v("for row in ret:")]),e("div",[o._v("    print(row.user_type.__dict__)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x000002C281E56AC8>, 'title': '黑金会员', 'id': 3}")])]),e("div",[o._v("    print(row.name, row.address, row.user_type.title) "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v(" # Kevin 横沥 黑金会员")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("反向查询 -> 从表获取主表的数据")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("# 当调用了 relationship() 方法的时候，会将主表的所有数据放进 xxoo 变量里面，当要获取与从表数据相关的主表数据的时候，xxoo 就会返回与从表数据相关的主表数据的列表")])]),e("div",[e("br")]),e("div",[o._v("ret2 = session.query(UserType).all()")]),e("div",[o._v("for row in ret2:")]),e("div",[o._v("    print(row.title, row.xxoo)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 超级会员 [<__main__.Users object at 0x000001830D6E71D0>, <__main__.Users object at 0x000001830D6E7240>]")])]),e("div",[o._v("    print(row.xxoo[0].name)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# Aimer")])])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("3.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("添加")]),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("数据")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt"}},[o._v("例子: 创建一个用户类型为: 超级会员，然后再往该用户类型中添加一个用户: Amy")])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("方式一")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ut_obj = UserType(title='超级会员')")]),e("div",[o._v("session.add(ut_obj)")]),e("div",[o._v("session.commit()")]),e("div",[e("br")]),e("div",[o._v("user_obj = Users(name='Amy', age=25, address='南城', utid=ut_obj.id)")]),e("div",[o._v("session.add(user_obj)")]),e("div",[o._v("session.commit()")])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("方式二")])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[o._v("通过 relationship 字段添加数据")])])])])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("data_obj = Users(name='Amy', age=25, address='南城', user_type=UserType(title='超级会员'))")]),e("div",[o._v("session.add(data_obj)")]),e("div",[o._v("session.commit()")])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("例子: 创建一个用户类型为: VVIP，"),e("span",{staticStyle:{"font-size":"12pt"}},[o._v("然后再往该用户类型中添加多个用户: Eric，")]),o._v("Peggy，……")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ut_obj = UserType(title='VVIP')")]),e("div",[o._v("ut_obj.xxoo = [")]),e("div",[o._v("    Users(name='Eric', age=18, address='凤岗'),")]),e("div",[o._v("    Users(name='Peggy', age=32, address='莞城'),")]),e("div",[o._v("    Users(name='Brie', age=22, address='石碣'),")]),e("div",[o._v("]")]),e("div",[o._v("session.add(ut_obj)")]),e("div",[o._v("session.commit()")])]),e("div",[e("br")]),e("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[e("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[o._v("多对多")])]),e("div",[e("br")]),e("div",[e("font",{staticStyle:{color:"rgb(227, 0, 0)","font-size":"14pt"}},[o._v("注意: 在 SQLAchemy 中需要自行创建第三张表")])],1),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("1.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("创建多对多的表结构")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt"}},[o._v("创建表和删除表")])])])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# models.py")])],1),e("div",[e("br")]),e("div",[o._v("from sqlalchemy.ext.declarative import declarative_base")]),e("div",[o._v("from sqlalchemy import create_engine")]),e("div",[o._v("from sqlalchemy import Column, Integer, VARCHAR, ForeignKey, UniqueConstraint, Index")]),e("div",[o._v("from sqlalchemy.orm import relationship")]),e("div",[e("br")]),e("div",[o._v("Base = declarative_base()")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 学生表")])],1),e("div",[o._v("class Student(Base):")]),e("div",[o._v("    __tablename__ = 'student'")]),e("div",[o._v("    id = Column(Integer, primary_key=True, autoincrement=True)")]),e("div",[o._v("    name = Column(VARCHAR(32), nullable=False, index=True)")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 语法: 正向查询所使用的字段名 = relationship('表类名', secondary='小写的关系表表名', backref='反向查询所使用的名字')")])],1),e("div",[e("font",{attrs:{color:"#FA7A00"}},[o._v("course_list = relationship('Course', secondary='student2course', backref='xxoo')")]),o._v(" "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 简化连表获取数据操作的字段，且不会在数据库中生成字段")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 课程表")])],1),e("div",[o._v("class Course(Base):")]),e("div",[o._v("    __tablename__ = 'course'")]),e("div",[o._v("    id = Column(Integer, primary_key=True, autoincrement=True)")]),e("div",[o._v("    title = Column(VARCHAR(32), nullable=False, index=True)")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 学生和课程的关系表")])],1),e("div",[o._v("class Student2Course(Base):")]),e("div",[o._v("    __tablename__ = 'student2course'")]),e("div",[o._v("    id = Column(Integer, primary_key=True, autoincrement=True)")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#FA7A00"}},[o._v("student_id = Column(Integer, ForeignKey('student.id'))")])],1),e("div",[e("font",{attrs:{color:"#FA7A00"}},[o._v("    course_id = Column(Integer, ForeignKey('course.id'))")])],1),e("div",[e("br")]),e("div",[o._v("    __table_args__ = (")]),e("div",[o._v("        UniqueConstraint('student_id', 'course_id', name='sid_cid_name'),  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建一个名为 sid_cid_name 的联合唯一索引 (即：一个学生不能重复选择同一门课程)")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("#")]),o._v(" Index('sid_cid_name', 'student_id', 'course_id')  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建一个名为 sid_cid_name 的普通联合索引 (即：一个学生可以重复选择同一门课程)")])],1),e("div",[o._v("    )")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建表")])],1),e("div",[o._v("def create_table():")]),e("div",[o._v("    engine = create_engine(")]),e("div",[o._v('        "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("        max_overflow=0,")]),e("div",[o._v("        pool_size=5,")]),e("div",[o._v("        pool_timeout=10,")]),e("div",[o._v("        pool_recycle=-1")]),e("div",[o._v("    )")]),e("div",[o._v("    Base.metadata.create_all(engine)")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 删除表")])],1),e("div",[o._v("def drop_table():")]),e("div",[o._v("    engine = create_engine(")]),e("div",[o._v('        "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("        max_overflow=0,")]),e("div",[o._v("        pool_size=5,")]),e("div",[o._v("        pool_timeout=10,")]),e("div",[o._v("        pool_recycle=-1")]),e("div",[o._v("    )")]),e("div",[o._v("    Base.metadata.drop_all(engine)")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[o._v("if __name__ == '__main__':")]),e("div",[o._v("    create_table()")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("#")]),o._v(" drop_table()")],1)]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt"}},[o._v("添加数据")])])])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# xxx.py")])],1),e("div",[e("br")]),e("div",[o._v("from sqlalchemy.orm import sessionmaker")]),e("div",[o._v("from sqlalchemy import create_engine")]),e("div",[o._v("from models import Student, Course, Student2Course")]),e("div",[e("br")]),e("div",[o._v("engine = create_engine(")]),e("div",[o._v('    "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("    max_overflow=0,")]),e("div",[o._v("    pool_size=5,")]),e("div",[o._v("    pool_timeout=10,")]),e("div",[o._v("    pool_recycle=-1")]),e("div",[o._v(")")]),e("div",[e("br")]),e("div",[o._v("SessionFactory = sessionmaker(bind=engine)")]),e("div",[o._v("session = SessionFactory()")]),e("div",[e("br")]),e("div",[o._v("session.add_all([")]),e("div",[o._v("    Student(name='Kevin'),")]),e("div",[o._v("    Student(name='Yeung'),")]),e("div",[o._v("    Course(title='生物'),")]),e("div",[o._v("    Course(title='体育')")]),e("div",[o._v("])")]),e("div",[o._v("session.commit()")]),e("div",[e("br")]),e("div",[o._v("session.add_all([")]),e("div",[o._v("    Student2Course(student_id=1, course_id=1),")]),e("div",[o._v("    Student2Course(student_id=1, course_id=2),")]),e("div",[o._v("    Student2Course(student_id=2, course_id=1),")]),e("div",[o._v("])")]),e("div",[o._v("session.commit()")]),e("div",[e("br")]),e("div",[o._v("session.close()")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",[e("img",{attrs:{"data-filename":"TIM截图20191004164544.jpg",src:"/kevin-blog/Python/SQLAchemy 模块_files/TIM截图20191004164544.jpg",type:"image/jpeg"}})]),e("div",[e("br")]),e("div",[e("img",{attrs:{"data-filename":"TIM图片20191004164644.png",src:"/kevin-blog/Python/SQLAchemy 模块_files/TIM图片20191004164644.png",type:"image/png"}})]),e("div",[e("br")]),e("div",[e("img",{attrs:{"data-filename":"TIM截图20191004164740.jpg",src:"/kevin-blog/Python/SQLAchemy 模块_files/TIM截图20191004164740.jpg",type:"image/jpeg"}})]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("2.")])]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("查询数据")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[o._v("普通的连表查询")])])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("三张表关联查询")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ret = session.query(Student2Course.id, Student.id, Student.name, Course.id, Course.title) \\")]),e("div",[o._v("    .join(Student, Student2Course.student_id == Student.id) \\")]),e("div",[o._v("    .join(Course, Student2Course.course_id == Course.id) \\")]),e("div",[o._v("    .order_by(Student2Course.id.asc())")]),e("div",[e("br")]),e("div",[o._v("for row in ret:")]),e("div",[o._v("    print(row)")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v('"""')])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    结果:")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("        (1, 1, 'Kevin', 1, '生物')")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("        (2, 1, 'Kevin', 2, '体育')")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("        (3, 2, 'Yeung', 2, '体育')")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v('    """')])],1)]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("查询 “Kevin” 选的所有课程")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ret = session.query(Student2Course.id, Student.id, Student.name, Course.id, Course.title) \\")]),e("div",[o._v("    .join(Student, Student2Course.student_id == Student.id) \\")]),e("div",[o._v("    .join(Course, Student2Course.course_id == Course.id) \\")]),e("div",[o._v("    .filter(Student.name == 'Kevin') \\")]),e("div",[o._v("    .order_by(Student2Course.id.asc())")]),e("div",[e("br")]),e("div",[o._v("for row in ret:")]),e("div",[o._v("    print(row)")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v('"""')])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    结果:")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("        (1, 1, 'Kevin', 1, '生物')")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("        (2, 1, 'Kevin', 2, '体育')")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v('    """')])],1)]),e("div",[e("br")]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("relationship() -> 简化连表获取数据的操作 -> 在 ")]),e("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("django 中也有类似操作")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 导入 relationship")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(0, 0, 0)"}},[o._v("from sqlalchemy.orm import ")]),o._v("relationship")])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("relationship('从表的类名', secondary='小写的关系表表名', backref='从表使用的变量名')")])])])]),e("div",[e("br")]),e("ul",[e("ul",[e("ul",[e("li",[e("div",[o._v('backref="从表使用的变量名"，所定义的变量名是给当从表获取主表数据的时候使用')])]),e("li",[e("div",[o._v("secondary='小写的关系表表名'，第三张表的表名")])]),e("li",[e("div",[o._v("在主表类中（即：有外键的类）中调用 relationship() 方法，且 relationship() 不会影响表的创建")])])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("class Student(Base):")]),e("div",[o._v("    __tablename__ = 'student'")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    …………")])],1),e("div",[e("br")]),e("div",[o._v("    course_list = relationship('Course', secondary='student2course', backref='xxoo')")])]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("正向查询 -> 主表获取从表的数据")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("# 当调用了 relationship")]),e("font",{attrs:{color:"#E30000"}},[o._v("() 方法的时候，会将从表的所有数据放进 course_list 变量里面，当要获取与主表数据相关的从表数据的时候，course_list 就会返回与主表数据相关的从表数据的对象")])],1),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 查询“Kevin”选的所有课")])],1),e("div",[e("br")]),e("div",[o._v("student_obj = session.query(Student).filter(Student.name == 'Kevin').first()")]),e("div",[o._v("course_list = student_obj"),e("font",{attrs:{color:"#FA7A00"}},[o._v(".course_list")])],1),e("div",[e("br")]),e("div",[o._v("for course in course_list:")]),e("div",[o._v("    print(course.title)")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v('"""')])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    结果:")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("        体育")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("        生物")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v('    """')])],1)]),e("div",[e("br")]),e("ul",[e("ul",[e("li",[e("div",[o._v("反向查询 -> 从表获取主表的数据")])])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("# 当调用了 relationship() 方法的时候，会将主表的所有数据放进 xxoo 变量里面，当要获取与从表数据相关的主表数据的时候，xxoo 就会返回与从表数据相关的主表数据的列表")])]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 查询选了“生物”的所有人")])],1),e("div",[e("br")]),e("div",[o._v("course_obj = session.query(Course).filter(Course.title == '生物').first()")]),e("div",[o._v("student_list = course_obj"),e("font",{attrs:{color:"#FA7A00"}},[o._v(".xxoo")])],1),e("div",[e("br")]),e("div",[o._v("for student in student_list:")]),e("div",[o._v("    print(student.name)")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v('"""')])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("    结果:")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("        Kevin")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("        Yeung")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v('    """')])],1)]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("3.")]),o._v(" "),e("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("添加数据")])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("ul",[e("li",[e("div",[e("span",{staticStyle:{"font-size":"12pt"}},[o._v("例子: 创建一个英语课程，然后再创建2个学生，并且让这两个学生选择英语课程")])])])]),e("div",[e("span",{staticStyle:{"font-size":"14pt"}},[e("br")])]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("course_obj = Course(title='英语')")]),e("div",[o._v("course_obj.xxoo = [")]),e("div",[o._v("    Student(name='Eric'),")]),e("div",[o._v("    Student(name='Jack')")]),e("div",[o._v("]")]),e("div",[o._v("session.add(course_obj)")]),e("div",[o._v("session.commit()")])]),e("div",[e("br")]),e("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[e("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[o._v("其他查询")])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("子查询")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("ret = session.query(Users.name, Users.address).filter(Users.id.in_(session.query(Users.id).filter(Users.id < 3))).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# select name,address from users where id in (select id from users where id < 3);")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [('Kevin', '横沥'), ('Yeung', '横沥')]")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("临时表")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# .subquery()")])]),e("div",[e("br")]),e("div",[o._v("sql = session.query(Users).filter(Users.id < 5).subquery()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 使用 .subquery() 创建临时表")])]),e("div",[e("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[o._v("# 注意子句中需要使用 c 来调用字段内容")])]),e("div",[o._v("ret = session.query(sql).filter(sql.c.id > 2).all()  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 使用临时表 -> select * from (select * from users where id < 5) as A where A.id > 2")])]),e("div",[o._v("print(ret)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [(4, 'Timmy', 25, '万江', 2)]")])])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("在 select 语句中的字段名那一块可以使用 select 语句 -> select 字段名,(select查询语句) from 表名 where 条件")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 导入 aliased")])]),e("div",[e("br")]),e("div",[o._v("from sqlalchemy.orm import aliased")])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# .as_scalar() -> 在SQL语句外面加了()")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 该例子在 Mysql 练习中的 显示所有学生的生物、物理、体育、美术四门的课程成绩")])]),e("div",[e("br")]),e("div",[o._v("score_alias1 = aliased(Score, name='score_alias1')  "),e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("# 给表起别名")])]),e("div",[o._v("score_alias2 = aliased(Score, name='score_alias2')  "),e("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("# 给表起别名")])]),e("div",[e("br")]),e("div",[o._v("result = session.query(")]),e("div",[o._v("    score_alias1.student_id,")]),e("div",[o._v("    session.query(score_alias2.num).filter(score_alias1.student_id == score_alias2.student_id, score_alias2.course_id == 1).as_scalar(),")]),e("div",[o._v("    session.query(score_alias2.num).filter(score_alias1.student_id == score_alias2.student_id, score_alias2.course_id == 2).as_scalar(),")]),e("div",[o._v("    session.query(score_alias2.num).filter(score_alias1.student_id == score_alias2.student_id, score_alias2.course_id == 3).as_scalar(),")]),e("div",[o._v("    session.query(score_alias2.num).filter(score_alias1.student_id == score_alias2.student_id, score_alias2.course_id == 4).as_scalar(),")]),e("div",[o._v(").group_by(score_alias1.student_id).all()")]),e("div",[e("br")]),e("div",[o._v("print(result)  "),e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# [(1, 10, 9, None, 66), (2, 8, None, 68, 99), (3, 77, 66, 87, 99), (4, 79, 11, 67, 100), (5, 79, 11, 67, 100), (6, 9, 100, 67, 100), (7, 9, 100, 67, 88), (8, 9, 100, 67, 88), (9, 91, 88, 67, 22), (10, 90, 77, 43, 87), (11, 90, 77, 43, 87), (12, 90, 77, 43, 87), (13, None, None, 87, None)]")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# SQL语句")])]),e("div",[e("br")]),e("div",[o._v("select")]),e("div",[o._v("    student_id,")]),e("div",[o._v("    (select num from score as s2 where s2.student_id = s1.student_id and course_id = 1) as '生物',")]),e("div",[o._v("    (select num from score as s2 where s2.student_id = s1.student_id and course_id = 2) as '物理',")]),e("div",[o._v("    (select num from score as s2 where s2.student_id = s1.student_id and course_id = 3) as '体育',")]),e("div",[o._v("    (select num from score as s2 where s2.student_id = s1.student_id and course_id = 4) as '美术'")]),e("div",[o._v("from")]),e("div",[o._v("    score as s1")]),e("div",[o._v("group by")]),e("div",[o._v("    student_id;")])]),e("div",[e("br")]),e("div",[e("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Python/SQLAchemy 模块_files/Image [6].png",type:"image/png"}})]),e("div",[e("br")]),e("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","font-weight":"bold","line-height":"1.5","background-color":"#3eaf7c","border-radius":"3px","text-align":"center",color:"white","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[e("span",{staticStyle:{"font-size":"21px","font-weight":"bold","line-height":"1.5","background-color":"#3eaf7c","border-radius":"3px",color:"white","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o._v("获取连接池连接的两种方式")])]),e("div",[e("br")]),e("div",[e("font",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)"}},[o._v("注意: 本栏目是以多线程来介绍获取连接池连接的两种方法")])],1),e("div",[e("font",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)"}},[e("br")])],1),e("div",[e("font",[e("span",{staticStyle:{"font-size":"18.6667px"}},[o._v("本栏目所使用到的表")])])],1),e("div",[e("font",{attrs:{color:"#E30000"}},[e("span",{staticStyle:{"font-size":"18.6667px"}},[e("br")])])],1),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# models.py")])],1),e("div",[e("font",{attrs:{color:"#41AD1C"}},[e("br")])],1),e("div",[o._v("from sqlalchemy.ext.declarative import declarative_base")]),e("div",[o._v("from sqlalchemy import create_engine")]),e("div",[o._v("from sqlalchemy import Column, Integer, VARCHAR")]),e("div",[e("br")]),e("div",[o._v("Base = declarative_base()")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 学生表")])],1),e("div",[o._v("class Student(Base):")]),e("div",[o._v("    __tablename__ = 'student'")]),e("div",[o._v("    id = Column(Integer, primary_key=True, autoincrement=True)")]),e("div",[o._v("    name = Column(VARCHAR(32), nullable=False, index=True)")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建表")])],1),e("div",[o._v("def create_table():")]),e("div",[o._v("    engine = create_engine(")]),e("div",[o._v('        "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("        max_overflow=0,")]),e("div",[o._v("        pool_size=5,")]),e("div",[o._v("        pool_timeout=10,")]),e("div",[o._v("        pool_recycle=-1")]),e("div",[o._v("    )")]),e("div",[o._v("    Base.metadata.create_all(engine)")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 删除表")])],1),e("div",[o._v("def drop_table():")]),e("div",[o._v("    engine = create_engine(")]),e("div",[o._v('        "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("        max_overflow=0,")]),e("div",[o._v("        pool_size=5,")]),e("div",[o._v("        pool_timeout=10,")]),e("div",[o._v("        pool_recycle=-1")]),e("div",[o._v("    )")]),e("div",[o._v("    Base.metadata.drop_all(engine)")]),e("div",[e("br")]),e("div",[e("br")]),e("div",[o._v("if __name__ == '__main__':")]),e("div",[o._v("    create_table()")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("#")]),o._v(" drop_table()")],1)]),e("div",[e("font",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)"}},[e("br")])],1),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[o._v("1.")]),e("span",{staticStyle:{color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-size":"medium","font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}}),e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[o._v("局部连接 -> 容易理解")])]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[e("br")])]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# xxx.py")])],1),e("div",[e("br")]),e("div",[o._v("from sqlalchemy.orm import sessionmaker")]),e("div",[o._v("from sqlalchemy import create_engine")]),e("div",[o._v("from models import Student")]),e("div",[o._v("from threading import Thread")]),e("div",[e("br")]),e("div",[o._v("engine = create_engine(")]),e("div",[o._v('    "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("    max_overflow=0,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 允许溢出多少个连接（即：连接池的连接已满后，还可以创建多少条连接）")])],1),e("div",[o._v("    pool_size=5,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中的连接数")])],1),e("div",[o._v("    pool_timeout=10,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中没有线程后最多等待的时间（单位：秒），如果超过指定时间还没有连接就报错")])],1),e("div",[o._v("    pool_recycle=-1  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 多久之后对线程池中的线程进行一次连接的回收（重置）（单位：秒）-> -1表示不重置")])],1),e("div",[o._v(")")]),e("div",[e("br")]),e("div",[o._v("SessionFactory = sessionmaker(bind=engine)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建连接池")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[o._v("def task():")]),e("div",[e("font",{attrs:{color:"#FA7A00"}},[o._v("session = SessionFactory()")]),o._v(" "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 从连接池中获取一条连接对表进行操作")])],1),e("div",[o._v("    ret = session.query(Student).all()")]),e("div",[o._v("    print(ret)")]),e("div",[e("font",{attrs:{color:"#FA7A00"}},[o._v("session.close()")]),o._v(" "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 将连接交还给连接池")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建20个线程执行task函数")])],1),e("div",[o._v("for i in range(20):")]),e("div",[o._v("    t = Thread(target=task)")]),e("div",[o._v("    t.start()")])]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[e("br")])]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[o._v("2.")]),e("span",{staticStyle:{color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-size":"medium","font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}}),e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[o._v("全局连接 -> 推荐使用")])]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[e("br")])]),e("ul",[e("li",[e("div",[e("font",{staticStyle:{"font-size":"12pt"}},[o._v("全局连接是基于 threading.local() 所实现的")])],1)])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# xxx.py")])],1),e("div",[e("br")]),e("div",[o._v("from sqlalchemy.orm import sessionmaker")]),e("div",[o._v("from sqlalchemy import create_engine")]),e("div",[o._v("from sqlalchemy.orm import "),e("font",{attrs:{color:"#FA7A00"}},[o._v("scoped_session")])],1),e("div",[o._v("from models import Student")]),e("div",[o._v("from threading import Thread")]),e("div",[e("br")]),e("div",[o._v("engine = create_engine(")]),e("div",[o._v('    "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("    max_overflow=0,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 允许溢出多少个连接（即：连接池的连接已满后，还可以创建多少条连接）")])],1),e("div",[o._v("    pool_size=5,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中的连接数")])],1),e("div",[o._v("    pool_timeout=10,  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中没有线程后最多等待的时间（单位：秒），如果超过指定时间还没有连接就报错")])],1),e("div",[o._v("    pool_recycle=-1  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 多久之后对线程池中的线程进行一次连接的回收（重置）（单位：秒）-> -1表示不重置")])],1),e("div",[o._v(")")]),e("div",[e("br")]),e("div",[o._v("SessionFactory = sessionmaker(bind=engine)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建连接池")])],1),e("div",[e("font",{attrs:{color:"#FA7A00"}},[o._v("session = scoped_session(SessionFactory)  # 获取全局连接")]),o._v(" "),e("font",{attrs:{color:"#41AD1C"}},[o._v("->")]),o._v(" "),e("font",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("1. scoped_session 存放着一个空的 threading.local()")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[o._v("def task():")]),e("div",[o._v("    ret = session.query(Student).all()  "),e("font",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("# 3. 当执行 session.query 的时候会从连接池中获取一条连接然后放到 threading.local() 中对应线程的内存空间里面")])],1),e("div",[o._v("    print(ret)")]),e("div",[e("font",{attrs:{color:"#FA7A00"}},[o._v("session.remove()  # 将连接交还给连接池")]),o._v(" "),e("font",{attrs:{color:"#41AD1C"}},[o._v("->")]),o._v(" "),e("font",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("4. 关闭 threading.local() 中对应线程所存放的连接，然后将对应的线程从 threading.local() 中删除掉")])],1),e("div",[e("br")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建20个线程执行task函数")])],1),e("div",[o._v("for i in range(20):")]),e("div",[o._v("    t = Thread(target=task)")]),e("div",[o._v("    t.start()  "),e("font",{staticStyle:{color:"rgb(227, 0, 0)"}},[o._v("# 2. 当线程启动的时候 scoped_session 里面的 threading.local() 会为每一个线程开辟一块内存空间存放连接池中的连接")])],1)]),e("div",[e("br")])]),e("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","font-weight":"bold","line-height":"1.5","background-color":"#3eaf7c","border-radius":"3px","text-align":"center",color:"white","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[e("span",{staticStyle:{"font-size":"21px","font-weight":"bold","line-height":"1.5","background-color":"#3eaf7c","border-radius":"3px",color:"white","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o._v("执行原生SQL语句")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[o._v("1.")]),e("span",{staticStyle:{color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-size":"medium","font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}}),e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[o._v("方式一")])]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[e("br")])]),e("ul",[e("li",[e("div",[o._v("查询")])])]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[e("br")])]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("student_obj = session.execute('select * from student')")]),e("div",[o._v("result = student_obj.fetchall()")]),e("div",[e("br")]),e("div",[o._v("print(result)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# [(3, 'Eric'), (4, 'Jack'), (1, 'Kevin'), (2, 'Yeung')]")])],1)]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("添加")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("cursor = session.execute('insert into student(name) values(:value)', params={'value': 'Timmy'})")]),e("div",[o._v("session.commit()")]),e("div",[e("br")]),e("div",[o._v("print(cursor.lastrowid)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# 获取添加成功后数据的id")])],1)]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("修改")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("cursor = session.execute('update student set name = :student_name where id = 3', params={'student_name': 'Yeung_Edit'})")]),e("div",[o._v("session.commit()")])]),e("div",[e("br")]),e("ul",[e("li",[e("div",[o._v("删除")])])]),e("div",[e("br")]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("cursor = session.execute('delete from student where id=:s_id;', params={'s_id': 9})")]),e("div",[o._v("session.commit()")])]),e("div",[e("br")]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[o._v("2.")]),e("span",{staticStyle:{color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-size":"medium","font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}}),e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[o._v("方式二")])]),e("div",[e("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","font-weight":"bold"}},[e("br")])]),e("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[e("div",[o._v("from sqlalchemy import create_engine")]),e("div",[e("br")]),e("div",[e("font",{attrs:{color:"#FA7A00"}},[o._v("engine")]),o._v(" = create_engine(")],1),e("div",[o._v('    "mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8",')]),e("div",[o._v("    max_overflow=0,")]),e("div",[o._v("    pool_size=5,")]),e("div",[o._v("    pool_timeout=10,")]),e("div",[o._v("    pool_recycle=-1")]),e("div",[o._v(")")]),e("div",[e("br")]),e("div",[o._v("cur = "),e("font",{attrs:{color:"#FA7A00"}},[o._v("engine")]),o._v('.execute("select * from student")')],1),e("div",[o._v("result = cur.fetchall()")]),e("div",[e("br")]),e("div",[o._v("print(result)  "),e("font",{attrs:{color:"#41AD1C"}},[o._v("# [(3, 'Eric'), (4, 'Jack'), (1, 'Kevin'), (2, 'Yeung')]")])],1)]),e("div",[e("br")])])])])])}),[],!1,null,null,null);r.default=i.exports}}]);