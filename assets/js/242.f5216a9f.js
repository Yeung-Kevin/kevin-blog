(window.webpackJsonp=window.webpackJsonp||[]).push([[242],{597:function(t,o,i){"use strict";i.r(o);var e=i(25),r=Object(e.a)({},(function(){var t=this,o=t.$createElement,i=t._self._c||o;return i("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[i("div",[i("span",[i("div",[i("div",[i("div",[i("div",[i("font",{staticStyle:{"font-size":"14pt"}},[i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("之前学习了线程、进程的概念，了解了在操作系统中")]),i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v("进程是资源分配的最小单位,线程是CPU调度的最小单位。")]),i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("按道理来说我们已经算是把cpu的利用率提高很多了。但是我们知道无论是创建多进程还是创建多线程来解")]),i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("决问题，都要消耗一定的时间来创建进程、创建线程、以及管理他们之间的切换，")])]),i("span",{staticStyle:{"font-size":"14pt"}},[t._v(" 为了")]),i("font",{staticStyle:{"font-size":"14pt"}},[i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("对效率的追求不断提高，")]),i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v("基于单线程来实现并发")]),i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("，即只用一个主线程（很明显可利用的cpu只有一个）情况下实现并发。这样就可以节省创建线进程所消耗的时间。")])])],1),i("div",[i("br")]),i("div",[i("font",{staticStyle:{"font-size":"14pt"},attrs:{color:"#E30000"}},[i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("协程: ")]),i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v("基于单线程来实现并发，")]),i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("即只用一个主线程（很明显可利用的cpu只有一个）情况下实现并发。这样就可以节省创建线进程所消耗的时间。")])])],1),i("div",[i("font",{staticStyle:{"font-size":"14pt"},attrs:{color:"#E30000"}},[i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[i("br")])])],1),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("协程可以开很多很多，没有上限，切换之间的消耗可以忽略不计")])])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("并发的本质: 函数之间切换执行 + 保存状态（即: 一个函数执行上一次的执行位置，以便下次再从该位置开始执行）")])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("使用生成器实现函数之间的切换执行 -> "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold",color:"rgb(227, 0, 0)"}},[t._v("遇到 IO操作")])]),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("（阻塞）还是会等待 ")]),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("IO操作")]),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("（阻塞）完后再往下执行，没有实现真正的并发，只是实现了函数之间的切换执行")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("def fun1():")]),i("div",[t._v("    print(1)")]),i("div",[t._v("    yield  ")]),i("div",[t._v("    print(3)")]),i("div",[t._v("    yield")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def fun2():")]),i("div",[t._v("    g = fun1()")]),i("div",[t._v("    next(g)")]),i("div",[t._v("    print(2)")]),i("div",[t._v("    next(g)")]),i("div",[t._v("    print(4)")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("fun2()")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("使用生成器中的 .send() 实现函数之间的切换执行 -> 生产者消费者模型（吃包子例子） ")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("->")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("遇到 IO操作")]),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("（阻塞）还是会等待 ")]),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("IO操作")]),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("（阻塞）完后再往下执行，没有实现真正的并发，只是实现了函数之间的切换执行")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("def consumer():")]),i("div",[t._v("    while True:")]),i("div",[t._v("        n = yield")]),i("div",[t._v("        print('吃了%s个包子' % n)")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def producer():")]),i("div",[t._v("    g = consumer()")]),i("div",[t._v("    next(g)  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 第一次使用生成器的时候一定用next获取下一个值，不懂的可以看回生成器中 .send() 方法的注意事项")])],1),i("div",[t._v("    for i in range(10):")]),i("div",[t._v("        print('生产了%s个包子' % (i + 1))")]),i("div",[t._v("        g.send(i + 1)")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("producer()")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("greenlet 的安装")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("pip3 install greenlet -i https://pypi.douban.com/simple  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用豆瓣的镜像")])],1)]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("4.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("使用第三方模块 greenlet ")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("实现函数之间的切换执行")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("->")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("遇到 IO操作")]),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("（阻塞）还是会等待 ")]),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("IO操作")]),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("（阻塞）完后再往下执行，没有实现真正的并发，只是实现了函数之间的切换执行")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("当函数的执行过程中遇见了 .switch() 就会进行函数的切换执行")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("import time")]),i("div",[t._v("from greenlet import greenlet")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def eat1():")]),i("div",[t._v("    print('food1')")]),i("div",[t._v("    g2.switch() "),i("font",{attrs:{color:"#41AD1C"}},[t._v(" # 切换执行 eat2 函数")])],1),i("div",[t._v("    time.sleep(5)")]),i("div",[t._v("    print('food3')")]),i("div",[t._v("    g2.switch()  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 切换执行 eat2 函数")])],1),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def eat2():")]),i("div",[t._v("    print('food2')")]),i("div",[t._v("    g1.switch()  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 切换执行 eat1 函数")])],1),i("div",[t._v("    time.sleep(3)")]),i("div",[t._v("    print('food4')")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("g1 = greenlet(eat1)")]),i("div",[t._v("g2 = greenlet(eat2)")]),i("div",[t._v("g1.switch()  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 执行 eat1 方法 -> 一定要使用 .switch() 执行函数不然会没有效果")])],1)]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("5.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("在没有IO操作的情况下进行函数之间的切换执行反而会降低效率")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("# 串行执行（同步执行）")]),i("div",[i("br")]),i("div",[t._v("import time")]),i("div",[i("br")]),i("div",[t._v("def consumer(res):")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v('"""任务1:接收数据,处理数据"""')])],1),i("div",[t._v("    pass")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def producer():")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v('"""任务2:生产数据"""')])],1),i("div",[t._v("    res = []")]),i("div",[t._v("    for i in range(10000000):")]),i("div",[t._v("        res.append(i)")]),i("div",[t._v("    return res")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("start = time.time()")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 串行执行（同步执行）")])],1),i("div",[t._v("res = producer()")]),i("div",[t._v("consumer(res) "),i("font",{attrs:{color:"#41AD1C"}},[t._v(" # 写成consumer(producer())会降低执行效率")])],1),i("div",[t._v("stop = time.time()")]),i("div",[t._v("print(stop - start)  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 1.5536692142486572")])],1)]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("# 基于yield并发执行")]),i("div",[i("br")]),i("div",[t._v("import time")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def consumer():")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v('"""任务1:接收数据,处理数据"""')])],1),i("div",[t._v("    while True:")]),i("div",[t._v("        x = yield")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def producer():")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v('"""任务2:生产数据"""')])],1),i("div",[t._v("    g = consumer()")]),i("div",[t._v("    next(g)")]),i("div",[t._v("    for i in range(10000000):")]),i("div",[t._v("        g.send(i)")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("start = time.time()")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 基于yield保存状态,实现两个任务直接来回切换,即并发的效果")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# PS:如果每个任务中都加上打印,那么明显地看到两个任务的打印是你一次我一次,即并发执行的.")])],1),i("div",[t._v("producer()")]),i("div",[i("br")]),i("div",[t._v("stop = time.time()")]),i("div",[t._v("print(stop - start)  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 2.0272178649902344")])],1)])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("6.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("gevent")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 的安装")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("pip3 install gevent -i https://pypi.douban.com/simple  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用豆瓣的镜像")])],1)]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("7.")]),i("span",{staticStyle:{color:"rgb(227, 0, 0)"}}),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("使用第三方模块 gevent ")]),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("实现真正的意义上的并发执行，即：协程")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("gevent模块是基于greenlet模块 进行封装的")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[i("span",{staticStyle:{"font-size":"12pt"}},[i("span",{staticStyle:{"font-size":"12pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("遇见 gevent 的自带的 IO 操作（阻塞）就会自动的切换到另一个函数去执行，从而实现并发的效果")])])])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("注意: gevent的操作是完全和程序进行异步，虽然它执行了但是会看不见效果的，解决办法: 使用 g1.join() 或者.joinall([g1, g2]) 等待gevent执行完毕")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("gevent.spawn(函数名, 函数接收的参数1, 函数接收的参数2, 函数接收的参数3)")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("import gevent")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def fun1(d1, d2):")]),i("div",[t._v("    print(d1)")]),i("div",[t._v("    gevent.sleep(2)  "),i("font",{attrs:{color:"#E30000"}},[t._v("# gevent 自带的 IO 操作，延时执行下方代码 -> 如果使用 time.sleep(2) 它就无法识别这个IO操作（因为不是 gevent 自带的），导致不会自动切换另一个函数去执行，而是等待2秒后继续往下执行")])],1),i("div",[t._v("    print(d2)")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def fun2(d1, d2):")]),i("div",[t._v("    print(d1)")]),i("div",[t._v("    gevent.sleep(2) "),i("font",{attrs:{color:"#E30000"}},[t._v(" # gevent 自带的 IO 操作，延时执行下方代码 -> 如果使用 time.sleep(2) 它就无法识别这个IO操作（因为不是 gevent 自带的），导致不会自动切换另一个函数去执行，而是等待2秒后继续往下执行")])],1),i("div",[t._v("    print(d2)")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("g1 = gevent.spawn(fun1, 1, 3)  "),i("font",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("# 执行 fun1 函数，当 gevent 遇见它自带的 IO操作（阻塞）就会自动切换另一个函数去执行，从而实现并发")])],1),i("div",[t._v("g2 = gevent.spawn(fun2, 2, 4)  "),i("font",{attrs:{color:"#E30000"}},[t._v("# 执行 fun2 函数，当 gevent 遇见它自带的 IO操作（阻塞）就会自动切换另一个函数去执行，从而实现并发")])],1),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# g1.join()")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# g2.join()")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 等价于")])],1),i("div",[i("br")]),i("div",[t._v("gevent.joinall([g1, g2])  "),i("font",{attrs:{color:"#E30000"}},[t._v("# 等待所有 gevent 执行完后再往下执行")])],1)]),i("div",[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("解决 gevent 模块可以识别其他IO阻塞 ")])])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[i("font",{staticStyle:{"font-size":"12pt"}},[i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"12pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("上例gevent.sleep(2)模拟的是gevent可以识别的io阻塞, ")]),i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"12pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("而time.sleep(2)或其他的阻塞,gevent是不能直接识别的需要用")])])],1)])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[t._v("使用 "),i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("font",{staticStyle:{"font-size":"12pt"}},[i("span",{staticStyle:{"font-size":"12pt"}},[i("span",{staticStyle:{"font-size":"12pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v("from gevent import monkey;monkey.patch_all()")])]),i("span",{staticStyle:{"font-size":"12pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}})])],1),i("span",{staticStyle:{"font-size":"12pt"}},[t._v("解决 gevent 模块可以识别其他IO阻塞 -> 把所有IO阻塞操作进行打包放进 ")]),t._v("gevent 里面")])])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[t._v("如果使用了"),i("span",{staticStyle:{"font-size":"12pt"}},[t._v("gevent 模块，就将 ")]),i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"12pt"}},[i("span",{staticStyle:{"font-size":"12pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v("from gevent import monkey;monkey.patch_all()")])]),t._v(" "),i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"12pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("放在程序的起始位置")])])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#E30000"}},[t._v("# 写法一")])],1),i("div",[i("font",{attrs:{color:"#E30000"}},[t._v("# from gevent import monkey;monkey.patch_all()")])],1),i("div",[i("font",{attrs:{color:"#E30000"}},[i("br")])],1),i("div",[i("font",{attrs:{color:"#E30000"}},[t._v("# 写法二")])],1),i("div",[t._v("from gevent import monkey")]),i("div",[t._v("monkey.patch_all()")]),i("div",[i("br")]),i("div",[t._v("import gevent")]),i("div",[t._v("import time")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def fun1(d1, d2):")]),i("div",[t._v("    print(d1)")]),i("div",[t._v("    time.sleep(2)  "),i("font",{attrs:{color:"#E30000"}},[t._v("# IO阻塞")])],1),i("div",[t._v("    print(d2)")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def fun2(d1, d2):")]),i("div",[t._v("    print(d1)")]),i("div",[t._v("    time.sleep(2)  "),i("font",{attrs:{color:"#E30000"}},[t._v("# IO阻塞")])],1),i("div",[t._v("    print(d2)")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("g1 = gevent.spawn(fun1, 1, 3)  "),i("font",{attrs:{color:"#E30000"}},[t._v("# 执行 fun1 函数，遇到IO阻塞就会自动切换另一个函数去执行，从而实现并发")])],1),i("div",[t._v("g2 = gevent.spawn(fun2, 2, 4) "),i("font",{attrs:{color:"#E30000"}},[t._v(" # 执行 fun2 函数，遇到IO阻塞就会自动切换另一个函数去执行，从而实现并发")])],1),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# g1.join()")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# g2.join()")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 等价于")])],1),i("div",[i("br")]),i("div",[t._v("gevent.joinall([g1, g2])  "),i("font",{attrs:{color:"#E30000"}},[t._v("# 等待所有 gevent 执行完后再往下执行")])],1)]),i("div",[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("8.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("使用协程实现TCP协议的多人聊天")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("# server.py")]),i("div",[i("br")]),i("div",[t._v("from gevent import monkey")]),i("div",[t._v("monkey.patch_all()")]),i("div",[i("br")]),i("div",[t._v("import gevent")]),i("div",[t._v("import socket")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def talk(conn):")]),i("div",[t._v("    while True:")]),i("div",[t._v("        ret = conn.recv(1024).decode('utf-8')")]),i("div",[t._v("        print(ret)")]),i("div",[t._v("        conn.send(ret.upper().encode('utf-8'))")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("sk = socket.socket()")]),i("div",[t._v("sk.bind(('127.0.0.1', 8080))")]),i("div",[t._v("sk.listen()")]),i("div",[t._v("while True:")]),i("div",[t._v("    conn, addr = sk.accept()")]),i("div",[t._v("    gevent.spawn(talk, conn)")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("# client.py")]),i("div",[i("br")]),i("div",[t._v("import socket")]),i("div",[t._v("from threading import Thread")]),i("div",[t._v("import time")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def my_client():")]),i("div",[t._v("    sk = socket.socket()")]),i("div",[t._v("    sk.connect(('127.0.0.1', 8080))")]),i("div",[t._v("    while True:")]),i("div",[t._v("        sk.send(b'hello')")]),i("div",[t._v("        msg = sk.recv(1024).decode('utf-8')")]),i("div",[t._v("        print(msg)")]),i("div",[t._v("        time.sleep(1)")]),i("div",[t._v("    sk.close()")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("for i in range(500):")]),i("div",[t._v("    t = Thread(target=my_client)")]),i("div",[t._v("    t.start()")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("9.")]),t._v(" "),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("爬取网页信息")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用协程爬取网页信息")])],1),i("div",[i("br")]),i("div",[t._v("from gevent import monkey")]),i("div",[t._v("monkey.patch_all()")]),i("div",[i("br")]),i("div",[t._v("import gevent")]),i("div",[t._v("import requests")]),i("div",[t._v("import time")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def get_url(url):")]),i("div",[t._v("    res = requests.get(url)")]),i("div",[t._v("    print(url, res.status_code, len(res.text))")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("url_lis = [")]),i("div",[t._v("    'http://www.sohu.com',")]),i("div",[t._v("    'http://www.baidu.com',")]),i("div",[t._v("    'http://www.qq.com',")]),i("div",[t._v("    'http://www.python.org',")]),i("div",[t._v("    'http://www.cnblogs.com',")]),i("div",[t._v("    'http://www.mi.com',")]),i("div",[t._v("    'http://www.apache.org',")]),i("div",[t._v("    'https://www.taobao.com',")]),i("div",[t._v("    'http://www.360.com',")]),i("div",[t._v("    'http://www.7daysinn.cn/'")]),i("div",[t._v("]")]),i("div",[i("br")]),i("div",[t._v("stat_time = time.time()")]),i("div",[i("br")]),i("div",[t._v("g_lis = []")]),i("div",[t._v("for url in url_lis:")]),i("div",[t._v("    g = gevent.spawn(get_url, url)")]),i("div",[t._v("    g_lis.append(g)")]),i("div",[i("br")]),i("div",[t._v("gevent.joinall(g_lis)")]),i("div",[i("br")]),i("div",[t._v("print(time.time() - stat_time)  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 执行时间: 1.5333659648895264")])],1)]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 不使用协程爬取网页信息")])],1),i("div",[i("br")]),i("div",[t._v("import requests")]),i("div",[t._v("import time")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("def get_url(url):")]),i("div",[t._v("    res = requests.get(url)")]),i("div",[t._v("    print(url, res.status_code, len(res.text))")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("url_lis = [")]),i("div",[t._v("    'http://www.sohu.com',")]),i("div",[t._v("    'http://www.baidu.com',")]),i("div",[t._v("    'http://www.qq.com',")]),i("div",[t._v("    'http://www.python.org',")]),i("div",[t._v("    'http://www.cnblogs.com',")]),i("div",[t._v("    'http://www.mi.com',")]),i("div",[t._v("    'http://www.apache.org',")]),i("div",[t._v("    'https://www.taobao.com',")]),i("div",[t._v("    'http://www.360.com',")]),i("div",[t._v("    'http://www.7daysinn.cn/'")]),i("div",[t._v("]")]),i("div",[i("br")]),i("div",[t._v("stat_time = time.time()")]),i("div",[i("br")]),i("div",[t._v("for url in url_lis:")]),i("div",[t._v("    get_url(url)")]),i("div",[i("br")]),i("div",[t._v("print(time.time() - stat_time)  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 执行时间: 4.400969982147217")])],1)]),i("div",[i("br")])])])])}),[],!1,null,null,null);o.default=r.exports}}]);