(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{463:function(t,o,i){"use strict";i.r(o);var r=i(25),a=Object(r.a)({},(function(){var t=this,o=t.$createElement,i=t._self._c||o;return i("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[i("div",[i("span",[i("div",[i("div",[i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("flask-migrate")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 的介绍")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("flask-migrate 必须依赖于 flask-script")])])])]),i("div",[i("font",{staticStyle:{"font-size":"12pt"}},[i("br")])],1),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("flask-migrate 的作用就是对数据库表进行增删改（注: flask-sqlalchemy 只能对表进行增加和删除的操作）")])])])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("flask-migrate")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 的安装")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("pip3 install flask-migrate -i https://pypi.douban.com/simple  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用豆瓣的镜像")])],1)]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("flask-migrate")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 的使用")])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[i("font",{attrs:{color:"#41AD1C"}},[t._v("# app.py")])],1)]),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[t._v("from flask import Flask")]),i("div",[t._v("from flask_sqlalchemy import SQLAlchemy")]),i("div",[i("font",{attrs:{color:"#FA7A00"}},[t._v("from flask_script import Manager")])],1),i("div",[i("font",{attrs:{color:"#FA7A00"}},[t._v("from flask_migrate import Migrate, MigrateCommand")])],1),i("div",[i("br")]),i("div",[t._v("db = SQLAlchemy()")]),i("div",[i("br")]),i("div",[t._v("from models import *")]),i("div",[i("br")]),i("div",[t._v("app = Flask(__name__)")]),i("div",[t._v("app.config.from_object('settings.ProConfig')")]),i("div",[i("br")]),i("div",[t._v("db.init_app(app)")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#FA7A00"}},[t._v("manage = Manager(app)")])],1),i("div",[i("font",{attrs:{color:"#FA7A00"}},[t._v("Migrate(app, db)")])],1),i("div",[i("font",{attrs:{color:"#FA7A00"}},[t._v("manage.add_command('db', MigrateCommand)")]),t._v(" "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 添加数据库迁移命令")])],1),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("@app.route('/home')")]),i("div",[t._v("def home():")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 添加数据")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(" db.session.add(Users(name='Kevin', age=18, address='横沥'))")],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v(" #")]),t._v(" db.session.commit()")],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v(" #")]),t._v(" db.session.remove()")],1),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 查询数据")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(" result = db.session.query(Users.name, Users.age).all()")],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(" print(result)")],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(" db.session.remove()")],1),i("div",[i("br")]),i("div",[t._v("    return '首页'")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("if __name__ == '__main__':")]),i("div",[i("font",{attrs:{color:"#FA7A00"}},[t._v("manage.run()")])],1)]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco",color:"rgb(65, 173, 28)"}},[t._v("# settings.py")])]),i("div",[i("br")]),i("div",[t._v("class BaseConfig(object):")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v(" # SQLAlchemy 配置")])]),i("div",[t._v("    SQLALCHEMY_DATABASE_URI = 'mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8'")]),i("div",[t._v("    SQLALCHEMY_MAX_OVERFLOW = 10  "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 允许溢出多少个连接（即：连接池的连接已满后，还可以创建多少条连接）")])]),i("div",[t._v("    SQLALCHEMY_POOL_SIZE = 5  "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 连接池中的连接数")])]),i("div",[t._v("    SQLALCHEMY_POOL_TIMEOUT = 10  "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 连接池中没有线程后最多等待的时间（单位：秒），如果超过指定时间还没有连接就报错")])]),i("div",[t._v("    SQLALCHEMY_POOL_RECYCLE = -1  "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 多久之后对线程池中的线程进行一次连接的回收（重置）（单位：秒）-> -1表示不重置")])]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("class ProConfig(BaseConfig):")]),i("div",[t._v("    pass")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# models.py")])]),i("div",[i("br")]),i("div",[t._v("from sqlalchemy import Column, Integer, VARCHAR")]),i("div",[i("font",{attrs:{color:"#464646"}},[t._v("from app import db")])],1),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# Users 表的类")])]),i("div",[t._v("class Users("),i("font",{attrs:{color:"#464646"}},[t._v("db.Model")]),t._v("):  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 创建表的类一定要继承 db.Model")])],1),i("div",[t._v("    __tablename__ = 'users'  "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 表名")])]),i("div",[t._v("    id = Column(Integer, primary_key=True, autoincrement=True)  "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 整型 设置主键 设置自增列")])]),i("div",[t._v("    name = Column(VARCHAR(32), nullable=False, index=True)  "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# varchar类型(长度：32) 不允许为空 将name字段设置为索引")])]),i("div",[t._v("    age = Column(Integer)  "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 整形")])]),i("div",[t._v("    address = Column(VARCHAR(32))  "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# varchar类型(长度：32)")])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[t._v("所生成的数据库迁移命令")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[t._v("注意: 在进行第一次数据库迁移的时候必须是空的数据库没有任何表，否则会报错")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("python app.py db init  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 初始化 migrations 文件夹用于记录表的修改情况，只执行一次")])],1),i("div",[i("br")]),i("div",[t._v("python app.py db migrate  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 类似于 Django 中的 makemigrations")])],1),i("div",[i("br")]),i("div",[t._v("python app.py db upgrade  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 类似于 Django 中的 migrate")])],1)]),i("div",[i("br")])])])])])}),[],!1,null,null,null);o.default=a.exports}}]);