(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{377:function(o,t,a){"use strict";a.r(t);var e=a(25),r=Object(e.a)({},(function(){var o=this,t=o.$createElement,a=o._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":o.$parent.slotKey}},[a("div",[a("span",[a("div",[a("div",[a("div",[a("span",{staticStyle:{"white-space":"pre-wrap","font-size":"14pt","font-weight":"bold"}},[o._v("1.")]),a("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v(" 修改项目的settings的配置")])]),a("div",[a("span",{staticStyle:{"font-size":"14pt"}},[a("br")])]),a("ul",[a("li",[a("div",[a("span",{staticStyle:{"font-size":"12pt"}},[o._v("在 settings.py 中配置需要连接的多个数据库")])])])]),a("div",[a("span",{staticStyle:{"font-size":"14pt"}},[a("br")])]),a("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("# settings.py")])],1),a("div",[a("br")]),a("div",[o._v("DATABASES = {")]),a("div",[o._v("    '"),a("font",{attrs:{color:"#FA7A00"}},[o._v("default")]),o._v("': {")],1),a("div",[o._v("        'ENGINE': 'django.db.backends.sqlite3',")]),a("div",[o._v("        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),")]),a("div",[o._v("    },")]),a("div",[o._v("    '"),a("font",{attrs:{color:"#FA7A00"}},[o._v("db_mysql")]),o._v("': {")],1),a("div",[o._v('        "ENGINE": "django.db.backends.mysql",  # django.db.backends.所连接的数据库')]),a("div",[o._v('        "NAME": "test_db",  # 数据库名称')]),a("div",[o._v('        "USER": "root",  # 数据库用户名')]),a("div",[o._v('        "PASSWORD": "",  # 数据库密码')]),a("div",[o._v('        "HOST": "127.0.0.1",  # 数据库IP，如果是连接本机的可以直接填写 127.0.0.1 或 localhost')]),a("div",[o._v('        "POST": 3306  # 数据库端口号')]),a("div",[o._v("    }")]),a("div",[o._v("}")])]),a("div",[a("br")])]),a("div",[a("span",{staticStyle:{"white-space":"pre-wrap","font-size":"14pt","font-weight":"bold"}},[o._v("2.")]),a("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v(" 设置数据库的路由规则")])]),a("div",[a("span",{staticStyle:{"font-size":"14pt"}},[a("br")])]),a("ul",[a("li",[a("div",[a("span",{staticStyle:{"font-size":"12pt"}},[o._v("如果不设置当某个视图使用了orm并且访问了该视图，那么就会出现报错")])])])]),a("div",[a("br")]),a("div",[a("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Django ORM/ORM-配置和使用多个数据库_files/Image.png",type:"image/png"}})]),a("div",[a("br")]),a("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("# database_router.py")])],1),a("div",[a("br")]),a("div",[o._v("from django.conf import settings")]),a("div",[a("br")]),a("div",[o._v("DATABASE_MAPPING = settings.DATABASE_APPS_MAPPING")]),a("div",[a("br")]),a("div",[a("br")]),a("div",[o._v("class DatabaseAppsRouter(object):")]),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v('"""')])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("    A router to control all database operations on models for different")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("    databases.")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[a("br")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("    In case an app is not set in settings.DATABASE_APPS_MAPPING, the router")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("    will fallback to the `default` database.")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[a("br")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("    Settings example:")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[a("br")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("    DATABASE_APPS_MAPPING = {'app1': 'db1', 'app2': 'db2'}")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v('    """')])],1),a("div",[a("br")]),a("div",[o._v("    def db_for_read(self, model, **hints):")]),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v('""""Point all read operations to the specific database."""')])],1),a("div",[o._v("        if model._meta.app_label in DATABASE_MAPPING:")]),a("div",[o._v("            return DATABASE_MAPPING[model._meta.app_label]")]),a("div",[o._v("        return None")]),a("div",[a("br")]),a("div",[o._v("    def db_for_write(self, model, **hints):")]),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v('"""Point all write operations to the specific database."""')])],1),a("div",[o._v("        if model._meta.app_label in DATABASE_MAPPING:")]),a("div",[o._v("            return DATABASE_MAPPING[model._meta.app_label]")]),a("div",[o._v("        return None")]),a("div",[a("br")]),a("div",[o._v("    def allow_relation(self, obj1, obj2, **hints):")]),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v('"""Allow any relation between apps that use the same database."""')])],1),a("div",[o._v("        db_obj1 = DATABASE_MAPPING.get(obj1._meta.app_label)")]),a("div",[o._v("        db_obj2 = DATABASE_MAPPING.get(obj2._meta.app_label)")]),a("div",[o._v("        if db_obj1 and db_obj2:")]),a("div",[o._v("            if db_obj1 == db_obj2:")]),a("div",[o._v("                return True")]),a("div",[o._v("            else:")]),a("div",[o._v("                return False")]),a("div",[o._v("        return None")]),a("div",[a("br")]),a("div",[o._v("    def allow_syncdb(self, db, model):")]),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v('"""Make sure that apps only appear in the related database."""')])],1),a("div",[o._v("        if db in DATABASE_MAPPING.values():")]),a("div",[o._v("            return DATABASE_MAPPING.get(model._meta.app_label) == db")]),a("div",[o._v("        elif model._meta.app_label in DATABASE_MAPPING:")]),a("div",[o._v("            return False")]),a("div",[o._v("        return None")]),a("div",[a("br")]),a("div",[o._v("    def allow_migrate(self, db, app_label, model=None, **hints):")]),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v('"""')])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("        Make sure the auth app only appears in the 'auth_db'")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("        database.")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v('        """')])],1),a("div",[o._v("        if db in DATABASE_MAPPING.values():")]),a("div",[o._v("            return DATABASE_MAPPING.get(app_label) == db")]),a("div",[o._v("        elif app_label in DATABASE_MAPPING:")]),a("div",[o._v("            return False")]),a("div",[o._v("        return None")])]),a("div",[a("br")]),a("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("# settings.py")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[a("br")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("# DATABASE_ROUTERS = ['项目文件夹.database_router.DatabaseAppsRouter']")])],1),a("div",[a("font",{attrs:{color:"#41AD1C"}},[a("br")])],1),a("div",[o._v("DATABASE_ROUTERS = ['test_dblj.database_router.DatabaseAppsRouter']")])]),a("div",[a("br")]),a("div",[a("span",{staticStyle:{"white-space":"pre-wrap","font-size":"14pt","font-weight":"bold"}},[o._v("3.")]),a("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),a("span",{staticStyle:{"font-size":"14pt"}},[a("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("设置APP所对应的数据库")])])]),a("div",[a("span",{staticStyle:{"font-size":"14pt"}},[a("br")])]),a("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[a("div",[a("font",{staticStyle:{"font-size":"9pt"},attrs:{color:"#41AD1C"}},[o._v("# settings.py")])],1),a("div",[a("font",{staticStyle:{"font-size":"9pt"}},[a("br")])],1),a("div",[a("font",{staticStyle:{"font-size":"9pt"}},[o._v("DATABASE_APPS_MAPPING = {")])],1),a("div",[a("font",{staticStyle:{"font-size":"9pt"}},[a("font",{attrs:{color:"#41AD1C"}},[o._v("# '")]),a("font",{attrs:{color:"#FA7A00"}},[o._v("app_name")]),a("font",{attrs:{color:"#41AD1C"}},[o._v("':'")]),a("font",{attrs:{color:"#FA7A00"}},[o._v("DATABASES配置项中所定义的数据库名")]),a("font",{attrs:{color:"#41AD1C"}},[o._v("',")])],1)],1),a("div",[a("font",{staticStyle:{"font-size":"9pt"}},[o._v("    'app01': 'default',")])],1),a("div",[a("font",{staticStyle:{"font-size":"9pt"}},[o._v("    'app02': 'db_mysql',")])],1),a("div",[a("font",{staticStyle:{"font-size":"9pt"}},[o._v("}")])],1)]),a("div",[a("br")]),a("div",[a("span",{staticStyle:{"white-space":"pre-wrap","font-size":"14pt","font-weight":"bold"}},[o._v("4.")]),a("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),a("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("创建表")])]),a("div",[a("span",{staticStyle:{"font-size":"14pt"}},[a("br")])]),a("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("# app01/models.py")])],1),a("div",[a("br")]),a("div",[o._v("from django.db import models")]),a("div",[a("br")]),a("div",[a("br")]),a("div",[o._v("class UserA(models.Model):")]),a("div",[o._v("    name = models.CharField(max_length=32)")]),a("div",[o._v("    age = models.IntegerField(null=True)")]),a("div",[a("br")]),a("div",[o._v("    class Meta:")]),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("# app_label = 'app的名字'")])],1),a("div",[a("font",{attrs:{color:"#FA7A00"}},[o._v("app_label")]),o._v(" = 'app01' "),a("font",{attrs:{color:"#FF0000"}}),a("font",{attrs:{color:"#E30000"}},[o._v("# 一定要设置 app_label，因为在执行 migrate 的时候会通过 app_label 所设置的 app_name 找到它所对应的数据，如果不设置默认创建到 settings -> DATABASES -> default 所配置的数据库下")])],1)]),a("div",[a("br")]),a("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("# 终端所执行的代码")])],1),a("div",[a("br")]),a("div",[o._v("python manage.py makemigrations "),a("font",{attrs:{color:"#FA7A00"}},[o._v("app01 ")]),o._v(" "),a("font",{attrs:{color:"#41AD1C"}},[a("font",[o._v("# ")]),o._v("记录 app01 下 models.py 中所改动的内容")],1)],1),a("div",[a("br")]),a("div",[a("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[a("font",{attrs:{color:"#41AD1C"}},[o._v("# 或")])],1)]),a("div",[a("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[a("br")])]),a("div",[o._v("python manage.py makemigrations  "),a("font",{attrs:{color:"#41AD1C"}},[o._v("# 记录所有 app 下 models.py 中所改动的内容")])],1)]),a("div",[a("br")]),a("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("# 终端所执行的代码")])],1),a("div",[a("br")]),a("div",[o._v("python manage.py migrate "),a("font",{attrs:{color:"#FA7A00"}},[o._v("app01")]),o._v(" --database "),a("font",{attrs:{color:"#FA7A00"}},[o._v("default ")]),o._v(" "),a("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 默认只会创建 django_migrations 和 你所定义的表，django_session、django_content_type 等都不会创建")])],1),a("div",[a("br")]),a("div",[a("font",{attrs:{color:"#E30000"}},[o._v("# 如果当前app所使用的数据库是default，那么就要执行下面的代码，不能执行上面的代码")])],1),a("div",[a("br")]),a("div",[o._v("python manage.py migrate  "),a("font",{attrs:{color:"#41AD1C"}},[o._v("# ")]),a("font",{attrs:{color:"#FF0000"}},[a("b",[o._v("只在")]),o._v("default数据库下创建")]),o._v(" "),a("font",{attrs:{color:"#41AD1C"}},[o._v("你所定义的表 和 django_session、django_content_type 等表")])],1)]),a("div",[a("br")]),a("hr"),a("div",[a("br")]),a("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("# app02/models.py")])],1),a("div",[a("br")]),a("div",[o._v("from django.db import models")]),a("div",[a("br")]),a("div",[a("br")]),a("div",[o._v("class UserB(models.Model):")]),a("div",[o._v("    name = models.CharField(max_length=32)")]),a("div",[o._v("    age = models.IntegerField(null=True)")]),a("div",[a("br")]),a("div",[o._v("    class Meta:")]),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("# app_label = 'app的名字'")])],1),a("div",[a("font",{attrs:{color:"#FA7A00"}},[o._v("app_label")]),o._v(" = 'app02'  "),a("font",{attrs:{color:"#E30000"}},[o._v("# 一定要设置 app_label，因为在执行 migrate 的时候会通过 app_label 所设置的 app_name 找到它所对应的数据，如果不设置默认创建到 settings -> DATABASES -> default 所配置的数据库下")])],1)]),a("div",[a("br")]),a("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("# 终端所执行的代码")])],1),a("div",[a("br")]),a("div",[o._v("python manage.py makemigrations "),a("font",{attrs:{color:"#FA7A00"}},[o._v("app02 ")]),o._v(" "),a("font",{attrs:{color:"#41AD1C"}},[o._v("# 记录 app02 下 models.py 中所改动的内容")])],1),a("div",[a("br")]),a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("# 或")])],1),a("div",[a("br")]),a("div",[o._v("python manage.py makemigrations  "),a("font",{attrs:{color:"#41AD1C"}},[o._v("# 记录所有 app 下 models.py 中所改动的内容")])],1)]),a("div",[a("br")]),a("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[a("div",[a("font",{attrs:{color:"#41AD1C"}},[o._v("# 终端所执行的代码")])],1),a("div",[a("br")]),a("div",[o._v("python manage.py migrate "),a("font",{attrs:{color:"#FA7A00"}},[o._v("app02")]),o._v(" --database "),a("font",{attrs:{color:"#FA7A00"}},[o._v("db_mysql  ")]),a("font",{attrs:{color:"#41AD1C"}},[o._v("# 默认只会创建 django_migrations 和 你所定义的表，django_session、django_content_type 等都不会创建")])],1)]),a("div",[a("br")])]),a("div",[a("br")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);