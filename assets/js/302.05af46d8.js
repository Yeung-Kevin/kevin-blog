(window.webpackJsonp=window.webpackJsonp||[]).push([[302],{654:function(t,o,r){"use strict";r.r(o);var i=r(25),e=Object(i.a)({},(function(){var t=this,o=t.$createElement,r=t._self._c||o;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("div",[r("span",[r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[t._v("Pipe 管道支持双向通信")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[r("br")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[t._v("Pipe 管道是通过 socket 实现的")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[r("br")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt",color:"rgb(173, 0, 0)","font-weight":"bold"}},[t._v("在管道中数据是不安全的")]),r("span",{staticStyle:{"font-size":"14pt",color:"rgb(173, 0, 0)","font-weight":"bold"}},[t._v("，")]),r("span",{staticStyle:{"font-size":"14pt",color:"rgb(173, 0, 0)","font-weight":"bold"}},[t._v("因为")]),r("span",{staticStyle:{"font-size":"14pt",color:"rgb(173, 0, 0)","font-weight":"bold"}},[t._v("管道")]),r("span",{staticStyle:{"font-size":"14pt",color:"rgb(173, 0, 0)","font-weight":"bold"}},[t._v("中没有锁的机制，")]),r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(173, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("多个进程修改同一块数据时，就会导致数据的混乱")]),r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(173, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("，")]),r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[r("span",{staticStyle:{"font-size":"14pt",color:"rgb(173, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("处理方式上锁")])])]),r("div",[r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[r("br")])]),r("div",[r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[r("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("在管道中如果两个进程同时抢占一个资源的时候，在 Mac 和 Linux 就会报错，处理方式上锁")])])]),r("div",[r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[r("br")])]),r("div",[r("font",{staticStyle:{"font-size":"14pt"}},[r("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("注意：没有被进程使用到的管道需要被关闭")])])],1),r("div",[r("font",{staticStyle:{"font-size":"14pt"}},[r("br")])],1),r("div",[r("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),t._v(" "),r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("Pipe管道的基本使用")])]),r("div",[r("font",{staticStyle:{"font-size":"14pt"}},[r("br")])],1),r("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[r("div",[t._v("from multiprocessing import Pipe")]),r("div",[r("br")]),r("div",[r("br")]),r("div",[t._v("p1, p2 = Pipe()  "),r("font",{attrs:{color:"#41AD1C"}},[t._v("# 返回值：两个对象，可以理解为两条管道")])],1),r("div",[r("br")]),r("div",[r("br")]),r("div",[t._v("p1.send('hello')  "),r("font",{attrs:{color:"#41AD1C"}},[t._v("# 管道p1发送了数据")])],1),r("div",[r("br")]),r("div",[r("br")]),r("div",[t._v("print(p2.recv())  "),r("font",{attrs:{color:"#41AD1C"}},[t._v("# hello 接收p1发送过来的数据，不需要传字节数")])],1),r("div",[r("br")]),r("div",[r("br")]),r("div",[t._v("p2.send('world') "),r("font",{attrs:{color:"#41AD1C"}},[t._v(" # 管道p2发送了数据")])],1),r("div",[r("br")]),r("div",[r("br")]),r("div",[t._v("p2.close() "),r("font",{attrs:{color:"#41AD1C"}},[t._v(" # 关闭 p2 管道")])],1),r("div",[r("br")]),r("div",[r("br")]),r("div",[t._v("print(p1.recv()) "),r("font",{attrs:{color:"#41AD1C"}},[t._v(" # world 接收p2发送过来的数据，")]),r("font",{attrs:{color:"#E30000"}},[t._v("p2管道关闭了还可以接受到数据是因为数据是在关闭管道之前发送的，此时的数据已经存在管道里面了")])],1),r("div",[t._v("print(p1.recv())  "),r("font",{attrs:{color:"#E30000"}},[t._v("# EOFError 报错，当p2管道关闭了且里面没有任何数据那么就会报错，"),r("b",[t._v("一般都会使用报错执行 try 来结束程序")])])],1)]),r("div",[r("br")]),r("div",[r("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),t._v(" "),r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("使用管道实现进程之间的通讯")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[r("br")])]),r("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[r("div",[t._v("from multiprocessing import Pipe")]),r("div",[t._v("from multiprocessing import Process")]),r("div",[t._v("from multiprocessing import Lock")]),r("div",[r("br")]),r("div",[r("br")]),r("div",[t._v("def fun(son):")]),r("div",[t._v("    while True:")]),r("div",[t._v("        try:")]),r("div",[t._v("            print(son.recv())  # "),r("font",{attrs:{color:"#E30000"}},[t._v("接收主进程发送过来的数据")])],1),r("div",[t._v("        except EOFError:")]),r("div",[t._v("            son.close()  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 关闭子进程的管道")])],1),r("div",[t._v("            break")]),r("div",[r("br")]),r("div",[r("br")]),r("div",[t._v("if __name__ == '__main__':")]),r("div",[t._v("    foo, son = Pipe()")]),r("div",[t._v("    p = Process(target=fun, args=(son,))  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 将其中一个管道传递给子进程进行通信")])],1),r("div",[t._v("    p.start()")]),r("div",[t._v("    son.close()  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 将主进程中没有用到的管道关闭掉")])],1),r("div",[r("br")]),r("div",[t._v("    foo.send('hello')")]),r("div",[t._v("    foo.send('hello')")]),r("div",[t._v("    foo.send('hello')")]),r("div",[t._v("    foo.send('hello')")]),r("div",[t._v("    foo.send('hello')")]),r("div",[r("br")]),r("div",[t._v("    foo.close()  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 数据发送完后关闭主进程的管道")])],1)]),r("div",[r("br")]),r("div",[r("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),t._v(" "),r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("使用管道实现生产者消费者模型")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[r("br")])]),r("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[r("div",[t._v("# 生产者消费者模型1")]),r("div",[r("br")]),r("div",[t._v("import time")]),r("div",[t._v("from multiprocessing import Pipe")]),r("div",[t._v("from multiprocessing import Process")]),r("div",[t._v("from multiprocessing import Lock")]),r("div",[r("br")]),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[t._v("# 生产者")])],1),r("div",[t._v("def func1(foo, l):")]),r("div",[t._v("    for i in range(10):")]),r("div",[t._v("        foo.send(i)"),r("font",{staticStyle:{color:"rgb(65, 173, 28)"}}),t._v(" "),r("font",{attrs:{color:"#E30000"}},[t._v("# 发送数据")])],1),r("div",[t._v("    foo.close()  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 关闭管道")])],1),r("div",[r("br")]),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[t._v("# 消费者")])],1),r("div",[t._v("def func2(son, l):")]),r("div",[t._v("    while True:")]),r("div",[t._v("        try:")]),r("div",[t._v("            l.acquire()  "),r("font",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("# 加锁")])],1),r("div",[t._v("            time.sleep(0.1)")]),r("div",[t._v("            print(son.recv()) "),r("font",{attrs:{color:"#E30000"}},[t._v("# 接收生产者发送过来的数据")])],1),r("div",[t._v("            l.release()  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 解锁")])],1),r("div",[t._v("        except EOFError:")]),r("div",[t._v("            l.release() "),r("font",{attrs:{color:"#E30000"}},[t._v(" # 要在这个地方进行解锁，因为上面没有解锁就报错了，如果不在这里解锁就会进行阻塞")])],1),r("div",[t._v("            son.close()  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 关闭管道")])],1),r("div",[t._v("            break")]),r("div",[r("br")]),r("div",[r("br")]),r("div",[t._v("if __name__ == '__main__':")]),r("div",[t._v("    foo, son = Pipe()")]),r("div",[t._v("    l = Lock()")]),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[t._v("  # 生产者进程")])],1),r("div",[t._v("    f1 = Process(target=func1, args=(foo, l))")]),r("div",[t._v("    f1.start()")]),r("div",[t._v("    f2 = Process(target=func1, args=(foo, l))")]),r("div",[t._v("    f2.start()")]),r("div",[t._v("    f3 = Process(target=func1, args=(foo, l))")]),r("div",[t._v("    f3.start()")]),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[t._v("    # 消费者进程")])],1),r("div",[t._v("    s1 = Process(target=func2, args=(son, l))")]),r("div",[t._v("    s1.start()")]),r("div",[t._v("    s2 = Process(target=func2, args=(son, l))")]),r("div",[t._v("    s2.start()")]),r("div",[t._v("    s3 = Process(target=func2, args=(son, l))")]),r("div",[t._v("    s3.start()")]),r("div",[t._v("    s4 = Process(target=func2, args=(son, l))")]),r("div",[t._v("    s4.start()")]),r("div",[r("br")]),r("div",[t._v("    foo.close() "),r("font",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v(" # 关闭主进程没有使用到的管道")])],1),r("div",[t._v("    son.close() "),r("font",{attrs:{color:"#E30000"}},[t._v(" # 关闭主进程没有使用到的管道")])],1)]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[r("br")])]),r("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[r("div",[t._v("# 生产者消费者模型2")]),r("div",[r("br")]),r("div",[t._v("import time")]),r("div",[t._v("from multiprocessing import Pipe")]),r("div",[t._v("from multiprocessing import Process")]),r("div",[t._v("from multiprocessing import Lock")]),r("div",[r("br")]),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[t._v("# 生产者")])],1),r("div",[t._v("def producer(produce, n):")]),r("div",[t._v("    for i in range(n):")]),r("div",[t._v("        produce.send(i)  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 发送数据")])],1),r("div",[t._v("    produce.send(None)  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 发送数据")])],1),r("div",[t._v("    produce.send(None)  "),r("font",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("# 发送数据")])],1),r("div",[t._v("    produce.close()"),r("font",{attrs:{color:"#E30000"}},[t._v("  # 关闭管道")])],1),r("div",[r("br")]),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[t._v("# 消费者")])],1),r("div",[t._v("def consumer(consume, name, lock):")]),r("div",[t._v("    while True:")]),r("div",[t._v("        lock.acquire()  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 加锁")])],1),r("div",[t._v("        baozi = consume.recv()  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 接收生产者发送过来的数据 ")])],1),r("div",[t._v("        lock.release()  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 解锁")])],1),r("div",[t._v("        if baozi:")]),r("div",[t._v("            time.sleep(0.1)")]),r("div",[t._v("            print('%s 吃了包子:%s' % (name, baozi))")]),r("div",[t._v("        else:")]),r("div",[t._v("            consume.close()"),r("font",{attrs:{color:"#E30000"}},[t._v("  # 关闭管道")])],1),r("div",[t._v("            break")]),r("div",[r("br")]),r("div",[r("br")]),r("div",[t._v("if __name__ == '__main__':")]),r("div",[t._v("    produce, consume = Pipe()")]),r("div",[t._v("    lock = Lock()")]),r("div"),r("div",[r("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}}),t._v(" "),r("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[r("font",{attrs:{color:"#41AD1C"}},[t._v("# 生产者进程")])],1)]),r("div",[t._v("    p1 = Process(target=producer, args=(produce, 10))")]),r("div",[t._v("    p1.start()")]),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[t._v(" # 消费者进程")])],1),r("div",[t._v("    c1 = Process(target=consumer, args=(consume, 'Kevin', lock))")]),r("div",[t._v("    c2 = Process(target=consumer, args=(consume, 'Yeung', lock))")]),r("div",[t._v("    c1.start()")]),r("div",[t._v("    c2.start()")]),r("div",[r("br")]),r("div",[t._v("    produce.close()  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 关闭主进程没有使用到的管道")])],1),r("div",[t._v("    consume.close()  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 关闭主进程没有使用到的管道")])],1),r("div",[r("br")]),r("div",[t._v("    p1.join()")]),r("div",[t._v("    c1.join()")]),r("div",[t._v("    c2.join()")]),r("div",[t._v("    print('主进程')")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[r("br")])])])])])}),[],!1,null,null,null);o.default=e.exports}}]);