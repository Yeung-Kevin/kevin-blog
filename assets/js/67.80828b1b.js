(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{444:function(t,i,o){"use strict";o.r(i);var e=o(25),r=Object(e.a)({},(function(){var t=this,i=t.$createElement,o=t._self._c||i;return o("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[o("div",[o("span",[o("div",[o("div",[o("div",[o("div",[o("div",[o("div",[o("div",[o("div",[o("br")]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("rest-framework框架的介绍")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("rest-framework 是根据 RESTful 规范开发出来的一套 Django 的 API 框架")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("rest-framework 是建立在CBV基础上使用的 -> 通俗理解: 如果要是用 rest-framework，那么就一定要使用 CBV 去编写视图")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("rest-framework 的作用: 开发符合 RESTful 规范的接口")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("rest-framework 的10个功能（按请求顺序排序）: 路由 视图 版本 认证 权限 频率 解析器 序列化 分页 渲染器")])])]),o("div",[o("br")])]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","font-weight":"bold","line-height":"1.5","background-color":"#3eaf7c","border-radius":"3px","text-align":"center",color:"white","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","font-weight":"bold","line-height":"1.5","background-color":"#3eaf7c","border-radius":"3px",color:"white","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[t._v("csrf token 的问题")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("在使用 rest-framework 编写接口的时候会默认忽略掉 csrf token 认证中间件")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("原理: 在 .as_view() 返回 view 视图函数的时候会在 view 视图函数上加上 csrf_exempt 装饰器，使其忽略 csrf token 的认证")])])])]),o("div",[o("br")]),o("div",[o("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Django/rest-framework 框架_files/Image.png",type:"image/png"}})]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("如果在编写接口的时候还是发生了 csrf token 问题的解决办法")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("问题一: Postman 可以正常发送请求，但是在浏览器上无法正常发送")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("解决办法一: 以 vue 项目为例: 查看 cookie 中是否存在 csrf token 的相关 cookie，如果存在清楚浏览器所有 cookie 即可")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("解决办法二: 以 vue 项目为例: 先注释掉 csrf token 中间件，然后查看浏览器是否可以正常发送请求，如果可以，删除掉 csrf token 中间件的注释，给视图类下的视图函数单独添加  csrf_exempt 装饰器")])])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from django.utils.decorators import method_decorator")]),o("div",[t._v("from django.views.decorators.csrf import "),o("font",{attrs:{color:"#FA7A00"}},[t._v("csrf_exempt")])],1),o("div",[o("br")]),o("div",[t._v("class Test(APIView):")]),o("div",[t._v("　　@method_decorator("),o("font",{attrs:{color:"#FA7A00"}},[t._v("csrf_exempt")]),t._v(")  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 给类里面的方法加装饰器  需要导入一个方法method_decorator")])],1),o("div",[t._v("　　def post(self, request):")]),o("div",[t._v("　　　　return Response({'a': 1})")])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("问题一: Postman 可以无法发送请求，浏览器上也无法正常发送")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("解决办法: 先注释掉 csrf token 中间件，然后查看Postman是否可以正常发送请求，如果可以，删除掉 csrf token 中间件的注释，给视图类下的视图函数单独添加  csrf_exempt 装饰器")])])])])]),o("div",[o("br")]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("本章节所使用的数据库")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("# models.py")])],1)]),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("from django.db import models")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[t._v("class User(models.Model):")]),o("div",[t._v("    username = models.CharField(max_length=32)")]),o("div",[t._v("    password = models.CharField(max_length=32)")]),o("div",[t._v("    type_choices = ((1, '普通用户'), (2, 'VIP'), (3, 'SVIP'))")]),o("div",[t._v("    user_type = models.IntegerField(choices=type_choices, default=1)")]),o("div",[o("br")]),o("div",[t._v("    def __str__(self):")]),o("div",[t._v("        return self.username")]),o("div",[o("br")]),o("div",[t._v("    class Meta:")]),o("div",[t._v('        verbose_name = "用户表"')]),o("div",[t._v("        verbose_name_plural = verbose_name")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class Token(models.Model):")]),o("div",[t._v("    user = models.OneToOneField(to='User')")]),o("div",[t._v("    token = models.CharField(max_length=128)")]),o("div",[o("br")]),o("div",[t._v("    def __str__(self):")]),o("div",[t._v("        return self.token")]),o("div",[o("br")]),o("div",[t._v("    class Meta:")]),o("div",[t._v('        verbose_name = "Token表"')]),o("div",[t._v("        verbose_name_plural = verbose_name")]),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("class Book(models.Model):")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    title = models.CharField(max_length=32, verbose_name='书名')")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    price = models.IntegerField(verbose_name='价格')")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    pub_date = models.DateField(verbose_name='出版日期')")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}}),t._v("production_date = models.DateTimeField(verbose_name='生产日期', null=True)")],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    publish = models.ForeignKey(\"Publish\", verbose_name='出版社')")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    authors = models.ManyToManyField(\"Author\", verbose_name='作者')")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    def __str__(self):")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        return self.title")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    class Meta:")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v('        verbose_name = "书籍表"')])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        verbose_name_plural = verbose_name")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("class Publish(models.Model):")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    name = models.CharField(max_length=32, verbose_name='出版社名称')")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    email = models.EmailField(verbose_name='邮箱')")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    def __str__(self):")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        return self.name")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    class Meta:")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v('        verbose_name = "出版社表"')])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        verbose_name_plural = verbose_name")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("class Author(models.Model):")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    name = models.CharField(max_length=32, verbose_name='姓名')")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    age = models.IntegerField(verbose_name='年龄')")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    def __str__(self):")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        return self.name")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    class Meta:")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v('        verbose_name = "作者表"')])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        verbose_name_plural = verbose_name")])],1)]),o("div",[o("br")]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("rest-framework 的下载与配置")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 下载 rest-")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("framework ")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[t._v("pip3 install djangorestframework -i https://pypi.douban.com/simple "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 使用豆瓣的镜像")])])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 注册 rest-")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("framework")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),o("div",[o("br")]),o("div",[t._v("INSTALLED_APPS = [")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("……")])],1),o("div",[t._v("    'rest_framework',")]),o("div",[t._v("]")])]),o("div",[o("br")]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("接口类的编写规范")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("在编写接口的时候要注意不能出现异常导致程序运行中断，而是使用 try 对异常进行捕获防治程序运行中断")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("编写好每个异常的状态码（即: code），每个状态码就代表着一个错误信息")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[t._v("注意: 在本章节中只有这里使用了接口类编写规范，其他栏目没有使用需要注意，且一定要按照该规范编写")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# response.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 返回给前端的数据结构")])],1),o("div",[t._v("class BaseResponse(object):")]),o("div",[t._v("    def __init__(self):")]),o("div",[t._v("        self.code = 0")]),o("div",[t._v("        self.data = None")]),o("div",[t._v("        self.msg = ''")]),o("div",[o("br")]),o("div",[t._v("    @property")]),o("div",[t._v("    def dic(self):")]),o("div",[t._v("        return self.__dict__")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# exceptions.py")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 自定义异常类")])],1),o("div",[t._v("class CommonException(Exception):")]),o("div",[t._v("    def __init__(self, code, msg):")]),o("div",[t._v("        self.code = code")]),o("div",[t._v("        self.msg = msg")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[o("br")]),o("div",[t._v("from django.core.exceptions import ObjectDoesNotExist "),o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 如果查询不到数据会抛出该错误")])],1),o("div",[o("br")]),o("div",[t._v("from api.utils.response import BaseResponse")]),o("div",[t._v("from api.utils.exceptions import CommonException  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 自定义异常类")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class Spec(APIView):")]),o("div",[t._v("    def get(self):")]),o("div",[t._v("        res = BaseResponse()")]),o("div",[t._v("        try:")]),o("div",[t._v("            obj1 = 表类.objects.get(pk=xxx)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# .get() 方法如果查询不到就会抛出 ObjectDoesNotExist 异常")])],1),o("div",[t._v("            obj2 = 表类.objects.filter(pk=xxx).first()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 如果查询不到不会抛出异常，只会返回 None")])],1),o("div",[o("br")]),o("div",[t._v("            if not obj2:")]),o("div",[t._v("                raise CommonException(1002, 'xxx不存在2')")]),o("div",[o("br")]),o("div",[t._v("            res.data = {")]),o("div",[t._v("                'xxx': obj1.xxx,")]),o("div",[t._v("                'xxx': obj2.xxx")]),o("div",[t._v("            }")]),o("div",[o("br")]),o("div",[t._v("        except ObjectDoesNotExist as e:")]),o("div",[t._v("            res.msg = 'xxx不存在1'")]),o("div",[t._v("            res.code = 1001")]),o("div",[t._v("        except CommonException as e:")]),o("div",[t._v("            res.msg = e.msg")]),o("div",[t._v("            res.code = e.code")]),o("div",[t._v("        except Exception as e:")]),o("div",[t._v("            print(e)")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# 捕获其他不知道的异常，然后写入日志中")])],1),o("div",[t._v("        return Response(res.dic)")])]),o("div",[o("br")]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("序列化组件")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[t._v("只要继承了 APIView 就可以使用序列化组件")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 序列化组件的基本使用")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("序列化组件 的使用和 form 组件的使用类似，都需要定义一个类，而这个类就叫: 序列化类")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# serializer.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishSerializers(serializers.Serializer):")]),o("div",[t._v("    name = serializers.CharField()")]),o("div",[t._v("    email = serializers.CharField()")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_obj = Publish.objects.all()")]),o("div",[o("br")]),o("div",[t._v("        ps = PublishSerializers(publish_obj, many=True)  "),o("font",{attrs:{color:"#E30000"}},[t._v("# 通过你所创建的 序列化类 序列化数据")])],1),o("div",[t._v("        data = ps.data  "),o("font",{attrs:{color:"#E30000"}},[t._v("# Serializer对象.data 获取序列化后的数据")]),t._v(" "),o("font",{attrs:{color:"#41AD1C"}},[t._v("-> [OrderedDict([('name', '东莞出版社'), ('email', '123@qq.com')]), OrderedDict([('name', '广州出版社'), ('email', '123@qq.com')])]")])],1),o("div",[o("br")]),o("div",[t._v("        return Response(data)")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/publish/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "name": "东莞出版社",')]),o("div",[t._v('        "email": "123@qq.com"')]),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "name": "广州出版社",')]),o("div",[t._v('        "email": "123@qq.com"')]),o("div",[t._v("    }")]),o("div",[t._v("]")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" many 参数")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("many 参数: 说明所要序列化的数据是 queryset对象（查询到的数据列表）还是 查询到的数据对象")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("many=True -> 所要序列化的数据是 queryset对象（查询到的数据列表）")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# serializer.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishSerializers(serializers.Serializer):")]),o("div",[t._v("    name = serializers.CharField()")]),o("div",[t._v("    email = serializers.CharField()")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_obj = Publish.objects.all()")]),o("div",[o("br")]),o("div",[t._v("        ps = PublishSerializers(publish_obj, "),o("font",{attrs:{color:"#FA7A00"}},[t._v("many")]),t._v("=True)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 所要序列化的数据是 queryset对象（查询到的数据列表）")])],1),o("div",[t._v("        data = ps.data")]),o("div",[o("br")]),o("div",[t._v("        return Response(data)")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/publish/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "name": "东莞出版社",')]),o("div",[t._v('        "email": "123@qq.com"')]),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "name": "广州出版社",')]),o("div",[t._v('        "email": "123@qq.com"')]),o("div",[t._v("    }")]),o("div",[t._v("]")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("many=False -> 所要序列化的数据是查询到的数据对象，且 many 参数默认值为False，所以在序列化查询到的数据对象的时候 many 参数可以不用传")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# serializer.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishSerializers(serializers.Serializer):")]),o("div",[t._v("    name = serializers.CharField()")]),o("div",[t._v("    email = serializers.CharField()")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_obj = Publish.objects.all().first()")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# ps = PublishSerializers(publish_obj,")]),t._v(" "),o("font",{attrs:{color:"#FA7A00"}},[t._v("many")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("=False)  # 所要序列化的数据是查询到的数据对象")])],1),o("div",[t._v("        ps = PublishSerializers(publish_obj)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 所要序列化的数据是查询到的数据对象")])],1),o("div",[t._v("        data = ps.data")]),o("div",[o("br")]),o("div",[t._v("        return Response(data)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/publish/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("{")]),o("div",[t._v('    "name": "东莞出版社",')]),o("div",[t._v('    "email": "123@qq.com"')]),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" Response() 方法")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("rest-framework 所提供的 Response() 方法实际上也是继承了 ")]),t._v("HttpResponse ，只是在 HttpResponse 的基础上扩展了一些功能")])]),o("li",[o("div",[t._v("如果使用了 "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("rest-framework 那么就使用它所提供的 ")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("Response() 方法将数据发送给前端")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# serializer.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishSerializers(serializers.Serializer):")]),o("div",[t._v("    name = serializers.CharField()")]),o("div",[t._v("    email = serializers.CharField()")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_obj = Publish.objects.all().first()")]),o("div",[t._v("        ps = PublishSerializers(publish_obj)")]),o("div",[t._v("        data = ps.data")]),o("div",[o("br")]),o("div",[t._v("        return "),o("font",{attrs:{color:"#FA7A00"}},[t._v("Response")]),t._v("(data)")],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("Response() 方法可以直接对 字典、列表、元祖、字符串、数字 进行发送")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[o("br")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        return Response({'a': 1, 'b': 2})")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v(" # return Response([1, 2, 3])")])],1),o("div",[o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        # return Response((1, 2, 3))")])],1),o("div",[o("font",{staticStyle:{color:"rgb(65, 173, 28)"}}),o("font",{attrs:{color:"#41AD1C"}},[t._v("# return Response('字符串')")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        # return Response(10)")])],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("4.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("序列化日期对象并且处理日期格式")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("format='日期格式'")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# serializer.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookSerializers(serializers.Serializer):")]),o("div",[t._v("    title = serializers.CharField()")]),o("div",[t._v("    price = serializers.CharField()")]),o("div",[t._v("    pub_date = serializers.CharField()")]),o("div",[t._v("    production_date = serializers."),o("font",{attrs:{color:"#FA7A00"}},[t._v("DateTimeField")]),t._v("("),o("font",{attrs:{color:"#FA7A00"}},[t._v("format='%Y-%m-%d %H:%M:%S'")]),t._v(")")],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        book_list = Book.objects.all()")]),o("div",[t._v("        bs = BookSerializers(book_list, many=True)")]),o("div",[t._v("        data = bs.data")]),o("div",[t._v("        return Response(data)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "title": "三国演义",')]),o("div",[t._v('        "price": "100",')]),o("div",[t._v('        "pub_date": "2019-08-11",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("production_date")]),t._v('": "2019-08-11 18:07:19"')],1),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "title": "红楼梦",')]),o("div",[t._v('        "price": "200",')]),o("div",[t._v('        "pub_date": "2019-08-11",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("production_date")]),t._v('": "2019-08-11 18:08:06"')],1),o("div",[t._v("    }")]),o("div",[t._v("]")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("4.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("Serializer 类的 depth ")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("参数说明")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("作用: 序列化 一对多 或 多对多 字段")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("depth 的缺点: 获取很多与当前接口无用的字段数据（即: 获取到一对多或多对多字段中的全部数据）")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("depth 值的说明: 必须为数值")])]),o("ul",[o("li",[o("div",[t._v("当前值为0: 序列化出来的是 一对多 或 多对多字段 所保存的 id 值")])]),o("li",[o("div",[t._v("当前值为1: 序列化出来的是 一对多 或 多对多字段 所对应的表的数据")])]),o("li",[o("div",[t._v("当前值为2: 如果 一对多 或 多对多字段 中还有 一对多 或 多对多字段，那么就序列化出该 一对多 或 多对多字段 所对应的表的数据")])]),o("li",[o("div",[t._v("当前数值为n: ……")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("depth 的默认值: 0")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("depth 官方取值范围推荐: 1-10")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("depth = 0")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# serializer.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework import serializers")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookSerializers(serializers.ModelSerializer):")]),o("div",[t._v("    class Meta:")]),o("div",[t._v("        model = Book")]),o("div",[t._v("        fields = '__all__'")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("depth")]),t._v(" = 1")],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        book_list = Book.objects.all()")]),o("div",[t._v("        bs = BookSerializers(book_list, many=True)")]),o("div",[t._v("        return Response(bs.data)")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# ")]),t._v("depth = 0")]),o("div",[o("br")]),o("div",[o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口: http://127.0.0.1:8001/book/")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: GET")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 2,')]),o("div",[t._v('        "title": "三体（第二部）",')]),o("div",[t._v('        "price": 100,')]),o("div",[t._v('        "pub_date": "2012-12-12",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("publish")]),t._v('": 1,')],1),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("authors")]),t._v('": [')],1),o("div",[t._v("            1,")]),o("div",[t._v("            2")]),o("div",[t._v("        ]")]),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 5,')]),o("div",[t._v('        "title": "三国演义",')]),o("div",[t._v('        "price": 100,')]),o("div",[t._v('        "pub_date": "2012-12-12",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("publish")]),t._v('": 1,')],1),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("authors")]),t._v('": [')],1),o("div",[t._v("            1,")]),o("div",[t._v("            2")]),o("div",[t._v("        ]")]),o("div",[t._v("    }")]),o("div",[t._v("]")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# --------------------------------------------------------------")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(" "),o("font",{attrs:{color:"#000000"}},[t._v("depth = 1")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8001/book/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[o("br")])]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 2,')]),o("div",[t._v('        "title": "三体（第二部）",')]),o("div",[t._v('        "price": 100,')]),o("div",[t._v('        "pub_date": "2012-12-12",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("publish")]),t._v('": {')],1),o("div",[t._v('            "id": 1,')]),o("div",[t._v('            "name": "东莞出版社",')]),o("div",[t._v('            "email": "123@qq.com"')]),o("div",[t._v("        },")]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("authors")]),t._v('": [')],1),o("div",[t._v("            {")]),o("div",[t._v('                "id": 1,')]),o("div",[t._v('                "name": "Kevin",')]),o("div",[t._v('                "age": 18')]),o("div",[t._v("            },")]),o("div",[t._v("            {")]),o("div",[t._v('                "id": 2,')]),o("div",[t._v('                "name": "Aimer",')]),o("div",[t._v('                "age": 20')]),o("div",[t._v("            }")]),o("div",[t._v("        ]")]),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 5,')]),o("div",[t._v('        "title": "三国演义",')]),o("div",[t._v('        "price": 100,')]),o("div",[t._v('        "pub_date": "2012-12-12",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("publish")]),t._v('": {')],1),o("div",[t._v('            "id": 1,')]),o("div",[t._v('            "name": "东莞出版社",')]),o("div",[t._v('            "email": "123@qq.com"')]),o("div",[t._v("        },")]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("authors")]),t._v('": [')],1),o("div",[t._v("            {")]),o("div",[t._v('                "id": 1,')]),o("div",[t._v('                "name": "Kevin",')]),o("div",[t._v('                "age": 18')]),o("div",[t._v("            },")]),o("div",[t._v("            {")]),o("div",[t._v('                "id": 2,')]),o("div",[t._v('                "name": "Aimer",')]),o("div",[t._v('                "age": 20')]),o("div",[t._v("            }")]),o("div",[t._v("        ]")]),o("div",[t._v("    }")]),o("div",[t._v("]")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("5.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("Serializer 类的 ")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("source 参数说明")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("source 参数一般用于序列化 choices 字段 和 一对多字段")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("source 参数可以序列化自身字段，但是没有意义")])]),o("ul",[o("li",[o("div",[t._v("即: username = serializers.CharField(source='username') 等同于 username = serializers.CharField()")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("source 参数的值支持像模板语言中的链式操作")])]),o("ul",[o("li",[o("div",[t._v("source='get_choices字段_display' -> source='get_user_type_display'")])]),o("li",[o("div",[t._v("source='一对多字段名.字段' -> source='publish.name'")])]),o("li",[o("div",[t._v("source='多对多字段名.all' -> source='authors.all'")])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("6.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 序列化 ")]),o("span",{staticStyle:{"font-size":"14pt"}},[o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("choices ")])]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("字段的方法")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("使用 source 参数序列化 choices 字段")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("如果不使用 source 参数序列化 choices 字段，那么在序列化 choices 字段的时候默认会取与该字段所保存的数值")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("语法: source='get_choices字段_display'")])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# serializer.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class UserSerializers(serializers.Serializer):")]),o("div",[t._v("    username = serializers.CharField()")]),o("div",[t._v("    user_type = serializers.CharField("),o("font",{attrs:{color:"#FA7A00"}},[t._v("source")]),t._v("='"),o("font",{attrs:{color:"#FA7A00"}},[t._v("get_")]),t._v("user_type"),o("font",{attrs:{color:"#FA7A00"}},[t._v("_display")]),t._v("')")],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class UserView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        user_list = User.objects.all()")]),o("div",[t._v("        us = UserSerializers(user_list, many=True)")]),o("div",[t._v("        print(us.data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# [OrderedDict([('username', 'Kevin'), ('")]),o("font",{attrs:{color:"#FA7A00"}},[t._v("user_type")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("', 'SVIP')]), OrderedDict([('username', 'Aimer'), ('")]),o("font",{attrs:{color:"#FA7A00"}},[t._v("user_type")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("', 'VIP')]), OrderedDict([('username', 'Jack'), ('")]),o("font",{attrs:{color:"#FA7A00"}},[t._v("user_type")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("', '普通用户')])]")])],1),o("div",[t._v("        return Response(us.data)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("#")]),t._v(" "),o("font",{attrs:{color:"#41AD1C"}},[t._v("接口: http://127.0.0.1:8001/user/")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: GET")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "username": "Kevin",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("user_type")]),t._v('": "SVIP"')],1),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "username": "Aimer",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("user_type")]),t._v('": "VIP"')],1),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "username": "Jack",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("user_type")]),t._v('": "普通用户"')],1),o("div",[t._v("    }")]),o("div",[t._v("]")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("7.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt"}},[o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("SerializerMethodField 自定义字段")])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("SerializerMethodField() 字段方法的作用: 自定义字段的返回值")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("使用场景: 当我们想返回一些自定义的值的时候，就可以使用 "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("SerializerMethodField")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("函数名定义规则: get_字段名")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# serializer.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookSerializers(serializers.Serializer):")]),o("div",[t._v("    title = serializers.CharField()")]),o("div",[t._v("    price = serializers.CharField()")]),o("div",[o("br")]),o("div",[t._v("    custom_field = serializers."),o("font",{attrs:{color:"#FA7A00"}},[t._v("SerializerMethodField")]),t._v("()")],1),o("div",[o("br")]),o("div",[t._v("    def "),o("font",{attrs:{color:"#FA7A00"}},[t._v("get_custom_field")]),t._v("(self, obj):")],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :param")]),t._v(" "),o("font",{attrs:{color:"#FA7A00"}},[t._v("obj")]),o("font",{attrs:{color:"#41AD1C"}},[t._v(":")]),t._v(" "),o("font",{attrs:{color:"#FA7A00"}},[t._v("obj 就是数据库中的一条数据")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :")]),o("font",{attrs:{color:"#FA7A00"}},[t._v("return")]),o("font",{attrs:{color:"#41AD1C"}},[t._v(":")]),t._v(" "),o("font",{attrs:{color:"#FA7A00"}},[t._v("所要显示的数据")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('        """')])],1),o("div",[t._v("        price = obj.price")]),o("div",[t._v("        return price + 100")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        book_list = Book.objects.all()")]),o("div",[t._v("        bs = BookSerializers(book_list, many=True)")]),o("div",[t._v("        print(bs.data)  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("#")]),o("font",{attrs:{color:"#41AD1C"}},[t._v(" [OrderedDict([('title', '三体'), ('price', '100'), ('")]),o("font",{attrs:{color:"#FA7A00"}},[t._v("custom_field")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("', 200)]), OrderedDict([('title', '七大罪'), ('price', '50'), ('")]),o("font",{attrs:{color:"#FA7A00"}},[t._v("custom_field")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("', 150)])]")])],1),o("div",[t._v("        return Response(bs.data)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: GET")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "title": "三体",')]),o("div",[t._v('        "price": "100",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("custom_field")]),t._v('": 200')],1),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "title": "七大罪",')]),o("div",[t._v('        "price": "50",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("custom_field")]),t._v('": 150')],1),o("div",[t._v("    }")]),o("div",[t._v("]")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("8.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("context ")]),o("font",{staticStyle:{"font-size":"14pt"}},[o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("参数")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("（即: ")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold",color:"rgb(227, 0, 0)"}},[t._v("在 ")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold",color:"rgb(227, 0, 0)"}},[t._v("serializers 中获取 request 对象")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("）")])])],1),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("视图类没有使用 serializer_class 参数")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("通过 context 参数 "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("serializers 可以接收视图传递过来的参数")])])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        book_list = Book.objects.all()")]),o("div",[t._v("        bs = BookSerializers(book_list, many=True, "),o("font",{attrs:{color:"#FA7A00"}},[t._v("context")]),t._v("={'request': request, 'username': 'Kevin', 'age': 18})")],1),o("div",[t._v("        return Response(bs.data)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# serializers.py")])],1),o("div",[o("br")]),o("div",[t._v("class BookSerializers(serializers.Serializer):")]),o("div",[t._v("    title = serializers.CharField()")]),o("div",[t._v("    price = serializers.CharField()")]),o("div",[o("br")]),o("div",[t._v("    custom_field = serializers.SerializerMethodField()")]),o("div",[o("br")]),o("div",[t._v("    def get_custom_field(self, obj):")]),o("div",[t._v("        print("),o("font",{attrs:{color:"#FA7A00"}},[t._v("self.context")]),t._v(") "),o("font",{attrs:{color:"#41AD1C"}},[t._v(" # {'request': <rest_framework.request.Request object at 0x0000025F75F0D668>, 'age': 18, 'username': 'Kevin'}")])],1),o("div",[t._v("        request = "),o("font",{attrs:{color:"#FA7A00"}},[t._v("self.context")]),t._v(".get('request')")],1),o("div",[t._v("        username = "),o("font",{attrs:{color:"#FA7A00"}},[t._v("self.context")]),t._v(".get('username')")],1),o("div",[t._v("        age = "),o("font",{attrs:{color:"#FA7A00"}},[t._v("self.context")]),t._v(".get('age')")],1),o("div",[t._v("        return 1")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("视图类使用了 serializer_class 参数")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("当视图类使用了 serializer_class 参数，那么 "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("serializers 默认只会接收到三个参数:")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("request -> request 对象，当前视图的请求对象")])]),o("li",[o("div",[t._v("format -> 当前请求期望返回的数据格式")])]),o("li",[o("div",[t._v("view -> 当前请求的类视图对象，相当于视图类中的 self")])])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView(viewsets.ModelViewSet):")]),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("serializer_class")]),t._v(" = BookSerializers")],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# serializers.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("class BookSerializers(serializers.Serializer):")]),o("div",[t._v("    title = serializers.CharField()")]),o("div",[t._v("    price = serializers.CharField()")]),o("div",[o("br")]),o("div",[t._v("    custom_field = serializers.SerializerMethodField()")]),o("div",[o("br")]),o("div",[t._v("    def get_custom_field(self, obj):")]),o("div",[t._v("        print("),o("font",{attrs:{color:"#FA7A00"}},[t._v("self.context")]),t._v(")  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# {'view': <api.views.BookView object at 0x00000229E4FCA5C0>, 'request': <rest_framework.request.Request object at 0x00000229E5077898>, 'format': None}")])],1),o("div",[t._v("        request = "),o("font",{attrs:{color:"#FA7A00"}},[t._v("self.context")]),t._v(".get('request')")],1),o("div",[t._v("        response_format = "),o("font",{attrs:{color:"#FA7A00"}},[t._v("self.context")]),t._v(".get('format')")],1),o("div",[t._v("        view = "),o("font",{attrs:{color:"#FA7A00"}},[t._v("self.context")]),t._v(".get('view')")],1),o("div",[t._v("        return 1")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("9.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 序列化一对多字段的方法 -> 正向查询")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("使用 source 参数序列化一对多字段")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("如果不使用 source 参数序列化一对多字段，那么在序列化一对多字段的时候默认会取与该字段所关联的表类里面的 __str__ 的返回值")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("语法: source='一对多字段名.字段'")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# serializer.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookSerializers(serializers.Serializer):")]),o("div",[t._v("    title = serializers.CharField()")]),o("div",[t._v("    price = serializers.CharField()")]),o("div",[t._v("    pub_date = serializers.CharField()")]),o("div",[t._v("    publish = serializers.CharField("),o("font",{attrs:{color:"#FA7A00"}},[t._v("source")]),t._v("='publish.name')  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 序列化一对多字段，且在序列化一对多字段的时候默认取 publish 表下的 name 字段的数据")])],1)]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        book_list = Book.objects.all()")]),o("div",[t._v("        bs = BookSerializers(book_list, many=True)")]),o("div",[t._v("        print(bs.data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# [OrderedDict([('title', '西游记'), ('price', '111'), ('pub_date', None), ('")]),o("font",{attrs:{color:"#FA7A00"}},[t._v("publish")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("', '东莞出版社')]), OrderedDict([('title', '三体'), ('price', '222'), ('pub_date', None), ('")]),o("font",{attrs:{color:"#FA7A00"}},[t._v("publish")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("', '东莞出版社')])]")])],1),o("div",[t._v("        return Response(bs.data)")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "title": "三体",')]),o("div",[t._v('        "price": "222",')]),o("div",[t._v('        "pub_date": null,')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("publish")]),t._v('": "东莞出版社"')],1),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "title": "三国演义",')]),o("div",[t._v('        "price": "100",')]),o("div",[t._v('        "pub_date": "2012-12-12",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("publish")]),t._v('": "东莞出版社"')],1),o("div",[t._v("    }")]),o("div",[t._v("]")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("10.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 序列化一对多字段的方法 -> 反向查询")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("使用 SerializerMethodField() 字段方法，自定义函数返回值，实现序列化一对多字段的反向查询")])])])]),o("div",[o("font",{staticStyle:{"font-size":"12pt"}},[o("br")])],1),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("SerializerMethodField() 字段方法的作用: 自定义字段的返回值")])])])]),o("div",[o("font",{staticStyle:{"font-size":"12pt"}},[o("br")])],1),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("函数名定义规则: get_字段名")])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# serializer.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("class PublishSerializers(serializers.Serializer):")]),o("div",[t._v("    name = serializers.CharField()")]),o("div",[t._v("    email = serializers.CharField()")]),o("div",[o("br")]),o("div",[t._v("    book = serializers."),o("font",{attrs:{color:"#FA7A00"}},[t._v("SerializerMethodField")]),t._v("()")],1),o("div",[o("br")]),o("div",[t._v("    def "),o("font",{attrs:{color:"#FA7A00"}},[t._v("get_book")]),t._v("(self, obj):")],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :param obj: 当前数据的对象（即: 和查询到的数据对象是一样的）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('        """')])],1),o("div",[t._v("        temp = []")]),o("div",[t._v("        for book in obj.book_set.all():  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 反向查询")])],1),o("div",[t._v("            temp.append({")]),o("div",[t._v("                'title': book.title,")]),o("div",[t._v("                'price': book.price,")]),o("div",[t._v("                'pub_date': book.pub_date,")]),o("div",[t._v("            })")]),o("div",[t._v("        return temp")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_list = Publish.objects.all()")]),o("div",[t._v("        ps = PublishSerializers(publish_list, many=True)")]),o("div",[t._v("        return Response(ps.data)")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8001/publish/")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: GET")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "name": "东莞出版社",')]),o("div",[t._v('        "email": "123@qq.com",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("book")]),t._v('": [')],1),o("div",[t._v("            {")]),o("div",[t._v('                "pub_date": "2012-12-12",')]),o("div",[t._v('                "price": 100,')]),o("div",[t._v('                "title": "三体（第二部）"')]),o("div",[t._v("            },")]),o("div",[t._v("            {")]),o("div",[t._v('                "pub_date": "2012-12-12",')]),o("div",[t._v('                "price": 100,')]),o("div",[t._v('                "title": "三国演义"')]),o("div",[t._v("            },")]),o("div",[t._v("            {")]),o("div",[t._v('                "pub_date": "2012-12-12",')]),o("div",[t._v('                "price": 100,')]),o("div",[t._v('                "title": "红楼梦"')]),o("div",[t._v("            }")]),o("div",[t._v("        ]")]),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "name": "广州出版社",')]),o("div",[t._v('        "email": "123@qq.com",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("book")]),t._v('": []')],1),o("div",[t._v("    }")]),o("div",[t._v("]")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("11.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 序列化多对多字段的方法 -> 正向查询")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("使用 SerializerMethodField() 字段方法，自定义函数返回值，实现序列化多对多字段的正向查询")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("SerializerMethodField() 字段方法的作用: 自定义字段的返回值")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("函数名定义规则: get_字段名")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# serializer.py")])]),o("div",[o("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[o("br")])]),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookSerializers(serializers.Serializer):")]),o("div",[t._v("    title = serializers.CharField()")]),o("div",[t._v("    price = serializers.CharField()")]),o("div",[t._v("    pub_date = serializers.CharField()")]),o("div",[t._v("    authors = serializers."),o("font",{attrs:{color:"#FA7A00"}},[t._v("SerializerMethodField")]),t._v("()")],1),o("div",[o("br")]),o("div",[t._v("    def "),o("font",{attrs:{color:"#FA7A00"}},[t._v("get_authors")]),t._v("(self, obj):")],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :param obj: 当前数据的对象（即: 和查询到的数据对象是一样的）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('        """')])],1),o("div",[t._v("        temp = []")]),o("div",[t._v("        for author in obj.authors.all():")]),o("div",[t._v("            temp.append(author.name)")]),o("div",[t._v("        return temp")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        book_list = Book.objects.all()")]),o("div",[t._v("        bs = BookSerializers(book_list, many=True)")]),o("div",[t._v("        print(bs.data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# [OrderedDict([('title', '西游记'), ('price', '111'), ('pub_date', None), ('")]),o("font",{attrs:{color:"#FA7A00"}},[t._v("authors")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("', ['Kevin'])]), OrderedDict([('title', '三体'), ('price', '222'), ('pub_date', None), ('")]),o("font",{attrs:{color:"#FA7A00"}},[t._v("authors")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("', ['Aimer'])])]")])],1),o("div",[t._v("        return Response(bs.data)")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "title": "三体",')]),o("div",[t._v('        "price": "222",')]),o("div",[t._v('        "pub_date": null,')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("authors")]),t._v('": [')],1),o("div",[t._v('            "Aimer"')]),o("div",[t._v("        ]")]),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "title": "三国演义",')]),o("div",[t._v('        "price": "100",')]),o("div",[t._v('        "pub_date": "2012-12-12",')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("authors")]),t._v('": [')],1),o("div",[t._v('            "Kevin",')]),o("div",[t._v('            "Aimer"')]),o("div",[t._v("        ]")]),o("div",[t._v("    }")]),o("div",[t._v("]")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("12.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 序列化多对多字段的方法 -> 反向查询")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("使用 SerializerMethodField() 字段方法，自定义函数返回值，实现序列化多对多字段的反向查询")])])])]),o("div",[o("font",{staticStyle:{"font-size":"12pt"}},[o("br")])],1),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("SerializerMethodField() 字段方法的作用: 自定义字段的返回值")])])])]),o("div",[o("font",{staticStyle:{"font-size":"12pt"}},[o("br")])],1),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("函数名定义规则: get_字段名")])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# serializer.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class AuthorSerializers(serializers.Serializer):")]),o("div",[t._v("    name = serializers.CharField()")]),o("div",[t._v("    age = serializers.IntegerField()")]),o("div",[o("br")]),o("div",[t._v("    book = serializers."),o("font",{attrs:{color:"#FA7A00"}},[t._v("SerializerMethodField")]),t._v("()")],1),o("div",[o("br")]),o("div",[t._v("    def "),o("font",{attrs:{color:"#FA7A00"}},[t._v("get_book")]),t._v("(self, obj):")],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :param obj: 当前数据的对象（即: 和查询到的数据对象是一样的）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('        """')])],1),o("div",[t._v("        temp = []")]),o("div",[t._v("        for book in obj.book_set.all():  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 反向查询")])],1),o("div",[t._v("            temp.append({")]),o("div",[t._v("                'title': book.title,")]),o("div",[t._v("                'price': book.price,")]),o("div",[t._v("                'pub_date': book.pub_date,")]),o("div",[t._v("            })")]),o("div",[t._v("        return temp")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1)]),o("div",[o("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1)]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class AuthorView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        author_list = Author.objects.all()")]),o("div",[t._v("        aus = AuthorSerializers(author_list, many=True)")]),o("div",[t._v("        return Response(aus.data)")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8001/author/")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: GET")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "name": "Kevin",')]),o("div",[t._v('        "age": 18,')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("book")]),t._v('": [')],1),o("div",[t._v("            {")]),o("div",[t._v('                "title": "红楼梦",')]),o("div",[t._v('                "price": 100,')]),o("div",[t._v('                "pub_date": "2012-12-12"')]),o("div",[t._v("            },")]),o("div",[t._v("            {")]),o("div",[t._v('                "title": "勿忘我",')]),o("div",[t._v('                "price": 100,')]),o("div",[t._v('                "pub_date": "2012-12-12"')]),o("div",[t._v("            }")]),o("div",[t._v("        ]")]),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "name": "Aimer",')]),o("div",[t._v('        "age": 20,')]),o("div",[t._v('        "'),o("font",{attrs:{color:"#FA7A00"}},[t._v("book")]),t._v('": [')],1),o("div",[t._v("            {")]),o("div",[t._v('                "title": "三体（第二部）",')]),o("div",[t._v('                "price": 100,')]),o("div",[t._v('                "pub_date": "2012-12-12"')]),o("div",[t._v("            },")]),o("div",[t._v("            {")]),o("div",[t._v('                "title": "三国演义",')]),o("div",[t._v('                "price": 100,')]),o("div",[t._v('                "pub_date": "2012-12-12"')]),o("div",[t._v("            },")]),o("div",[t._v("            {")]),o("div",[t._v('                "title": "超人",')]),o("div",[t._v('                "price": 100,')]),o("div",[t._v('                "pub_date": "2012-12-12"')]),o("div",[t._v("            }")]),o("div",[t._v("        ]")]),o("div",[t._v("    }")]),o("div",[t._v("]")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("13.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 验证数据是否有误")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("一般都是验证提交过来的数据")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("这里的验证数据功能和Form组件或者ModelForm是一样的")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# serializer.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishSerializers(serializers.Serializer):")]),o("div",[t._v("    name = serializers.CharField(error_messages={'required': '出版社名称不能为空'})")]),o("div",[t._v("    email = serializers.CharField(error_messages={'required': '邮箱不能为空'})")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[t._v("    def post(self, request):")]),o("div",[t._v("        ps = PublishSerializers("),o("font",{attrs:{color:"#FA7A00"}},[t._v("data")]),t._v("=request.data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 将提交过来的数据传入data参数中进行验证")])],1),o("div",[t._v("        if ps."),o("font",{attrs:{color:"#FA7A00"}},[t._v("is_valid")]),t._v("():  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 验证提交过来的数据")])],1),o("div",[t._v("            print(ps."),o("font",{attrs:{color:"#FA7A00"}},[t._v("validated_data")]),t._v(")  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取验证通过的数据 -> OrderedDict([('name', '深圳出版社'), ('email', '123@qq.com')])")])],1),o("div",[t._v("            publish = Publish.objects.create(**ps.validated_data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 将数据保存到数据库")])],1),o("div",[t._v("            p_ps = PublishSerializers(publish)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 序列化数据")])],1),o("div",[t._v("            return Response(p_ps.data)")]),o("div",[t._v("        else:")]),o("div",[t._v("            print(ps."),o("font",{attrs:{color:"#FA7A00"}},[t._v("errors")]),t._v(")  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取验证失败后的错误信息")])],1),o("div",[t._v("            return Response(ps.errors)")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 添加出版社")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/publish/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: POST")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 发送数据的编码格式: application/json -> 即: json 格式")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 所要发送的数据: ")]),t._v('{"name":"上海出版社","email":"123@qq.com"}')],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("{")]),o("div",[t._v('    "name": "上海出版社",')]),o("div",[t._v('    "email": "123@qq.com"')]),o("div",[t._v("}")])]),o("div",[o("br")]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("APIView 的 request 对象 ")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" APIView 的 request对象 说明")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("这里所指的request对象就是 FBV 或 CBV 中的 request 对象")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("APIView（在")]),t._v(" rest-framework 中 CBV 所要继承的类"),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("） 的 request 对象是在 View（即: 以前CBV中所继承的类） 的 request 对象的基础上进行封装的，所以在使用")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("在使用")]),t._v(" rest-framework 中的 CBV 里的 request 对象是一个全新的 request 对象")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("View 的 request 对象有的功能，APIView 的 request 对象都有")])])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" APIView 的 request对象 所提供的常用属性:")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("request.GET -> 获取GET请求参数")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[o("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[o("br")])]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[o("br")]),o("div",[t._v("        get_data = "),o("font",{attrs:{color:"#FA7A00"}},[t._v("request.GET")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 等同于")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        # get_data = request._request.GET")])],1),o("div",[o("br")]),o("div",[t._v("        print(get_data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# <QueryDict: {'b': ['2'], 'a': ['1']}>")])],1),o("div",[o("br")]),o("div",[t._v("        return HttpResponse('get请求')")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("request.query_params -> "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("获取GET请求参数")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("request.query_params 等同于 "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("request.GET")])])]),o("li",[o("div",[t._v("request.query_params 实际上是执行了 request._request.GET")])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[o("br")]),o("div",[t._v("        get_data = "),o("font",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("request.query_params")])],1),o("div",[o("br")]),o("div",[t._v("        print(get_data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# <QueryDict: {'name': ['三国演义'], 'price': ['100']}>")])],1),o("div",[t._v("        print(get_data.get('name'))  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 三国演义")])],1),o("div",[t._v("        print(get_data.get('price'))  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 100")])],1),o("div",[o("br")]),o("div",[t._v("        return HttpResponse('get请求')")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("request.data -> 获取除GET请求外的其他请求参数（即: POST/PUT/")]),t._v("PATCH 等请求的参数"),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("）")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("在不使用 rest-framework 之前，request.POST 只能获取以 application/x-www-form-urlencoded 编码格式发送过来的数据，其他编码格式发送过来的数据（如: application/json）都只能通过 request.body 获取，然后自行解析，但是在 rest-framework 可以通过 request.data 获取不同编码格式发送过来的数据，并且帮我们进行解析")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[o("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[o("br")])]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[o("br")]),o("div",[t._v("    def post(self, request):")]),o("div",[t._v("        data = "),o("font",{attrs:{color:"#FA7A00"}},[t._v("request.data")])],1),o("div",[t._v("        print(data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 以 application/json 编码格式提交过来的数据 -> {'name': 'Kevin', 'age': 18}")])],1),o("div",[t._v("        return HttpResponse('post请求')")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("request._request -> 获取 View 的 request 对象（即: 旧的request对象）")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[o("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[o("br")])]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        get_data = "),o("font",{attrs:{color:"#FA7A00"}},[t._v("request._request")]),t._v(".GET")],1),o("div",[t._v("        print(get_data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# <QueryDict: {'b': ['2'], 'a': ['1']}>")])],1),o("div",[t._v("        return HttpResponse('get请求')")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("    def post(self, request):")]),o("div",[t._v("        post_data = "),o("font",{attrs:{color:"#FA7A00"}},[t._v("request._request")]),t._v(".POST")],1),o("div",[t._v("        print(post_data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# <QueryDict: {'age': ['18'], 'name': ['Kevin']}>")])],1),o("div",[t._v("        return HttpResponse('post请求')")])]),o("div",[o("br")]),o("div",[o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("序列化数据的方式")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"18.6667px"}},[t._v("这里的序列化数据指的是将 ")]),o("span",{staticStyle:{"font-size":"18.6667px",color:"rgb(250, 122, 0)"}},[t._v("queryset对象")]),o("span",{staticStyle:{"font-size":"18.6667px"}},[t._v(" 或 ")]),o("span",{staticStyle:{"font-size":"18.6667px",color:"rgb(65, 173, 28)"}},[t._v("查询到的数据对象")]),o("span",{staticStyle:{"font-size":"18.6667px"}},[t._v(" 转换成 ")]),o("span",{staticStyle:{"font-size":"18.6667px",color:"rgb(250, 122, 0)"}},[t._v("列表")]),o("span",{staticStyle:{"font-size":"18.6667px"}},[t._v(" 或 ")]),o("span",{staticStyle:{"font-size":"18.6667px",color:"rgb(65, 173, 28)"}},[t._v("字典，")]),o("span",{staticStyle:{"font-size":"18.6667px"}},[t._v("然后将序列化好的数据发送给前端")])])]),o("div",[o("span",{staticStyle:{"font-size":"18.6667px"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 序列化 queryset 对象（查询到的数据列表）")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("方式一")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from django.http import JsonResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_queryset = Publish.objects.all().values('name', 'email')")]),o("div",[t._v("        publish_list = list(publish_queryset)")]),o("div",[t._v("        print(publish_list)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# [{'name': '东莞出版社', 'email': '123@qq.com'}, {'name': '广州出版社', 'email': '123@qq.com'}]")])],1),o("div",[t._v("        return JsonResponse(publish_list, safe=False)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("方式二")])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from django.http import JsonResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from django.forms.models import model_to_dict")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_queryset = Publish.objects.all()")]),o("div",[t._v("        publish_list = []")]),o("div",[t._v("        for publish in publish_queryset:")]),o("div",[t._v("            publish_list.append(model_to_dict(publish))")]),o("div",[t._v("        print(publish_list)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# [{'id': 1, 'name': '东莞出版社', 'email': '123@qq.com'}, {'id': 2, 'name': '广州出版社', 'email': '123@qq.com'}]")])],1),o("div",[t._v("        return JsonResponse(publish_list, safe=False)")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("方式三")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from django.core import serializers")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_queryset = Publish.objects.all()")]),o("div",[t._v('        publish_list = serializers.serialize("json", publish_queryset)')]),o("div",[t._v("        print(publish_list)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v('# [{"model": "app01.publish", "pk": 1, "fields": {"name": "\\u4e1c\\u839e\\u51fa\\u7248\\u793e", "email": "123@qq.com"\'+\'}\'+\'}\'}}, {"model": "app01.publish", "pk": 2, "fields": {"name": "\\u5e7f\\u5dde\\u51fa\\u7248\\u793e", "email": "123@qq.com"\'+\'}\'+\'}\'}}]')])],1),o("div",[t._v("        return HttpResponse(publish_list)")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("方式四 -> 推荐使用")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# serializer.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishSerializers(serializers.Serializer):")]),o("div",[t._v("    name = serializers.CharField()")]),o("div",[t._v("    email = serializers.CharField()")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_queryset = Publish.objects.all().values('name', 'email')")]),o("div",[t._v("        ps = PublishSerializers(publish_queryset, many=True)")]),o("div",[t._v("        print(ps.data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取序列化之后的数据 -> [OrderedDict([('name', '东莞出版社'), ('email', '123@qq.com')]), OrderedDict([('name', '广州出版社'), ('email', '123@qq.com')])]")])],1),o("div",[t._v("        return Response(ps.data)")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 序列化查询到的数据对象")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("方式一")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from django.http import JsonResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from django.forms.models import model_to_dict")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_obj = Publish.objects.all().first()")]),o("div",[t._v("        publish_dict = model_to_dict(publish_obj)")]),o("div",[t._v("        print(publish_dict)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# {'email': '123@qq.com', 'name': '东莞出版社', 'id': 1}")])],1),o("div",[t._v("        return JsonResponse(publish_dict)")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("方式二")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# serializer.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework import serializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishSerializers(serializers.Serializer):")]),o("div",[t._v("    name = serializers.CharField()")]),o("div",[t._v("    email = serializers.CharField()")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])]),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_obj = Publish.objects.all().first()")]),o("div",[t._v("        ps = PublishSerializers(publish_obj)")]),o("div",[t._v("        print(ps.data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取序列化之后的数据 -> {'email': '123@qq.com', 'name': '东莞出版社'}")])],1),o("div",[t._v("        return Response(ps.data)")])]),o("div",[o("br")])]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("ModelSerializer")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[t._v("只要继承了 APIView 就可以使用 ")]),o("span",{staticStyle:{"font-size":"14pt"}},[t._v("ModelSerializer")]),o("span",{staticStyle:{"font-size":"14pt"}})]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[t._v("ModelSerializer")]),o("span",{staticStyle:{"font-size":"14pt"}},[t._v(" 的使用和 ModelForm 组件的使用类似")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt"}},[o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("ModelSerializer的基本使用")])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{staticStyle:{color:"rgb(65, 173, 28)","font-size":"9pt"}},[t._v("# serializer.py")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"},attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("from rest_framework import serializers")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("from .models import *")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("class BookSerializers(serializers.ModelSerializer):")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    class Meta:")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        model = Book")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        fields = '__all__'")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 自定义错误信息")])],1)],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        extra_kwargs = {")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v('            "title": {')])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                'error_messages': {")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                    'required': '书籍名称不能为空'")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                }")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("            },")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("            'price': {")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                'error_messages': {")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                    'required': '价格不能为空'")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                }")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("            },")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("            'pub_date': {")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                'error_messages': {")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                    'required': '日期不能为空'")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                }")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("            },")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("            'publish': {")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                'error_messages': {")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                    'required': '出版社不能为空'")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                }")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("            },")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("            'author': {")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                'error_messages': {")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                    'required': '作者不能为空'")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("                }")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("            }")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        }")])],1)]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 查看所有书籍")])],1),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        book_list = Book.objects.all()")]),o("div",[t._v("        bs = BookSerializers(book_list, many=True)")]),o("div",[t._v("        return Response(bs.data)")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 添加书籍")])],1),o("div",[t._v("    def post(self, request):")]),o("div",[t._v("        bs = BookSerializers(data=request.data)")]),o("div",[t._v("        if bs.is_valid():  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 验证数据是否有误")])],1),o("div",[t._v("            print(bs.validated_data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 验证过后正确的数据: OrderedDict([('title', '三国演义'), ('price', 100), ('pub_date', datetime.date(2012, 12, 12)), ('publish', <Publish: 东莞出版社>), ('authors', [<Author: Kevin>, <Author: Aimer>])])")])],1),o("div",[t._v("            bs.save()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 保存数据，实际上调用的是 rest-framework 中的 create 方法")])],1),o("div",[t._v("            return Response(bs.data)")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response(bs.errors)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# bs.errors 验证过后的错误信息")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookDetailView(APIView):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 查看指定的书籍")])],1),o("div",[t._v("    def get(self, request, id):")]),o("div",[t._v("        book_obj = Book.objects.filter(pk=id).first()")]),o("div",[t._v("        if book_obj:")]),o("div",[t._v("            bs = BookSerializers(book_obj)")]),o("div",[t._v("            return Response(bs.data)")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response({'static': 0, 'message': '没有该书籍'})")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 修改书籍")])],1),o("div",[t._v("    def put(self, request, id):")]),o("div",[t._v("        book_obj = Book.objects.filter(pk=id).first()")]),o("div",[t._v("        bs = BookSerializers(book_obj, data=request.data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 修改数据的时候一定要指定修改那条数据（即: book_obj），否则在执行 .save() 的时候就相当于新增数据")])],1),o("div",[t._v("        if bs.is_valid():  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 验证数据是否有误")])],1),o("div",[t._v("            bs.save()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 保存数据，实际上调用的是 rest-framework 中的 update 方法")])],1),o("div",[t._v("            return Response(bs.data)")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response(bs.errors)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# bs.errors 验证过后的错误信息")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 删除书籍")])],1),o("div",[t._v("    def delete(self, request, id):")]),o("div",[t._v("        Book.objects.filter(pk=id).delete()")]),o("div",[t._v("        return Response()")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# urls.py")])],1),o("div",[o("br")]),o("div",[t._v("urlpatterns = [")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("……")])],1),o("div",[t._v("    url(r'book/$', BookView.as_view()),")]),o("div",[t._v("    url(r'book/(\\d+)', BookDetailView.as_view())")]),o("div",[t._v("]")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 查看所有书籍")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 2,')]),o("div",[t._v('        "title": "三体",')]),o("div",[t._v('        "price": 222,')]),o("div",[t._v('        "pub_date": null,')]),o("div",[t._v('        "publish": 1,')]),o("div",[t._v('        "authors": [')]),o("div",[t._v("            2")]),o("div",[t._v("        ]")]),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 5,')]),o("div",[t._v('        "title": "三国演义",')]),o("div",[t._v('        "price": 100,')]),o("div",[t._v('        "pub_date": "2012-12-12",')]),o("div",[t._v('        "publish": 1,')]),o("div",[t._v('        "authors": [')]),o("div",[t._v("            1,")]),o("div",[t._v("            2")]),o("div",[t._v("        ]")]),o("div",[t._v("    }")]),o("div",[t._v("]")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# --------------------------------------------------------------")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 添加书籍")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: POST")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 发送数据的编码格式: application/json -> 即: json 格式")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 所要发送的数据: ")]),t._v('{"title":"勿忘我","price":100,"pub_date":"2012-12-12","publish":1,"authors":[1,2]}')],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("{")]),o("div",[t._v('    "id": 14,')]),o("div",[t._v('    "title": "勿忘我",')]),o("div",[t._v('    "price": 100,')]),o("div",[t._v('    "pub_date": "2012-12-12",')]),o("div",[t._v('    "publish": 1,')]),o("div",[t._v('    "authors": [')]),o("div",[t._v("        1,")]),o("div",[t._v("        2")]),o("div",[t._v("    ]")]),o("div",[t._v("}")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# --------------------------------------------------------------")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 查看指定书籍")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/2")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("{")]),o("div",[t._v('    "id": 2,')]),o("div",[t._v('    "title": "三体",')]),o("div",[t._v('    "price": 222,')]),o("div",[t._v('    "pub_date": null,')]),o("div",[t._v('    "publish": 1,')]),o("div",[t._v('    "authors": [')]),o("div",[t._v("        2")]),o("div",[t._v("    ]")]),o("div",[t._v("}")]),o("div",[o("br")]),o("div",[o("font",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("# --------------------------------------------------------------")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 修改书籍")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/2")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: PUT")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 发送数据的编码格式: application/json -> 即: json 格式")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 所要发送的数据: ")]),t._v('{"title":"三体（第二部）","price":100,"pub_date":"2012-12-12","publish":1,"authors":[1,2]}')],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("{")]),o("div",[t._v('    "id": 2,')]),o("div",[t._v('    "title": "三体（第二部）",')]),o("div",[t._v('    "price": 100,')]),o("div",[t._v('    "pub_date": "2012-12-12",')]),o("div",[t._v('    "publish": 1,')]),o("div",[t._v('    "authors": [')]),o("div",[t._v("        2,")]),o("div",[t._v("        1")]),o("div",[t._v("    ]")]),o("div",[t._v("}")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# --------------------------------------------------------------")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 删除书籍")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/11")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: DELETE")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("空")])],1)]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("save() 方法的说明")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("执行 save() 之前一定要执行 is_valid() 方法，否则会报错")])])])]),o("div",[o("font",{staticStyle:{"font-size":"12pt"}},[o("br")])],1),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v(".save() 方法的返回值就是所添加/修改的该条数据对象")])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 添加书籍")])],1),o("div",[t._v("    def post(self, request):")]),o("div",[t._v("        bs = BookSerializers(data=request.data)")]),o("div",[t._v("        if bs."),o("font",{attrs:{color:"#FA7A00"}},[t._v("is_valid")]),t._v("():  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 验证数据是否有误")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("data_obj")]),t._v(" = bs.save()")],1),o("div",[t._v("            print(data_obj.title, data_obj.price)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 三体 100")])],1),o("div",[t._v("            return Response(bs.data)")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response(bs.errors)")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("自定制字段")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("当 fields = '__all__' 的时候，但是又想对里面的某些字段进行单独配置的时候，可以直接在 ModelSerializer 类中重新编写该字段，那么该字段的配置就会覆盖掉之前的配置")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(147, 150, 0)"}},[t._v("建议:")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v(" 如果使用了 ModelSerializer 就尽量不要自定制字段，否则容易出现问题")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("注意: ")])])]),o("ul",[o("li",[o("div",[t._v("当自定制一对多字段的时候，并且使用了source参数，那么就需要重写save()方法中的create()和update()方法 ")])]),o("li",[o("div",[t._v("当自定制多对多字段的时候，添加或修改数据多对多字段的数据会有问题")])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# serializer.py ")])],1),o("div",[o("br")]),o("div",[t._v("class BookSerializers(serializers.ModelSerializer):")]),o("div",[t._v("    class Meta:")]),o("div",[t._v("        model = Book")]),o("div",[t._v("        fields = '__all__'")]),o("div",[t._v("        extra_kwargs = {")]),o("div",[t._v('            "title": {')]),o("div",[t._v("                'error_messages': {")]),o("div",[t._v("                    'required': '书籍名称不能为空'")]),o("div",[t._v("                }")]),o("div",[t._v("            },")]),o("div",[t._v("            'price': {")]),o("div",[t._v("                'error_messages': {")]),o("div",[t._v("                    'required': '价格不能为空'")]),o("div",[t._v("                }")]),o("div",[t._v("            },")]),o("div",[t._v("            'pub_date': {")]),o("div",[t._v("                'error_messages': {")]),o("div",[t._v("                    'required': '日期不能为空'")]),o("div",[t._v("                }")]),o("div",[t._v("            },")]),o("div",[t._v("            'publish': {")]),o("div",[t._v("                'error_messages': {")]),o("div",[t._v("                    'required': '出版社不能为空'")]),o("div",[t._v("                }")]),o("div",[t._v("            },")]),o("div",[t._v("            'author': {")]),o("div",[t._v("                'error_messages': {")]),o("div",[t._v("                    'required': '作者不能为空'")]),o("div",[t._v("                }")]),o("div",[t._v("            }")]),o("div",[t._v("        }")]),o("div",[o("br")]),o("div",[t._v('    publish = serializers.CharField(source="publish.name")  '),o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 重新编写 publish 字段的配置")])],1)]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("4.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 重写 save() 中的 create() 和 ")]),o("span",{staticStyle:{"font-size":"14pt"}},[o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("update()")])]),t._v(" "),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("方法")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v(".save()方法实际上调用的是 rest-framework 中的 create 或者 update 方法")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("重写create()/update()方法就是自己将提交过来的数据保存到数据库，并且返回当前保存的数据")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("什么时候需要重写")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("当使用了自定制字段，并且再字段方法中传递了source参数 -> 通俗理解: 当自定制一对多字段的时候，并且使用了source参数，那么就需要重写save()方法中的create()和update()方法 ")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# serializer.py")])],1),o("div",[o("br")]),o("div",[t._v("class BookSerializers(serializers.ModelSerializer):")]),o("div",[t._v("    class Meta:")]),o("div",[t._v("        model = Book")]),o("div",[t._v("        fields = '__all__'")]),o("div",[t._v("        extra_kwargs = {")]),o("div",[t._v('            "title": {')]),o("div",[t._v("                'error_messages': {")]),o("div",[t._v("                    'required': '书籍名称不能为空'")]),o("div",[t._v("                }")]),o("div",[t._v("            },")]),o("div",[t._v("            'price': {")]),o("div",[t._v("                'error_messages': {")]),o("div",[t._v("                    'required': '价格不能为空'")]),o("div",[t._v("                }")]),o("div",[t._v("            },")]),o("div",[t._v("            'pub_date': {")]),o("div",[t._v("                'error_messages': {")]),o("div",[t._v("                    'required': '日期不能为空'")]),o("div",[t._v("                }")]),o("div",[t._v("            },")]),o("div",[t._v("            'publish': {")]),o("div",[t._v("                'error_messages': {")]),o("div",[t._v("                    'required': '出版社不能为空'")]),o("div",[t._v("                }")]),o("div",[t._v("            },")]),o("div",[t._v("            'author': {")]),o("div",[t._v("                'error_messages': {")]),o("div",[t._v("                    'required': '作者不能为空'")]),o("div",[t._v("                }")]),o("div",[t._v("            }")]),o("div",[t._v("        }")]),o("div",[o("br")]),o("div",[t._v('    publish = serializers.CharField(source="publish.pk")  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 重新编写 publish 字段的配置")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# ")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("重写 save() 中的 create() 方法")])],1),o("div",[t._v("    def create(self, validated_data):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :param validated_data: 通过验证的数据")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('        """')])],1),o("div",[t._v("        print(validated_data)")]),o("div",[o("br")]),o("div",[t._v("        book = Book.objects.create(title=validated_data['title'], price=validated_data['price'], pub_date=validated_data['pub_date'], publish_id=validated_data['publish']['pk'])")]),o("div",[t._v('        book.authors.add(*validated_data["authors"])')]),o("div",[o("br")]),o("div",[t._v("        return book")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# ")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("重写 save() 中的 update() 方法")])],1),o("div",[t._v("    def update(self, instance, validated_data):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :param instance: 需要修改的查询到的数据对象")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :param validated_data: 通过验证的数据")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('        """')])],1),o("div",[t._v("        for key, val in validated_data.items():")]),o("div",[t._v("            if hasattr(instance, key):")]),o("div",[t._v("                if 'publish' == key:")]),o("div",[t._v("                    instance.publish_id = validated_data['publish']['pk']")]),o("div",[t._v("                elif 'authors' == key:")]),o("div",[t._v("                    instance.authors.set(validated_data['authors'])")]),o("div",[t._v("                else:")]),o("div",[t._v("                    setattr(instance, key, val)")]),o("div",[t._v("        instance.save()")]),o("div",[t._v("        return instance")])]),o("div",[o("br")]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("超链接API: Hyperlinked")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt"}},[o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("HyperlinkedIdentityField 字段方法")])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("HyperlinkedIdentityField 字段方法一般都是用在一对多字段上")])])]),o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("HyperlinkedIdentityField 字段方法返回的是一个url路径")])])]),o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("HyperlinkedIdentityField 字段方法一般在前后端分离的时候很少会使用")])])]),o("li",[o("div",[t._v("使用场景: 分页器")])]),o("li",[o("div",[o("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("注意")]),t._v(": 如果你所定义的 序列化类 使用了 "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("HyperlinkedIdentityField 字段方法，那么在实例化 序列化")]),t._v("类 的时候一定要设置 context={'request': request}，否则会报错")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# urls.py")])],1),o("div",[o("br")]),o("div",[t._v("urlpatterns = [")]),o("div",[t._v("    url(r'^admin/', admin.site.urls),")]),o("div",[t._v("    url(r'publish/(?P<"),o("font",{attrs:{color:"#FA7A00"}},[t._v("pk")]),t._v(">\\d+)', PublishDetailView.as_view(), "),o("font",{attrs:{color:"#FA7A00"}},[t._v("name")]),t._v("='publish_detail'),")],1),o("div",[t._v("    url(r'book/$', BookView.as_view())")]),o("div",[t._v("]")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# serializer.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework import serializers")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishSerializers(serializers.Serializer):")]),o("div",[t._v("    name = serializers.CharField()")]),o("div",[t._v("    email = serializers.CharField()")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookSerializers(serializers.ModelSerializer):")]),o("div",[t._v("    class Meta:")]),o("div",[t._v("        model = Book")]),o("div",[t._v("        fields = '__all__'")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# view_name -> url别名")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("    # lookup_field -> 当前外键字段（一对多）在数据库中的字段名")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("    # lookup_url_kwarg -> 分组命名匹配中的别名")])],1),o("div",[o("br")]),o("div",[t._v("    publish = serializers."),o("font",{attrs:{color:"#FA7A00"}},[t._v("HyperlinkedIdentityField")]),t._v("(view_name='publish_detail', lookup_field='publish_id', lookup_url_kwarg='pk')")],1)]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看所有书籍")])],1),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        book_list = Book.objects.all()")]),o("div",[t._v("        bs = BookSerializers(book_list, many=True, "),o("font",{attrs:{color:"#FA7A00"}},[t._v("context")]),t._v("={'request': request})  "),o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 如果你所定义的 序列化类 使用了 HyperlinkedIdentityField 字段方法，那么在实例化 序列化类 的时候一定要设置 context={'request': request}，否则会报错")])],1),o("div",[t._v("        return Response(bs.data)")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishDetailView(APIView):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看指定的出版社")])],1),o("div",[t._v("    def get(self, request, pk):")]),o("div",[t._v("        publish_obj = Publish.objects.filter(pk=pk).first()")]),o("div",[t._v("        if publish_obj:")]),o("div",[t._v("            ps = PublishSerializers(publish_obj)")]),o("div",[t._v("            return Response(ps.data)")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response({'static': 0, 'message': '没有该出版社'})")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 2,')]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v('"publish": "http://127.0.0.1:8000/publish/1",')])],1),o("div",[t._v('        "title": "三体",')]),o("div",[t._v('        "price": 222,')]),o("div",[t._v('        "pub_date": null,')]),o("div",[t._v('        "authors": [')]),o("div",[t._v("            2")]),o("div",[t._v("        ]")]),o("div",[t._v("    },")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("……")])],1),o("div",[o("br")]),o("div",[t._v("]")])]),o("div",[o("br")])]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("视图四部曲")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 混合使用")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看所有书籍")])],1),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        book_list = Book.objects.all()")]),o("div",[t._v("        bs = BookSerializers(book_list, many=True)")]),o("div",[t._v("        return Response(bs.data)")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 添加书籍")])],1),o("div",[t._v("    def post(self, request):")]),o("div",[t._v("        bs = BookSerializers(data=request.data)")]),o("div",[t._v("        if bs.is_valid():  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 验证数据是否有误")])],1),o("div",[t._v("            print(bs.validated_data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 验证过后正确的数据: OrderedDict([('title', '三国演义'), ('price', 100), ('pub_date', datetime.date(2012, 12, 12)), ('publish', <Publish: 东莞出版社>), ('authors', [<Author: Kevin>, <Author: Aimer>])])")])],1),o("div",[t._v("            bs.save()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 保存数据，实际上调用的是 rest-framework 中的 create 方法")])],1),o("div",[t._v("            return Response(bs.data)")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response(bs.errors)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# bs.errors 验证过后的错误信息")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookDetailView(APIView):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看指定的书籍")])],1),o("div",[t._v("    def get(self, request, id):")]),o("div",[t._v("        book_obj = Book.objects.filter(pk=id).first()")]),o("div",[t._v("        if book_obj:")]),o("div",[t._v("            bs = BookSerializers(book_obj)")]),o("div",[t._v("            return Response(bs.data)")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response({'static': 0, 'message': '没有该书籍'})")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 修改书籍")])],1),o("div",[t._v("    def put(self, request, id):")]),o("div",[t._v("        book_obj = Book.objects.filter(pk=id).first()")]),o("div",[t._v("        bs = BookSerializers(book_obj, data=request.data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 修改数据的时候一定要指定修改那条数据（即: book_obj），否则在执行 .save() 的时候就相当于新增数据")])],1),o("div",[t._v("        if bs.is_valid():  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 验证数据是否有误")])],1),o("div",[t._v("            bs.save()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 保存数据，实际上调用的是 rest-framework 中的 update 方法")])],1),o("div",[t._v("            return Response(bs.data)")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response(bs.errors)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# bs.errors 验证过后的错误信息")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 删除书籍")])],1),o("div",[t._v("    def delete(self, request, id):")]),o("div",[t._v("        Book.objects.filter(pk=id).delete()")]),o("div",[t._v("        return Response()")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看所有出版社")])],1),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_list = Publish.objects.all()")]),o("div",[t._v("        ps = PublishSerializers(publish_list, many=True)")]),o("div",[t._v("        return Response(ps.data)")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 添加出版社")])],1),o("div",[t._v("    def post(self, request):")]),o("div",[t._v("        ps = PublishSerializers(data=request.data)")]),o("div",[t._v("        if ps.is_valid():  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 验证数据是否有误")])],1),o("div",[t._v("            print(ps.validated_data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 验证过后正确的数据: OrderedDict([('name', '台山出版社'), ('email', '123@qq.com')])")])],1),o("div",[t._v("            ps.save()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 保存数据，实际上调用的是 rest-framework 中的 create 方法")])],1),o("div",[t._v("            return Response(ps.data)")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response(ps.errors)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# ps.errors 验证过后的错误信息")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishDetailView(APIView):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看指定的出版社")])],1),o("div",[t._v("    def get(self, request, id):")]),o("div",[t._v("        publish_obj = Publish.objects.filter(pk=id).first()")]),o("div",[t._v("        if publish_obj:")]),o("div",[t._v("            ps = PublishSerializers(publish_obj)")]),o("div",[t._v("            return Response(ps.data)")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response({'static': 0, 'message': '没有该出版社'})")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 修改出版社")])],1),o("div",[t._v("    def put(self, request, id):")]),o("div",[t._v("        publish_obj = Publish.objects.filter(pk=id).first()")]),o("div",[t._v("        ps = PublishSerializers(publish_obj, data=request.data)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 修改数据的时候一定要指定修改那条数据（即: publish_obj），否则在执行 .save() 的时候就相当于新增数据")])],1),o("div",[t._v("        if ps.is_valid():  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 验证数据是否有误")])],1),o("div",[t._v("            ps.save()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 保存数据，实际上调用的是 rest-framework 中的 update 方法")])],1),o("div",[t._v("            return Response(ps.data)")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response(ps.errors)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# ps.errors 验证过后的错误信息")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 删除出版社")])],1),o("div",[t._v("    def delete(self, request, id):")]),o("div",[t._v("        Publish.objects.filter(pk=id).delete()")]),o("div",[t._v("        return Response()")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# serializer.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework import serializers")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishSerializers(serializers.ModelSerializer):")]),o("div",[t._v("    class Meta:")]),o("div",[t._v("        model = Publish")]),o("div",[t._v("        fields = '__all__'")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookSerializers(serializers.ModelSerializer):")]),o("div",[t._v("    class Meta:")]),o("div",[t._v("        model = Book")]),o("div",[t._v("        fields = '__all__'")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# urls.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("urlpatterns = [")]),o("div",[t._v("    url(r'^admin/', admin.site.urls),")]),o("div",[o("br")]),o("div",[t._v("    url(r'book/$', BookView.as_view()),")]),o("div",[t._v("    url(r'book/(\\d+)', BookDetailView.as_view()),")]),o("div",[o("br")]),o("div",[t._v("    url(r'publish/$', PublishView.as_view()),")]),o("div",[t._v("    url(r'publish/(\\d+)', PublishDetailView.as_view()),")]),o("div",[t._v("]")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt"}},[o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("mixin类编写视图")])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("在 mixin 模块下提供了5个类，分别对应着 查询所有数据，查看指定数据，添加数据，修改数据，删除数据，其实这5个类就是将混合使用中的处理http请求的方法封装了起来")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("mixin 模块下的5个类:")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("mixins.ListModelMixin -> 查看所有数据")])]),o("ul",[o("li",[o("div",[t._v("mixins.ListModelMixin 下的 "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("list")]),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("()")]),t._v(" 方法: 封装了查看所有数据的代码")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("mixins.CreateModelMixin -> 创建数据")])]),o("ul",[o("li",[o("div",[t._v("mixins.CreateModelMixin 下的"),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}}),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("create")]),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("()")]),t._v(" 方法: 封装了添加数据的代码")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("mixins.RetrieveModelMixin -> 查询指定数据")])]),o("ul",[o("li",[o("div",[t._v("mixins.RetrieveModelMixin 下的 "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("retrieve()")]),t._v(" 方法: 封装了查询指定数据的代码")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("mixins.UpdateModelMixin -> 修改数据")])]),o("ul",[o("li",[o("div",[t._v("mixins.UpdateModelMixin 下的 "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("update()")]),t._v(" 方法: PUT请求 -> 封装了修改数据的代码")])]),o("li",[o("div",[t._v("mixins.UpdateModelMixin 下的 "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("partial_update()")]),t._v(" 方法: PATCH -> 封装了修改数据的代码")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("mixins.DestroyModelMixin -> 删除数据")])]),o("ul",[o("li",[o("div",[t._v("mixins.DestroyModelMixin 下的 "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("destroy()")]),t._v(" 方法: 封装了删除数据的代码")])])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("generics 模块下的 GenericAPIView 类，其实就是继承 rest-framework 中的 APIView，并且在这基础上扩展了一些方法")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("注意")]),t._v(":")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("在使用mixin类编写视图的时候一定要继承 GenericAPIView 类")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("在使用 mixins.UpdateModelMixin 类的时候，要在操作单条数据的url中加上名为 pk 的命名匹配 -> url(r'book/(?P<"),o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("pk")]),t._v(">\\d+)', BookDetailView.as_view())")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("在使用mixin类编写视图的时候一定要在该视图类下定义两个静态属性，且这两个静态属性的名字不能随便修改一定要使用这两个属性名: ")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("queryset -> 指定操作那张表的数据")])]),o("li",[o("div",[t._v("serializer_class -> 指定序列化类")])])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])],1)]),o("div",[o("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[o("br")])]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework import "),o("font",{attrs:{color:"#FA7A00"}},[t._v("mixins")])],1),o("div",[t._v("from rest_framework import "),o("font",{attrs:{color:"#FA7A00"}},[t._v("generics")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView("),o("font",{attrs:{color:"#FA7A00"}},[t._v("mixins.ListModelMixin")]),t._v(", "),o("font",{attrs:{color:"#FA7A00"}},[t._v("mixins.CreateModelMixin")]),t._v(", "),o("font",{attrs:{color:"#FA7A00"}},[t._v("generics.GenericAPIView")]),t._v("):")],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 不能随意修改这两个静态属性名，因为 mixins 模块下的 5 个类需要用到这两个静态属性")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("queryset")]),t._v(" = Book.objects.all()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 指定操作那张表的数据")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("serializer_class")]),t._v(" = BookSerializers  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 指定序列化类")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看所有书籍")])],1),o("div",[t._v("    def get(self, request, *args, **kwargs):")]),o("div",[t._v("        return self."),o("font",{attrs:{color:"#FA7A00"}},[t._v("list")]),t._v("(request, *args, **kwargs)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# self.list() 是 mixins.ListModelMixin 所提供的方法，")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("封装了查看所有数据的代码")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("，self.list() 的返回值: Response(数据)")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 添加书籍")])],1),o("div",[t._v("    def post(self, request, *args, **kwargs):")]),o("div",[t._v("        return self."),o("font",{attrs:{color:"#FA7A00"}},[t._v("create")]),t._v("(request, *args, **kwargs)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# self.create() 是 mixins.CreateModelMixin 所提供的方法，")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("封装了添加数据的代码")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("，self.create() 的返回值: Response(数据)")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookDetailView("),o("font",{attrs:{color:"#FA7A00"}},[t._v("mixins.RetrieveModelMixin")]),t._v(", "),o("font",{attrs:{color:"#FA7A00"}},[t._v("mixins.UpdateModelMixin")]),t._v(", "),o("font",{attrs:{color:"#FA7A00"}},[t._v("mixins.DestroyModelMixin")]),t._v(", "),o("font",{attrs:{color:"#FA7A00"}},[t._v("generics.GenericAPIView")]),t._v("):")],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 不能随意修改这两个静态属性名，因为 mixins 模块下的 5 个类需要用到这两个静态属性")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("queryset")]),t._v(" = Book.objects.all()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 指定操作那张表的数据")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("serializer_class")]),t._v(" = BookSerializers  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 指定序列化类")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看指定的书籍")])],1),o("div",[t._v("    def get(self, request, *args, **kwargs):")]),o("div",[t._v("        return self."),o("font",{attrs:{color:"#FA7A00"}},[t._v("retrieve")]),t._v("(request, *args, **kwargs)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# self.retrieve() 是 mixins.RetrieveModelMixin 所提供的方法，")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("封装了查询指定数据的代码")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("，self.retrieve() 的返回值: Response(数据)")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 修改书籍")])],1),o("div",[t._v("    def put(self, request, *args, **kwargs):")]),o("div",[t._v("        return self."),o("font",{attrs:{color:"#FA7A00"}},[t._v("update")]),t._v("(request, *args, **kwargs)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# self.update() 是 mixins.UpdateModelMixin 所提供的方法，")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("封装了修改数据的代码")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("，self.update() 的返回值: Response(数据)")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 删除书籍")])],1),o("div",[t._v("    def delete(self, request, *args, **kwargs):")]),o("div",[t._v("        return self."),o("font",{attrs:{color:"#FA7A00"}},[t._v("destroy")]),t._v("(request, *args, **kwargs)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# self.destroy() 是 mixins.DestroyModelMixin 所提供的方法，")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("封装了删除数据的代码")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("，self.destroy() 的返回值: Response(数据)")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(mixins.ListModelMixin, mixins.CreateModelMixin, generics.GenericAPIView):")]),o("div",[o("br")]),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看所有出版社")])],1),o("div",[t._v("    def get(self, request, *args, **kwargs):")]),o("div",[t._v("        return self.list(request, *args, **kwargs)")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 添加出版社")])],1),o("div",[t._v("    def post(self, request, *args, **kwargs):")]),o("div",[t._v("        return self.create(request, *args, **kwargs)")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishDetailView(mixins.RetrieveModelMixin, mixins.UpdateModelMixin, mixins.DestroyModelMixin, generics.GenericAPIView):")]),o("div",[o("br")]),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看指定的出版社")])],1),o("div",[t._v("    def get(self, request, *args, **kwargs):")]),o("div",[t._v("        return self.retrieve(request, *args, **kwargs)")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 修改出版社")])],1),o("div",[t._v("    def put(self, request, *args, **kwargs):")]),o("div",[t._v("        return self.update(request, *args, **kwargs)")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 删除出版社")])],1),o("div",[t._v("    def delete(self, request, *args, **kwargs):")]),o("div",[t._v("        return self.destroy(request, *args, **kwargs)")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# serializer.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework import serializers")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishSerializers(serializers.ModelSerializer):")]),o("div",[t._v("    class Meta:")]),o("div",[t._v("        model = Publish")]),o("div",[t._v("        fields = '__all__'")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookSerializers(serializers.ModelSerializer):")]),o("div",[t._v("    class Meta:")]),o("div",[t._v("        model = Book")]),o("div",[t._v("        fields = '__all__'")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# urls.py")])],1),o("div",[o("br")]),o("div",[t._v("urlpatterns = [")]),o("div",[t._v("    url(r'^admin/', admin.site.urls),")]),o("div",[o("br")]),o("div",[t._v("    url(r'book/$', BookView.as_view()),")]),o("div",[t._v("    url(r'book/("),o("font",{attrs:{color:"#FA7A00"}},[t._v("?P<pk>")]),t._v("\\d+)', BookDetailView.as_view()),")],1),o("div",[o("br")]),o("div",[t._v("    url(r'publish/$', PublishView.as_view()),")]),o("div",[t._v("    url(r'publish/("),o("font",{attrs:{color:"#FA7A00"}},[t._v("?P<pk>")]),t._v("\\d+)', PublishDetailView.as_view()),")],1),o("div",[t._v("]")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 使用通用的基于类的视图")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("使用通用的基于类的视图说明:")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("简化了mixin类编写视图的操作")])])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("generics 模块下的类的功能说明:")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("GenericAPIView 继承了 APIView，且在这基础上扩展了新的功能")])]),o("li",[o("div",[t._v("----------------------------------------------------")])]),o("li",[o("div",[t._v("generics.ListAPIView  提供了 查询所有数据 的功能")])]),o("li",[o("div",[t._v("generics.CreateAPIView 提供了 添加数据 的功能")])]),o("li",[o("div",[t._v("generics.ListCreateAPIView 提供了 查询所有数据、添加数据 的功能")])]),o("li",[o("div",[t._v("generics.RetrieveAPIView 提供了 查询指定数据 的功能")])]),o("li",[o("div",[t._v("generics.UpdateAPIView 提供了 修改数据 的功能")])]),o("li",[o("div",[t._v("generics.DestroyAPIView 提供了 删除数据 的功能")])]),o("li",[o("div",[t._v("generics.RetrieveUpdateAPIView 提供了 查询指定数据、修改数据 的功能")])]),o("li",[o("div",[t._v("generics.RetrieveDestroyAPIView 提供了 查询指定数据、删除数据 的功能")])]),o("li",[o("div",[t._v("generics.RetrieveUpdateDestroyAPIView 提供了 查询指定数据、修改数据、删除数据 的功能")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("generics.ListAPIView 的说明:")])]),o("ul",[o("li",[o("div",[t._v("提供了 查询所有数据 的功能")])]),o("li",[o("div",[t._v("---------------------------------------")])]),o("li",[o("div",[t._v("继承了 mixins.ListModelMixin")])]),o("li",[o("div",[t._v("提供了处理 GET 请求的方法")])]),o("li",[o("div",[t._v("处理GET请求的方法调用了 mixins.ListModelMixin 下的 list() 方法")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("generics.CreateAPIView 的说明:")])]),o("ul",[o("li",[o("div",[t._v("提供了 添加数据 的功能")])]),o("li",[o("div",[t._v("---------------------------------------")])]),o("li",[o("div",[t._v("继承了 mixins.CreateModelMixin")])]),o("li",[o("div",[t._v("提供了处理 POST 请求的方法")])]),o("li",[o("div",[t._v("处理POST请求的方法调用了 mixins.CreateModelMixin 下的 create() 方法")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("generics.ListCreateAPIView 的说明:")])]),o("ul",[o("li",[o("div",[t._v("提供了 查询所有数据、添加数据 的功能")])]),o("li",[o("div",[t._v("---------------------------------------")])]),o("li",[o("div",[t._v("继承了 mixins.ListModelMixin / mixins.CreateModelMixin")])]),o("li",[o("div",[t._v("提供了处理 GET / POST 请求的方法")])]),o("li",[o("div",[t._v("处理GET请求的方法调用了 mixins.ListModelMixin 下的 list() 方法")])]),o("li",[o("div",[t._v("处理POST请求的方法调用了 mixins.CreateModelMixin 下的 create() 方法")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("generics.RetrieveAPIView 的说明:")])]),o("ul",[o("li",[o("div",[t._v("提供了 查询指定数据 的功能")])]),o("li",[o("div",[t._v("---------------------------------------")])]),o("li",[o("div",[t._v("继承了 mixins.RetrieveModelMixin")])]),o("li",[o("div",[t._v("提供了处理 GET 请求的方法")])]),o("li",[o("div",[t._v("处理GET请求的方法调用了 mixins.RetrieveModelMixin 下的 retrieve() 方法")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("generics.UpdateAPIView 的说明:")])]),o("ul",[o("li",[o("div",[t._v("提供了 修改数据 的功能")])]),o("li",[o("div",[t._v("---------------------------------------")])]),o("li",[o("div",[t._v("继承了 mixins.UpdateModelMixin")])]),o("li",[o("div",[t._v("提供了处理 PUT / PATCH 请求的方法")])]),o("li",[o("div",[t._v("处理PUT请求的方法调用了 mixins.UpdateModelMixin 下的 update() 方法")])]),o("li",[o("div",[t._v("处理PATCH请求的方法调用了 mixins.UpdateModelMixin 下的 partial_update() 方法")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("generics.DestroyAPIView 的说明:")])]),o("ul",[o("li",[o("div",[t._v("提供了 删除数据 的功能")])]),o("li",[o("div",[t._v("---------------------------------------")])]),o("li",[o("div",[t._v("继承了 mixins.DestroyModelMixin")])]),o("li",[o("div",[t._v("提供了处理 DELETE 请求的方法")])]),o("li",[o("div",[t._v("处理DELETE请求的方法调用了 mixins.DestroyModelMixin 下的 destroy() 方法")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("generics.RetrieveUpdateAPIView 的说明:")])]),o("ul",[o("li",[o("div",[t._v("提供了 查询指定数据、修改数据 的功能")])]),o("li",[o("div",[t._v("---------------------------------------")])]),o("li",[o("div",[t._v("继承了 mixins.RetrieveModelMixin / mixins.UpdateModelMixin")])]),o("li",[o("div",[t._v("提供了处理 GET / PUT / PATCH 请求的方法")])]),o("li",[o("div",[t._v("处理GET请求的方法调用了 mixins.RetrieveModelMixin 下的 retrieve() 方法")])]),o("li",[o("div",[t._v("处理PUT请求的方法调用了 mixins.UpdateModelMixin 下的 update() 方法")])]),o("li",[o("div",[t._v("处理PATCH请求的方法调用了 mixins.UpdateModelMixin 下的 partial_update() 方法")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("generics.RetrieveDestroyAPIView 的说明:")])]),o("ul",[o("li",[o("div",[t._v("提供了 查询指定数据、删除数据 的功能")])]),o("li",[o("div",[t._v("---------------------------------------")])]),o("li",[o("div",[t._v("继承了 mixins.RetrieveModelMixin / mixins.DestroyModelMixin")])]),o("li",[o("div",[t._v("提供了处理 GET / DELETE 请求的方法")])]),o("li",[o("div",[t._v("处理GET请求的方法调用了 mixins.RetrieveModelMixin 下的 retrieve() 方法")])]),o("li",[o("div",[t._v("处理DELETE请求的方法调用了 mixins.DestroyModelMixin 下的 destroy() 方法")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("generics.RetrieveUpdateDestroyAPIView 的说明:")])]),o("ul",[o("li",[o("div",[t._v("提供了 查询指定数据、修改数据、删除数据 的功能")])]),o("li",[o("div",[t._v("---------------------------------------")])]),o("li",[o("div",[t._v("继承了 mixins.RetrieveModelMixin / mixins.UpdateModelMixin / mixins.DestroyModelMixin")])]),o("li",[o("div",[t._v("提供了处理 GET / PUT / PATCH / DELETE 请求的方法")])]),o("li",[o("div",[t._v("处理GET请求的方法调用了 mixins.RetrieveModelMixin 下的 retrieve() 方法")])]),o("li",[o("div",[t._v("处理PUT请求的方法调用了 mixins.UpdateModelMixin 下的 update() 方法")])]),o("li",[o("div",[t._v("处理PATCH请求的方法调用了 mixins.UpdateModelMixin 下的 partial_update() 方法")])]),o("li",[o("div",[t._v("处理DELETE请求的方法调用了 mixins.DestroyModelMixin 下的 destroy() 方法")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[t._v("注意")]),t._v(":")])]),o("ul",[o("li",[o("div",[t._v("一定要继承 generics 模块所提供的功能类")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("如果继承了 generics.UpdateAPIView 等涉及到修改数据的功能类，那么就要在操作单条数据的url中加上名为 pk 的命名匹配，因为修改数据的功能类继承了mixins.UpdateModelMixin类，且mixins.UpdateModelMixin类中的代码是通过“pk”这个名字去获取url中的参数，然后才能查询到指定的数据对象 -> url(r'book/(?P<"),o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("pk")]),t._v(">\\d+)', BookDetailView.as_view({'请求方式': '视图类的处理请求的方法名'}))")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("在编写视图的时候一定要在该视图类下定义两个静态属性，且这两个静态属性的名字不能随便修改一定要使用这两个属性名: ")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("queryset -> 指定操作那张表的数据")])]),o("li",[o("div",[t._v("serializer_class -> 指定序列化类")])])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1)]),o("div",[o("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1)]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework import "),o("font",{attrs:{color:"#FA7A00"}},[t._v("generics")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView("),o("font",{attrs:{color:"#FA7A00"}},[t._v("generics.ListCreateAPIView")]),t._v("):")],1),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[t._v("    serializer_class = BookSerializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookDetailView("),o("font",{attrs:{color:"#FA7A00"}},[t._v("generics.RetrieveUpdateDestroyAPIView")]),t._v("):")],1),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[t._v("    serializer_class = BookSerializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView("),o("font",{attrs:{color:"#FA7A00"}},[t._v("generics.ListCreateAPIView")]),t._v("):")],1),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishDetailView("),o("font",{attrs:{color:"#FA7A00"}},[t._v("generics.RetrieveUpdateDestroyAPIView")]),t._v("):")],1),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# urls.py")])],1),o("div",[o("br")]),o("div",[t._v("urlpatterns = [")]),o("div",[t._v("    url(r'^admin/', admin.site.urls),")]),o("div",[o("br")]),o("div",[t._v("    url(r'book/$', BookView.as_view()),")]),o("div",[t._v("    url(r'book/("),o("font",{attrs:{color:"#FA7A00"}},[t._v("?P<pk>")]),t._v("\\d+)', BookDetailView.as_view()),")],1),o("div",[o("br")]),o("div",[t._v("    url(r'publish/$', PublishView.as_view()),")]),o("div",[t._v("    url(r'publish/("),o("font",{attrs:{color:"#FA7A00"}},[t._v("?P<pk>")]),t._v("\\d+)', PublishDetailView.as_view()),")],1),o("div",[t._v("]")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("4.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("终极版")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("终极版的说明:")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("两条url使用同一个视图类")])]),o("li",[o("div",[t._v("视图类不再继承mixins模块下的5个类，而是继承 ModelViewSet 类")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("ModelViewSet类的说明:")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("ModelViewSet类已经继承了mixins模块下的5个类")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v(".as_view() 新用法的说明:")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("viewsets模块下的ViewSetMixin类通过重写 .as_view() 方法，实现了通过传递的字典（{'get':'list', 'post':'create'}）方式对处理http请求的方法进行分发")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[t._v("注意")]),t._v(":")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("一定要继承 ModelViewSet 类")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("要在操作单条数据的url中加上名为 pk 的命名匹配，因为ModelViewSet类继承了mixins.UpdateModelMixin类，且mixins.UpdateModelMixin类中的代码是通过“pk”这个名字去获取url中的参数，然后才能查询到指定的数据对象 -> url(r'book/(?P<"),o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("pk")]),t._v(">\\d+)', BookDetailView.as_view({'请求方式': '视图类的处理请求的方法名'}))")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("在编写视图的时候一定要在该视图类下定义两个静态属性，且这两个静态属性的名字不能随便修改一定要使用这两个属性名: ")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("queryset -> 指定操作那张表的数据")])]),o("li",[o("div",[t._v("serializer_class -> 指定序列化类")])])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework import "),o("font",{attrs:{color:"#FA7A00"}},[t._v("viewsets")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet("),o("font",{attrs:{color:"#FA7A00"}},[t._v("viewsets.ModelViewSet")]),t._v("):")],1),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[t._v("    serializer_class = BookSerializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishViewSet("),o("font",{attrs:{color:"#FA7A00"}},[t._v("viewsets.ModelViewSet")]),t._v("):")],1),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# urls.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# url(r'book/$', BookViewSet.as_view({'请求类型': '视图类的处理请求的方法名'})")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[o("br")])],1),o("div",[t._v("urlpatterns = [")]),o("div",[t._v("    url(r'^admin/', admin.site.urls),")]),o("div",[o("br")]),o("div",[t._v("    url(r'book/$', BookViewSet."),o("font",{attrs:{color:"#FA7A00"}},[t._v("as_view")]),t._v("({")],1),o("div",[t._v('        "get": "list",  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# list 方法是 mixins.ListModelMixin 所提供的方法，")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("封装了查看所有数据的代码")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("，由于 viewsets.ModelViewSet 继承了 mixins.ListModelMixin 所以可以使用 list 方法")])],1),o("div",[t._v('        "post": "create"  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# create 方法是 mixins.CreateModelMixin 所提供的方法，")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("封装了添加数据的代码")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("，由于 viewsets.ModelViewSet 继承了 mixins.CreateModelMixin 所以可以使用 create 方法")])],1),o("div",[t._v("    })),")]),o("div",[t._v("    url(r'book/("),o("font",{attrs:{color:"#FA7A00"}},[t._v("?P<pk>")]),t._v("\\d+)', BookViewSet."),o("font",{attrs:{color:"#FA7A00"}},[t._v("as_view")]),t._v("({")],1),o("div",[t._v("        'get': 'retrieve',  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# retrieve 方法是 mixins.RetrieveModelMixin 所提供的方法，")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("封装了查询指定数据的代码")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("，由于 viewsets.ModelViewSet 继承了 mixins.RetrieveModelMixin 所以可以使用 retrieve 方法")])],1),o("div",[t._v("        'put': 'update',  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# update 方法是 mixins.UpdateModelMixin 所提供的方法，")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("封装了修改数据的代码")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("，由于 viewsets.ModelViewSet 继承了 mixins.UpdateModelMixin 所以可以使用 update 方法")])],1),o("div",[t._v("        'patch': 'partial_update',  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# partial_update 方法是 mixins.UpdateModelMixin 所提供的方法，")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("封装了修改数据的代码")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("，由于 viewsets.ModelViewSet 继承了 mixins.UpdateModelMixin 所以可以使用 partial_update 方法")])],1),o("div",[t._v("        'delete': 'destroy'  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# destroy 方法是 mixins.DestroyModelMixin 所提供的方法，")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("封装了删除数据的代码")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("，由于 viewsets.ModelViewSet 继承了 mixins.DestroyModelMixin 所以可以使用 destroy 方法")])],1),o("div",[t._v("    })),")]),o("div",[o("br")]),o("div",[t._v("    url(r'publish/$', PublishViewSet."),o("font",{attrs:{color:"#FA7A00"}},[t._v("as_view")]),t._v("({")],1),o("div",[t._v('        "get": "list",')]),o("div",[t._v('        "post": "create"')]),o("div",[t._v("    })),")]),o("div",[t._v("    url(r'publish/("),o("font",{attrs:{color:"#FA7A00"}},[t._v("?P<pk>")]),t._v("\\d+)', PublishViewSet."),o("font",{attrs:{color:"#FA7A00"}},[t._v("as_view")]),t._v("({")],1),o("div",[t._v("        'get': 'retrieve',")]),o("div",[t._v("        'put': 'update',")]),o("div",[t._v("        'patch': 'partial_update',")]),o("div",[t._v("        'delete': 'destroy'")]),o("div",[t._v("    })),")]),o("div",[t._v("]")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("4.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt"}},[o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("重写 list、create、retrieve、update、partial_update、destroy 方法")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("如果默认返回给前端的数据结构不合适的话，可以通过重写 list 等方法重新构造数据结构")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("原理: 在视图类下重写 list 等方法，那么就不会执行 mixin 模块下的5个类所分别提供的方法（即: "),o("span",{staticStyle:{"font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("list、create、retrieve、update、partial_update、destroy")]),t._v("）")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])]),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[t._v("    serializer_class = BookSerializers")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# 重写编写 list 方法覆盖 mixins.ListModelMixin 类下的 list 方法")])],1),o("div",[t._v("    def "),o("font",{attrs:{color:"#FA7A00"}},[t._v("list")]),t._v("(self, request, *args, **kwargs):")],1),o("div",[t._v("        ret = {")]),o("div",[t._v("            'static': 1,")]),o("div",[t._v("            'data': {")]),o("div",[t._v("                'a': 1,")]),o("div",[t._v("                'b': 2,")]),o("div",[t._v("            }")]),o("div",[t._v("        }")]),o("div",[t._v("        return Response(ret)")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# 重写编写 retrieve 方法覆盖 mixins.RetrieveModelMixin 类下的 retrieve 方法")])],1),o("div",[t._v("    def "),o("font",{attrs:{color:"#FA7A00"}},[t._v("retrieve")]),t._v("(self, request, *args, **kwargs):")],1),o("div",[t._v("        ret = {")]),o("div",[t._v("            'data': '你所查询到的单条数据'")]),o("div",[t._v("        }")]),o("div",[t._v("        return Response(ret)")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# urls.py")])]),o("div",[o("br")]),o("div",[t._v("urlpatterns = [")]),o("div",[t._v("    url(r'^admin/', admin.site.urls),")]),o("div",[o("br")]),o("div",[t._v("    url(r'book/$', BookViewSet."),o("font",{attrs:{color:"#000000"}},[t._v("as_view")]),t._v("({")],1),o("div",[t._v('        "get": "list",  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# list 方法是 mixins.ListModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.ListModelMixin 所以可以使用 list 方法")])]),o("div",[t._v('        "post": "create"  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# create 方法是 mixins.CreateModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.CreateModelMixin 所以可以使用 create 方法")])]),o("div",[t._v("    })),")]),o("div",[o("font",{attrs:{color:"#000000"}},[t._v(" url(r'book/(?P<pk>\\d+)', BookViewSet.as_view")]),t._v("({")],1),o("div",[t._v("        'get': 'retrieve',  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# retrieve 方法是 mixins.RetrieveModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.RetrieveModelMixin 所以可以使用 retrieve 方法")])]),o("div",[t._v("        'put': 'update',  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# update 方法是 mixins.UpdateModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.UpdateModelMixin 所以可以使用 update 方法")])]),o("div",[t._v("        'patch': 'partial_update',  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# partial_update 方法是 mixins.UpdateModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.UpdateModelMixin 所以可以使用 partial_update 方法")])]),o("div",[t._v("        'delete': 'destroy'  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# destroy 方法是 mixins.DestroyModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.DestroyModelMixin 所以可以使用 destroy 方法")])]),o("div",[t._v("    })),")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#000000"}},[t._v("url(r'publish/$', PublishViewSet.as_view")]),t._v("({")],1),o("div",[t._v('        "get": "list",')]),o("div",[t._v('        "post": "create"')]),o("div",[t._v("    })),")]),o("div",[o("font",{attrs:{color:"#000000"}},[t._v("url(r'publish/(?P<pk>\\d+)', PublishViewSet.as_view")]),t._v("({")],1),o("div",[t._v("        'get': 'retrieve',")]),o("div",[t._v("        'put': 'update',")]),o("div",[t._v("        'patch': 'partial_update',")]),o("div",[t._v("        'delete': 'destroy'")]),o("div",[t._v("    })),")]),o("div",[t._v("]")])]),o("div",[o("br")]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v(".as_view() 的新用法")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(".as_view() 新用法的说明")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v(".as_view() 新用法的作用就是两条url使用同一个视图类")])]),o("li",[o("div",[t._v(".as_view() 新用法其实就是视图四部曲中的终极版")])])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(".as_view() 新的使用方式一")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("viewsets模块下的ViewSetMixin类通过重写 .as_view() 方法，实现了通过传递的字典（{'get':'list', 'post':'create'}）方式对处理http请求的方法进行分发")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("通过继承 ViewSetMixin 类 和 APIView 类 实现 .as_view() 的新用法")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[o("br")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet("),o("font",{attrs:{color:"#FA7A00"}},[t._v("viewsets.ViewSetMixin")]),t._v(", "),o("font",{attrs:{color:"#FA7A00"}},[t._v("APIView")]),t._v("):")],1),o("div",[o("br")]),o("div",[t._v("    def list(self, request, *args, **kwargs):")]),o("div",[t._v("        ret = {")]),o("div",[t._v("            'data': '你所查询到的所有数据'")]),o("div",[t._v("        }")]),o("div",[t._v("        return Response(ret)")]),o("div",[o("br")]),o("div",[t._v("    def create(self, request, *args, **kwargs):")]),o("div",[t._v("        ret = {")]),o("div",[t._v("            'data': '你所添加的数据'")]),o("div",[t._v("        }")]),o("div",[t._v("        return Response(ret)")]),o("div",[o("br")]),o("div",[t._v("    def retrieve(self, request, *args, **kwargs):")]),o("div",[t._v("        ret = {")]),o("div",[t._v("            'data': '你所查询到的单条数据'")]),o("div",[t._v("        }")]),o("div",[t._v("        print(ret)")]),o("div",[t._v("        return Response(ret)")]),o("div",[o("br")]),o("div",[t._v("    def update(self, request, *args, **kwargs):")]),o("div",[t._v("        ret = {")]),o("div",[t._v("            'data': '你所修改的数据'")]),o("div",[t._v("        }")]),o("div",[t._v("        return Response(ret)")]),o("div",[o("br")]),o("div",[t._v("    def partial_update(self, request, *args, **kwargs):")]),o("div",[t._v("        ret = {")]),o("div",[t._v("            'data': '你所修改的数据'")]),o("div",[t._v("        }")]),o("div",[t._v("        return Response(ret)")]),o("div",[o("br")]),o("div",[t._v("    def destroy(self, request, *args, **kwargs):")]),o("div",[t._v("        ret = {")]),o("div",[t._v("            'data': '删除数据成功'")]),o("div",[t._v("        }")]),o("div",[t._v("        return Response(ret)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# urls.py")])]),o("div",[o("br")]),o("div",[t._v("urlpatterns = [")]),o("div",[t._v("    url(r'book/$', BookViewSet."),o("span",{staticStyle:{color:"rgb(0, 0, 0)"}},[t._v("as_view")]),t._v("({")]),o("div",[t._v('        "get": "list",  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# list 方法是 mixins.ListModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.ListModelMixin 所以可以使用 list 方法")])]),o("div",[t._v('        "post": "create"  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# create 方法是 mixins.CreateModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.CreateModelMixin 所以可以使用 create 方法")])]),o("div",[t._v("    })),")]),o("div",[o("span",{staticStyle:{color:"rgb(0, 0, 0)"}},[t._v(" url(r'book/(?P<pk>\\d+)', BookViewSet.as_view")]),t._v("({")]),o("div",[t._v("        'get': 'retrieve',  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# retrieve 方法是 mixins.RetrieveModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.RetrieveModelMixin 所以可以使用 retrieve 方法")])]),o("div",[t._v("        'put': 'update',  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# update 方法是 mixins.UpdateModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.UpdateModelMixin 所以可以使用 update 方法")])]),o("div",[t._v("        'patch': 'partial_update',  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# partial_update 方法是 mixins.UpdateModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.UpdateModelMixin 所以可以使用 partial_update 方法")])]),o("div",[t._v("        'delete': 'destroy'  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# destroy 方法是 mixins.DestroyModelMixin 所提供的方法，由于 viewsets.ModelViewSet 继承了 mixins.DestroyModelMixin 所以可以使用 destroy 方法")])]),o("div",[t._v("    })),")]),o("div",[t._v("]")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(".as_view() 新的使用方式二")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v(".as_view() 的使用方式二实际上就是视图四部曲中的终极版，通过继承 ")]),t._v("ModelViewSet 类，实际上 ModelViewSet 类也是继承了 viewsets 模块下的 ViewSetMixin 类")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[t._v("这里就不做代码演示了不懂的可以看回 视图四部曲中的终极版 或者 查看 ")]),t._v("ModelViewSet 类的源码")])],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("认证组件")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[t._v("只要继承了 APIView 就可以使用认证组件")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)"}},[t._v("认证: 每次请求都要带着token（即: 字符串）来进行验证，如果认证成功则返回相应的数据")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[t._v("组件的")]),o("span",{staticStyle:{"font-size":"14pt"}},[t._v("执行顺序: ")]),t._v(" "),o("span",{staticStyle:{"font-size":"14pt",color:"rgb(255, 0, 0)"}},[t._v("认证")]),t._v(" "),o("span",{staticStyle:{"font-size":"14pt"}},[t._v("-> 权限 -> 频率")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","white-space":"pre-wrap",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v(" 认证类的创建")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("认证类的固定写法一 -> 没有继承 BaseAuthentication 认证类")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("如果没有继承 BaseAuthentication 认证类，那么就需要在认证类中编写两个方法")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("authenticate -> 编写认证的逻辑代码")])]),o("li",[o("div",[t._v("authenticate_header -> 不知道有啥用，反正就是要写上 rest-framework 的源码规定的，否则就会报错 ")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("注意")]),t._v(":")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("authenticate 方法必须有返回值")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("当验证失败的时候（即: if Fasle 的时候）要主动抛出异常，因为 rest-framework 是通过捕获异常来进行处理的")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-weight":"bold"}},[t._v("authenticate 方法返回值说明:")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt","font-weight":"bold"}},[t._v("返回 ")]),o("span",{staticStyle:{"font-weight":"bold"}},[t._v("两个值 或者")]),o("span",{staticStyle:{"font-size":"12pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-weight":"bold"}},[t._v("一个列表/元祖中包含两个值")])])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("rest-framework 会将第一个值赋值给 "),o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("request.user")]),t._v("，第二个值会赋值给 "),o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("request.auth，")]),t._v("然后在视图类中就可以通过 request.user/auth 分别获取这两个值")])])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-weight":"bold"}},[t._v("返回 None")])])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("跳出当前认证，执行下一个认证")])])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-weight":"bold"}},[t._v("返回 异常")])])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("跳出当前认证，抛出异常信息")])])])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# rf_auth.py")])],1),o("div",[o("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[o("br")])]),o("div",[t._v("from rest_framework import exceptions")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class "),o("font",{attrs:{color:"#FA7A00"}},[t._v("认证类的类名")]),t._v("(object):")],1),o("div",[o("br")]),o("div",[t._v("    def authenticate(self, request):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 认证的逻辑代码")])],1),o("div",[o("br")]),o("div",[t._v("        if "),o("font",{attrs:{color:"#FA7A00"}},[t._v("True/False")]),t._v(":")],1),o("div",[t._v("            return "),o("font",{attrs:{color:"#FA7A00"}},[t._v("返回值一")]),t._v(", "),o("font",{attrs:{color:"#FA7A00"}},[t._v("返回值二")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}}),t._v("elif xxx:")],1),o("div",[t._v("            return "),o("font",{attrs:{color:"#FA7A00"}},[t._v("None ")]),t._v(" "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 跳出本次认证")])],1),o("div",[t._v("        else:")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(' raise exceptions.AuthenticationFailed("验证失败!")  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}}),t._v(" raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1),o("div",[o("br")]),o("div",[t._v("    def authenticate_header(self, request):")]),o("div",[t._v("        pass")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("认证类的固定写法二 -> 继承 BaseAuthentication 类 -> "),o("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[t._v("常用")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("BaseAuthentication 认证类其实就是一个初始化好的认证类")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("BaseAuthentication 认证类里面也有 "),o("span",{staticStyle:{"font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("authenticate")]),o("span",{staticStyle:{"font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v(" 和 ")]),t._v("authenticate_header 方法，只不过这两个方法里面没有任何逻辑代码")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("在编写认证类的时候可以继承 BaseAuthentication 认证类，然后重写 "),o("span",{staticStyle:{"font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("authenticate")]),o("span",{staticStyle:{"font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v(" 方法，而自己编写的认证类就无需写 ")]),t._v("authenticate_header 方法了，因为 BaseAuthentication 认证类里面有")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("注意")]),t._v(":")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("authenticate 方法必须有返回值")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("当验证失败的时候（即: if Fasle 的时候）要主动抛出异常，因为 rest-framework 是通过捕获异常来进行处理的")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-weight":"bold"}},[t._v("authenticate 方法返回值说明:")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt","font-weight":"bold"}},[t._v("返回 ")]),o("span",{staticStyle:{"font-weight":"bold"}},[t._v("两个值 或者")]),o("span",{staticStyle:{"font-size":"12pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-weight":"bold"}},[t._v("一个列表/元祖中包含两个值")])])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("rest-framework 会将第一个值赋值给 "),o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("request.user")]),t._v("，第二个值会赋值给 "),o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("request.auth，")]),t._v("然后在视图类中就可以通过 request.user/auth 分别获取这两个值")])])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-weight":"bold"}},[t._v("返回 None")])])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("跳出当前认证，执行下一个认证")])])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-weight":"bold"}},[t._v("返回 异常")])])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("跳出当前认证，抛出异常信息")])])])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# rf_auth.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework.authentication import BaseAuthentication")]),o("div",[t._v("from rest_framework import exceptions")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class "),o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("认证类的类名")]),t._v("(BaseAuthentication):")]),o("div",[o("br")]),o("div",[t._v("    def authenticate(self, request):")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 认证的逻辑代码")])]),o("div",[o("br")]),o("div",[t._v("        if "),o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("True/False")]),t._v(":")]),o("div",[t._v("            return "),o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("返回值一")]),t._v(", "),o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("返回值二")])]),o("div",[o("span",{staticStyle:{color:"rgb(250, 122, 0)"}}),o("font",{attrs:{color:"#FA7A00"}}),t._v(" "),o("font",{attrs:{color:"#000000"}},[t._v("elif xxx:")])],1),o("div",[o("font",{attrs:{color:"#000000"}},[t._v("            return")]),t._v(" "),o("font",{attrs:{color:"#FA7A00"}},[t._v("None ")]),t._v(" "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 跳出本次认证")])],1),o("div",[t._v("        else:")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(' raise exceptions.AuthenticationFailed("验证失败!")  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 设置报错信息")])],1),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}}),t._v("raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("认证类的例子")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# rf_auth.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework.authentication import BaseAuthentication")]),o("div",[t._v("from rest_framework import exceptions")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class TokenAuth(BaseAuthentication):")]),o("div",[t._v("    def authenticate(self, request):")]),o("div",[t._v('        token = request.GET.get("token")  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 从get请求中获取token值进行判断")])],1),o("div",[t._v("        token_obj = Token.objects.filter(token=token).first()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 判断是否有当前token值的记录")])],1),o("div",[t._v("        if token_obj:")]),o("div",[t._v("            return token_obj.user, token_obj.token")]),o("div",[t._v("        else:")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(' raise exceptions.AuthenticationFailed("验证失败!")  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}}),t._v("raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt","white-space":"pre-wrap",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v("3.")]),o("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v(" 局部认证")])]),o("div",[o("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("局部认证作用于当前视图的所有请求")])])])]),o("div",[o("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("局部认证的配置（即: "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("authentication_classes = [认证类, 认证类]")]),t._v("）会覆盖掉该视图类在全局认证中的配置")])])]),o("div",[o("span",{staticStyle:{"box-sizing":"border-box","-webkit-tap-highlight-color":"transparent","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("authentication_classes = [认证类, 认证类]")])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# rf_auth.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework.authentication import BaseAuthentication")]),o("div",[t._v("from rest_framework import exceptions")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class TokenAuth(BaseAuthentication):")]),o("div",[t._v("    def authenticate(self, request):")]),o("div",[t._v('        token = request.GET.get("token")  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 从get请求中获取token值进行判断")])],1),o("div",[t._v("        token_obj = Token.objects.filter(token=token).first()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 判断是否有当前token值的记录")])],1),o("div",[t._v("        if token_obj:")]),o("div",[t._v("            return token_obj.user, token_obj.token")]),o("div",[t._v("        else:")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(' raise exceptions.AuthenticationFailed("验证失败!")  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}}),t._v("raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("import hashlib")]),o("div",[t._v("import time")]),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from .rf_auth import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class TestRequestView(APIView):")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("authentication_classes")]),t._v(" = [TokenAuth]  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 局部认证，只作用于当前视图")])],1),o("div",[o("br")]),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        print("),o("font",{attrs:{color:"#FA7A00"}},[t._v("request.user")]),t._v(")  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# Kevin -> user对象 -> TokenAuth 认证类下 authenticate 方法的返回值的第一个值")])],1),o("div",[t._v("        print("),o("font",{attrs:{color:"#FA7A00"}},[t._v("request.auth")]),t._v(")  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# aec82e5c956da440c11651d0e4dfd052 -> token 值 ")]),t._v("-> "),o("font",{attrs:{color:"#41AD1C"}},[t._v("TokenAuth 认证类下 authenticate 方法的返回值的第二个值")])],1),o("div",[t._v("        return Response('测试 request.user/auth 的值')")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet(viewsets.ModelViewSet):")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("authentication_classes")]),t._v(" = [TokenAuth]  "),o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 局部认证，只作用于当前视图下的所有请求")])],1),o("div",[o("br")]),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[t._v("    serializer_class = BookSerializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishViewSet(viewsets.ModelViewSet):")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("authentication_classes")]),t._v(" = [TokenAuth]  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 局部认证，只作用于当前视图")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("下的所有请求")])],1),o("div",[o("br")]),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取以用户名作为盐，以当前时间作为加密内容的字符串token")])],1),o("div",[t._v("def get_token_str(username):")]),o("div",[t._v("    now_time = str(time.time())")]),o("div",[t._v('    md5 = hashlib.md5(bytes(username, encoding="utf8"))  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 加盐，使用用户名作为盐，保证token的唯一性")])],1),o("div",[t._v("    md5.update(bytes(now_time, encoding='utf-8'))")]),o("div",[t._v("    return md5.hexdigest()")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# 登陆，并且返回当前用户的token")])],1),o("div",[t._v("class LoginView(APIView):")]),o("div",[t._v("    def post(self, request):")]),o("div",[t._v("        username = request.data.get('username')")]),o("div",[t._v("        password = request.data.get('password')")]),o("div",[t._v("        user = User.objects.filter(username=username, password=password).first()")]),o("div",[t._v("        ret = {")]),o("div",[t._v("            'status': 0,")]),o("div",[t._v("            'msg': None")]),o("div",[t._v("        }")]),o("div",[t._v("        if user:")]),o("div",[t._v("            token_str = get_token_str(user.username)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取Token值")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 每次登陆成功后都要修改当前用户的token值")])],1),o("div",[t._v("            Token.objects.update_or_create(user=user, defaults={'token': token_str})  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 如果有 user=user 这条数据，那么就修改 token 值，否则就进行添加")])],1),o("div",[t._v("            ret['status'] = 1")]),o("div",[t._v("            ret['token'] = token_str")]),o("div",[t._v("        else:")]),o("div",[t._v("            ret['msg'] = '登陆失败'")]),o("div",[o("br")]),o("div",[t._v("        return Response(ret)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 登陆，获取token值")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/login/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: POST")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 发送数据的编码格式: application/json -> 即: json 格式")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 所要发送的数据: ")]),t._v('{"username":"Kevin","password":"123"}')],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("{")]),o("div",[t._v('    "status": 1,')]),o("div",[t._v('    "msg": null,')]),o("div",[t._v('    "token": "4a70be5742f536bd78dad811c5044827"')]),o("div",[t._v("}")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("# --------------------------------------------------------------")])]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 查看所有书籍（带token值）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/?token=4a70be5742f536bd78dad811c5044827")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 2,')]),o("div",[t._v('        "title": "三体（第二部）",')]),o("div",[t._v('        "price": 100,')]),o("div",[t._v('        "pub_date": "2012-12-12",')]),o("div",[t._v('        "publish": 1,')]),o("div",[t._v('        "authors": [')]),o("div",[t._v("            1,")]),o("div",[t._v("            2")]),o("div",[t._v("        ]")]),o("div",[t._v("    },")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[o("font",{attrs:{color:"#41AD1C"}},[t._v("……")])],1)]),o("div",[o("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[t._v("]")])]),o("div",[o("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[o("br")])]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# --------------------------------------------------------------")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 查看所有书籍（不带token值）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("{")]),o("div",[t._v('    "detail": "验证失败!"')]),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 局部请求认证")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("局部请求认证作用于当前视图的某几个请求")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("通过重写 rest-framework 源码中 get_authenticators 方法来实现局部请求认证")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-weight":"bold"}},[t._v("get_authenticators 返回值格式")]),t._v(": [认证类(), 认证类(), 认证类(), ……]")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# rf_auth.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework.authentication import BaseAuthentication")]),o("div",[t._v("from rest_framework import exceptions")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class TokenAuth(BaseAuthentication):")]),o("div",[t._v("    def authenticate(self, request):")]),o("div",[t._v('        token = request.GET.get("token")  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 从get请求中获取token值进行判断")])]),o("div",[t._v("        token_obj = Token.objects.filter(token=token).first()  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 判断是否有当前token值的记录")])]),o("div",[t._v("        if token_obj:")]),o("div",[t._v("            return token_obj.user, token_obj.token")]),o("div",[t._v("        else:")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("#")]),t._v(' raise exceptions.AuthenticationFailed("验证失败!")  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 设置报错信息")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}}),t._v("raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 设置报错信息")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])]),o("div",[o("br")]),o("div",[t._v("import hashlib")]),o("div",[t._v("import time")]),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from .rf_auth import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[t._v("from rest_framework.authentication import "),o("font",{attrs:{color:"#FA7A00"}},[t._v("SessionAuthentication")])],1),o("div",[t._v("from rest_framework.authentication import "),o("font",{attrs:{color:"#FA7A00"}},[t._v("BasicAuthentication")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookView(APIView):")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# ")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("局部请求认证，只作用于当前视图的某几个请求")])],1),o("div",[t._v("    def "),o("font",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("get_authenticators")]),t._v("(self):  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 通过重写 rest-framework 的 get_authenticators 方法从而实现局部请求认证")])],1),o("div",[t._v("        if self.request.method == 'POST':  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 当请求是 POST 请求的时候，返回自定义的认证类，否则返回 rest-framework 默认的两个认证类")])],1),o("div",[t._v("            return [TokenAuth(), ]  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 自定义的认证类")])],1),o("div",[t._v("        else:")]),o("div",[t._v("            return ["),o("font",{attrs:{color:"#FA7A00"}},[t._v("SessionAuthentication()")]),t._v(", "),o("font",{attrs:{color:"#FA7A00"}},[t._v("BasicAuthentication()")]),t._v("]  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# rest-framework 默认返回的两个认证类")])],1),o("div",[o("br")]),o("div",[t._v("    def get(self, request, *args, **kwargs):")]),o("div",[t._v("        book_queryset = Book.objects.all()")]),o("div",[t._v("        ser = BookSerializers(instance=book_queryset, many=True)")]),o("div",[t._v("        return Response(ser.data)")]),o("div",[o("br")]),o("div",[t._v("    def post(self, request):")]),o("div",[t._v("        ser = BookSerializers(data=request.data)")]),o("div",[t._v("        if ser.is_valid():")]),o("div",[t._v("            ser.save()")]),o("div",[t._v("            return Response(ser.data)")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response(ser.errors)")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 获取以用户名作为盐，以当前时间作为加密内容的字符串token")])]),o("div",[t._v("def get_token_str(username):")]),o("div",[t._v("    now_time = str(time.time())")]),o("div",[t._v('    md5 = hashlib.md5(bytes(username, encoding="utf8"))  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 加盐，使用用户名作为盐，保证token的唯一性")])]),o("div",[t._v("    md5.update(bytes(now_time, encoding='utf-8'))")]),o("div",[t._v("    return md5.hexdigest()")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("# 登陆，并且返回当前用户的token")])]),o("div",[t._v("class LoginView(APIView):")]),o("div",[t._v("    def post(self, request):")]),o("div",[t._v("        username = request.data.get('username')")]),o("div",[t._v("        password = request.data.get('password')")]),o("div",[t._v("        user = User.objects.filter(username=username, password=password).first()")]),o("div",[t._v("        ret = {")]),o("div",[t._v("            'status': 0,")]),o("div",[t._v("            'msg': None")]),o("div",[t._v("        }")]),o("div",[t._v("        if user:")]),o("div",[t._v("            token_str = get_token_str(user.username)  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 获取Token值")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 每次登陆成功后都要修改当前用户的token值")])]),o("div",[t._v("            Token.objects.update_or_create(user=user, defaults={'token': token_str})  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 如果有 user=user 这条数据，那么就修改 token 值，否则就进行添加")])]),o("div",[t._v("            ret['status'] = 1")]),o("div",[t._v("            ret['token'] = token_str")]),o("div",[t._v("        else:")]),o("div",[t._v("            ret['msg'] = '登陆失败'")]),o("div",[o("br")]),o("div",[t._v("        return Response(ret)")])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口说明: 登陆，获取token值")])]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/login/")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: POST")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 发送数据的编码格式: application/json -> 即: json 格式")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 所要发送的数据: ")]),t._v('{"username":"Kevin","password":"123"}')]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("{")]),o("div",[t._v('    "status": 1,')]),o("div",[t._v('    "msg": null,')]),o("div",[t._v('    "token": "4a70be5742f536bd78dad811c5044827"')]),o("div",[t._v("}")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("# --------------------------------------------------------------")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口说明: 查看所有书籍")])]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: GET")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 2,')]),o("div",[t._v('        "title": "三体（第二部）",')]),o("div",[t._v('        "price": 100,')]),o("div",[t._v('        "pub_date": "2012-12-12",')]),o("div",[t._v('        "publish": 1,')]),o("div",[t._v('        "authors": [')]),o("div",[t._v("            1,")]),o("div",[t._v("            2")]),o("div",[t._v("        ]")]),o("div",[t._v("    },")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}}),t._v(" "),o("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco",color:"rgb(65, 173, 28)"}},[t._v("……")])]),o("div",[o("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[t._v("]")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("# --------------------------------------------------------------")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口说明: 添加书籍（带token值）")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("#")]),t._v(" "),o("font",{attrs:{color:"#41AD1C"}},[t._v("接口: http://127.0.0.1:8000/book/?token=4a70be5742f536bd78dad811c5044827")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: POST")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("{")]),o("div",[t._v('    "id": 3,')]),o("div",[t._v('    "title": "七大罪",')]),o("div",[t._v('    "price": 50,')]),o("div",[t._v('    "pub_date": "2020-04-08",')]),o("div",[t._v('    "production_date": "2020-04-08T07:06:16Z",')]),o("div",[t._v('    "publish": 1,')]),o("div",[t._v('    "authors": [')]),o("div",[t._v("        1,")]),o("div",[t._v("        2")]),o("div",[t._v("    ]")]),o("div",[t._v("}")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# --------------------------------------------------------------")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 添加书籍（不带token值）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/book/")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: POST")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("{")]),o("div",[t._v('    "msg": "验证失败",')]),o("div",[t._v('    "code": "1000"')]),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("4.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 全局认证")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("全局认证作用于所有视图类")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# rf_auth.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework.authentication import BaseAuthentication")]),o("div",[t._v("from rest_framework import exceptions")]),o("div",[t._v("from .models import *")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class TokenAuth(BaseAuthentication):")]),o("div",[t._v("    def authenticate(self, request):")]),o("div",[t._v('        token = request.GET.get("token")  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 从get请求中获取token值进行判断")])]),o("div",[t._v("        token_obj = Token.objects.filter(token=token).first()  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 判断是否有当前token值的记录")])]),o("div",[t._v("        if token_obj:")]),o("div",[t._v("            return token_obj.user, token_obj.token")]),o("div",[t._v("        else:")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(' raise exceptions.AuthenticationFailed("验证失败!")  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 设置报错信息")])],1),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}}),t._v("raise exceptions.AuthenticationFailed({'code': 1000, 'msg': '验证失败'})  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置报错信息")])],1)]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 配置全局认证所需要的认证类的路径")])],1),o("div",[t._v("REST_FRAMEWORK = {")]),o("div",[t._v('    "DEFAULT_AUTHENTICATION_CLASSES": ["app01.rf_auth.TokenAuth"]')]),o("div",[t._v("}")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("不进行认证的视图类设置")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("如果设置了全局认证，但是又想某些视图不进行认证，那么可以在不想进行认证的视图类中设置 authentication_classes = []，因为在 rest-framework 源码中 局部认证的配置 会覆盖掉 全局认证的配置")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("import hashlib")]),o("div",[t._v("import time")]),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from .rf_auth import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[t._v("    serializer_class = BookSerializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取以用户名作为盐，以当前时间作为加密内容的字符串token")])],1),o("div",[t._v("def get_token_str(username):")]),o("div",[t._v("    now_time = str(time.time())")]),o("div",[t._v('    md5 = hashlib.md5(bytes(username, encoding="utf8"))  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 加盐，使用用户名作为盐，保证token的唯一性")])],1),o("div",[t._v("    md5.update(bytes(now_time, encoding='utf-8'))")]),o("div",[t._v("    return md5.hexdigest()")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 登陆，并且返回当前用户的token")])],1),o("div",[t._v("class LoginView(APIView):")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("authentication_classes = []")]),t._v(" "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 在全局认证下，当前视图不进行认证")])],1),o("div",[o("br")]),o("div",[t._v("    def post(self, request):")]),o("div",[t._v("        username = request.data.get('username')")]),o("div",[t._v("        password = request.data.get('password')")]),o("div",[t._v("        user = User.objects.filter(username=username, password=password).first()")]),o("div",[t._v("        ret = {")]),o("div",[t._v("            'status': 0,")]),o("div",[t._v("            'msg': None")]),o("div",[t._v("        }")]),o("div",[t._v("        if user:")]),o("div",[t._v("            token_str = get_token_str(user.username)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取Token值")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 每次登陆成功后都要修改当前用户的token值")])],1),o("div",[t._v("            Token.objects.update_or_create(user=user, defaults={'token': token_str})  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 如果有 user=user 这条数据，那么就修改 token 值，否则就进行添加")])],1),o("div",[t._v("            ret['status'] = 1")]),o("div",[t._v("            ret['token'] = token_str")]),o("div",[t._v("        else:")]),o("div",[t._v("            ret['msg'] = '登陆失败'")]),o("div",[o("br")]),o("div",[t._v("        return Response(ret)")])]),o("div",[o("br")])]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("权限组件")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[t._v("只要继承了 APIView 就可以使用权限组件")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[t._v("组件的")]),o("span",{staticStyle:{"font-size":"14pt"}},[t._v("执行顺序: ")]),t._v(" "),o("span",{staticStyle:{"font-size":"14pt"}},[t._v("认证 ->")]),t._v(" "),o("span",{staticStyle:{"font-size":"14pt",color:"rgb(255, 0, 0)"}},[t._v("权限")]),t._v(" "),o("span",{staticStyle:{"font-size":"14pt"}},[t._v("-> 频率")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 权限类的创建")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("权限类的固定写法一 -> 没有继承 BasePermission 权限类")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("如果没有继承 BasePermission 权限类，那么就需要在权限类中编写两个方法")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[t._v("has_permission -> 编写权限的逻辑代码")])]),o("li",[o("div",[t._v("has_object_permission -> 不知道有啥用，反正就是要写上 rest-framework 的源码规定的，否则就会报错 ")])])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("注意")]),t._v(":")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-weight":"bold"}},[t._v("has_permission 方法必须返回")]),o("span",{staticStyle:{color:"rgb(250, 122, 0)","font-weight":"bold"}},[t._v("True（也可以是能代表True的元素，即: 字符串、列表、字典等）")]),o("span",{staticStyle:{"font-weight":"bold"}},[t._v("或则")]),o("span",{staticStyle:{color:"rgb(250, 122, 0)","font-weight":"bold"}},[t._v("False（也可以是能代表True的元素，即: 0、None等）")]),o("span",{staticStyle:{"font-weight":"bold"}},[t._v("，因为是 rest-framework 的源码规定的")])])])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# rf_permission.py")])],1),o("div",[o("br")]),o("div",[t._v("class "),o("font",{attrs:{color:"#FA7A00"}},[t._v("权限类的类名")]),t._v("(object):")],1),o("div",[o("br")]),o("div",[t._v("    message = "),o("font",{attrs:{color:"#FA7A00"}},[t._v("'错误信息'")]),t._v(" "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 配置错误信息，如果不配置会使用默认的错误信息")])],1),o("div",[o("br")]),o("div",[t._v("    def has_permission(self, request, view):")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 权限的逻辑代码")])],1),o("div",[o("br")]),o("div",[t._v("        if "),o("font",{attrs:{color:"#FA7A00"}},[t._v("True / False")]),t._v(":")],1),o("div",[t._v("            return "),o("font",{attrs:{color:"#FA7A00"}},[t._v("True")])],1),o("div",[t._v("        else:")]),o("div",[t._v("            return "),o("font",{attrs:{color:"#FA7A00"}},[t._v("False")])],1),o("div",[o("br")]),o("div",[t._v("    def has_object_permission(self, request, view, obj):")]),o("div",[o("br")]),o("div",[t._v("        return True")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("权限类的固定写法二 -> 继承 BasePermission 权限类 -> "),o("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[t._v("常用")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("BasePermission 权限类其实就是一个初始化好的权限类")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("BasePermission 权限类里面也有 has_permission "),o("span",{staticStyle:{"font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("和 ")]),t._v("has_object_permission 方法，只不过这两个方法里面没有任何逻辑代码")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("在编写权限类的时候可以继承 BasePermission 权限类，然后重写 has_permission "),o("span",{staticStyle:{"font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("方法，而自己编写的权限类就无需写 ")]),t._v("has_object_permission 方法了，因为 BasePermission 权限类里面有")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("注意")]),t._v(":")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-weight":"bold"}},[t._v("has_permission 方法必须返回")]),o("span",{staticStyle:{color:"rgb(250, 122, 0)","font-weight":"bold"}},[t._v("True（也可以是能代表True的元素，即: 字符串、列表、字典等）")]),o("span",{staticStyle:{"font-weight":"bold"}},[t._v("或则")]),o("span",{staticStyle:{color:"rgb(250, 122, 0)","font-weight":"bold"}},[t._v("False（也可以是能代表True的元素，即: 0、None等）")]),o("span",{staticStyle:{"font-weight":"bold"}},[t._v("，因为是 rest-framework 的源码规定的")])])])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# rf_permission.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework.permissions import BasePermission")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class "),o("font",{attrs:{color:"#FA7A00"}},[t._v("权限类的类名")]),t._v("(BasePermission):")],1),o("div",[o("br")]),o("div",[t._v("    message = "),o("font",{attrs:{color:"#FA7A00"}},[t._v("'错误信息'")]),t._v(" "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 配置错误信息，如果不配置会使用默认的错误信息")])],1),o("div",[o("br")]),o("div",[t._v("    def has_permission(self, request, view):")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 权限的逻辑代码")])],1),o("div",[o("br")]),o("div",[t._v("        if "),o("font",{attrs:{color:"#FA7A00"}},[t._v("True / False")]),t._v(":")],1),o("div",[t._v("            return "),o("font",{attrs:{color:"#FA7A00"}},[t._v("True")])],1),o("div",[t._v("        else:")]),o("div",[t._v("            return "),o("font",{attrs:{color:"#FA7A00"}},[t._v("False")])],1)]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("权限类的例子")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# rf_permission.py")])],1),o("div",[o("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[o("br")])]),o("div",[t._v("from rest_framework.permissions import BasePermission")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class SVIPPermission(BasePermission):")]),o("div",[o("br")]),o("div",[t._v('    message = "SVIP才能访问!"  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 配置错误信息，如果不配置会使用默认的错误信息")])],1),o("div",[o("br")]),o("div",[t._v("    def has_permission(self, request, view):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v(' """')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :param request: APIView 的 request")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :param view: 视图类的实例化对象 -> APIView 类中的 self")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :return: True/False")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('        """')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        # request.user / request.auth 可以使用是因为先执行了认证类然后再执行权限类，且在执行认证类的authenticate方法的时候已经把返回值分别赋值给 request.user / request.auth")])],1),o("div",[o("br")]),o("div",[t._v("        if request.user.user_type == 3:")]),o("div",[t._v("            print(request.user)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 用户的数据对象")])],1),o("div",[t._v("            print(request.auth)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# token: 7a06fa70c1516f8cd9399e17285d9903")])],1),o("div",[t._v("            return True")]),o("div",[t._v("        else:")]),o("div",[t._v("            return False")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 局部权限")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("局部权限的配置（即: permission_classes "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("= [")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("权限")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("类,")]),t._v(" "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("权限")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("类]")]),t._v("）会覆盖掉该视图类在全局权限中的配置")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("permission_classes"),o("span",{staticStyle:{color:"rgb(250, 122, 0)"}}),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("= [权限类, 权限类]")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# rf_permission.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework.permissions import BasePermission")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class SVIPPermission(BasePermission):")]),o("div",[o("br")]),o("div",[t._v('    message = "SVIP才能访问!"  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 配置错误信息，如果不配置会使用默认的错误信息")])]),o("div",[o("br")]),o("div",[t._v("    def has_permission(self, request, view):")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v(' """')])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        :param request: APIView 的 request")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        :param view: 视图类的实例化对象 -> APIView 类中的 self")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        :return: True/False")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        """')])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        # request.user / request.auth 可以使用是因为先执行了认证类然后再执行权限类，且在执行认证类的authenticate方法的时候已经把返回值分别赋值给 request.user / request.auth")])]),o("div",[o("br")]),o("div",[t._v("        if request.user.user_type == 3:")]),o("div",[t._v("            print(request.user)  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 用户的数据对象")])]),o("div",[t._v("            print(request.auth)  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# token: 7a06fa70c1516f8cd9399e17285d9903")])]),o("div",[t._v("            return True")]),o("div",[t._v("        else:")]),o("div",[t._v("            return False")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from .rf_auth import *")]),o("div",[t._v("from .rf_permission import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    authentication_classes = [TokenAuth]  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 局部认证，只作用于当前视图")])],1),o("div",[o("font",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("permission_classes")]),t._v(" = [SVIPPermission]  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 局部权限，只作用于当前视图")])],1),o("div",[o("br")]),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[t._v("    serializer_class = BookSerializers")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 全局权限")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("全局权限作用于所有视图类")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# rf_permission.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework.permissions import BasePermission")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class SVIPPermission(BasePermission):")]),o("div",[o("br")]),o("div",[t._v('    message = "SVIP才能访问!"  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 配置错误信息，如果不配置会使用默认的错误信息")])]),o("div",[o("br")]),o("div",[t._v("    def has_permission(self, request, view):")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v(' """')])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        :param request: APIView 的 request")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        :param view: 视图类的实例化对象 -> APIView 类中的 self")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        :return: True/False")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        """')])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        # request.user / request.auth 可以使用是因为先执行了认证类然后再执行权限类，且在执行认证类的authenticate方法的时候已经把返回值分别赋值给 request.user / request.auth")])]),o("div",[o("br")]),o("div",[t._v("        if request.user.user_type == 3:")]),o("div",[t._v("            print(request.user)  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 用户的数据对象")])]),o("div",[t._v("            print(request.auth)  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# token: 7a06fa70c1516f8cd9399e17285d9903")])]),o("div",[t._v("            return True")]),o("div",[t._v("        else:")]),o("div",[t._v("            return False")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 配置全局权限所需要的权限类的路径")])],1),o("div",[t._v("REST_FRAMEWORK = {")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('# "DEFAULT_AUTHENTICATION_CLASSES": ["app01.rf_auth.TokenAuth"],  # 全局认证')])],1),o("div",[t._v('    "DEFAULT_PERMISSION_CLASSES": ["app01.rf_permission.SVIPPermission"]  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 全局权限")])],1),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("不进行权限认证的视图类设置")])])])]),o("div",[o("font",{staticStyle:{"font-size":"12pt"}},[o("br")])],1),o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("如果设置了全局权限，但是又想某些视图不进行权限认证，那么可以在不想进行权限认证的视图类中设置")]),t._v(" permission_classes"),o("span",{staticStyle:{color:"rgb(250, 122, 0)"}}),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("= []，因为在 rest-framework 源码中 局部权限的配置 会覆盖掉 全局权限的配置")])])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])]),o("div",[o("br")]),o("div",[t._v("import hashlib")]),o("div",[t._v("import time")]),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from .rf_auth import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[t._v("    serializer_class = BookSerializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 获取以用户名作为盐，以当前时间作为加密内容的字符串token")])]),o("div",[t._v("def get_token_str(username):")]),o("div",[t._v("    now_time = str(time.time())")]),o("div",[t._v('    md5 = hashlib.md5(bytes(username, encoding="utf8"))  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 加盐，使用用户名作为盐，保证token的唯一性")])]),o("div",[t._v("    md5.update(bytes(now_time, encoding='utf-8'))")]),o("div",[t._v("    return md5.hexdigest()")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 登陆，并且返回当前用户的token")])]),o("div",[t._v("class LoginView(APIView):")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("permission_classes = []")]),t._v(" "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 在全局权限下，当前视图不进行权限认证")])],1),o("div",[o("br")]),o("div",[t._v("    def post(self, request):")]),o("div",[t._v("        username = request.data.get('username')")]),o("div",[t._v("        password = request.data.get('password')")]),o("div",[t._v("        user = User.objects.filter(username=username, password=password).first()")]),o("div",[t._v("        ret = {")]),o("div",[t._v("            'status': 0,")]),o("div",[t._v("            'msg': None")]),o("div",[t._v("        }")]),o("div",[t._v("        if user:")]),o("div",[t._v("            token_str = get_token_str(user.username)  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 获取Token值")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 每次登陆成功后都要修改当前用户的token值")])]),o("div",[t._v("            Token.objects.update_or_create(user=user, defaults={'token': token_str})  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 如果有 user=user 这条数据，那么就修改 token 值，否则就进行添加")])]),o("div",[t._v("            ret['status'] = 1")]),o("div",[t._v("            ret['token'] = token_str")]),o("div",[t._v("        else:")]),o("div",[t._v("            ret['msg'] = '登陆失败'")]),o("div",[o("br")]),o("div",[t._v("        return Response(ret)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("频率组件")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[t._v("只要继承了 APIView 就可以使用频率组件")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[t._v("组件的")]),o("span",{staticStyle:{"font-size":"14pt"}},[t._v("执行顺序: ")]),t._v(" "),o("span",{staticStyle:{"font-size":"14pt"}},[t._v("认证 -> 权限 -> "),o("span",{staticStyle:{"font-size":"14pt",color:"rgb(255, 0, 0)"}},[t._v("频率")])])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 频率类的固定写法")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# rf_throttle.py")])],1),o("div",[o("br")]),o("div",[t._v("class "),o("font",{attrs:{color:"#FA7A00"}},[t._v("频率类的类名")]),t._v("(object):")],1),o("div",[o("br")]),o("div",[t._v("    def allow_request(self, request, view):")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 频率的逻辑代码")])],1),o("div",[o("br")]),o("div",[t._v("        if "),o("font",{attrs:{color:"#FA7A00"}},[t._v("True / False")]),t._v(":")],1),o("div",[t._v("            return "),o("font",{attrs:{color:"#FA7A00"}},[t._v("True")])],1),o("div",[t._v("        else:")]),o("div",[t._v("            return "),o("font",{attrs:{color:"#FA7A00"}},[t._v("False")])],1),o("div",[o("br")]),o("div",[t._v("    def wait(self):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 钩子函数（即: 回调函数）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        # 当超过设置的访问频率时调用（即: 当allow_request返回False时调用）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        # 返回需要等待的时间")])],1),o("div",[o("br")]),o("div",[t._v("        return "),o("font",{attrs:{color:"#FA7A00"}},[t._v("'时间字符串'")])],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 局部频率 -> 自己编写频率类")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("局部频率的配置（即: throttle_classes "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("= [频率")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("类, ")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("频率")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("类]")]),t._v("）会覆盖掉该视图类在全局频率中的配置")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("throttle_classes "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("= [")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("频率")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("类, ")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("频率")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("类]")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# rf_throttle.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("import time")]),o("div",[o("br")]),o("div",[t._v("VISIT_RECORD = {")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# '127.0.0.1:8080':[最新的时间，……，最初的时间]")])],1),o("div",[t._v("}")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class MyThrottle(object):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v(' """')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("    一分钟允许访问5次")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("    原理:")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        拿到用户IP地址")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        编写访问记录 {'ip地址':[最新的时间，……，最初的时间]}")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        确保用户所对应的记录列表的最新时间和最初时间的时间差 <= 规定时间")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        判断用户所对应的记录列表的长度 < 允许访问次数")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('    """')])],1),o("div",[o("br")]),o("div",[t._v("    allow_time = 60  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 时间")])],1),o("div",[t._v("    visits = 5  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 允许访问次数")])],1),o("div",[o("br")]),o("div",[t._v("    def __init__(self):")]),o("div",[t._v("        self.history_list = []")]),o("div",[o("br")]),o("div",[t._v("    def allow_request(self, request, view):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :param request: APIView 的 request")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :param view: 视图类的实例化对象 -> APIView 类中的 self")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        :return: True/False")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('        """')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取用户的IP地址")])],1),o("div",[t._v("        ip = request.META.get('REMOTE_ADDR', '')")]),o("div",[t._v("        if ip not in VISIT_RECORD:")]),o("div",[t._v("            VISIT_RECORD[ip] = [time.time()]")]),o("div",[t._v("        else:")]),o("div",[t._v("            history = VISIT_RECORD[ip]")]),o("div",[o("br")]),o("div",[t._v("            if len(history) <= self.visits:")]),o("div",[t._v("                history.insert(0, time.time())  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 将最新的时间添加到列表的第一位")])],1),o("div",[o("br")]),o("div",[t._v("            self.history_list = history  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 因为 history 是列表，所以 self.history_list = history 是引用关系，没有进行深度拷贝，所以下面 history.pop() 执行 self.history_list 无需重新赋值")])],1),o("div",[o("br")]),o("div",[t._v("            while time.time() - history[-1] > self.allow_time:")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 确保列表时间是允许的范围内（即: 列表的时间差不能超过60秒）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("                # 循环计算最新的时间和最初的时间是否在60秒，如果不是删除则删除最初的时间")])],1),o("div",[t._v("                history.pop()")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 判断列表的长度有没有超过允许访问次数")])],1),o("div",[t._v("            if len(history) > self.visits:")]),o("div",[t._v("                return False")]),o("div",[o("br")]),o("div",[t._v("        return True")]),o("div",[o("br")]),o("div",[t._v("    def wait(self):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 钩子函数（即: 回调函数）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        # 当超过设置的访问频率时调用（即: 当allow_request返回False时调用）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        # 返回值等待时间")])],1),o("div",[t._v("        return self.allow_time - (time.time() - self.history_list[-1])")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from .rf_auth import *")]),o("div",[t._v("from .rf_permission import *")]),o("div",[t._v("from .rf_throttle import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[t._v("from rest_framework import "),o("font",{attrs:{color:"#FA7A00"}},[t._v("exceptions")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# 修改频率组件的错误信息")])],1),o("div",[t._v("class MyExceptions(exceptions.Throttled):")]),o("div",[t._v("    default_detail = '连接次数过多'")]),o("div",[t._v("    extra_detail_plural = extra_detail_singular = '请在{wait}秒后访问'")]),o("div",[o("br")]),o("div",[t._v("    def __init__(self, wait=None, detail=None, code=None):")]),o("div",[t._v("        super().__init__(wait=wait, detail=detail, code=code)")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    authentication_classes = [TokenAuth]  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 局部认证，只作用于当前视图")])],1),o("div",[t._v("    permission_classes = [SVIPPermission]  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 局部权限，只作用于当前视图")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("throttle_classes")]),t._v(" = [MyThrottle]  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 局部频率，只作用于当前视图")])],1),o("div",[o("br")]),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[t._v("    serializer_class = BookSerializers")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# 修改频率组件的错误信息")])],1),o("div",[t._v("    def throttled(self, request, wait):")]),o("div",[t._v("        raise MyExceptions(wait=wait)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 全局频率 -> 自己编写频率类")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("全局频率作用于所有视图类")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# rf_throttle.py")])],1),o("div",[o("br")]),o("div",[t._v("import time")]),o("div",[o("br")]),o("div",[t._v("VISIT_RECORD = {")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# '127.0.0.1:8080':[最新的时间，……，最初的时间]")])]),o("div",[t._v("}")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class MyThrottle(object):")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v(' """')])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("    一分钟允许访问5次")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("    原理:")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        拿到用户IP地址")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        编写访问记录 {'ip地址':[最新的时间，……，最初的时间]}")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        确保用户所对应的记录列表的最新时间和最初时间的时间差 <= 规定时间")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        判断用户所对应的记录列表的长度 < 允许访问次数")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('    """')])]),o("div",[o("br")]),o("div",[t._v("    allow_time = 60  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 时间")])]),o("div",[t._v("    visits = 5  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 允许访问次数")])]),o("div",[o("br")]),o("div",[t._v("    def __init__(self):")]),o("div",[t._v("        self.history_list = []")]),o("div",[o("br")]),o("div",[t._v("    def allow_request(self, request, view):")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('"""')])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        :param request: APIView 的 request")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        :param view: 视图类的实例化对象 -> APIView 类中的 self")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        :return: True/False")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        """')])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 获取用户的IP地址")])]),o("div",[t._v("        ip = request.META.get('REMOTE_ADDR', '')")]),o("div",[t._v("        if ip not in VISIT_RECORD:")]),o("div",[t._v("            VISIT_RECORD[ip] = [time.time()]")]),o("div",[t._v("        else:")]),o("div",[t._v("            history = VISIT_RECORD[ip]")]),o("div",[o("br")]),o("div",[t._v("            if len(history) <= self.visits:")]),o("div",[t._v("                history.insert(0, time.time())  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 将最新的时间添加到列表的第一位")])]),o("div",[o("br")]),o("div",[t._v("            self.history_list = history  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 因为 history 是列表，所以 self.history_list = history 是引用关系，没有进行深度拷贝，所以下面 history.pop() 执行 self.history_list 无需重新赋值")])]),o("div",[o("br")]),o("div",[t._v("            while time.time() - history[-1] > self.allow_time:")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v(" # 确保列表时间是允许的范围内（即: 列表的时间差不能超过60秒）")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("                # 循环计算最新的时间和最初的时间是否在60秒，如果不是删除则删除最初的时间")])]),o("div",[t._v("                history.pop()")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 判断列表的长度有没有超过允许访问次数")])]),o("div",[t._v("            if len(history) > self.visits:")]),o("div",[t._v("                return False")]),o("div",[o("br")]),o("div",[t._v("        return True")]),o("div",[o("br")]),o("div",[t._v("    def wait(self):")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 钩子函数（即: 回调函数）")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        # 当超过设置的访问频率时调用（即: 当allow_request返回False时调用）")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("        # 返回值等待时间")])]),o("div",[t._v("        return self.allow_time - (time.time() - self.history_list[-1])")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),o("div",[o("br")]),o("div",[t._v("REST_FRAMEWORK = {")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v(' # "DEFAULT_AUTHENTICATION_CLASSES": ["app01.rf_auth.TokenAuth"],  # 全局认证')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('    # "DEFAULT_PERMISSION_CLASSES": ["app01.rf_permission.SVIPPermission"]  # 全局权限')])],1),o("div",[t._v('    "DEFAULT_THROTTLE_CLASSES": ["app01.rf_throttle.MyThrottle"]  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 全局频率")])],1),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("不进行频率认证的视图类设置")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("如果设置了全局频率，但是又想某些视图不进行频率认证，那么可以在不想进行频率认证的视图类中设置")]),t._v(" throttle_classes "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("= []，因为在 rest-framework 源码中 局部频率的配置 会覆盖掉 全局频率的配置")])])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])]),o("div",[o("br")]),o("div",[t._v("import hashlib")]),o("div",[t._v("import time")]),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from .rf_auth import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[t._v("    serializer_class = BookSerializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 获取以用户名作为盐，以当前时间作为加密内容的字符串token")])]),o("div",[t._v("def get_token_str(username):")]),o("div",[t._v("    now_time = str(time.time())")]),o("div",[t._v('    md5 = hashlib.md5(bytes(username, encoding="utf8"))  '),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 加盐，使用用户名作为盐，保证token的唯一性")])]),o("div",[t._v("    md5.update(bytes(now_time, encoding='utf-8'))")]),o("div",[t._v("    return md5.hexdigest()")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 登陆，并且返回当前用户的token")])]),o("div",[t._v("class LoginView(APIView):")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("throttle_classes = []")]),t._v(" "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 在全局频率下，当前视图不进行频率认证")])],1),o("div",[o("br")]),o("div",[t._v("    def post(self, request):")]),o("div",[t._v("        username = request.data.get('username')")]),o("div",[t._v("        password = request.data.get('password')")]),o("div",[t._v("        user = User.objects.filter(username=username, password=password).first()")]),o("div",[t._v("        ret = {")]),o("div",[t._v("            'status': 0,")]),o("div",[t._v("            'msg': None")]),o("div",[t._v("        }")]),o("div",[t._v("        if user:")]),o("div",[t._v("            token_str = get_token_str(user.username)  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 获取Token值")])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 每次登陆成功后都要修改当前用户的token值")])]),o("div",[t._v("            Token.objects.update_or_create(user=user, defaults={'token': token_str})  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 如果有 user=user 这条数据，那么就修改 token 值，否则就进行添加")])]),o("div",[t._v("            ret['status'] = 1")]),o("div",[t._v("            ret['token'] = token_str")]),o("div",[t._v("        else:")]),o("div",[t._v("            ret['msg'] = '登陆失败'")]),o("div",[o("br")]),o("div",[t._v("        return Response(ret)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("4.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 局部频率 ->  使用 ")]),o("span",{staticStyle:{"font-size":"14pt"}},[o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("rest-framework 所提供的频率类")])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{staticStyle:{"font-size":"9pt",color:"rgb(65, 173, 28)"}},[t._v("# rf_throttle.py")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"},attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework.throttling import "),o("font",{attrs:{color:"#FA7A00"}},[t._v("SimpleRateThrottle")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class MyThrottle("),o("font",{attrs:{color:"#FA7A00"}},[t._v("SimpleRateThrottle")]),t._v("):")],1),o("div",[t._v("    rate = '5/m'  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 每分钟允许访问5次")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取用户IP地址")])],1),o("div",[t._v("    def get_cache_key(self, request, view):")]),o("div",[t._v("        return self.get_ident(request)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from .rf_throttle import *")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet(viewsets.ModelViewSet):")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("throttle_classes")]),t._v(" = [MyThrottle]")],1),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[t._v("    serializer_class = BookSerializers")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("5.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 全局频率 -> ")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("使用 ")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("rest-framework 所提供的频率类")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# rf_throttle.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework.throttling import SimpleRateThrottle")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class MyThrottle(SimpleRateThrottle):")]),o("div",[t._v("    scope = '"),o("font",{attrs:{color:"#FA7A00"}},[t._v("visit_rate")]),t._v("'  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置全局频率的属性名")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取用户IP地址")])],1),o("div",[t._v("    def get_cache_key(self, request, view):")]),o("div",[t._v("        return self.get_ident(request)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),o("div",[o("br")]),o("div",[t._v("REST_FRAMEWORK = {")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('# "DEFAULT_AUTHENTICATION_CLASSES": ["app01.rf_auth.TokenAuth"],  # 全局认证')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('    # "DEFAULT_PERMISSION_CLASSES": ["app01.rf_permission.SVIPPermission"]  # 全局权限')])],1),o("div",[t._v('    "DEFAULT_THROTTLE_CLASSES": ["app01.rf_throttle.MyThrottle"],  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 全局频率")])],1),o("div",[t._v('    "DEFAULT_THROTTLE_RATES": {')]),o("div",[t._v("        '"),o("font",{attrs:{color:"#FA7A00"}},[t._v("visit_rate")]),t._v("': '5/m'  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 每分钟允许访问5次")])],1),o("div",[t._v("    }")]),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("分页")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[t._v("只要继承了 APIView 就可以使用分页组件")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt"}},[o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("PageNumberPagination 的分页类使用")])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("方式一")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("视图四部曲中在混合使用方式中使用分页")])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{staticStyle:{"font-size":"9pt"},attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("from django.shortcuts import render, HttpResponse")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("from rest_framework.views import APIView")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("from rest_framework.response import Response")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("from .models import *")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("from .serializer import *")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("from rest_framework.pagination import PageNumberPagination")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("class MyPageNumberPagination(PageNumberPagination):")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    page_size = 1  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 每页显示多少条数据")])],1)],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    page_query_param = 'page'  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# url的参数名，即: ?page=1")])],1)],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    page_size_query_param = 'size'  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# url的参数名，即: ?page=1&size=2，如果在url加上该参数就代表临时显示2条数据")])],1)],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    max_page_size = 5  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置最大的临时显示数，一般和 page_size_query_param 搭配使用，即: size 所设置的数值不能超过 max_page_size 所设置的数值")])],1)],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("class PublishView(APIView):")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看所有出版社")])],1)],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("    def get(self, request):")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        publish_list = Publish.objects.all()")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 分页")])],1)],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        pnp = MyPageNumberPagination()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 实例化分页对象")])],1)],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        publish_list_page = pnp.paginate_queryset(publish_list, request, self)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用分页对象下的 paginate_queryset 方法处理 queryset 对象（即: 查询到的数据列表）")])],1)],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        ps = PublishSerializers(publish_list_page, many=True)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 序列化被 paginate_queryset 方法处理后的 queryset 对象（即: 查询到的数据列表）")])],1)],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"}},[t._v("        return Response(ps.data)")])],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 查看出版社（带分页）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/publish/?page=1")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 分页说明: 每页显示1条数据")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 1,')]),o("div",[t._v('        "name": "东莞出版社",')]),o("div",[t._v('        "email": "123@qq.com"')]),o("div",[t._v("    }")]),o("div",[t._v("]")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# --------------------------------------------------------------")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口说明: 查看出版社（带分页）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/publish/?page=1&size=3")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 请求类型: GET")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 分页说明: 每页显示1条数据，临时显示3条数据")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 结果:")])],1),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 1,')]),o("div",[t._v('        "name": "东莞出版社",')]),o("div",[t._v('        "email": "123@qq.com"')]),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 2,')]),o("div",[t._v('        "name": "广州出版社",')]),o("div",[t._v('        "email": "123@qq.com"')]),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 4,')]),o("div",[t._v('        "name": "深圳出版社",')]),o("div",[t._v('        "email": "123@qq.com"')]),o("div",[t._v("    }")]),o("div",[t._v("]")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("方式二")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("视图四部曲中除了混合使用方式外的其他方式使用分页")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("pagination_class = 分页类")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[t._v("from rest_framework.pagination import PageNumberPagination")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class MyPageNumberPagination(PageNumberPagination):")]),o("div",[t._v("    page_size = 1  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 每页显示多少条数据")])],1),o("div",[t._v("    page_query_param = 'page'  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# url的参数名，即: ?page=1")])],1),o("div",[t._v("    page_size_query_param = 'size'  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# url的参数名，即: ?page=1&size=2，如果在url加上该参数就代表临时显示2条数据")])],1),o("div",[t._v("    max_page_size = 5  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置最大的临时显示数，一般和 page_size_query_param 搭配使用，即: size 所设置的数值不能超过 max_page_size 所设置的数值")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("pagination_class")]),t._v(" = MyPageNumberPagination")],1)]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口说明: 查看出版社（带分页）")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("口: http://127.0.0.1:8000/publish/?page=1")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: GET")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 分页说明: 每页显示1条数据")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("{")]),o("div",[t._v('    "count": 11,  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 总页数")])],1),o("div",[t._v('    "next": "http://127.0.0.1:8000/publish/?page=2",  '),o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 下一页的网址，没有则为 null")])],1),o("div",[t._v('    "previous": null,  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 上一页的网址，没有则为 null")])],1),o("div",[t._v('    "results": [')]),o("div",[t._v("        {")]),o("div",[t._v('            "id": 1,')]),o("div",[t._v('            "name": "东莞出版社",')]),o("div",[t._v('            "email": "123@qq.com"')]),o("div",[t._v("        }")]),o("div",[t._v("    ]")]),o("div",[t._v("}")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("# --------------------------------------------------------------")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口说明: 查看出版社（带分页）")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口:")]),o("font",{attrs:{color:"#41AD1C"}},[t._v(" http://127.0.0.1:8000/publish/?page=1&size=3")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: GET")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 分页说明: 每页显示1条数据，临时显示3条数据")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("{")]),o("div",[t._v('    "count": 11,  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 总页数")])],1),o("div",[t._v('    "next": "http://127.0.0.1:8000/publish/?page=2&size=3",  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 下一页的网址，没有则为 null")])],1),o("div",[t._v('    "previous": null,  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 上一页的网址，没有则为 null")])],1),o("div",[t._v('    "results": [')]),o("div",[t._v("        {")]),o("div",[t._v('            "id": 1,')]),o("div",[t._v('            "name": "东莞出版社",')]),o("div",[t._v('            "email": "123@qq.com"')]),o("div",[t._v("        },")]),o("div",[t._v("        {")]),o("div",[t._v('            "id": 2,')]),o("div",[t._v('            "name": "广州出版社",')]),o("div",[t._v('            "email": "123@qq.com"')]),o("div",[t._v("        },")]),o("div",[t._v("        {")]),o("div",[t._v('            "id": 4,')]),o("div",[t._v('            "name": "深圳出版社",')]),o("div",[t._v('            "email": "123@qq.com"')]),o("div",[t._v("        }")]),o("div",[t._v("    ]")]),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("配置全局的分页参数 -> 不建议使用")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("如果配置了全局的分页参数可以不用创建分页类，直接使用 PageNumberPagination 分页类")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("只有 PAGE_SIZE 这个参数可以进行设置")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),o("div",[o("br")]),o("div",[t._v("REST_FRAMEWORK = {")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('# "DEFAULT_AUTHENTICATION_CLASSES": ["app01.rf_auth.TokenAuth"],  # 全局认证')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('    # "DEFAULT_PERMISSION_CLASSES": ["app01.rf_permission.SVIPPermission"]  # 全局权限')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("    # 'DEFAULT_PARSER_CLASSES': ['rest_framework.parsers.JSONParser']  # 全局解析器")])],1),o("div",[t._v("    'PAGE_SIZE': 1,  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 分页 -> 一页显示多少条数据")])],1),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 方式一")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework.pagination import PageNumberPagination")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 查看所有出版社")])],1),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_list = Publish.objects.all()")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 分页")])],1),o("div",[t._v("        pnp = PageNumberPagination()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 实例化分页对象")])],1),o("div",[t._v("        publish_list_page = pnp.paginate_queryset(publish_list, request, self)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用分页对象下的 paginate_queryset 方法处理 queryset 对象（即: 查询到的数据列表）")])],1),o("div",[o("br")]),o("div",[t._v("        ps = PublishSerializers(publish_list_page, many=True)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 序列化被 paginate_queryset 方法处理后的 queryset 对象（即: 查询到的数据列表）")])],1),o("div",[t._v("        return Response(ps.data)")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# -----------------------------------------")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 方式二")])],1),o("div",[o("br")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[t._v("from rest_framework.pagination import PageNumberPagination")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#000000"}},[t._v("pagination_class")]),t._v(" = PageNumberPagination")],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("LimitOffsetPagination")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 的偏移分页类使用")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("LimitOffsetPagination的使用方式和PageNumberPagination的使用方式是一样，只是")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("LimitOffsetPagination分页")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("类的参数和功能不一样而已")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("方式一")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("视图四部曲中在混合使用方式中使用分页")])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework.pagination import LimitOffsetPagination")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class MyLimitOffsetPagination(LimitOffsetPagination):")]),o("div",[t._v("    default_limit = 2  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 显示多少条数据")])],1),o("div",[t._v("    limit_query_param = 'limit'  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# url的参数名，即: ?limit=2")])],1),o("div",[t._v("    offset_query_param = 'offset'  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# url的参数名，即: ?limit=2&offset=1，如果在url加上该参数就代表从1开始偏移几位")])],1),o("div",[t._v("    max_limit = 5  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 限制最多显示多少条数据")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看所有出版社")])],1),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_list = Publish.objects.all()")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 分页")])],1),o("div",[t._v("        lop = MyLimitOffsetPagination()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 实例化分页对象")])],1),o("div",[t._v("        publish_list_page = lop.paginate_queryset(publish_list, request, self)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用分页对象下的 paginate_queryset 方法处理 queryset 对象（即: 查询到的数据列表）")])],1),o("div",[o("br")]),o("div",[t._v("        ps = PublishSerializers(publish_list_page, many=True)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 序列化被 paginate_queryset 方法处理后的 queryset 对象（即: 查询到的数据列表）")])],1),o("div",[t._v("        return Response(ps.data)")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口说明: 查看出版社（带分页）")])]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 接口: http://127.0.0.1:8000/publish/?offset=2")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: GET")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 分页说明: 显示2条数据，从1开始偏移2条数据")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 3,')]),o("div",[t._v('        "name": "深圳出版社",')]),o("div",[t._v('        "email": "123@qq.com"')]),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 4,')]),o("div",[t._v('        "name": "深圳出版社",')]),o("div",[t._v('        "email": "123@qq.com"')]),o("div",[t._v("    }")]),o("div",[t._v("]")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("# --------------------------------------------------------------")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口说明: 查看出版社（带分页）")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("口: http://127.0.0.1:8000/publish/?limit=3&offset=2")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: GET")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 分页说明: 显示3条数据，从1开始偏移2条数据")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("[")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 3,')]),o("div",[t._v('        "name": "深圳出版社",')]),o("div",[t._v('        "email": "123@qq.com"')]),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 4,')]),o("div",[t._v('        "name": "深圳出版社",')]),o("div",[t._v('        "email": "123@qq.com"')]),o("div",[t._v("    },")]),o("div",[t._v("    {")]),o("div",[t._v('        "id": 5,')]),o("div",[t._v('        "name": "深圳出版社",')]),o("div",[t._v('        "email": "123@qq.com"')]),o("div",[t._v("    }")]),o("div",[t._v("]")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("方式二")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("视图四部曲中除了混合使用方式外的其他方式使用分页")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("pagination_class = 分页类")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1)]),o("div",[o("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1)]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[t._v("from rest_framework.pagination import LimitOffsetPagination")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class MyLimitOffsetPagination(LimitOffsetPagination):")]),o("div",[t._v("    default_limit = 2 "),o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 显示多少条数据")])],1),o("div",[t._v("    limit_query_param = 'limit'  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# url的参数名，即: ?limit=2")])],1),o("div",[t._v("    offset_query_param = 'offset'  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# url的参数名，即: ?limit=2&offset=1，如果在url加上该参数就代表从1开始偏移几位")])],1),o("div",[t._v("    max_limit = 5  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 限制最多显示多少条数据")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("pagination_class")]),t._v(" = MyLimitOffsetPagination")],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口说明: 查看出版社（带分页）")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("口: http://127.0.0.1:8000/publish/?offset=1")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: GET")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 分页说明: 默认显示2条数据，从1开始偏移1条数据")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("{")]),o("div",[t._v('    "count": 11,  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 总页数")])],1),o("div",[t._v('    "next": "http://127.0.0.1:8000/publish/?limit=2&offset=3",  '),o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 下一页的网址，没有则显示null")])],1),o("div",[t._v('    "previous": "http://127.0.0.1:8000/publish/?limit=2",  '),o("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 上一页的网址，没有则显示null")])],1),o("div",[t._v('    "results": [')]),o("div",[t._v("        {")]),o("div",[t._v('            "id": 2,')]),o("div",[t._v('            "name": "广州出版社",')]),o("div",[t._v('            "email": "123@qq.com"')]),o("div",[t._v("        },")]),o("div",[t._v("        {")]),o("div",[t._v('            "id": 4,')]),o("div",[t._v('            "name": "深圳出版社",')]),o("div",[t._v('            "email": "123@qq.com"')]),o("div",[t._v("        }")]),o("div",[t._v("    ]")]),o("div",[t._v("}")]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("# --------------------------------------------------------------")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接口说明: 查看出版社（带分页）")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 接")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("口: http://127.0.0.1:8000/publish/?limit=3&offset=2")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 请求类型: GET")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 分页说明: ")]),o("font",{attrs:{color:"#41AD1C"}},[t._v("显示3条数据，从1开始偏移2条数据")])],1),o("div",[o("br")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 结果:")])]),o("div",[o("br")]),o("div",[t._v("{")]),o("div",[t._v('    "count": 11,  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 总页数")])],1),o("div",[t._v('    "next": "http://127.0.0.1:8000/publish/?limit=3&offset=5",  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 下一页的网址，没有则显示null")])],1),o("div",[t._v('    "previous": "http://127.0.0.1:8000/publish/?limit=3",  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 上一页的网址，没有则显示null")])],1),o("div",[t._v('    "results": [')]),o("div",[t._v("        {")]),o("div",[t._v('            "id": 4,')]),o("div",[t._v('            "name": "深圳出版社",')]),o("div",[t._v('            "email": "123@qq.com"')]),o("div",[t._v("        },")]),o("div",[t._v("        {")]),o("div",[t._v('            "id": 5,')]),o("div",[t._v('            "name": "深圳出版社",')]),o("div",[t._v('            "email": "123@qq.com"')]),o("div",[t._v("        },")]),o("div",[t._v("        {")]),o("div",[t._v('            "id": 6,')]),o("div",[t._v('            "name": "深圳出版社",')]),o("div",[t._v('            "email": "123@qq.com"')]),o("div",[t._v("        }")]),o("div",[t._v("    ]")]),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("配置全局的分页参数 -> 不建议使用")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("如果配置了全局的分页参数可以不用创建分页类，直接使用 LimitOffsetPagination 分页类")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("只有 PAGE_SIZE 这个参数可以进行设置")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("这里的 PAGE_SIZE 参数指的是 default_limit 参数")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# settings.py")])]),o("div",[o("br")]),o("div",[t._v("REST_FRAMEWORK = {")]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('# "DEFAULT_AUTHENTICATION_CLASSES": ["app01.rf_auth.TokenAuth"],  # 全局认证')])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('    # "DEFAULT_PERMISSION_CLASSES": ["app01.rf_permission.SVIPPermission"]  # 全局权限')])]),o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("    # 'DEFAULT_PARSER_CLASSES': ['rest_framework.parsers.JSONParser']  # 全局解析器")])]),o("div",[t._v("    'PAGE_SIZE': 2,  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 分页 -> 显示多少条数据")])]),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 方式一")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from django.shortcuts import render, HttpResponse")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework.pagination import LimitOffsetPagination")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishView(APIView):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 查看所有出版社")])],1),o("div",[t._v("    def get(self, request):")]),o("div",[t._v("        publish_list = Publish.objects.all()")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 分页")])],1),o("div",[t._v("        lop = LimitOffsetPagination()  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 实例化分页对象")])],1),o("div",[t._v("        publish_list_page = lop.paginate_queryset(publish_list, request, self)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用分页对象下的 paginate_queryset 方法处理 queryset 对象（即: 查询到的数据列表）")])],1),o("div",[o("br")]),o("div",[t._v("        ps = PublishSerializers(publish_list_page, many=True)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 序列化被 paginate_queryset 方法处理后的 queryset 对象（即: 查询到的数据列表）")])],1),o("div",[t._v("        return Response(ps.data)")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("# -------------------------------------------")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 方式二")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from .models import *")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[t._v("from rest_framework.pagination import LimitOffsetPagination")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class PublishViewSet(viewsets.ModelViewSet):")]),o("div",[t._v("    queryset = Publish.objects.all()")]),o("div",[t._v("    serializer_class = PublishSerializers")]),o("div",[o("br")]),o("div",[t._v("    pagination_class = LimitOffsetPagination")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("版本")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[t._v("只要继承了 APIView 就可以使用版本")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 版本的作用")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("根据版本的不同返回相应的数据结构")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("限制只能使用哪几个版本的接口")])])])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 局部版本")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("局部版本的配置（即:")]),t._v(" versioning_class "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("= 版本类）会覆盖掉该视图类在全局版本中的配置")])])])]),o("div",[o("font",{staticStyle:{"font-size":"12pt"}},[o("br")])],1),o("ul",[o("li",[o("div",[t._v("versioning_class "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("= 版本类")])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("QueryParameterVersioning 版本类 -> 从 url 参数中获取版本号")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("url版本参数的默认参数名: version")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("访问的url: "),o("a",{attrs:{href:"http://127.0.0.1:8000/api/book/?version=v1"}},[t._v("http://127.0.0.1:8000/api/book/?version=v1")])])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[o("br")]),o("div",[t._v("from rest_framework.versioning import "),o("font",{attrs:{color:"#FA7A00"}},[t._v("QueryParameterVersioning")]),t._v(", URLPathVersioning")],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet(APIView):")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("versioning_class")]),t._v(" = QueryParameterVersioning  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 局部版本")])],1),o("div",[o("br")]),o("div",[t._v("    def get(self, request, *args, **kwargs):")]),o("div",[o("br")]),o("div",[t._v("        print(request.version)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# v1 -> 获取当前版本号")])],1),o("div",[t._v("        print(request.versioning_scheme)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# QueryParameterVersioning 的实例化对象")])],1),o("div",[o("br")]),o("div",[t._v("        if request.version == 'v1':")]),o("div",[t._v("            return Response('v1版本的数据')")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response('其他版本的数据')")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("URLPathVersioning ")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("版本类")]),t._v(" "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("-> 使用url正则匹配获取版本号 -> 推荐使用")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("命名匹配的默认名称: version")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("访问的url:  "),o("a",{attrs:{href:"http://127.0.0.1:8000/api/v1/book/"}},[t._v("http://127.0.0.1:8000/api/v1/book/")])])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[o("br")]),o("div",[t._v("from rest_framework.versioning import QueryParameterVersioning, "),o("font",{attrs:{color:"#FA7A00"}},[t._v("URLPathVersioning")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet(APIView):")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("versioning_class")]),t._v(" = URLPathVersioning  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 局部版本")])],1),o("div",[o("br")]),o("div",[t._v("    def get(self, request, *args, **kwargs):")]),o("div",[o("br")]),o("div",[t._v("        print(request.version)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# v1 -> 获取当前版本号")])],1),o("div",[t._v("        print(request.versioning_scheme)  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# QueryParameterVersioning 的实例化对象")])],1),o("div",[o("br")]),o("div",[t._v("        if request.version == 'v1':")]),o("div",[t._v("            return Response('v1版本的数据')")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response('其他版本的数据')")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("注意:")]),o("span",{staticStyle:{"font-weight":"bold"}},[t._v(" url必须使用命名匹配")])])])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# urls.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("urlpatterns = [")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(" url(r'api/"),o("font",{attrs:{color:"#FA7A00"}},[t._v("(?P<version>[v1|v2]+)")]),t._v("/book', BookViewSet.as_view()),")],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 等同于")])],1),o("div",[t._v("    url(r'api/"),o("font",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("(?P<version>\\w+)")]),t._v("/book', BookViewSet.as_view()),  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用该正则的前提必须设置了允许的版本")])],1),o("div",[t._v("]")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("request.version 和 request.")]),t._v("versioning_scheme 的说明")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("如果使用了版本，那么 request 就会被绑定两个属性: "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("version 和 ")]),t._v("versioning_scheme ")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("version: 当前版本，用于")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("根据版本的不同返回相应的数据结构")])])]),o("li",[o("div",[t._v("versioning_scheme: 当前使用的版本类的实例化对象")])])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# views.py")])]),o("div",[o("br")]),o("div",[t._v("from rest_framework.views import APIView")]),o("div",[t._v("from rest_framework.response import Response")]),o("div",[o("br")]),o("div",[t._v("from rest_framework.versioning import QueryParame"),o("font",{attrs:{color:"#000000"}},[t._v("terVersioning, URLPathVersioning")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet(APIView):")]),o("div",[o("br")]),o("div",[t._v("    versioning_class = URLPathVersioning  ")]),o("div",[o("br")]),o("div",[t._v("    def get(self, request, *args, **kwargs):")]),o("div",[o("br")]),o("div",[t._v("        print("),o("font",{attrs:{color:"#FA7A00"}},[t._v("request.version")]),t._v(")  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# v1 -> 获取当前版本号")])],1),o("div",[t._v("        print("),o("font",{attrs:{color:"#FA7A00"}},[t._v("request.versioning_scheme")]),t._v(")  "),o("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# QueryParameterVersioning 的实例化对象")])],1),o("div",[o("br")]),o("div",[t._v("        if request.version == 'v1':")]),o("div",[t._v("            return Response('v1版本的数据')")]),o("div",[t._v("        else:")]),o("div",[t._v("            return Response('其他版本的数据')")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("version 参数名的修改")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("version 参数名必须要在全局设置中修改（即: settings.py）")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("QueryParameterVersioning 的 ")]),t._v("url版本参数名 “version” 和 "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("URLPathVersioning 命名匹配的 “")]),t._v("version"),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("”，使用的都是同一个配置项中的参数名")])])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),o("div",[o("br")]),o("div",[t._v("REST_FRAMEWORK = {")]),o("div",[t._v("    \"VERSION_PARAM\": 'v',  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 参数名")])],1),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("默认版本号")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("该设置必须在全局中进行设置（即: settings.py）")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("REST_FRAMEWORK = {")]),o("div",[t._v("    \"VERSION_PARAM\": 'version', "),o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 参数名")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("    'DEFAULT_VERSION': 'v1',  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 默认版本号")])],1),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("允许的版本")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("说明: 允许调用当前接口的哪些版本")])])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("该设置必须在全局中进行设置（即: settings.py）")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),o("div",[o("br")]),o("div",[t._v("REST_FRAMEWORK = {")]),o("div",[t._v("    \"VERSION_PARAM\": 'version',  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 参数名")])],1),o("div",[t._v("    'DEFAULT_VERSION': 'v1',  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 默认版本号")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("    'ALLOWED_VERSIONS': ['v1', 'v2'],  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 允许的版本")])],1),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 全局版本")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("全局版本作用于所有视图类")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("可以通过设置局部版本来覆盖全局版本的设置")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),o("div",[o("br")]),o("div",[t._v("REST_FRAMEWORK = {")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("……")])],1),o("div",[t._v('    "DEFAULT_VERSIONING_CLASS": "rest_framework.versioning.URLPathVersioning",  '),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 使用什么版本类")])],1),o("div",[t._v("    \"VERSION_PARAM\": 'version', "),o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 参数名")])],1),o("div",[t._v("    'DEFAULT_VERSION': 'v1',  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 默认版本号")])],1),o("div",[t._v("    'ALLOWED_VERSIONS': ['v1', 'v2'],  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 允许的版本")])],1),o("div",[t._v("}")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("解析器")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 解析器的说明")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("根据 Content-Type 类型对发送过来的数据进行解析")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("可以通过编写中间件的方式实现解析器的功能")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("rest_framework 提供了4个解析器:")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("JSONParser ->  Content-Type = application/json")])]),o("li",[o("div",[t._v("FormParser ->  Content-Type = application/x-www-form-urlencoded")])]),o("li",[o("div",[t._v("MultiPartParser -> Content-Type = multipart/form-data")])]),o("li",[o("div",[t._v("FileUploadParser -> Content-Type = */*")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("在使用 rest_framework 的时候所有视图类默认支持 JSONParser、FormParser、MultiPartParser 解析器")])])])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 局部解析器")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("局部解析器的配置（即: parser_classes = [解析器, 解析器]）会覆盖掉该视图类在全局解析器中的配置")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("parser_classes = [解析器, 解析器]")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("注意: ")]),t._v("在日常开发中尽量不要去配置局部解析器和全局解析器，因为 rest_framework 默认所设置的3个解析器已经够用了")])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[t._v("from rest_framework.parsers import JSONParser, FormParser  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 导入解析器")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet(viewsets.ModelViewSet):")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("parser_classes")]),t._v(" = [JSONParser]  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 该视图类只使用 JSONParser 解析器")])],1),o("div",[o("br")]),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[t._v("    serializer_class = BookSerializers")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 全局解析器")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("全局解析器的设置作用于所有视图类")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("可以通过设置局部解析器来覆盖全局解析器的设置")])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),o("div",[o("br")]),o("div",[t._v("REST_FRAMEWORK = {")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('# "DEFAULT_AUTHENTICATION_CLASSES": ["app01.rf_auth.TokenAuth"],  # 全局认证')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('    # "DEFAULT_PERMISSION_CLASSES": ["app01.rf_permission.SVIPPermission"]  # 全局权限')])],1),o("div",[t._v("    'DEFAULT_PARSER_CLASSES': ['rest_framework.parsers.JSONParser']  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 全局解析器")])],1),o("div",[t._v("}")])]),o("div",[o("br")])]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("渲染器")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 渲染器的说明")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("渲染器就是设置所要返回的数据在浏览器的显示格式")])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("注意:")]),o("span",{staticStyle:{"font-weight":"bold"}},[t._v(" 不要使用 JSONRenderer 除外的渲染器，因为容易出 BUG （通俗理解: 只使用 JSONRenderer 渲染器）")])])])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 局部渲染器")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("局部渲染器的配置（即:")]),t._v(" renderer_classes "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("= [渲染器,")]),t._v(" "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("渲染器")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("]）会覆盖掉该视图类在全局渲染器中的配置")])])])]),o("div",[o("font",{staticStyle:{"font-size":"12pt"}},[o("br")])],1),o("ul",[o("li",[o("div",[t._v("renderer_classes "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("= [渲染器,")]),t._v(" "),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("渲染器")]),o("span",{staticStyle:{"font-size":"12pt"}},[t._v("]")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),o("div",[o("br")]),o("div",[t._v("from .serializer import *")]),o("div",[t._v("from .models import *")]),o("div",[t._v("from rest_framework import viewsets")]),o("div",[o("br")]),o("div",[t._v("from rest_framework.renderers import "),o("font",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("JSONRenderer")]),t._v(", "),o("font",{attrs:{color:"#FA7A00"}},[t._v("BrowsableAPIRenderer")]),t._v(", "),o("font",{attrs:{color:"#FA7A00"}},[t._v("AdminRenderer")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("class BookViewSet(viewsets.ModelViewSet):")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("        常用的渲染器:")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("            JSONRenderer: 显示JSON格式（即: 没有任何样式）")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("            BrowsableAPIRenderer: 使用 rest-framework 所提供的 html 模板显示 JSON 格式，默认显示格式")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("            AdminRenderer: 显示表格的形式")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('    """')])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(" "),o("font",{attrs:{color:"#FA7A00"}},[t._v("renderer_classes")]),t._v(" = ["),o("font",{attrs:{color:"#FA7A00"}},[t._v("JSONRenderer")]),t._v(", "),o("font",{attrs:{color:"#FA7A00"}},[t._v("BrowsableAPIRenderer")]),t._v(", "),o("font",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v("AdminRenderer")]),t._v("]  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 局部渲染器，同时使用 JSONRenderer、BrowsableAPIRenderer、AdminRenderer 渲染器")])],1),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("renderer_classes")]),t._v(" = ["),o("font",{attrs:{color:"#FA7A00"}},[t._v("JSONRenderer")]),t._v("]  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 该视图类只使用 JSONRenderer 渲染器")])],1),o("div",[o("br")]),o("div",[t._v("    queryset = Book.objects.all()")]),o("div",[t._v("    serializer_class = BookSerializers")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("JSONRenderer 在浏览器的显示效果")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("访问的url: "),o("a",{attrs:{href:"http://127.0.0.1:8000/book/?format=json"}},[t._v("http://127.0.0.1:8000/book/?format=json")])])])])]),o("div",[o("br")]),o("div",[o("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Django/rest-framework 框架_files/Image [1].png",type:"image/png"}})]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("BrowsableAPIRenderer 在浏览器的显示效果，默认显示格式")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("访问的url: "),o("a",{attrs:{href:"http://127.0.0.1:8000/book/?format=api"}},[t._v("http://127.0.0.1:8000/book/?format=api")])])])])]),o("div",[o("br")]),o("div",[o("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Django/rest-framework 框架_files/Image [2].png",type:"image/png"}})]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("AdminRenderer 在浏览器的显示效果")])])]),o("div",[o("br")]),o("ul",[o("ul",[o("li",[o("div",[t._v("访问的url:  "),o("a",{attrs:{href:"http://127.0.0.1:8000/book/?format=admin"}},[t._v("http://127.0.0.1:8000/book/?format=admin")])])])])]),o("div",[o("br")]),o("div",[o("img",{attrs:{"data-filename":"Image.png",src:"/kevin-blog/Django/rest-framework 框架_files/Image [3].png",type:"image/png"}})]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 全局渲染器")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("全局渲染器的设置作用于所有视图类")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("可以通过设置局部渲染器来覆盖全局渲染器的设置")])])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# settings.py")])],1),o("div",[o("br")]),o("div",[t._v("REST_FRAMEWORK = {")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('# "DEFAULT_AUTHENTICATION_CLASSES": ["app01.rf_auth.TokenAuth"],  # 全局认证')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('    # "DEFAULT_PERMISSION_CLASSES": ["app01.rf_permission.SVIPPermission"]  # 全局权限')])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v('    # "DEFAULT_THROTTLE_CLASSES": ["app01.rf_throttle.MyThrottle"],  # 全局频率')])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("#")]),t._v(" \"DEFAULT_RENDERER_CLASSES\": ['rest_framework.renderers.JSONRenderer', 'rest_framework.renderers.BrowsableAPIRenderer', 'rest_framework.renderers.AdminRenderer']  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 全局渲染器")])],1),o("div",[t._v("    \"DEFAULT_RENDERER_CLASSES\": ['rest_framework.renderers.JSONRenderer']  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 全局渲染器")])],1),o("div",[t._v("}")])]),o("div",[o("br")]),o("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("注册url的新方法")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("rest-framework 提供了新的url注册方法")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("使用前提: 视图类必须继承 ModelViewSet（即: 必须使用视图四部曲中的终极版）")])])])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("rest-framework 的url注册方法会在原本的两条url基础上在添加多两条url")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# urls.py")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[t._v("from django.conf.urls import url, include")]),o("div",[t._v("from django.contrib import admin")]),o("div",[t._v("from app01.views import *")]),o("div",[o("br")]),o("div",[t._v("from rest_framework import "),o("font",{attrs:{color:"#FA7A00"}},[t._v("routers")])],1),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 实例化默认路由对象")])],1),o("div",[t._v("router = routers.DefaultRouter()")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 注册路由:")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}}),o("font",{attrs:{color:"#FA7A00"}},[t._v("# 默认路由对象.register('url前缀', 视图类)")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("    # url前缀是一个字符串，而不是一个url正则路径")])],1),o("div",[t._v("router.register(r'book', BookViewSet)")]),o("div",[t._v("router.register(r'publish', PublishViewSet)")]),o("div",[o("br")]),o("div",[t._v("urlpatterns = [")]),o("div",[o("font",{attrs:{color:"#FA7A00"}},[t._v("url(r'', include(router.urls))")]),t._v(",  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 注册路由")])],1),o("div",[t._v("    url(r'login', LoginView.as_view()),")]),o("div",[t._v("]")])]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("所生成的url正则路径")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[t._v("^book/$ [name='book-list']  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 平时我们使用的操作或查看所有数据的url")])],1),o("div",[t._v("^book\\.(?P<format>[a-z0-9]+)/?$ [name='book-list']  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# rest-framework 新增的")])],1),o("div",[t._v("^book/(?P<pk>[^/.]+)/$ [name='book-detail']  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 平时我们使用的操作或查看指定数据的url")])],1),o("div",[t._v("^book/(?P<pk>[^/.]+)\\.(?P<format>[a-z0-9]+)/?$ [name='book-detail']  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# rest-framework 新增的")])],1),o("div",[o("br")]),o("div",[t._v("^publish/$ [name='publish-list']  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 平时我们使用的操作或查看所有数据的url")])],1),o("div",[t._v("^publish\\.(?P<format>[a-z0-9]+)/?$ [name='publish-list']  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# rest-framework 新增的")])],1),o("div",[t._v("^publish/(?P<pk>[^/.]+)/$ [name='publish-detail']  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 平时我们使用的操作或查看指定数据的url")])],1),o("div",[t._v("^publish/(?P<pk>[^/.]+)\\.(?P<format>[a-z0-9]+)/?$ [name='publish-detail']  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# rest-framework 新增的")])],1)]),o("div",[o("br")]),o("ul",[o("li",[o("div",[t._v("所生成url路径")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[t._v("http://127.0.0.1:8000/book/")]),o("div",[t._v("http://127.0.0.1:8000/book.json")]),o("div",[t._v("http://127.0.0.1:8000/book/2/")]),o("div",[t._v("http://127.0.0.1:8000/book/2.json")]),o("div",[o("br")]),o("div",[t._v("http://127.0.0.1:8000/publish/")]),o("div",[t._v("http://127.0.0.1:8000/publish.json")]),o("div",[t._v("http://127.0.0.1:8000/publish/1/")]),o("div",[t._v("http://127.0.0.1:8000/publish/1.json")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[t._v("# 在url正则路径中没有，但是 ")]),t._v("rest-framework 默认添加上的url路径")])],1),o("div",[o("br")]),o("div",[t._v("http://127.0.0.1:8000/book/?format=api")]),o("div",[t._v("http://127.0.0.1:8000/book/?format=json")]),o("div",[o("br")]),o("div",[t._v("http://127.0.0.1:8000/book/2/?format=api")]),o("div",[t._v("http://127.0.0.1:8000/book/2/?format=json")])]),o("div",[o("br")])]),o("div",[o("br")]),o("div",[o("br")]),o("div",[o("br")])])])])}),[],!1,null,null,null);i.default=r.exports}}]);