(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{424:function(e,t,i){"use strict";i.r(t);var r=i(25),o=Object(r.a)({},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[i("div",[i("span",[i("div",[i("div",[i("div",[i("div",[i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[e._v("中间件介绍")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("1.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v(" 官方说法: ")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"12pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[e._v("中间件是一个用来处理Django的请求和响应的框架级别的钩子")])])])]),i("li",[i("div",[i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"12pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[e._v("它是一个轻量、低级别的插件系统，")])])])]),i("li",[i("div",[i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"12pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[e._v("用于在全局范围内改变Django的输入和输出。")])])])]),i("li",[i("div",[i("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"12pt",color:"rgb(0, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal"}},[e._v("每个中间件组件都负责做一些特定的功能")])])])])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("2.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v(" 通俗理解:")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("中间件是帮助我们在视图函数执行之前和执行之后都可以做一些额外的操作（类似于装饰器，只不过就是所有的视图函数都自动使用上了这个装饰器）")])]),i("li",[i("div",[e._v("本质上就是一个自定义类，类中定义了几个方法")])]),i("li",[i("div",[e._v("Django框架会在请求的特定的时间去执行这些方法")])])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("3.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v(" 什么时候使用中间件:")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[e._v("当所有的视图函数在执行前后需要做一些额外的功能的时候（如: 登陆验证），这样就无需编写装饰器，然后给每一个视图函数添加装饰器")])])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("4.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v(" 注意事项:")])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[e._v("中间件是作用于全局的，所以需要谨慎使用，使用不当会影响性能")])])])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("5.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v(" 中间件的执行顺序:")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[e._v("在 settings.py 中的 ")]),e._v("MIDDLEWARE 配置项里面所注册的中间件会从上往下执行")])])]),i("div",[i("br")]),i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[e._v("自定义中间件")])]),i("div",[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("1.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v(" 自定义一个中间件示例")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("# my_middleware.py")])],1),i("div",[i("br")]),i("div",[e._v("from django.utils.deprecation import MiddlewareMixin")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[e._v("class MD1(MiddlewareMixin):")]),i("div",[i("br")]),i("div",[e._v("    def process_request(self, request):")]),i("div",[e._v("        print('MD1里面的 process_request')")]),i("div",[i("br")]),i("div",[e._v("    def process_response(self, request, response):")]),i("div",[e._v("        print('MD1里面的 process_response')")]),i("div",[e._v("        return response")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# settings.py")])],1),i("div",[i("br")]),i("div",[e._v("MIDDLEWARE = [")]),i("div",[e._v("    'django.middleware.security.SecurityMiddleware',")]),i("div",[e._v("    'django.contrib.sessions.middleware.SessionMiddleware',")]),i("div",[e._v("    'django.middleware.common.CommonMiddleware',")]),i("div",[e._v("    'django.middleware.csrf.CsrfViewMiddleware',")]),i("div",[e._v("    'django.contrib.auth.middleware.AuthenticationMiddleware',")]),i("div",[e._v("    'django.contrib.messages.middleware.MessageMiddleware',")]),i("div",[e._v("    'django.middleware.clickjacking.XFrameOptionsMiddleware',")]),i("div",[e._v("    'my_middleware.MD1'  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 注册（添加）自定义的中间件")])],1),i("div",[e._v("]")])]),i("div",[i("br")]),i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[e._v("中间件的五个方法")])]),i("div",[i("br")]),i("div",[e._v("中间件可以定义五个方法，分别是:（常用的是process_request、process_response、process_view）")]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[e._v("process_request(self, request)")])])]),i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[e._v("process_view(self, request, view_func, view_args, view_kwargs)")])])]),i("li",[i("div",[e._v("process_template_response(self, request, response)")])]),i("li",[i("div",[e._v("process_exception(self, request, exception)")])]),i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[e._v("process_response(self, request, response)")])])])]),i("div",[i("br")]),i("div",[e._v("参数说明: ")]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("request: 和视图函数中 request 参数一样，可以获取到请求的相关信息")])]),i("li",[i("div",[e._v("response: 视图函数的返回值（即: response对象，三件套）")])]),i("li",[i("div",[e._v("view_func: Django即将执行的视图函数 ")])]),i("li",[i("div",[e._v("view_args: Django即将执行的视图函数所接收的位置参数，不包含第一个视图参数 response")])]),i("li",[i("div",[e._v("view_kwargs: Django即将执行的视图函数所接收的关键字参数，不包含第一个视图参数 response")])]),i("li",[i("div",[e._v("exception: 视图函数异常产生的Exception对象")])])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("1.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),i("font",{staticStyle:{"font-size":"14pt"}},[i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v("process_request(self, request)")])])],1),i("div",[i("font",{staticStyle:{"font-size":"14pt"}},[i("br")])],1),i("ul",[i("li",[i("div",[e._v("何时执行: 当WSGI拿到浏览器发送过来的相关请求之后")])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("执行顺序: 按照中间件的注册顺序（"),i("span",{staticStyle:{"font-size":"12pt"}},[e._v("在 settings.py 中的 ")]),e._v("MIDDLEWARE 配置项里面所注册的中间件顺序），从上往下执行")])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("返回值:")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[e._v("返回None，继续执行后续的中间件的 process_request 方法")])]),i("li",[i("div",[e._v("返回response对象（即: 三件套），不执行后续中间件的 process_request 方法，直接将 response对象 返回给浏览器")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("参数说明: ")])]),i("ul",[i("li",[i("div",[e._v("request: 和视图函数中 request 参数一样，可以获取到请求的相关信息")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("# my_middleware.py")])],1),i("div",[i("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[i("br")])]),i("div",[e._v("from django.shortcuts import HttpResponse, render, redirect")]),i("div",[e._v("from django.utils.deprecation import MiddlewareMixin")]),i("div",[i("br")]),i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("# 执行顺序: 先执行 MD1 再执行 MD2，如果MD1返回了response对象，那么MD2就不会执行")])],1),i("div",[i("br")]),i("div",[e._v("class MD1(MiddlewareMixin):")]),i("div",[i("br")]),i("div",[e._v("    def process_request(self, request):")]),i("div",[e._v("        print('MD1里面的 process_request')")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# return None  # 如果返回 None 继续往下执行")])],1),i("div",[e._v("        return HttpResponse('MD1')  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 如果返回 response对象，不执行后续的中间件直接将 response对象 返回给浏览器")])],1),i("div",[i("br")]),i("div",[i("br")]),i("div",[e._v("class MD2(MiddlewareMixin):")]),i("div",[i("br")]),i("div",[e._v("    def process_request(self, request):")]),i("div",[e._v("        print('MD2里面的 process_request')")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# return None")])],1),i("div",[e._v("        return HttpResponse('MD2')")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# settings.py")])],1),i("div",[i("br")]),i("div",[e._v("MIDDLEWARE = [")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("……")])],1),i("div",[e._v("    'my_middleware.MD1',")]),i("div",[e._v("    'my_middleware.MD2',")]),i("div",[e._v("]")])])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("2.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),i("font",{staticStyle:{"font-size":"14pt"}},[i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v("process_response(self, request, response)")])])],1),i("div",[i("font",{staticStyle:{"font-size":"14pt"}},[i("br")])],1),i("ul",[i("li",[i("div",[e._v("何时执行: 当得到response对象（即: 三件套）的时候")])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("执行顺序: 按照中间件的注册倒序（"),i("span",{staticStyle:{"font-size":"12pt"}},[e._v("在 settings.py 中的 ")]),e._v("MIDDLEWARE 配置项里面所注册的中间件顺序），从下往上执行")])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("返回值:")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[e._v("返回response对象（即: 三件套），必须返回，继续执行后续的中间件的 process_response 方法，返回response对象不会直接返回给浏览器，而是传递给下一个中间件，直到传递到最后一个中间件才返回给浏览器")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("参数说明: ")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[e._v("request: 和视图函数中 request 参数一样，可以获取到请求的相关信息")])]),i("li",[i("div",[e._v("response: 视图函数的返回值（即: response对象，三件套）")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("# my_middleware.py")])],1),i("div",[i("br")]),i("div",[e._v("from django.shortcuts import HttpResponse, render, redirect")]),i("div",[e._v("from django.utils.deprecation import MiddlewareMixin")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# 执行顺序: 先执行 MD2 再执行 MD1")])],1),i("div",[i("br")]),i("div",[e._v("class MD1(MiddlewareMixin):")]),i("div",[i("br")]),i("div",[e._v("    def process_response(self, request, response):")]),i("div",[e._v("        print('MD1里面的 process_response')")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# return response  # 可以返回得到的 response对象")])],1),i("div",[e._v("        return HttpResponse('MD1')  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 也可以返回三件套的 response对象")])],1),i("div",[i("br")]),i("div",[i("br")]),i("div",[e._v("class MD2(MiddlewareMixin):")]),i("div",[i("br")]),i("div",[e._v("    def process_response(self, request, response):")]),i("div",[e._v("        print('MD2里面的 process_response')")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# return response  # 可以返回得到的 response对象")])],1),i("div",[e._v("        return HttpResponse('MD2')  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 也可以返回三件套的 response对象")])],1)]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# settings.py")])],1),i("div",[i("br")]),i("div",[e._v("MIDDLEWARE = [")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("……")])],1),i("div",[e._v("    'my_middleware.MD1',")]),i("div",[e._v("    'my_middleware.MD2',")]),i("div",[e._v("]")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("3.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),i("font",{staticStyle:{"font-size":"14pt"}},[i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v("process_view(self, request, view_func, view_args, view_kwargs)")])])],1),i("div",[i("font",{staticStyle:{"font-size":"14pt"}},[i("br")])],1),i("ul",[i("li",[i("div",[e._v("何时执行: 在urls.py中找到对应关系之后，在执行真正的视图函数之前")])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("执行顺序: 按照中间件的注册顺序（"),i("span",{staticStyle:{"font-size":"12pt"}},[e._v("在 settings.py 中的 ")]),e._v("MIDDLEWARE 配置项里面所注册的中间件顺序），从上往下执行")])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("返回值:")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[e._v("返回None，继续执行后续的中间件的 process_view 方法")])]),i("li",[i("div",[e._v("返回response对象（即: 三件套），不执行后续中间件的 process_view 方法，直接将 response对象 返回给浏览器")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("参数说明: ")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[e._v("request: 和视图函数中 request 参数一样，可以获取到请求的相关信息")])]),i("li",[i("div",[e._v("view_func: Django即将执行的视图函数 ")])]),i("li",[i("div",[e._v("view_args: Django即将执行的视图函数所接收的位置参数，不包含第一个视图参数 response")])]),i("li",[i("div",[e._v("view_kwargs: Django即将执行的视图函数所接收的关键字参数，不包含第一个视图参数 response")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("# my_middleware.py")])]),i("div",[i("br")]),i("div",[e._v("from django.shortcuts import HttpResponse, render, redirect")]),i("div",[e._v("from django.utils.deprecation import MiddlewareMixin")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# 执行顺序: 先执行 MD1 再执行 MD2，如果MD1返回了response对象，那么MD2就不会执行")])],1),i("div",[i("br")]),i("div",[e._v("class MD1(MiddlewareMixin):")]),i("div",[i("br")]),i("div",[e._v("    def process_view(self, request, view_func, view_args, view_kwargs):")]),i("div",[e._v("        print('MD1里面的 process_view')")]),i("div",[e._v("        print(view_func, view_args, view_kwargs) "),i("font",{attrs:{color:"#41AD1C"}},[e._v(" # <function index at 0x0000022C75F49598> () {}")])],1),i("div",[i("br")]),i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("# return None  # 如果返回 None 继续往下执行")])],1),i("div",[e._v("        return HttpResponse('MD1')  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 如果返回 response对象，不执行后续的中间件直接将 response对象 返回给浏览器")])],1),i("div",[i("br")]),i("div",[i("br")]),i("div",[e._v("class MD2(MiddlewareMixin):")]),i("div",[i("br")]),i("div",[e._v("    def process_view(self, request, view_func, view_args, view_kwargs):")]),i("div",[e._v("        print('MD2里面的 process_view')")]),i("div",[e._v("        print(view_func, view_args, view_kwargs)")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# return None")])],1),i("div",[e._v("        return HttpResponse('MD2')")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("# settings.py")])]),i("div",[i("br")]),i("div",[e._v("MIDDLEWARE = [")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("……")])]),i("div",[e._v("    'my_middleware.MD1',")]),i("div",[e._v("    'my_middleware.MD2',")]),i("div",[e._v("]")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("4.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),i("span",{staticStyle:{"font-size":"14pt"}},[i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v("process_exception(self, request, exception)")])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("何时执行: 当视图函数中抛出异常的时候才执行")])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("执行顺序: 按照中间件的注册倒序（"),i("span",{staticStyle:{"font-size":"12pt"}},[e._v("在 settings.py 中的 ")]),e._v("MIDDLEWARE 配置项里面所注册的中间件顺序），从下往上执行")])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("返回值:")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[e._v("返回None，继续执行后续的中间件的 process_exception 方法")])]),i("li",[i("div",[e._v("返回response对象（即: 三件套），不执行后续中间件的 process_exception 方法，直接将 response对象 返回给浏览器")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("参数说明: ")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[e._v("request: 和视图函数中 request 参数一样，可以获取到请求的相关信息")])]),i("li",[i("div",[e._v("exception: 视图函数异常产生的Exception对象")])])])]),i("div",[i("font",{staticStyle:{"font-size":"14pt"}},[i("br")])],1),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("# my_middleware.py")])]),i("div",[i("br")]),i("div",[e._v("from django.shortcuts import HttpResponse, render, redirect")]),i("div",[e._v("from django.utils.deprecation import MiddlewareMixin")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# 执行顺序: 先执行 MD2 再执行 MD1，如果MD2返回了response对象，那么MD1就不会执行")])],1),i("div",[i("br")]),i("div",[e._v("class MD1(MiddlewareMixin):")]),i("div",[i("br")]),i("div",[e._v("    def process_exception(self, request, exception):")]),i("div",[e._v("        print('MD1里面的 process_exception')")]),i("div",[e._v("        print(exception)")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# return None")])],1),i("div",[e._v("        return HttpResponse('MD1 抛出了一个异常')")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[e._v("class MD2(MiddlewareMixin):")]),i("div",[i("br")]),i("div",[e._v("    def process_exception(self, request, exception):")]),i("div",[e._v("        print('MD2里面的 process_exception')")]),i("div",[e._v("        print(exception)  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 抛出了一个异常")])],1),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# return None  # 如果返回 None 继续往下执行")])],1),i("div",[e._v("        return HttpResponse('MD2 抛出了一个异常')  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 如果返回 response对象，不执行后续的中间件直接将 response对象 返回给浏览器")])],1)]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# views.py")])],1),i("div",[i("br")]),i("div",[e._v("from django.shortcuts import render, HttpResponse")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[e._v("def index(request):")]),i("div",[e._v("    raise ValueError('抛出了一个异常')")]),i("div",[e._v("    return HttpResponse('index.html')")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("# settings.py")])]),i("div",[i("br")]),i("div",[e._v("MIDDLEWARE = [")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("……")])]),i("div",[e._v("    'my_middleware.MD1',")]),i("div",[e._v("    'my_middleware.MD2',")]),i("div",[e._v("]")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("5.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),i("span",{staticStyle:{"font-size":"14pt"}},[i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v("process_template_response(self, request, response)")])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[e._v("何时执行: 视图函数执行完后，在执行视图函数返回 "),i("span",{staticStyle:{"font-size":"12pt"}},[e._v("response对象 ")]),e._v("之前（即: process_response方法之前）")])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("执行顺序: 按照中间件的注册倒序（"),i("span",{staticStyle:{"font-size":"12pt"}},[e._v("在 settings.py 中的 ")]),e._v("MIDDLEWARE 配置项里面所注册的中间件顺序），从下往上执行")])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("返回值:")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[e._v("返回response对象（即: 三件套），且该对象里面必须要有 render() 方法，必须返回，继续执行后续的中间件的 process_template_response 方法，返回response对象不会直接返回给浏览器，而是传递给下一个中间件，直到传递到最后一个中间件才返回给浏览器")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("参数说明: ")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[e._v("request: 和视图函数中 request 参数一样，可以获取到请求的相关信息")])]),i("li",[i("div",[e._v("response: 视图函数的返回值（即: response对象，三件套）")])])])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[e._v("注意事项")]),e._v(": process_template_response 接受的response对象和返回的response对象里面必须要有render方法")])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[i("font",{staticStyle:{"font-size":"9pt"}},[e._v("# my_middleware.py")])],1)]),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("br")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[e._v("from django.utils.deprecation import MiddlewareMixin")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("br")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"},attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"},attrs:{color:"#41AD1C"}},[e._v("# 执行顺序: 先执行 MD2 再执行 MD1")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("br")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[e._v("class MD1(MiddlewareMixin):")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("br")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[e._v("    def process_template_response(self, request, response):")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[e._v("        print('MD1里面的 process_template_response')")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[e._v("        return response")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("br")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("br")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[e._v("class MD2(MiddlewareMixin):")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("br")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[e._v("    def process_template_response(self, request, response):")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[e._v("        print('MD2里面的 process_template_response')")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[e._v("        return response")])],1)]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("# views.py")])]),i("div",[i("br")]),i("div",[e._v("from django.shortcuts import render, HttpResponse")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[e._v("def index(request):")]),i("div",[e._v("    ret = HttpResponse('index.html')")]),i("div",[i("br")]),i("div",[e._v("    def render():")]),i("div",[e._v("        return HttpResponse('render_fn')")]),i("div",[i("br")]),i("div",[e._v("    ret.render = render")]),i("div",[i("br")]),i("div",[e._v("    return ret")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("# settings.py")])]),i("div",[i("br")]),i("div",[e._v("MIDDLEWARE = [")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[e._v("……")])]),i("div",[e._v("    'my_middleware.MD1',")]),i("div",[e._v("    'my_middleware.MD2',")]),i("div",[e._v("]")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","font-weight":"bold","line-height":"1.5","background-color":"#3eaf7c","border-radius":"3px","text-align":"center",color:"white","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-ligatures":"normal","font-variant-caps":"normal","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[e._v("中间件中的request")]),i("div",[i("font",{staticStyle:{"font-size":"12pt"}},[i("br")])],1),i("ul",[i("li",[i("div",[i("font",{staticStyle:{"font-size":"12pt"}},[e._v("当我们在中间件中给 request 对象添加额外的属性参数的时候，视图函数可以通过 request 对象获取到该参数")])],1)])]),i("div",[i("span",{staticStyle:{"font-size":"18.6667px"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# my_middleware.py")])],1),i("div",[i("br")]),i("div",[e._v("from django.shortcuts import HttpResponse, render, redirect")]),i("div",[e._v("from django.utils.deprecation import MiddlewareMixin")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[e._v("class MD1(MiddlewareMixin):")]),i("div",[i("br")]),i("div",[e._v("    def process_request(self, request):")]),i("div",[e._v("        request.m_data = '在中间件中给request对象添加新的属性参数'")]),i("div",[e._v("        return None")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# settings.py")])],1),i("div",[i("br")]),i("div",[e._v("MIDDLEWARE = [")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v(" ……")])],1),i("div",[e._v("    'my_middleware.MD1',")]),i("div",[e._v("]")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# views.py")])],1),i("div",[i("font",{attrs:{color:"#41AD1C"}},[i("br")])],1),i("div",[e._v("def index(request):")]),i("div",[e._v("    m_data = "),i("font",{attrs:{color:"#FA7A00"}},[e._v("request.m_data")])],1),i("div",[e._v("    print(m_data)  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 在中间件中给request对象添加新的属性参数")])],1),i("div",[e._v("    return HttpResponse('index')")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[e._v("中间件的执行流程")])]),i("div",[i("br")]),i("div",[i("font",{staticStyle:{"font-size":"14pt"}},[i("span",{staticStyle:{"white-space":"pre-wrap","font-size":"14pt","font-weight":"bold"}},[e._v("1.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v(" process_request 和 process_response 方法")])])],1),i("div",[i("font",{staticStyle:{"font-size":"14pt"}},[i("br")])],1),i("ul",[i("li",[i("div",[e._v("实线的蓝色箭头表示，当返回了一个response对象（即: 三件套）的时候，不执行后续中间件的 process_request 方法")])])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"867021-20180409214209079-1725524152.png",src:"/kevin-blog/Django/中间件_files/867021-20180409214209079-1725524152.png",type:"image/png"}})]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("2.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v(" process_view 和 process_response 方法")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("虚线的蓝色箭头表示，当返回了一个response对象（即: 三件套）的时候，不执行后续中间件的 process_view 方法")])])]),i("div",[i("font",{staticStyle:{"font-size":"14pt"}},[i("br")])],1),i("div",[i("img",{attrs:{"data-filename":"867021-20180409214307195-1684061444.png",src:"/kevin-blog/Django/中间件_files/867021-20180409214307195-1684061444.png",type:"image/png"}})]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("3.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v("process_request 、 ")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v("process_view 、process_response 方法")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[e._v("虚线的蓝色箭头表示，当返回了一个response对象（即: 三件套）的时候，不执行后续中间件的 process_request 或 ")]),i("span",{staticStyle:{"font-size":"12pt"}},[e._v("process_view ")]),i("span",{staticStyle:{"font-size":"12pt"}},[e._v("方法")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("img",{attrs:{"data-filename":"867021-20180409214356226-286908304.png",src:"/kevin-blog/Django/中间件_files/867021-20180409214356226-286908304.png",type:"image/png"}})]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[e._v("4.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v(" 中间件")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[e._v("方法的执行顺序")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[e._v("虚线的箭头代表只有在特定情况下才能执行，且是不常用的")])]),i("li",[i("div",[e._v("SecurityMiddleware 等都是 "),i("span",{staticStyle:{"font-size":"12pt"}},[e._v("settings.py 中的 ")]),e._v("MIDDLEWARE 配置项里面中间件")])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("img",{attrs:{"data-filename":"867021-20180409214433968-2137571775.png",src:"/kevin-blog/Django/中间件_files/867021-20180409214433968-2137571775.png",type:"image/png"}})]),i("div",[i("br")]),i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[e._v("Django的请求流程图")])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"20180503174955252634.png",src:"/kevin-blog/Django/中间件_files/20180503174955252634.png",type:"image/png"}})]),i("div",[i("br")]),i("ul",[i("li",[i("div",[e._v("数字代表的是请求顺序，字母代表的是响应顺序")])])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"867021-20180409234112982-196913305.png",src:"/kevin-blog/Django/中间件_files/867021-20180409234112982-196913305.png",type:"image/png"}})]),i("div",[i("br")]),i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[e._v("中间件版登录验证 ")])]),i("div",[i("br")]),i("div",[i("a",{attrs:{href:"/kevin-blog/Django/中间件_files/middleware_login.rar"}},[i("img",{attrs:{alt:"middleware_login.rar",src:"/kevin-blog/Django/中间件_files/8f64673238143738093d3b362cb24bfe.png"}})])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# middlewares.py")])],1),i("div",[i("br")]),i("div",[e._v("from django.shortcuts import render, HttpResponse, redirect")]),i("div",[e._v("from django.utils.deprecation import MiddlewareMixin")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[e._v("class AuthMD(MiddlewareMixin):")]),i("div",[e._v("    white_list = ['/login/', '/home/', '/logout/']  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 白名单")])],1),i("div",[e._v("    black_list = ['/news/', ]  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 黑名单")])],1),i("div",[e._v("    no_login_list = ['/login/', '/logout/']  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 不跳转到登陆页面")])],1),i("div",[i("br")]),i("div",[e._v("    def process_request(self, request):")]),i("div",[e._v("        is_login = request.session.get('is_login', '0')  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 获取session")])],1),i("div",[i("br")]),i("div",[e._v("        url = request.path_info")]),i("div",[e._v("        next_url = request.get_full_path()")]),i("div",[i("br")]),i("div",[e._v("        if url in self.black_list:  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 判断是否在黑名单中")])],1),i("div",[e._v("            return HttpResponse('这是一个非法的网址')")]),i("div",[e._v("        elif url in self.white_list and is_login == '1':  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 判断是否在白名单中，且已经进行了登陆")])],1),i("div",[e._v("            return")]),i("div",[e._v("        elif url not in self.no_login_list:")]),i("div",[e._v("            return redirect('/login/?next={}'.format(next_url))")])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# views.py")])],1),i("div",[i("br")]),i("div",[e._v("from django.shortcuts import render, redirect")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# 登录")])],1),i("div",[e._v("def login(request):")]),i("div",[e._v("    if request.method == 'POST':")]),i("div",[e._v("        user = request.POST.get('user')")]),i("div",[e._v("        pwd = request.POST.get('pwd')")]),i("div",[e._v("        next_url = request.GET.get('next')")]),i("div",[i("br")]),i("div",[e._v("        if user == 'Kevin' and pwd == '123':")]),i("div",[e._v("            if next_url:")]),i("div",[e._v("                ret = redirect(next_url)")]),i("div",[e._v("            else:")]),i("div",[e._v("                ret = redirect('/home/')")]),i("div",[i("br")]),i("div",[e._v("            request.session['is_login'] = '1'  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 设置session")])],1),i("div",[e._v("            request.session.set_expiry(10)")]),i("div",[e._v("            return ret")]),i("div",[e._v("    return render(request, 'login.html')")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# 注销")])],1),i("div",[e._v("def logout(request):")]),i("div",[e._v("    request.session.flush()  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 清空当前请求的所有session，和与该session相关的cookie")])],1),i("div",[e._v("    return redirect('/login/')")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[e._v("def home(request):")]),i("div",[e._v("    return render(request, 'home.html')")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[e._v("def news(request):")]),i("div",[e._v("    return render(request, 'news.html')")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# urls.py")])],1),i("div",[i("br")]),i("div",[e._v("from django.conf.urls import url")]),i("div",[e._v("from django.contrib import admin")]),i("div",[e._v("from app01.views import *")]),i("div",[i("br")]),i("div",[e._v("urlpatterns = [")]),i("div",[e._v("    url(r'^login/', login),")]),i("div",[e._v("    url(r'^home/', home),")]),i("div",[e._v("    url(r'^news/', news),")]),i("div",[e._v("    url(r'^logout/', logout),")]),i("div",[e._v("]")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("# settings.py")])],1),i("div",[i("br")]),i("div",[e._v("MIDDLEWARE = [")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[e._v("……")])],1),i("div",[e._v("    'middlewares.AuthMD'  "),i("font",{attrs:{color:"#41AD1C"}},[e._v("# 注册（添加）自定义中间件 AuthMD")])],1),i("div",[e._v("]")])]),i("div",[i("br")])])])])}),[],!1,null,null,null);t.default=o.exports}}]);