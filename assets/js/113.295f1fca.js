(window.webpackJsonp=window.webpackJsonp||[]).push([[113],{466:function(o,t,r){"use strict";r.r(t);var a=r(25),s=Object(a.a)({},(function(){var o=this,t=o.$createElement,r=o._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":o.$parent.slotKey}},[r("div",[r("span",[r("div",[r("div",[r("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("1.")]),r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),r("span",{staticStyle:{"font-size":"14pt"}},[r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("flask-sqlalchemy")])]),r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v(" 的介绍")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[r("br")])]),r("ul",[r("li",[r("div",[r("span",{staticStyle:{"font-size":"12pt"}},[o._v("flask-sqlalchemy 简化了 sqlalchemy 在 Flask 中的操作")])])])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[r("br")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("2.")]),r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("flask-sqlalchemy")]),r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v(" 的安装")])]),r("div",[r("br")]),r("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[r("div",[o._v("pip3 install flask-sqlalchemy -i https://pypi.douban.com/simple  "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# 使用豆瓣的镜像")])],1)]),r("div",[r("br")]),r("div",[r("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[o._v("3.")]),r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v("flask-sqlalchemy")]),r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[o._v(" 的使用")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[r("br")])]),r("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v("# app.py")])],1),r("div",[r("br")]),r("div",[o._v("from flask import Flask")]),r("div",[r("font",{attrs:{color:"#FA7A00"}},[o._v("from flask_sqlalchemy import SQLAlchemy")])],1),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v("# 实例化 SQLAlchemy -> 一定要设置为全局变量，且在视图文件和models文件上面")])],1),r("div",[r("font",{attrs:{color:"#FA7A00"}},[o._v("db = SQLAlchemy()")]),o._v(" "),r("font",{attrs:{color:"#41AD1C"}},[o._v(" # 创建 SQLAlchemy 所用到的所有东西的一个对象，唯独少了数据库连接")])],1),r("div",[r("font",{attrs:{color:"#FA7A00"}},[r("br")])],1),r("div",[r("font",{attrs:{color:"#FA7A00"}},[o._v("from models import *")]),o._v(" "),r("font",{attrs:{color:"#E30000"}},[o._v("# 如果不导入 flask_sqlalchemy 就不会创建表，因为 models.py 没有被执行")])],1),r("div",[r("br")]),r("div",[o._v("app = Flask(__name__)")]),r("div",[o._v("app.config.from_object('settings.ProConfig') "),r("font",{attrs:{color:"#41AD1C"}},[o._v(" # 设置配置文件")])],1),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v("# 从app配置文件中获取相关的 SQLAlchemy 配置")])],1),r("div",[r("font",{attrs:{color:"#FA7A00"}},[o._v("db.init_app(app)")]),o._v(" "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# 通过读取app的配置文件获取到数据库的连接")])],1),r("div",[r("br")]),r("div",[r("br")]),r("div",[o._v("@app.route('/home')")]),r("div",[o._v("def home():")]),r("div",[r("font",{attrs:{color:"#FA7A00"}},[o._v("# 添加数据")])],1),r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v(" #")]),o._v(" db.session.add(Users(name='Kevin', age=18, address='横沥'))")],1),r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v(" #")]),o._v(" db.session.commit()")],1),r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v("#")]),o._v(" db.session.remove()")],1),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}}),r("font",{attrs:{color:"#FA7A00"}},[o._v("# 查询数据")])],1),r("div",[o._v("    result = db.session.query(Users.name, Users.age).all()")]),r("div",[o._v("    print(result)")]),r("div",[o._v("    db.session.remove()")]),r("div",[r("br")]),r("div",[o._v("    return '首页'")]),r("div",[r("br")]),r("div",[r("br")]),r("div",[o._v("if __name__ == '__main__':")]),r("div",[o._v("    app.run()")])]),r("div",[r("br")]),r("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v("# flask-sqlalchemy 的所有配置项和默认值")])],1),r("div",[r("br")]),r("div",[o._v("app.config.setdefault('"),r("font",{attrs:{color:"#FA7A00"}},[o._v("SQLALCHEMY_DATABASE_URI")]),o._v("', '"),r("font",{attrs:{color:"#FA7A00"}},[o._v("sqlite:///:memory:")]),o._v("')  "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接那个数据库")])],1),r("div",[o._v("app.config.setdefault('"),r("font",{attrs:{color:"#FA7A00"}},[o._v("SQLALCHEMY_BINDS")]),o._v("', "),r("font",{attrs:{color:"#FA7A00"}},[o._v("None")]),o._v(")")],1),r("div",[o._v("app.config.setdefault('"),r("font",{attrs:{color:"#FA7A00"}},[o._v("SQLALCHEMY_NATIVE_UNICODE")]),o._v("', "),r("font",{attrs:{color:"#FA7A00"}},[o._v("None")]),o._v(")")],1),r("div",[o._v("app.config.setdefault('"),r("font",{attrs:{color:"#FA7A00"}},[o._v("SQLALCHEMY_ECHO")]),o._v("', "),r("font",{attrs:{color:"#FA7A00"}},[o._v("False")]),o._v(")")],1),r("div",[o._v("app.config.setdefault('"),r("font",{attrs:{color:"#FA7A00"}},[o._v("SQLALCHEMY_RECORD_QUERIES")]),o._v("', "),r("font",{attrs:{color:"#FA7A00"}},[o._v("None")]),o._v(")")],1),r("div",[o._v("app.config.setdefault('"),r("font",{attrs:{color:"#FA7A00"}},[o._v("SQLALCHEMY_POOL_SIZE")]),o._v("', "),r("font",{attrs:{color:"#FA7A00"}},[o._v("None")]),o._v(")  "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中的连接数")])],1),r("div",[o._v("app.config.setdefault('"),r("font",{attrs:{color:"#FA7A00"}},[o._v("SQLALCHEMY_POOL_TIMEOUT")]),o._v("', "),r("font",{attrs:{color:"#FA7A00"}},[o._v("None")]),o._v(")  "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# 连接池中没有线程后最多等待的时间（单位：秒），如果超过指定时间还没有连接就报错")])],1),r("div",[o._v("app.config.setdefault('"),r("font",{attrs:{color:"#FA7A00"}},[o._v("SQLALCHEMY_POOL_RECYCLE")]),o._v("', "),r("font",{attrs:{color:"#FA7A00"}},[o._v("None")]),o._v(") "),r("font",{attrs:{color:"#41AD1C"}},[o._v(" # 多久之后对线程池中的线程进行一次连接的回收（重置）（单位：秒）-> -1表示不重置")])],1),r("div",[o._v("app.config.setdefault('"),r("font",{attrs:{color:"#FA7A00"}},[o._v("SQLALCHEMY_MAX_OVERFLOW")]),o._v("', "),r("font",{attrs:{color:"#FA7A00"}},[o._v("None")]),o._v(")  "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# 允许溢出多少个连接（即：连接池的连接已满后，还可以创建多少条连接）")])],1),r("div",[o._v("app.config.setdefault('"),r("font",{attrs:{color:"#FA7A00"}},[o._v("SQLALCHEMY_COMMIT_ON_TEARDOWN")]),o._v("', "),r("font",{attrs:{color:"#FA7A00"}},[o._v("False")]),o._v(")")],1)]),r("div",[r("br")]),r("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[r("div",[r("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[r("font",{attrs:{color:"#41AD1C"}},[o._v("# settings.py")])],1)]),r("div",[r("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[r("br")])]),r("div",[o._v("class BaseConfig(object):")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v(" # SQLAlchemy 配置")])],1),r("div",[o._v("    SQLALCHEMY_DATABASE_URI = 'mysql+pymysql://root:@127.0.0.1:3306/db1?charset=utf8'")]),r("div",[o._v("    SQLALCHEMY_MAX_OVERFLOW = 10  "),r("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 允许溢出多少个连接（即：连接池的连接已满后，还可以创建多少条连接）")])],1),r("div",[o._v("    SQLALCHEMY_POOL_SIZE = 5  "),r("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 连接池中的连接数")])],1),r("div",[o._v("    SQLALCHEMY_POOL_TIMEOUT = 10  "),r("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 连接池中没有线程后最多等待的时间（单位：秒），如果超过指定时间还没有连接就报错")])],1),r("div",[o._v("    SQLALCHEMY_POOL_RECYCLE = -1  "),r("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[o._v("# 多久之后对线程池中的线程进行一次连接的回收（重置）（单位：秒）-> -1表示不重置")])],1),r("div",[r("br")]),r("div",[r("br")]),r("div",[o._v("class ProConfig(BaseConfig):")]),r("div",[o._v("    pass")])]),r("div",[r("br")]),r("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v("# models.py")])],1),r("div",[r("br")]),r("div",[o._v("from sqlalchemy import Column, Integer, VARCHAR")]),r("div",[r("font",{attrs:{color:"#FA7A00"}},[o._v("from app import db")])],1),r("div",[r("br")]),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v("# Users 表的类")])],1),r("div",[o._v("class Users("),r("font",{attrs:{color:"#FA7A00"}},[o._v("db.Model")]),o._v("):  "),r("font",{attrs:{color:"#E30000"}},[o._v("# 创建表的类一定要继承 db.Model")])],1),r("div",[o._v("    __tablename__ = 'users'  "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# 表名")])],1),r("div",[o._v("    id = Column(Integer, primary_key=True, autoincrement=True)  "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# 整型 设置主键 设置自增列")])],1),r("div",[o._v("    name = Column(VARCHAR(32), nullable=False, index=True)  "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# varchar类型(长度：32) 不允许为空 将name字段设置为索引")])],1),r("div",[o._v("    age = Column(Integer)  "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# 整形")])],1),r("div",[o._v("    address = Column(VARCHAR(32))  "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# varchar类型(长度：32)")])],1)]),r("div",[r("br")]),r("ul",[r("li",[r("div",[o._v("通过离线文件创建或删除表（即: 需要单独运行该py文件）")])])]),r("div",[r("br")]),r("ul",[r("ul",[r("li",[r("div",[o._v("flask-sqlalchemy 不支持修改表，需要使用第三方模块（即: flask-migrate）")])])])]),r("div",[r("br")]),r("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v("# create_table.py")])],1),r("div",[r("br")]),r("div",[o._v("from app import db, app")]),r("div",[r("br")]),r("div",[o._v("app_ctx = app.app_context()  "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# app_ctx = app/g")])],1),r("div",[r("br")]),r("div",[o._v("with app_ctx:  "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# 当 with 对象的时候，就会执行该对象所在的类中的 __enter__ 和 __exit__ 方法")])],1),r("div",[r("font",{attrs:{color:"#41AD1C"}},[r("br")])],1),r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v("# app_ctx 所在的类中的 __enter__ 方法的作用: 通过 LocalStack 放入 Local 中")])],1),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v("# 创建表")])],1),r("div",[o._v("    db.create_all()  "),r("font",{attrs:{color:"#41AD1C"}},[o._v("# 相当于执行原 SQLAlchemy 的 create_all")])],1),r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v("# 会先去指定上下文中找到app，然后找到app的配置文件中的 flask-sqlalchemy 相关配置，最终生成数据库表")])],1),r("div",[r("font",{attrs:{color:"#41AD1C"}},[r("br")])],1),r("div",[r("font",{attrs:{color:"#41AD1C"}}),r("font",{attrs:{color:"#41AD1C"}},[o._v("# 删除表")])],1),r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v("# ")]),o._v("db.drop_all()")],1),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[o._v("# app_ctx 所在的类中的 __enter__ 方法的作用: 移除移除Local中你所放入的 app_ctx 对象")])],1)]),r("div",[r("br")])]),r("div",[r("br")])])])])}),[],!1,null,null,null);t.default=s.exports}}]);