(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{411:function(t,e,i){"use strict";i.r(e);var o=i(25),s=Object(o.a)({},(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[i("div",[i("span",[i("div",[i("div",[i("div",[i("div",[i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("Session的介绍")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" Session的由来")])])]),i("div",[i("br")]),i("div",[t._v("Cookie虽然在一定程度上解决了“保持状态”的需求，但是由于Cookie本身最大支持4096字节，以及Cookie本身保存在客户端，可能被拦截或窃取，因此就需要有一种新的东西，它能支持更多的字节，并且他保存在服务器，有较高的安全性。这就是Session。")]),i("div",[i("br")]),i("div",[t._v("问题来了，基于HTTP协议的无状态特征，服务器根本就不知道访问者是“谁”。那么上述的Cookie就起到桥接的作用。")]),i("div",[i("br")]),i("div",[t._v("我们可以给每个客户端的Cookie分配一个唯一的id，这样用户在访问时，通过Cookie，服务器就知道来的人是“谁”。然后我们再根据不同的Cookie的id，在服务器上保存一段时间的私密资料，如“账号密码”等等。")]),i("div",[i("br")]),i("div",[t._v("总结而言：Cookie弥补了HTTP无状态的不足，让服务器知道来的人是“谁”；但是Cookie以文本的形式保存在本地，自身安全性较差；所以我们就通过Cookie识别不同的用户，对应的在Session里保存私密的信息以及超过4096字节的文本。")]),i("div",[i("br")]),i("div",[t._v("另外，上述所说的Cookie和Session其实是共通性的东西，不限于语言和框架。")]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v("2.")]),i("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-weight":"bold"}},[t._v(" 注意")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("session 是依赖于cookie 的")])])]),i("li",[i("div",[t._v("在 Django 中 session 所设置的超时时间，其实是设置了 cookie 中 sessionid 的超时时间")])]),i("li",[i("div",[i("span",{staticStyle:{"font-size":"medium","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal"}},[t._v("在 Django 中 必须连接数据库才能使用session，因为session 的值是保存在数据库中的，除非在 settings.py 中重新设置")])])]),i("li",[i("div",[t._v("在设置 session 的时候 Django 会将数据先序列化后，再写入 session 中")])]),i("li",[i("div",[t._v("在获取 session 的时候 Django 会将获取到的 session 数据进行反序列化")])])]),i("div",[i("br")]),i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("Session的流程解析")])]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Session.png",src:"/kevin-blog/Django/Session_files/Session.png",type:"image/png"}})]),i("div",[i("br")]),i("div",[i("img",{attrs:{"data-filename":"Session_Cookie.png",src:"/kevin-blog/Django/Session_files/Session_Cookie.png",type:"image/png"}})]),i("div",[i("br")]),i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("Django中Session的相关操作")])])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("1.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 设置Session")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[t._v("request.session['key'] = value")])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("def home(request):")]),i("div",[t._v("    request.session['s_k'] = 123")]),i("div",[t._v("    return render(request, 'home.html')")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("session.setdefault(")]),t._v("'key', value"),i("span",{staticStyle:{"font-size":"12pt"}},[t._v(") -> 如果没有该Session就设置该Session，如果有就不进行设置")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{"font-size":"9pt"}},[t._v("def home(request):")])]),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[t._v("    request.session.setdefault('s_k', 312)")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[t._v("    return render(request, 'home.html')")])],1)]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("2.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 设置Session的过期时间")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"12pt",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","line-height":"1.5"}},[t._v("request.session.set_expiry(value)")])])])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("如果value是个整数，session会在些秒数后失效。")])])]),i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("如果value是个datatime或timedelta，session就会在这个时间后失效。")])])]),i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("如果value是0，用户关闭浏览器session就会失效。")])])]),i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("如果value是None，session会依赖全局session失效策略。")])])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# request.session.set_expiry(value)")])],1),i("div",[i("br")]),i("div",[t._v("def home(request):")]),i("div",[t._v("    request.session['s_k'] = '123'")]),i("div",[t._v("    request.session.set_expiry(24 * 60 * 60)")]),i("div",[i("br")]),i("div",[t._v("    return render(request, 'home.html')")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 获取Session中的数据")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("获取指定的Session")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("def home(request):")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 写法一")])],1),i("div",[t._v("    s_value1 = request.session['s_k']")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("   # 写法二")])],1),i("div",[t._v("    s_value2 = request.session.get('s_k', None)")]),i("div",[t._v("    print(s_value1, s_value2)")]),i("div"),i("div",[t._v("    return render(request, 'home.html')")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("获取 Session 中的 键、值、键值对")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[t._v("def home(request):")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("font",{attrs:{color:"#41AD1C"}}),i("font",{attrs:{color:"#E30000"}},[t._v("# Python3 中所使用，因为在Python3中取消了以iter开头了")])],1)],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("font",{attrs:{color:"#E30000"}}),t._v(" "),i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 获取 session 的所有的 key 值")])],1)],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[t._v("    print(request.session.keys())  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# dict_keys(['s_k5', 's_k2', 's_k4', 's_k'])")])],1)],1),i("div",[i("font",{staticStyle:{color:"rgb(65, 173, 28)","font-size":"9pt"}},[t._v("    # 获取 session 的所有的 value 值")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[t._v("    print(request.session.values())  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# dict_values([312, 312, 312, 123])")])],1)],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("font",{attrs:{color:"#41AD1C"}}),i("font",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 获取 session 的所有的 key, value 值")])],1)],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[t._v("    print(request.session.items()) "),i("font",{attrs:{color:"#41AD1C"}},[t._v(" # dict_items([('s_k5', 312), ('s_k2', 312), ('s_k4', 312), ('s_k', 123)])")])],1)],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("br")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("font",{attrs:{color:"#E30000"}},[t._v(" # Python2 中所使用")])],1)],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("font",{attrs:{color:"#E30000"}}),t._v(" "),i("font",{attrs:{color:"#41AD1C"}},[t._v(" # 获取 session 的所有的 key 值")])],1)],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[t._v("    print(request.session.iterkeys()) "),i("font",{attrs:{color:"#41AD1C"}},[t._v(" # dict_keys(['s_k5', 's_k2', 's_k4', 's_k'])")])],1)],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[i("font",{attrs:{color:"#41AD1C"}}),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取 session 的所有的 value 值")])],1)],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[t._v("    print(request.session.itervalues())  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# dict_values([312, 312, 312, 123])")])],1)],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"},attrs:{color:"#41AD1C"}},[t._v("    # 获取 session 的所有的 key, value 值")])],1),i("div",[i("font",{staticStyle:{"font-size":"9pt"}},[t._v("    print(request.session.iteritems())  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# dict_items([('s_k5', 312), ('s_k2', 312), ('s_k4', 312), ('s_k', 123)])")])],1)],1)]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("获当前Session的key")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("ul",[i("li",[i("div",[t._v("request.session.session_key")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("def home(request):")]),i("div",[t._v("    print(request.session.session_key)  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# m90f3iefejtce5b1haqtlc3ctwjronrh")])],1),i("div",[i("br")]),i("div",[t._v("    return render(request, 'home.html')")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("4.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 删除Session")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[t._v("删除指定的 Session")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[t._v("del request.session['key']")])])])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("def home(request):")]),i("div",[t._v("    del request.session['s_k2']")]),i("div",[i("br")]),i("div",[t._v("    return render(request, 'home.html')")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("删除当前请求的所有 Session")])])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[t._v("request.session.delete()")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("def home(request):")]),i("div",[t._v("    request.session.delete()")]),i("div",[i("br")]),i("div",[t._v("    return render(request, 'home.html')")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[t._v("删除当前请求的所有 Session，并且删除当前请求Session所关联的Cookie")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[i("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"12pt",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","line-height":"1.5"}},[t._v("用于确保所删除的Session数据不可以再次被用户的浏览器访问到")])])])])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[t._v("request.session.flush()")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("def home(request):")]),i("div",[t._v("    request.session.flush()")]),i("div",[i("br")]),i("div",[t._v("    return render(request, 'home.html')")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"12pt",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","line-height":"1.5"}},[t._v("将失效日期或小于当前日期的Session删除")])])])])]),i("div",[i("br")])]),i("ul",[i("ul",[i("li",[i("div",[t._v("request.session.clear_expired()")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("def home(request):")]),i("div",[t._v("    request.session.clear_expired()")]),i("div",[i("br")]),i("div",[t._v("    return render(request, 'home.html')")])]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("5.")]),i("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 检测当前Session是否存在该key")])]),i("div",[i("span",{staticStyle:{"font-size":"14pt"}},[i("br")])]),i("ul",[i("li",[i("div",[t._v('request.session.exists("session_key")')])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[t._v("def home(request):")]),i("div",[t._v('    print(request.session.exists("m90f3iefejtce5b1haqtlc3ctwjronrh"))')]),i("div",[i("br")]),i("div",[t._v("    return render(request, 'home.html')")])]),i("div",[i("br")]),i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("Django中")]),i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("Session的相关配置")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[t._v("Session的相关配置都是在 setting.py 中设置")])])]),i("div",[i("br")]),i("ul",[i("ul",[i("li",[i("div",[t._v("红色的是常用的")])]),i("li",[i("div",[t._v("SESSION_SAVE_EVERY_REQUEST=True 最好在setting.py设置上")])])])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("1. 数据库Session")])]),i("div",[t._v("SESSION_ENGINE = 'django.contrib.sessions.backends.db'     "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 引擎（默认）")])]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("2. 缓存Session")])]),i("div",[t._v("SESSION_ENGINE = 'django.contrib.sessions.backends.cache'  "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 引擎")])]),i("div",[t._v("SESSION_CACHE_ALIAS = 'default'                            "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 使用的缓存别名（默认内存缓存，也可以是memcache），此处别名依赖缓存的设置")])]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("3. 文件Session")])]),i("div",[t._v("SESSION_ENGINE = 'django.contrib.sessions.backends.file'    "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 引擎")])]),i("div",[t._v("SESSION_FILE_PATH = None                                    "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 缓存文件路径，如果为None，则使用tempfile模块获取一个临时地址tempfile.gettempdir()")])]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("4. 缓存+数据库")])]),i("div",[t._v("SESSION_ENGINE = 'django.contrib.sessions.backends.cached_db'        "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 引擎")])]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("5. 加密Cookie Session")])]),i("div",[t._v("SESSION_ENGINE = 'django.contrib.sessions.backends.signed_cookies'   "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 引擎")])]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("其他公用设置项：")])]),i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v('SESSION_COOKIE_NAME ＝ "sessionid"  ')]),t._v(" "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串（默认值: sessionid）")])]),i("div",[t._v('SESSION_COOKIE_PATH ＝ "/"                               '),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# Session的cookie保存的路径（默认值: '/'）")])]),i("div",[t._v("SESSION_COOKIE_DOMAIN = None                            "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v(" # Session的cookie保存的域名（默认值: None）")])]),i("div",[t._v("SESSION_COOKIE_SECURE = False                            "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 是否Https传输cookie（默认值: False）")])]),i("div",[t._v("SESSION_COOKIE_HTTPONLY = True                           "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 是否Session的cookie只支持http传输（默认值: True）")])]),i("div",[t._v("SESSION_COOKIE_AGE = 1209600                             "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# Session的cookie失效日期（2周）（默认值: 1209600）")])]),i("div",[t._v("SESSION_EXPIRE_AT_BROWSER_CLOSE = False                  "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 是否关闭浏览器使得Session过期（默认值: False）")])]),i("div",[i("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("SESSION_SAVE_EVERY_REQUEST = False ")]),t._v(" "),i("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 是否每次请求都保存Session，默认修改之后才保存（默认值: False）-> 通俗理解: 页面进行交互后就更新session的过期时间，永远拿最后一次请求时间重新计算过期时间")])])]),i("div",[i("br")]),i("h2",{staticStyle:{margin:"10px 0px 12px",padding:"0px 0px 0px 15px","font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-align":"center","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[i("span",{staticStyle:{"font-size":"21px","background-color":"#3eaf7c","border-radius":"3px","text-shadow":"rgb(34, 34, 34) 1px 1px 2px","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px",color:"white","font-family":'"Helvetica Neue", Helvetica, Verdana, Arial, sans-serif',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("Session的登陆验证")])]),i("div",[i("br")]),i("ul",[i("li",[i("div",[i("span",{staticStyle:{"font-size":"12pt"}},[t._v("使用装饰器进行登陆验证")])])])]),i("div",[i("br")]),i("div",[i("a",{attrs:{href:"/kevin-blog/Django/Session_files/session_login.rar"}},[i("img",{attrs:{alt:"session_login.rar",src:"/kevin-blog/Django/Session_files/b6f81816d2ab669c561d80dd98e0b839.png"}})])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# urls.py")])],1),i("div",[i("br")]),i("div",[t._v("from django.conf.urls import url")]),i("div",[t._v("from django.contrib import admin")]),i("div",[t._v("from app01.views import *")]),i("div",[i("br")]),i("div",[t._v("urlpatterns = [")]),i("div",[t._v("    url(r'^admin/', admin.site.urls),")]),i("div",[t._v("    url(r'^login/', login),")]),i("div",[t._v("    url(r'^home/', home),")]),i("div",[t._v("    url(r'^news/', news),")]),i("div",[t._v("    url(r'^logout/', logout),")]),i("div",[t._v("]")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# views.py")])],1),i("div",[i("br")]),i("div",[t._v("from django.shortcuts import render, redirect")]),i("div",[t._v("from functools import wraps")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 装饰器，通过session验证是否已经登录")])],1),i("div",[t._v("def check_login(func):")]),i("div",[t._v("    @wraps(func)")]),i("div",[t._v("    def inner(request, *args, **kwargs):")]),i("div",[t._v("        is_login = request.session.get('is_login', '0')  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取session")])],1),i("div",[i("br")]),i("div",[t._v("        if is_login == '1':")]),i("div",[t._v("            return func(request, *args, **kwargs)")]),i("div",[t._v("        else:")]),i("div",[t._v("            next_url = request.get_full_path()  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取当前路径并且带参数")])],1),i("div",[t._v("            return redirect('/login/?next={}'.format(next_url))")]),i("div",[i("br")]),i("div",[t._v("    return inner")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 登陆")])],1),i("div",[t._v("def login(request):")]),i("div",[t._v("    if request.method == 'POST':")]),i("div",[t._v("        user = request.POST.get('user')")]),i("div",[t._v("        pwd = request.POST.get('pwd')")]),i("div",[t._v("        next_url = request.GET.get('next')")]),i("div",[i("br")]),i("div",[t._v("        if user == 'Kevin' and pwd == '123':")]),i("div",[t._v("            if next_url:")]),i("div",[t._v("                ret = redirect(next_url)")]),i("div",[t._v("            else:")]),i("div",[t._v("                ret = redirect('/home/')")]),i("div",[i("br")]),i("div",[t._v("            request.session['is_login'] = '1'  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 设置session")])],1),i("div",[t._v("            request.session.set_expiry(10)")]),i("div",[t._v("            return ret")]),i("div",[t._v("    return render(request, 'login.html')")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# 注销")])],1),i("div",[t._v("def logout(request):")]),i("div",[t._v("    request.session.flush()  "),i("font",{attrs:{color:"#41AD1C"}},[t._v("# 清空当前请求的所有session，和与该session相关的cookie")])],1),i("div",[t._v("    return redirect('/login/')")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("@check_login")]),i("div",[t._v("def home(request):")]),i("div",[t._v("    return render(request, 'home.html')")]),i("div",[i("br")]),i("div",[i("br")]),i("div",[t._v("@check_login")]),i("div",[t._v("def news(request):")]),i("div",[t._v("    return render(request, 'news.html')")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# login.html")])],1),i("div",[i("br")]),i("div",[t._v("<!DOCTYPE html>")]),i("div",[t._v("<html>")]),i("div",[t._v("<head>")]),i("div",[t._v('    <meta charset="utf-8">')]),i("div",[t._v('    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">')]),i("div",[t._v("    <title>Title</title>")]),i("div",[t._v('    <meta name="description" content="">')]),i("div",[t._v('    <meta name="keywords" content="">')]),i("div",[t._v('    <link rel="stylesheet" href="">')]),i("div",[t._v("    <script type=\"text/javascript\" src=''><\/script>")]),i("div",[t._v("</head>")]),i("div",[t._v("<body>")]),i("div",[t._v('<form action="'+t._s("{{ request.get_full_path }}")+'" method="post">')]),i("div",[t._v("    {% csrf_token %}")]),i("div",[t._v('    <input type="text" name="user" id="" placeholder="用户名">')]),i("div",[t._v('    <input type="text" name="pwd" id="" placeholder="密码">')]),i("div",[t._v('    <input type="submit" value="提交">')]),i("div",[t._v("</form>")]),i("div",[t._v('<script type="text/javascript"><\/script>')]),i("div",[t._v("</body>")]),i("div",[t._v("</html>")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# home.html")])],1),i("div",[i("br")]),i("div",[t._v("<!DOCTYPE html>")]),i("div",[t._v("<html>")]),i("div",[t._v("<head>")]),i("div",[t._v('    <meta charset="utf-8">')]),i("div",[t._v('    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">')]),i("div",[t._v("    <title>Title</title>")]),i("div",[t._v('    <meta name="description" content="">')]),i("div",[t._v('    <meta name="keywords" content="">')]),i("div",[t._v('    <link rel="stylesheet" href="">')]),i("div",[t._v("    <script type=\"text/javascript\" src=''><\/script>")]),i("div",[t._v("</head>")]),i("div",[t._v("<body>")]),i("div",[t._v("Home.html")]),i("div",[t._v('<a href="/logout/">注销</a>')]),i("div",[t._v('<script type="text/javascript"><\/script>')]),i("div",[t._v("</body>")]),i("div",[t._v("</html>")])]),i("div",[i("br")]),i("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[i("div",[i("font",{attrs:{color:"#41AD1C"}},[t._v("# news.html")])],1),i("div",[i("br")]),i("div",[t._v("<!DOCTYPE html>")]),i("div",[t._v("<html>")]),i("div",[t._v("<head>")]),i("div",[t._v('    <meta charset="utf-8">')]),i("div",[t._v('    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">')]),i("div",[t._v("    <title>Title</title>")]),i("div",[t._v('    <meta name="description" content="">')]),i("div",[t._v('    <meta name="keywords" content="">')]),i("div",[t._v('    <link rel="stylesheet" href="">')]),i("div",[t._v("    <script type=\"text/javascript\" src=''><\/script>")]),i("div",[t._v("</head>")]),i("div",[t._v("<body>")]),i("div",[t._v("news.html")]),i("div",[t._v('<script type="text/javascript"><\/script>')]),i("div",[t._v("</body>")]),i("div",[t._v("</html>")])]),i("div",[i("br")])]),i("div",[i("br")]),i("div",[i("br")])])])])}),[],!1,null,null,null);e.default=s.exports}}]);