(window.webpackJsonp=window.webpackJsonp||[]).push([[296],{648:function(t,i,o){"use strict";o.r(i);var r=o(25),e=Object(r.a)({},(function(){var t=this,i=t.$createElement,o=t._self._c||i;return o("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[o("div",[o("span",[o("div",[o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[t._v("在以后互斥锁就简称是锁，除非遇到递归锁才叫回互斥锁")])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px"}},[o("font",{staticStyle:{"font-size":"14pt"}},[o("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("锁:")])])],1),t._v(" "),o("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("保证多个进程修改同一块数据时，同一时间只能有一个任务可以进行修改，")]),o("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("即串行的修改，使用锁后速度会变慢，")]),o("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("但牺牲了速度却保证了数据安全。")])]),o("div",[o("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("锁其实就是将异步执行变成了同步执行")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[o("font",{staticStyle:{"font-size":"9pt"},attrs:{color:"#000000"}},[t._v("from multiprocessing import Lock")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"},attrs:{color:"#000000"}},[o("br")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"},attrs:{color:"#000000"}},[t._v("lock = Lock()   # 获取锁")])],1),o("div",[o("font",{staticStyle:{"font-size":"9pt"},attrs:{color:"#000000"}},[t._v("lock.acquire()  # 上锁")])],1),o("div",[o("span",{staticStyle:{"font-size":"9pt",color:"rgb(51, 51, 51)","font-family":"Monaco"}},[t._v("print(123)")])]),o("div",[o("font",{staticStyle:{"font-size":"9pt"},attrs:{color:"#000000"}},[t._v("lock.release()  # 解锁")])],1)]),o("div",[o("span",{staticStyle:{"font-size":"14pt"}},[o("br")])]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-family":'"Courier New"',"font-weight":"bold","line-height":"1.75"}},[t._v("1.")]),t._v(" "),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("没有使用锁的抢票")]),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("例子")])]),o("div",[o("span",{staticStyle:{"font-size":"18.6667px"}},[o("br")])]),o("ul",[o("li",[o("div",[t._v("如果没有上锁，多个进程修改一个数据的时候，产生数据混乱，")])]),o("li",[o("div",[t._v("所有人都可以买到票，且剩下的票数也会有问题，因为所有进程几乎在同时读取文件，且读取到的票数都是大于0的，所以所有进程都可以抢到票，且每个进程将读取到的票数减1后再重新写入文件中，后写入的票数就会覆盖前面所写入的票数，这样就会造成数据的混乱或不安全")])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[t._v("# 没有上锁的抢票例子")]),o("div",[o("br")]),o("div",[t._v("import json")]),o("div",[t._v("import time")]),o("div",[t._v("import random")]),o("div",[t._v("from multiprocessing import Lock")]),o("div",[t._v("from multiprocessing import Process")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看还有多少票")])],1),o("div",[t._v("def search(i):")]),o("div",[t._v("    with open('ticket', encoding='utf-8') as f:")]),o("div",[t._v("        ticket_num = json.load(f)['count']")]),o("div",[t._v("        print(i, ticket_num)")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 抢票")])],1),o("div",[t._v("def get(i):")]),o("div",[t._v("    with open('ticket', encoding='utf-8') as f:")]),o("div",[t._v("        ticket_num = json.load(f)['count']  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取现有的票数")])],1),o("div",[t._v("    time.sleep(random.random()) "),o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 模拟网路延时")])],1),o("div",[t._v("    if ticket_num > 0:")]),o("div",[t._v("        with open('ticket', 'w', encoding='utf-8') as f:")]),o("div",[t._v("            json.dump({'count': ticket_num - 1}, f)")]),o("div",[t._v("        print('%s，买到票了' % i)")]),o("div",[t._v("    else:")]),o("div",[t._v("        print('%s，没票了' % i)")]),o("div",[o("br")]),o("div",[t._v("def task(i):")]),o("div",[t._v("    search(i)")]),o("div",[t._v("    get(i)")]),o("div",[o("br")]),o("div",[t._v("if __name__ == '__main__':")]),o("div",[t._v("    for i in range(5):")]),o("div",[t._v("        p = Process(target=task, args=(i,))")]),o("div",[t._v("        p.start()")])]),o("div",[o("span",{staticStyle:{"font-size":"18.6667px"}},[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[t._v("# ticket.txt -> 执行前")]),o("div",[o("br")]),o("div",[t._v('{"count": 10}')]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("# ticket.txt -> 执行后")]),o("div",[o("br")]),o("div",[t._v('{"count": 2}')])]),o("div",[o("br")]),o("div",[o("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-family":'"Courier New"',"font-weight":"bold","line-height":"1.75"}},[t._v("2.")]),t._v(" "),o("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("使用锁的抢票例子")])]),o("div",[o("font",{staticStyle:{"font-size":"12pt"}},[o("br")])],1),o("ul",[o("li",[o("div",[o("span",{staticStyle:{"font-size":"12pt"}},[t._v("每一次只允许一个进程对票数进行查看修改，这样就不会出现上面的情况")])])])]),o("div",[o("br")]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[t._v("# 上锁后的抢票例子")]),o("div",[o("br")]),o("div",[t._v("import json")]),o("div",[t._v("import time")]),o("div",[t._v("import random")]),o("div",[t._v("from multiprocessing import Lock")]),o("div",[t._v("from multiprocessing import Process")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[o("br")])],1),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 查看还有多少票")])],1),o("div",[t._v("def search(i):")]),o("div",[t._v("    with open('ticket', encoding='utf-8') as f:")]),o("div",[t._v("        ticket_num = json.load(f)['count']")]),o("div",[t._v("        print(i, ticket_num)")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[o("font",{attrs:{color:"#41AD1C"}},[t._v("# 抢票")])],1),o("div",[t._v("def get(i):")]),o("div",[t._v("    with open('ticket', encoding='utf-8') as f:")]),o("div",[t._v("        ticket_num = json.load(f)['count']  "),o("font",{attrs:{color:"#41AD1C"}},[t._v("# 获取现有的票数")])],1),o("div",[t._v("    time.sleep(random.random()) "),o("font",{attrs:{color:"#41AD1C"}},[t._v(" # 模拟网路延时")])],1),o("div",[t._v("    if ticket_num > 0:")]),o("div",[t._v("        with open('ticket', 'w', encoding='utf-8') as f:")]),o("div",[t._v("            json.dump({'count': ticket_num - 1}, f)")]),o("div",[t._v("        print('%s，买到票了' % i)")]),o("div",[t._v("    else:")]),o("div",[t._v("        print('%s，没票了' % i)")]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("def task(i, lock):")]),o("div",[t._v("    search(i)")]),o("div",[o("br")]),o("div",[t._v("    lock.acquire()  "),o("font",{attrs:{color:"#E30000"}},[t._v("# 上锁，每次只允许一个进程进入，且上锁后就不允许其他进程进入执行 lock.acquire() 下方的代码")])],1),o("div",[t._v("    get(i)  # 执行抢票")]),o("div",[t._v("    lock.release()  "),o("font",{attrs:{color:"#E30000"}},[t._v("# 解锁，解锁后下一个进程才允许被进入执行 lock.acquire() 下方的代码")])],1),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("if __name__ == '__main__':")]),o("div",[t._v("    lock = Lock()  "),o("font",{attrs:{color:"#E30000"}},[t._v("# 获取锁")])],1),o("div",[t._v("    for i in range(10):")]),o("div",[t._v("        p = Process(target=task, args=(i, lock))")]),o("div",[t._v("        p.start()")])]),o("div",[o("br")])]),o("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[o("div",[t._v("# ticket.txt -> 执行前")]),o("div",[o("br")]),o("div",[t._v('{"count": 1}')]),o("div",[o("br")]),o("div",[o("br")]),o("div",[t._v("# ticket.txt -> 执行后")]),o("div",[o("br")]),o("div",[t._v('{"count": 0}')])]),o("div",[o("br")])])])])}),[],!1,null,null,null);i.default=e.exports}}]);