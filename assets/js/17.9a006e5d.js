(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{369:function(t,e,s){"use strict";s.r(e);var a=s(25),o=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("div",[s("span",[s("div",[s("div",[s("span",{staticStyle:{"white-space":"pre-wrap","font-size":"14pt","font-weight":"bold"}},[t._v("1.")]),s("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 本章节中所用到的表")])]),s("div",[s("span",{staticStyle:{"font-size":"14pt"}},[s("br")])]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[s("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[s("font",{attrs:{color:"#41AD1C"}},[t._v("# models.py")])],1)]),s("div",[s("span",{staticStyle:{"font-size":"9pt","font-family":"Monaco"}},[s("font",{attrs:{color:"#41AD1C"}},[s("br")])],1)]),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v("# 班级表")])],1),s("div",[t._v("class Classes(models.Model):")]),s("div",[t._v("    id = models.AutoField(primary_key=True)")]),s("div",[t._v("    name = models.CharField(max_length=10)")]),s("div",[s("br")]),s("div",[s("br")]),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v("# 教师表")])],1),s("div",[t._v("class Teacher(models.Model):")]),s("div",[t._v("    id = models.AutoField(primary_key=True)")]),s("div",[t._v("    name = models.CharField(max_length=10)")]),s("div",[t._v("    classes = models.ManyToManyField(to='Classes')")]),s("div",[s("br")]),s("div",[s("br")]),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v("# 学生表")])],1),s("div",[t._v("class Student(models.Model):")]),s("div",[t._v("    id = models.AutoField(primary_key=True)")]),s("div",[t._v("    name = models.CharField(max_length=10)")]),s("div",[t._v("    age = models.IntegerField()")]),s("div",[t._v("    classes = models.ForeignKey(to='Classes')")]),s("div",[t._v("    student_info = models.OneToOneField(to='StudentInfo')")]),s("div",[s("br")]),s("div",[s("br")]),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v("# 学生详情表")])],1),s("div",[t._v("class StudentInfo(models.Model):")]),s("div",[t._v("    address = models.CharField(max_length=32)")])]),s("div",[s("span",{staticStyle:{"white-space":"pre-wrap","font-size":"14pt"}},[s("br")])]),s("div",[s("span",{staticStyle:{"white-space":"pre-wrap","font-size":"14pt","font-weight":"bold"}},[t._v("2.")]),s("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(" 错误用法")])]),s("div",[s("br")]),s("ul",[s("li",[s("div",[t._v("不要在通过.all()方法查询到的数据中进行跨表查询，因为这样会影响性能")])])]),s("div",[s("br")]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[t._v("student_list = Student.objects.all()")]),s("div",[s("br")]),s("div",[t._v("for student in student_list:")]),s("div",[t._v("    print(student.name)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# Kevin -> 直接从student对象中获取")])]),s("div",[t._v("    print(student.age)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 18 -> 直接从student对象中获取")])]),s("div",[t._v("    print(student.classes.name)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 一班 -> 需要再执行SQL语句查询获取")]),t._v(" -> "),s("span",{staticStyle:{color:"rgb(227, 0, 0)"}},[t._v("注意: 不要在通过.all()方法查询到的数据中进行跨表查询，因为 student.name 和 student.age 都是直接在student对象中获取数据的，而执行到 student.classes.name 这里的时候就要再执行一次 SQL 查询将当前student所关联的 classes.name 查询出来，如果 student_list 有500条数据，那么 student.classes.name 就要执行500条SQL语句")])]),s("div",[s("br")]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('"""')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("    所执行的SQL语句次数")])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        select "app01_student"."id", "app01_student"."name", "app01_student"."age", "app01_student"."classes_id", "app01_student"."student_info_id" from "app01_student"; args=()')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        select "app01_classes"."id", "app01_classes"."name" from "app01_classes" where "app01_classes"."id" = 1; args=(1,)')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        select "app01_classes"."id", "app01_classes"."name" from "app01_classes" where "app01_classes"."id" = 1; args=(1,)')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        select "app01_classes"."id", "app01_classes"."name" from "app01_classes" where "app01_classes"."id" = 2; args=(2,)')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('"""')])])]),s("div",[s("br")]),s("div",[s("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("3.")]),s("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),s("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v(".select_related()")])]),s("div",[s("br")]),s("ul",[s("li",[s("div",[t._v("说明")])]),s("ul",[s("li",[s("div",[s("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[t._v("select_related主要针一对一和一对多（正向查询）关系进行优化")])])]),s("li",[s("div",[t._v("select_related使用SQL的JOIN语句进行优化，通过减少SQL查询的次数来进行优化、提高性能")])]),s("li",[s("div",[s("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"12pt",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","line-height":"1.5"}},[t._v("性能相关：表之间进行join连表操作，一次性获取关联的数据")])])])])]),s("div",[s("br")]),s("ul",[s("li",[s("div",[s("span",{staticStyle:{"font-weight":"bold"}},[t._v("不传参")]),t._v(" -> 代表当前表 join 与当前表相关联的所有表")])])]),s("div",[s("br")]),s("ul",[s("ul",[s("li",[s("div",[t._v("用法一")])])])]),s("div",[s("br")]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[t._v("student_list = Student.objects.all().select_related()")]),s("div",[s("br")]),s("div",[t._v("for student in student_list:")]),s("div",[t._v("    print(student.name) "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v(" # Kevin -> 直接从student对象中获取")])]),s("div",[t._v("    print(student.age)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 18 -> 直接从student对象中获取")])]),s("div",[t._v("    print(student.classes.name)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 一班 -> 直接从student对象中获取")])]),s("div",[t._v("    print(student.student_info.address)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 横沥 -> 直接从student对象中获取")])]),s("div",[s("br")]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('"""')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("    所执行的SQL语句次数")])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        select "app01_student"."id", "app01_student"."name", "app01_student"."age", "app01_student"."classes_id", "app01_student"."student_info_id", "app01_classes"."id", "app01_classes"."name", "app01_studentinfo"."id", "app01_studentinfo"."address" from "app01_student" inner')]),t._v(" "),s("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v('join "app01_classes"')]),t._v(" "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('on ("app01_student"."classes_id" = "app01_classes"."id") inner')]),t._v(" "),s("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v('join "app01_studentinfo"')]),t._v(" "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('on ("app01_student"."student_info_id" = "app01_studentinfo"."id"); args=()')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('"""')])])]),s("div",[s("br")]),s("ul",[s("ul",[s("li",[s("div",[t._v("用法二")])])])]),s("div",[s("br")]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 查询每个学生所在的班级")])]),s("div",[s("br")]),s("div",[t._v("ret = Student.objects.all().select_related().values('name', 'classes__name')")]),s("div",[s("br")]),s("div",[t._v("ret = Student.objects.all().select_related().filter(age=18)")])]),s("div",[s("br")]),s("ul",[s("li",[s("div",[s("span",{staticStyle:{"font-weight":"bold"}},[t._v("传参")]),t._v(" -> 代表当前表 join 指定与当前表相关联的表")])])]),s("div",[s("br")]),s("ul",[s("ul",[s("li",[s("div",[t._v("语法: .select_related('外键字段名', '外键字段名', ……)")])])])]),s("div",[s("br")]),s("ul",[s("ul",[s("li",[s("div",[t._v("用法一")])])])]),s("div",[s("br")]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[t._v("student_list = Student.objects.all().select_related('classes')")]),s("div",[s("br")]),s("div",[t._v("for student in student_list:")]),s("div",[t._v("    print(student.name)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# Kevin -> 直接从student对象中获取")])]),s("div",[t._v("    print(student.age)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 18 -> 直接从student对象中获取")])]),s("div",[t._v("    print(student.classes.name)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 一班 -> 直接从student对象中获取")])]),s("div",[s("br")]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('"""')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("    所执行的SQL语句次数")])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        SELECT "app01_student"."id", "app01_student"."name", "app01_student"."age", "app01_student"."classes_id", "app01_student"."student_info_id", "app01_classes"."id", "app01_classes"."name" FROM "app01_student" INNER')]),t._v(" "),s("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v('JOIN "app01_classes"')]),t._v(" "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('ON ("app01_student"."classes_id" = "app01_classes"."id"); args=()')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('"""')])])]),s("div",[s("br")]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[t._v("student_list = Student.objects.all().select_related('classes')")]),s("div",[s("br")]),s("div",[t._v("for student in student_list:")]),s("div",[t._v("    print(student.name)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# Kevin -> 直接从student对象中获取")])]),s("div",[t._v("    print(student.age)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 18 -> 直接从student对象中获取")])]),s("div",[t._v("    print(student.classes.name)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 一班 -> 直接从student对象中获取")])]),s("div",[t._v("    print(student.student_info.address)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 横沥 -> 需要再执行SQL语句查询获取 ->")]),t._v(" "),s("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[t._v("注意: 如果 select_related 没有指定 student_info 外键字段那么也会再执行SQL语句查询获取，和上面的错误用法的注意事项一样")])]),s("div",[s("br")]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('"""')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("    所执行的SQL语句次数")])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        SELECT "app01_student"."id", "app01_student"."name", "app01_student"."age", "app01_student"."classes_id", "app01_student"."student_info_id", "app01_classes"."id", "app01_classes"."name" FROM "app01_student" INNER')]),t._v(" "),s("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v('JOIN "app01_classes"')]),t._v(" "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('ON ("app01_student"."classes_id" = "app01_classes"."id"); args=()')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        SELECT "app01_studentinfo"."id", "app01_studentinfo"."address" FROM "app01_studentinfo" WHERE "app01_studentinfo"."id" = 1; args=(1,)')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        SELECT "app01_studentinfo"."id", "app01_studentinfo"."address" FROM "app01_studentinfo" WHERE "app01_studentinfo"."id" = 2; args=(2,)')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        SELECT "app01_studentinfo"."id", "app01_studentinfo"."address" FROM "app01_studentinfo" WHERE "app01_studentinfo"."id" = 3; args=(3,)')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('"""')])])]),s("div",[s("br")]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[t._v("student_list = Student.objects.all().select_related('classes', 'student_info')")]),s("div",[s("br")]),s("div",[t._v("for student in student_list:")]),s("div",[t._v("    print(student.name) "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v(" # Kevin -> 直接从student对象中获取")])]),s("div",[t._v("    print(student.age) "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v(" # 18 -> 直接从student对象中获取")])]),s("div",[t._v("    print(student.classes.name) "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v(" # 一班 -> 直接从student对象中获取")])]),s("div",[t._v("    print(student.student_info.address)  "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 横沥 -> 直接从student对象中获取")])]),s("div",[s("br")]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('"""')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("    所执行的SQL语句次数")])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('        SELECT "app01_student"."id", "app01_student"."name", "app01_student"."age", "app01_student"."classes_id", "app01_student"."student_info_id", "app01_classes"."id", "app01_classes"."name", "app01_studentinfo"."id", "app01_studentinfo"."address" FROM "app01_student" INNER')]),t._v(" "),s("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v('JOIN "app01_classes"')]),t._v(" "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('ON ("app01_student"."classes_id" = "app01_classes"."id") INNER')]),t._v(" "),s("span",{staticStyle:{color:"rgb(250, 122, 0)"}},[t._v('JOIN "app01_studentinfo"')]),t._v(" "),s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('ON ("app01_student"."student_info_id" = "app01_studentinfo"."id"); args=()')])]),s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v('"""')])])]),s("div",[s("br")]),s("ul",[s("ul",[s("li",[s("div",[t._v("用法二")])])])]),s("div",[s("br")]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 查询每个学生所在的班级")])]),s("div",[s("br")]),s("div",[t._v("ret = Student.objects.all().select_related('classes').values('name', 'classes__name')")]),s("div",[s("br")]),s("div",[t._v("ret = Student.objects.all().select_related('classes').filter(age=18)")])]),s("div",[s("br")]),s("div",[s("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-weight":"bold"}},[t._v("4.")]),s("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}}),s("span",{staticStyle:{"letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none","white-space":"normal",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold"}},[t._v(".prefetch_related()")])]),s("div",[s("br")]),s("ul",[s("li",[s("div",[s("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[t._v("对于多对多字段（ManyToManyField）和一对多（反向查询），可以使用prefetch_related()来进行优化")])])]),s("li",[s("div",[t._v("prefetch_related()的优化方式是分别查询每个表，然后用Python处理他们之间的关系")])]),s("li",[s("div",[s("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"12pt",color:"rgb(0, 0, 0)","font-family":'"Courier New"',"font-variant-caps":"normal","font-variant-ligatures":"normal","line-height":"1.5"}},[t._v("性能相关：多表连表操作时速度会慢，使用其执行多次SQL查询在Python代码中实现连表操作")])])])]),s("div",[s("br")]),s("ul",[s("li",[s("div",[t._v("原理")])])]),s("div",[s("br")]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[s("font",{attrs:{color:"#000000"}},[t._v("1.")]),t._v(" "),s("font",{attrs:{color:"#FA7A00"}},[t._v("select * form classes;")]),s("br")],1),s("div",[s("font",{attrs:{color:"#000000"}},[s("br")])],1),s("div",[s("font",{attrs:{color:"#000000",face:"Monaco"}},[t._v("2. 通过python代码获取id:")]),t._v(" "),s("font",{attrs:{color:"#FA7A00"}},[s("font",{attrs:{face:"Monaco"}},[t._v("c_id=[1, 2 ,3]")])],1)],1),s("div",[s("font",{attrs:{color:"#000000",face:"Monaco"}},[s("br")])],1),s("div",[s("font",{attrs:{color:"#000000",face:"Monaco"}},[t._v("3.")]),t._v(" "),s("font",{attrs:{color:"#FA7A00"}},[s("font",{attrs:{face:"Monaco"}},[t._v("select * from teacher where id in c_id")])],1)],1)]),s("div",[s("br")]),s("ul",[s("li",[s("div",[s("font",{staticStyle:{color:"rgb(255, 0, 0)"}},[t._v("错误用法")])],1)])]),s("div",[s("br")]),s("ul",[s("ul",[s("li",[s("div",[s("font",{staticStyle:{color:"rgb(255, 0, 0)"}},[t._v("注意: .prefetch_related() 一定要传参，否则和普通的.all()方法的性能一样")])],1)])])]),s("div",[s("br")]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[t._v("teacher_list = Teacher.objects.all().prefetch_related()")]),s("div",[s("br")]),s("div",[t._v("for teacher in teacher_list:")]),s("div",[t._v("    for classes in teacher.classes.all():")]),s("div",[t._v("        print(classes.name)  "),s("font",{attrs:{color:"#41AD1C"}},[t._v("# 一班")])],1),s("div",[s("br")]),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v("    所执行的SQL语句次数")])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('        SELECT "app01_teacher"."id", "app01_teacher"."name" FROM "app01_teacher"; args=()')])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('        SELECT "app01_classes"."id", "app01_classes"."name" FROM "app01_classes" INNER JOIN "app01_teacher_classes" ON ("app01_classes"."id" = "app01_teacher_classes"."classes_id") WHERE "app01_teacher_classes"."teacher_id" = 1; args=(1,)')])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('        SELECT "app01_classes"."id", "app01_classes"."name" FROM "app01_classes" INNER JOIN "app01_teacher_classes" ON ("app01_classes"."id" = "app01_teacher_classes"."classes_id") WHERE "app01_teacher_classes"."teacher_id" = 2; args=(2,)')])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('        SELECT "app01_classes"."id", "app01_classes"."name" FROM "app01_classes" INNER JOIN "app01_teacher_classes" ON ("app01_classes"."id" = "app01_teacher_classes"."classes_id") WHERE "app01_teacher_classes"."teacher_id" = 3; args=(3,)')])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1)]),s("div",[s("br")]),s("ul",[s("li",[s("div",[t._v("多对多的正向查询")])])]),s("div",[s("br")]),s("ul",[s("ul",[s("li",[s("div",[t._v("语法: .prefetch_related('类的ManyToManyField属性名', ……)")])])])]),s("div",[s("br")]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[t._v("teacher_list = Teacher.objects.all().prefetch_related('"),s("font",{attrs:{color:"#FA7A00"}},[t._v("classes")]),t._v("')")],1),s("div",[s("br")]),s("div",[t._v("for teacher in teacher_list:")]),s("div",[t._v("    for classes in teacher.classes.all():")]),s("div",[t._v("        print(classes.name)  "),s("font",{attrs:{color:"#41AD1C"}},[t._v("# 一班")])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[s("br")])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v("    所执行的SQL语句次数")])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('        select "app01_teacher"."id", "app01_teacher"."name" from "app01_teacher"; args=()')])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('        select ("app01_teacher_classes"."teacher_id") as "_prefetch_related_val_teacher_id", "app01_classes"."id", "app01_classes"."name" from "app01_classes" inner join "app01_teacher_classes" on ("app01_classes"."id" = "app01_teacher_classes"."classes_id") where "app01_teacher_classes"."teacher_id"')]),t._v(" "),s("font",{attrs:{color:"#FA7A00"}},[t._v("in (1, 2, 3)")]),s("font",{attrs:{color:"#41AD1C"}},[t._v("; args=(1, 2, 3)")])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1)]),s("div",[s("br")]),s("ul",[s("li",[s("div",[t._v("多对多的反向查询")])])]),s("div",[s("br")]),s("ul",[s("ul",[s("li",[s("div",[t._v("语法一: .prefetch_related('"),s("span",{staticStyle:{"font-size":"12pt"}},[t._v("主表的类名_set")]),t._v("', ……) ")])]),s("li",[s("div",[t._v("语法二: .prefetch_related('"),s("span",{staticStyle:{"font-size":"12pt"}},[t._v("related_name所设置的名字")]),t._v("', ……)")])])])]),s("div",[s("br")]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[t._v("classes_list = Classes.objects.all().prefetch_related('"),s("font",{attrs:{color:"#FA7A00"}},[t._v("teacher_set")]),t._v("')")],1),s("div",[s("br")]),s("div",[t._v("for classes in classes_list:")]),s("div",[t._v("    for teacher in classes.teacher_set.all():")]),s("div",[t._v("        print(teacher.name)  "),s("font",{attrs:{color:"#41AD1C"}},[t._v("# 李老师")])],1),s("div",[s("br")]),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v("    所执行的SQL语句次数")])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('        select "app01_classes"."id", "app01_classes"."name" from "app01_classes"; args=()')])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('        select ("app01_teacher_classes"."classes_id") as "_prefetch_related_val_classes_id", "app01_teacher"."id", "app01_teacher"."name" from "app01_teacher" inner join "app01_teacher_classes" on ("app01_teacher"."id" = "app01_teacher_classes"."teacher_id") where "app01_teacher_classes"."classes_id"')]),t._v(" "),s("font",{attrs:{color:"#FA7A00"}},[t._v("in (1, 2)")]),s("font",{attrs:{color:"#41AD1C"}},[t._v("; args=(1, 2)")])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1)]),s("div",[s("br")]),s("ul",[s("li",[s("div",[t._v("一对多的反向查询")])])]),s("div",[s("br")]),s("ul",[s("ul",[s("li",[s("div",[t._v("语法一: .prefetch_related('"),s("span",{staticStyle:{"font-size":"12pt"}},[t._v("主表的类名_set")]),t._v("', ……) ")])]),s("li",[s("div",[t._v("语法二: .prefetch_related('"),s("span",{staticStyle:{"font-size":"12pt"}},[t._v("related_name所设置的名字")]),t._v("', ……)")])])])]),s("div",[s("br")]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[t._v("classes_list = Classes.objects.all().prefetch_related('"),s("font",{attrs:{color:"#FA7A00"}},[t._v("student_set")]),t._v("')")],1),s("div",[s("br")]),s("div",[t._v("for classes in classes_list:")]),s("div",[t._v("    for student in classes.student_set.all():")]),s("div",[t._v("        print(student.name)  "),s("font",{attrs:{color:"#41AD1C"}},[t._v("# Kevin")])],1),s("div",[s("br")]),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v("    所执行的SQL语句次数")])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('        select "app01_classes"."id", "app01_classes"."name" from "app01_classes"; args=()')])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('        select "app01_student"."id", "app01_student"."name", "app01_student"."age", "app01_student"."classes_id", "app01_student"."student_info_id" from "app01_student" where "app01_student"."classes_id"')]),t._v(" "),s("font",{attrs:{color:"#FA7A00"}},[t._v("in (1, 2)")]),s("font",{attrs:{color:"#41AD1C"}},[t._v("; args=(1, 2)")])],1),s("div",[s("font",{attrs:{color:"#41AD1C"}},[t._v('"""')])],1)]),s("div",[s("br")]),s("ul",[s("li",[s("div",[t._v("其他用法")])])]),s("div",[s("br")]),s("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[s("div",[s("span",{staticStyle:{color:"rgb(65, 173, 28)"}},[t._v("# 查询每个班级下的学生")])]),s("div",[s("br")]),s("div",[t._v("ret = Classes.objects.prefetch_related().values('name', 'student__name')")])]),s("div",[s("br")]),s("div",[s("br")])]),s("div",[s("br")])])])])}),[],!1,null,null,null);e.default=o.exports}}]);