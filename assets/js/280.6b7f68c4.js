(window.webpackJsonp=window.webpackJsonp||[]).push([[280],{631:function(t,o,r){"use strict";r.r(o);var e=r(25),i=Object(e.a)({},(function(){var t=this,o=t.$createElement,r=t._self._c||o;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("div",[r("span",[r("div",[r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[t._v("在以后互斥锁就简称是锁，除非遇到递归锁才叫回互斥锁")])]),r("div",[r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[r("br")])]),r("div",[r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("锁:")]),t._v(" "),r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("保证多个线程修改进程中同一块数据时，同一时间只能有一个任务可以进行修改，")]),r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("即串行的修改，使用锁后速度会变慢，")]),r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("但牺牲了速度却保证了数据安全。")])]),r("div",[r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[r("br")])]),r("div",[r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[r("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("锁其实就是将异步执行变成了同步执行")])])]),r("div",[r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[r("br")])]),r("div",[r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[r("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","line-height":"1.5"}},[t._v("虽然有了GIL锁，但是在多线程中的特殊情况数据也还是不安全的，仍然要加锁")])])]),r("ul",[r("li",[r("div",[r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[r("span",{staticStyle:{"font-size":"14pt"}},[r("span",{staticStyle:{"font-size":"14pt"}},[r("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)","font-variant-caps":"normal","font-variant-ligatures":"normal","font-weight":"bold","line-height":"1.5"}},[t._v("GIL锁 是锁线程的，普通的锁是锁数据的")])])])])])]),r("li",[r("div",[r("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)"}},[t._v("正常情况下不加锁，而是使用")]),r("span",{staticStyle:{"font-size":"14pt",color:"rgb(227, 0, 0)"}},[t._v("cpython解析器 GIL 锁，数据还是安全的，但是在使用多线程去修改进程中同一个数据的时候还是加上锁比较好")])])])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[r("br")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[t._v("线程中的锁和进程中的锁使用方式还是一样的")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[r("br")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-family":'"Courier New"',"font-weight":"bold","line-height":"1.75"}},[t._v("1.")]),t._v(" "),r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("正常情况下不加锁，数据还是安全的，因为有GIL锁")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[r("br")])]),r("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[r("div",[t._v("from threading import Thread")]),r("div",[r("br")]),r("div",[t._v("def fun():")]),r("div",[t._v("    global n")]),r("div",[t._v("    n -= 1  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 多个线程修改进程中的同一个数据")])],1),r("div",[r("br")]),r("div",[t._v("n = 100")]),r("div",[t._v("for i in range(100):")]),r("div",[t._v("    t = Thread(target=fun)")]),r("div",[t._v("    t.start()")]),r("div",[t._v("print(n)  "),r("font",{attrs:{color:"#41AD1C"}},[t._v("# 0")])],1)]),r("div",[r("span",{staticStyle:{"white-space":"pre-wrap","overflow-wrap":"break-word","letter-spacing":"normal",orphans:"2","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","font-size":"14pt"}},[r("br")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt","white-space":"pre-wrap","font-family":'"Courier New"',"font-weight":"bold","line-height":"1.75"}},[t._v("2.")]),t._v(" "),r("span",{staticStyle:{"font-size":"14pt","font-weight":"bold"}},[t._v("特殊情况就要上锁")])]),r("div",[r("span",{staticStyle:{"font-size":"14pt"}},[r("br")])]),r("ul",[r("li",[r("div",[r("span",{staticStyle:{"font-size":"12pt"}},[t._v("特殊情况: 多个线程去修改进程中的同一个数据的使用，当其中一个线程拿到了数据且将该数据放到寄存器里准备开始进行运算的时候，此时时间片就开始轮转，下个线程就开始从进程中获取数据（此时的数据还是原来的数据而不是上一个线程修改后的数据，因为还没有来得及修改时间片就开始轮转）进行修改，当这个线程修改完后时间片又开始轮转回之前那个还没来得及修改的线程中继续进行修改，且此时修改的结果和他下个修改的结果是一样的，因为他们从进程中获取到的数据还是原来的数据，这样就会造成数据的混乱和进程中的数据混乱是一样的")])])])]),r("div",[r("br")]),r("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[r("div",[t._v("# 没有上锁的特殊情况")]),r("div",[r("br")]),r("div",[t._v("import time")]),r("div",[t._v("from threading import Thread")]),r("div",[r("br")]),r("div",[t._v("def fun():")]),r("div",[t._v("    global n")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[t._v(" # 特殊情况：不是用 -= ，而是拆开运算")])],1),r("div",[t._v("    temp = n")]),r("div",[t._v("    time.sleep(0.01)")]),r("div",[t._v("    n = temp - 1")]),r("div",[r("br")]),r("div",[t._v("n = 100")]),r("div",[t._v("for i in range(100):")]),r("div",[t._v("    t = Thread(target=fun)")]),r("div",[t._v("    t.start()")]),r("div",[t._v("print(n)  "),r("font",{attrs:{color:"#41AD1C"}},[t._v("# 99")])],1)]),r("div",[r("br")])]),r("div",{staticStyle:{"box-sizing":"border-box",padding:"8px","font-family":'Monaco, Menlo, Consolas, "Courier New", monospace',"font-size":"12px",color:"rgb(51, 51, 51)","border-radius":"4px","background-color":"rgb(251, 250, 248)",border:"1px solid rgba(0, 0, 0, 0.15)","-en-codeblock":"true"}},[r("div",[t._v("# 上锁解决特殊情况")]),r("div",[r("br")]),r("div",[t._v("import time")]),r("div",[t._v("from threading import Thread")]),r("div",[t._v("from threading import Lock")]),r("div",[r("br")]),r("div",[r("br")]),r("div",[t._v("def fun():")]),r("div",[t._v("    global n")]),r("div",[r("br")]),r("div",[r("font",{attrs:{color:"#41AD1C"}},[t._v("# 特殊情况：不是用 -= ，而是拆开运算")])],1),r("div",[r("br")]),r("div",[t._v("    lock.acquire() "),r("font",{attrs:{color:"#E30000"}},[t._v(" # 上锁 -> 直接调用外部的变量, 因为一个进程中的多个线程是可以直接使用这个进程中的数据，且一个py文件就相当于一个进程，")]),r("font",{attrs:{color:"#E30000"}},[t._v("不按照线程的说法: 函数本来就可以调用外部的变量和方法，因为作用域链")])],1),r("div",[t._v("    temp = n")]),r("div",[t._v("    time.sleep(0.01)")]),r("div",[t._v("    n = temp - 1")]),r("div",[t._v("    lock.release()  "),r("font",{attrs:{color:"#E30000"}},[t._v("# 解锁 -> 直接调用外部的变量, 因为一个进程中的多个线程是可以直接使用这个进程中的数据，且一个py文件就相当于一个进程，")]),r("font",{attrs:{color:"#E30000"}},[t._v("不按照线程的说法: 函数本来就可以调用外部的变量和方法，因为作用域链")])],1),r("div",[r("br")]),r("div",[r("br")]),r("div",[t._v("n = 100")]),r("div",[t._v("lock = Lock()")]),r("div",[t._v("t_list = []")]),r("div",[t._v("for i in range(100):")]),r("div",[t._v("    t = Thread(target=fun)")]),r("div",[t._v("    t.start()")]),r("div",[t._v("    t_list.append(t)")]),r("div",[t._v("[i.join() for i in t_list]  "),r("font",{attrs:{color:"#41AD1C"}},[t._v("# 等待所有子线程执行完后再往下执行")])],1),r("div",[t._v("print(n)  "),r("font",{attrs:{color:"#41AD1C"}},[t._v("# 99")])],1)]),r("div",[r("br")])])])])}),[],!1,null,null,null);o.default=i.exports}}]);